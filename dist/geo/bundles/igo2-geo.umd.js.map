{"version":3,"file":"igo2-geo.umd.js","sources":["../../../packages/geo/src/lib/metadata/shared/metadata.service.ts","../../../packages/geo/src/lib/metadata/metadata-button/metadata-button.component.html","../../../packages/geo/src/lib/metadata/metadata-button/metadata-abstract.component.html","../../../packages/geo/src/lib/metadata/metadata-button/metadata-button.component.ts","../../../packages/geo/src/lib/metadata/metadata.module.ts","../../../node_modules/tslib/tslib.es6.js","../../../packages/geo/src/lib/feature/shared/feature.enums.ts","../../../packages/geo/src/lib/layer/utils/image-watcher.ts","../../../packages/geo/src/lib/layer/utils/layer.utils.ts","../../../packages/geo/src/lib/layer/shared/layers/layer.interface.ts","../../../packages/geo/src/lib/utils/id-generator.ts","../../../packages/geo/src/lib/datasource/shared/datasources/datasource.ts","../../../packages/geo/src/lib/filter/shared/ogc-filter.enum.ts","../../../packages/geo/src/lib/filter/shared/ogc-filter.ts","../../../packages/geo/src/lib/query/shared/query.enums.ts","../../../packages/geo/src/lib/datasource/shared/datasources/wms-wfs.utils.ts","../../../packages/geo/src/lib/datasource/shared/datasources/wms-datasource.ts","../../../packages/geo/src/lib/layer/utils/layerSync-watcher.ts","../../../packages/geo/src/lib/layer/utils/tile-watcher.ts","../../../packages/geo/src/lib/layer/utils/outputLegend.ts","../../../packages/geo/src/lib/datasource/shared/datasources/feature-datasource.ts","../../../packages/geo/src/lib/datasource/shared/datasources/cluster-datasource.ts","../../../packages/geo/src/lib/layer/utils/vector-watcher.ts","../../../packages/geo/src/lib/map/shared/map.utils.ts","../../../packages/geo/src/lib/layer/shared/layers/layer.ts","../../../packages/geo/src/lib/layer/shared/layers/vector-layer.ts","../../../packages/geo/src/lib/datasource/shared/datasources/data.service.ts","../../../packages/geo/src/lib/datasource/shared/datasources/osm-datasource.ts","../../../packages/geo/src/lib/datasource/shared/datasources/xyz-datasource.ts","../../../packages/geo/src/lib/datasource/shared/datasources/wfs-datasource.ts","../../../packages/geo/src/lib/datasource/shared/datasources/wfs.service.ts","../../../packages/geo/src/lib/datasource/utils/tilegrid.ts","../../../packages/geo/src/lib/datasource/shared/datasources/wmts-datasource.ts","../../../packages/geo/src/lib/datasource/shared/datasources/carto-datasource.ts","../../../packages/geo/src/lib/datasource/shared/datasources/arcgisrest-datasource.ts","../../../packages/geo/src/lib/datasource/shared/datasources/imagearcgisrest-datasource.ts","../../../packages/geo/src/lib/datasource/shared/datasources/tilearcgisrest-datasource.ts","../../../packages/geo/src/lib/datasource/shared/datasources/tiledebug-datasource.ts","../../../packages/geo/src/lib/datasource/shared/datasources/websocket-datasource.ts","../../../packages/geo/src/lib/datasource/shared/datasources/mvt-datasource.ts","../../../packages/geo/src/lib/datasource/utils/esri-style-generator.ts","../../../packages/geo/src/lib/filter/shared/time-filter.enum.ts","../../../packages/geo/src/lib/map/shared/map.service.ts","../../../packages/geo/src/lib/datasource/shared/capabilities.service.ts","../../../packages/geo/src/lib/datasource/shared/options/options.service.ts","../../../packages/geo/src/lib/map/shared/projection.service.ts","../../../packages/geo/src/lib/datasource/shared/datasource.service.ts","../../../packages/geo/src/lib/datasource/shared/options/options-api.service.ts","../../../packages/geo/src/lib/datasource/shared/options/options-api.providers.ts","../../../packages/geo/src/lib/feature/shared/feature.utils.ts","../../../packages/geo/src/lib/feature/shared/store.ts","../../../packages/geo/src/lib/feature/shared/strategies/in-map-extent.ts","../../../packages/geo/src/lib/feature/shared/strategies/in-map-resolution.ts","../../../packages/geo/src/lib/feature/shared/strategies/loading.ts","../../../packages/geo/src/lib/feature/shared/strategies/loading-layer.ts","../../../packages/geo/src/lib/feature/shared/strategies/selection.ts","../../../packages/geo/src/lib/feature/shared/strategies.utils.ts","../../../packages/geo/src/lib/overlay/shared/overlay-marker-style.utils.ts","../../../packages/geo/src/lib/layer/shared/style.service.ts","../../../packages/geo/src/lib/overlay/shared/overlay.utils.ts","../../../packages/geo/src/lib/overlay/shared/overlay.ts","../../../packages/geo/src/lib/map/utils/layer-watcher.ts","../../../packages/geo/src/lib/map/shared/map.enums.ts","../../../packages/geo/src/lib/map/shared/controllers/controller.ts","../../../packages/geo/src/lib/map/shared/controllers/view.ts","../../../packages/geo/src/lib/map/shared/map.ts","../../../packages/geo/src/lib/map/map-browser/map-browser.component.ts","../../../packages/geo/src/lib/map/map-browser/map-browser.component.html","../../../packages/geo/src/lib/map/shared/mapOffline.directive.ts","../../../packages/geo/src/lib/map/shared/map-pointer-position.directive.ts","../../../packages/geo/src/lib/layer/shared/layers/image-layer.ts","../../../packages/geo/src/lib/layer/shared/layers/tile-layer.ts","../../../packages/geo/src/lib/layer/shared/layers/vectortile-layer.ts","../../../packages/geo/src/lib/map/shared/hover-feature.directive.ts","../../../packages/geo/src/lib/map/shared/projection.utils.ts","../../../packages/geo/src/lib/map/zoom-button/zoom-button.component.ts","../../../packages/geo/src/lib/map/zoom-button/zoom-button.component.html","../../../packages/geo/src/lib/map/menu-button/menu-button.component.ts","../../../packages/geo/src/lib/map/menu-button/menu-button.component.html","../../../packages/geo/src/lib/map/geolocate-button/geolocate-button.component.ts","../../../packages/geo/src/lib/map/geolocate-button/geolocate-button.component.html","../../../packages/geo/src/lib/map/home-extent-button/home-extent-button.component.ts","../../../packages/geo/src/lib/map/home-extent-button/home-extent-button.component.html","../../../packages/geo/src/lib/map/offline-button/offline-button.component.html","../../../packages/geo/src/lib/map/offline-button/offline-button.component.ts","../../../packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.animation.ts","../../../packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.component.html","../../../packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.component.ts","../../../packages/geo/src/lib/layer/shared/layer.service.ts","../../../packages/geo/src/lib/map/baselayers-switcher/mini-basemap.component.html","../../../packages/geo/src/lib/map/baselayers-switcher/mini-basemap.component.ts","../../../packages/geo/src/lib/map/rotation-button/rotation-button.component.html","../../../packages/geo/src/lib/map/rotation-button/rotation-button.component.ts","../../../packages/geo/src/lib/map/swipe-control/swipe-control.component.ts","../../../packages/geo/src/lib/map/swipe-control/swipe-control.component.html","../../../packages/geo/src/lib/map/map-center/map-center.component.ts","../../../packages/geo/src/lib/map/map-center/map-center.component.html","../../../packages/geo/src/lib/map/info-section/info-section.component.html","../../../packages/geo/src/lib/map/info-section/info-section.component.ts","../../../packages/geo/src/lib/catalog/shared/catalog.enum.ts","../../../packages/geo/src/lib/catalog/shared/catalog.abstract.ts","../../../packages/geo/src/lib/query/shared/query.service.ts","../../../packages/geo/src/lib/query/shared/query.utils.ts","../../../packages/geo/src/lib/query/shared/query.directive.ts","../../../packages/geo/src/lib/search/shared/sources/source.ts","../../../packages/geo/src/lib/query/shared/query-search-source.ts","../../../packages/geo/src/lib/utils/googleLinks.ts","../../../packages/geo/src/lib/utils/commonVectorStyle.ts","../../../packages/geo/src/lib/utils/osmLinks.ts","../../../packages/geo/src/lib/catalog/shared/catalog.service.ts","../../../packages/geo/src/lib/catalog/catalog-browser/catalog-browser.component.html","../../../packages/geo/src/lib/catalog/catalog-browser/catalog-browser.component.ts","../../../packages/geo/src/lib/layer/layer-legend/layer-legend.component.html","../../../packages/geo/src/lib/layer/layer-legend/layer-legend.component.ts","../../../packages/geo/src/lib/catalog/catalog-browser/catalog-browser-layer.component.html","../../../packages/geo/src/lib/catalog/catalog-browser/catalog-browser-layer.component.ts","../../../packages/geo/src/lib/catalog/catalog-browser/catalog-browser-group.component.html","../../../packages/geo/src/lib/catalog/catalog-browser/catalog-browser-group.component.ts","../../../packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.service.ts","../../../packages/geo/src/lib/layer/layer-item/layer-item.component.html","../../../packages/geo/src/lib/layer/layer-item/layer-item.component.ts","../../../packages/geo/src/lib/layer/layer-list/layer-list.enum.ts","../../../packages/geo/src/lib/layer/layer-list/layer-list.component.html","../../../packages/geo/src/lib/layer/layer-list/layer-list.component.ts","../../../packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.component.html","../../../packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.component.ts","../../../packages/geo/src/lib/layer/layer-list/layer-list-binding.directive.ts","../../../packages/geo/src/lib/layer/layer-legend-list/layer-legend-list.component.html","../../../packages/geo/src/lib/layer/layer-legend-list/layer-legend-list.component.ts","../../../packages/geo/src/lib/layer/layer-legend-list/layer-legend-list-binding.directive.ts","../../../packages/geo/src/lib/layer/track-feature-button/track-feature-button.component.html","../../../packages/geo/src/lib/layer/track-feature-button/track-feature-button.component.ts","../../../packages/geo/src/lib/layer/layer-legend-item/layer-legend-item.component.ts","../../../packages/geo/src/lib/layer/layer-legend-item/layer-legend-item.component.html","../../../packages/geo/src/lib/layer/layer.module.ts","../../../packages/geo/src/lib/catalog/catalog-browser/catalog-browser.module.ts","../../../packages/geo/src/lib/catalog/catalog-library/add-catalog-dialog.component.html","../../../packages/geo/src/lib/catalog/catalog-library/add-catalog-dialog.component.ts","../../../packages/geo/src/lib/catalog/catalog-library/catalog-library.component.html","../../../packages/geo/src/lib/catalog/catalog-library/catalog-library.component.ts","../../../packages/geo/src/lib/catalog/catalog-library/catalog-library-item.component.html","../../../packages/geo/src/lib/catalog/catalog-library/catalog-library-item.component.ts","../../../packages/geo/src/lib/catalog/catalog-library/catalog-library.module.ts","../../../packages/geo/src/lib/catalog/catalog.module.ts","../../../packages/geo/src/lib/datasource/datasource.module.ts","../../../packages/geo/src/lib/filter/shared/filterable-datasource.pipe.ts","../../../packages/geo/src/lib/filter/shared/time-filter.service.ts","../../../packages/geo/src/lib/filter/shared/ogc-filter.service.ts","../../../packages/geo/src/lib/filter/shared/spatial-filter.enum.ts","../../../packages/geo/src/lib/filter/shared/spatial-filter.service.ts","../../../packages/geo/src/lib/download/shared/download.service.ts","../../../packages/geo/src/lib/download/download-button/download-button.component.html","../../../packages/geo/src/lib/download/download-button/download-button.component.ts","../../../packages/geo/src/lib/download/download.module.ts","../../../packages/geo/src/lib/feature/feature-details/feature-details.component.html","../../../packages/geo/src/lib/feature/feature-details/feature-details.component.ts","../../../packages/geo/src/lib/feature/feature-form/feature-form.component.ts","../../../packages/geo/src/lib/feature/feature-form/feature-form.component.html","../../../packages/geo/src/lib/draw/shared/draw.enum.ts","../../../packages/geo/src/lib/geometry/shared/geometry.errors.ts","../../../packages/geo/src/lib/geometry/shared/geometry.utils.ts","../../../packages/geo/src/lib/geometry/shared/controls/draw.ts","../../../packages/geo/src/lib/draw/draw/draw-popup.component.ts","../../../packages/geo/src/lib/draw/draw/draw-popup.component.html","../../../packages/geo/src/lib/draw/draw/draw-shorcuts.component.ts","../../../packages/geo/src/lib/draw/draw/draw-shorcuts.component.html","../../../packages/geo/src/lib/measure/shared/measure.enum.ts","../../../packages/geo/src/lib/measure/shared/measure.utils.ts","../../../packages/geo/src/lib/draw/shared/draw.utils.ts","../../../packages/geo/src/lib/draw/shared/draw-style.service.ts","../../../packages/geo/src/lib/draw/shared/draw-icon.service.ts","../../../packages/geo/src/lib/draw/draw/draw.component.html","../../../packages/geo/src/lib/draw/draw/draw.component.ts","../../../packages/geo/src/lib/draw/draw/draw.module.ts","../../../packages/geo/src/lib/draw/drawingTool.module.ts","../../../packages/geo/src/lib/feature/feature-details/feature-details.directive.ts","../../../packages/geo/src/lib/feature/feature-details/feature-details.module.ts","../../../packages/geo/src/lib/feature/feature-form/feature-form.module.ts","../../../packages/geo/src/lib/feature/feature.module.ts","../../../packages/geo/src/lib/geometry/shared/controls/modify.ts","../../../packages/geo/src/lib/geometry/shared/controls/slice.ts","../../../packages/geo/src/lib/layer/shared/layer.enums.ts","../../../packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.enum.ts","../../../packages/geo/src/lib/measure/measurer/measurer-dialog.component.html","../../../packages/geo/src/lib/measure/measurer/measurer-dialog.component.ts","../../../packages/geo/src/lib/measure/measurer/measurer.component.html","../../../packages/geo/src/lib/measure/measurer/measurer.component.ts","../../../packages/geo/src/lib/measure/measurer/measure-format.pipe.ts","../../../packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field-input.component.ts","../../../packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field-input.component.html","../../../packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field.component.html","../../../packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field.component.ts","../../../packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field.module.ts","../../../packages/geo/src/lib/geometry/geometry.module.ts","../../../packages/geo/src/lib/filter/time-filter-button/time-filter-button.component.html","../../../packages/geo/src/lib/filter/time-filter-button/time-filter-button.component.ts","../../../packages/geo/src/lib/filter/time-filter-form/time-filter-form.component.html","../../../packages/geo/src/lib/filter/time-filter-form/time-filter-form.component.ts","../../../packages/geo/src/lib/filter/time-filter-item/time-filter-item.component.html","../../../packages/geo/src/lib/filter/time-filter-item/time-filter-item.component.ts","../../../packages/geo/src/lib/filter/time-filter-list/time-filter-list.component.html","../../../packages/geo/src/lib/filter/time-filter-list/time-filter-list.component.ts","../../../packages/geo/src/lib/filter/time-filter-list/time-filter-list-binding.directive.ts","../../../packages/geo/src/lib/wkt/shared/wkt.service.ts","../../../packages/geo/src/lib/filter/ogc-filter-form/ogc-filter-form.component.html","../../../packages/geo/src/lib/filter/ogc-filter-form/ogc-filter-form.component.ts","../../../packages/geo/src/lib/filter/ogc-filterable-form/ogc-filterable-form.component.html","../../../packages/geo/src/lib/filter/ogc-filterable-form/ogc-filterable-form.component.ts","../../../packages/geo/src/lib/filter/ogc-filterable-item/ogc-filterable-item.component.html","../../../packages/geo/src/lib/filter/ogc-filterable-item/ogc-filterable-item.component.ts","../../../packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list.component.html","../../../packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list.component.ts","../../../packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list-binding.directive.ts","../../../packages/geo/src/lib/filter/ogc-filter-button/ogc-filter-button.component.html","../../../packages/geo/src/lib/filter/ogc-filter-button/ogc-filter-button.component.ts","../../../packages/geo/src/lib/filter/shared/ogc-filter-time.service.ts","../../../packages/geo/src/lib/filter/ogc-filter-selection/ogc-filter-selection.component.html","../../../packages/geo/src/lib/filter/ogc-filter-selection/ogc-filter-selection.component.ts","../../../packages/geo/src/lib/filter/spatial-filter/spatial-filter-type/spatial-filter-type.component.html","../../../packages/geo/src/lib/filter/spatial-filter/spatial-filter-type/spatial-filter-type.component.ts","../../../packages/geo/src/lib/filter/spatial-filter/spatial-filter-list/spatial-filter-list.component.html","../../../packages/geo/src/lib/filter/spatial-filter/spatial-filter-list/spatial-filter-list.component.ts","../../../packages/geo/src/lib/filter/spatial-filter/spatial-filter-item/spatial-filter-item.component.html","../../../packages/geo/src/lib/filter/spatial-filter/spatial-filter-item/spatial-filter-item.component.ts","../../../packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time.component.html","../../../packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time.component.ts","../../../packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time-slider.component.ts","../../../packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time-slider.component.html","../../../packages/geo/src/lib/filter/filter.module.ts","../../../packages/geo/src/lib/import-export/export-button/export-button.component.html","../../../packages/geo/src/lib/import-export/export-button/export-button.component.ts","../../../packages/geo/src/lib/import-export/shared/export.errors.ts","../../../packages/geo/src/lib/import-export/shared/export.utils.ts","../../../packages/geo/src/lib/import-export/shared/export.type.ts","../../../packages/geo/src/lib/import-export/shared/export.service.ts","../../../packages/geo/src/lib/import-export/shared/import.utils.ts","../../../packages/geo/src/lib/import-export/shared/import.errors.ts","../../../packages/geo/src/lib/import-export/shared/import.service.ts","../../../packages/geo/src/lib/import-export/style-list/style-list.service.ts","../../../packages/geo/src/lib/import-export/import-export/import-export.component.html","../../../packages/geo/src/lib/import-export/import-export/import-export.component.ts","../../../packages/geo/src/lib/import-export/shared/drop-geo-file.directive.ts","../../../packages/geo/src/lib/import-export/style-list/style-list.provider.ts","../../../packages/geo/src/lib/import-export/style-list/style-list.module.ts","../../../packages/geo/src/lib/import-export/import-export.module.ts","../../../packages/geo/src/lib/map/map.module.ts","../../../packages/geo/src/lib/measure/measurer/measurer-item.component.html","../../../packages/geo/src/lib/measure/measurer/measurer-item.component.ts","../../../packages/geo/src/lib/measure/measurer/measurer.module.ts","../../../packages/geo/src/lib/measure/measure.module.ts","../../../packages/geo/src/lib/overlay/shared/overlay.enum.ts","../../../packages/geo/src/lib/overlay/shared/overlay.service.ts","../../../packages/geo/src/lib/overlay/shared/overlay.directive.ts","../../../packages/geo/src/lib/overlay/overlay.module.ts","../../../packages/geo/src/lib/print/shared/print.service.ts","../../../packages/geo/src/lib/print/shared/print.type.ts","../../../packages/geo/src/lib/print/print-form/print-form.component.html","../../../packages/geo/src/lib/print/print-form/print-form.component.ts","../../../packages/geo/src/lib/print/print/print.component.ts","../../../packages/geo/src/lib/print/print/print.component.html","../../../packages/geo/src/lib/print/print.module.ts","../../../packages/geo/src/lib/query/shared/query-search-source.providers.ts","../../../packages/geo/src/lib/query/query.module.ts","../../../packages/geo/src/lib/directions/directions-sources/directions-source.ts","../../../packages/geo/src/lib/directions/shared/directions-source.service.ts","../../../packages/geo/src/lib/directions/shared/directions.enum.ts","../../../packages/geo/src/lib/directions/shared/directions.utils.ts","../../../packages/geo/src/lib/directions/directions-inputs/directions-inputs.component.html","../../../packages/geo/src/lib/directions/directions-inputs/directions-inputs.component.ts","../../../packages/geo/src/lib/directions/shared/directions.service.ts","../../../packages/geo/src/lib/search/shared/search.utils.ts","../../../packages/geo/src/lib/search/shared/search-source.service.ts","../../../packages/geo/src/lib/search/shared/search.service.ts","../../../packages/geo/src/lib/directions/directions-buttons/directions-buttons.component.html","../../../packages/geo/src/lib/directions/directions-buttons/directions-buttons.component.ts","../../../packages/geo/src/lib/directions/directions-results/directions-results.component.html","../../../packages/geo/src/lib/directions/directions-results/directions-results.component.ts","../../../packages/geo/src/lib/directions/directions.component.ts","../../../packages/geo/src/lib/directions/directions.component.html","../../../packages/geo/src/lib/directions/directions.module.ts","../../../packages/geo/src/lib/search/shared/search-source-service.providers.ts","../../../packages/geo/src/lib/search/shared/sources/icherche.ts","../../../packages/geo/src/lib/search/shared/sources/icherche.providers.ts","../../../packages/geo/src/lib/search/shared/sources/coordinates.ts","../../../packages/geo/src/lib/search/shared/sources/coordinates.providers.ts","../../../packages/geo/src/lib/search/shared/sources/ilayer.ts","../../../packages/geo/src/lib/search/shared/sources/ilayer.providers.ts","../../../packages/geo/src/lib/search/shared/search.enums.ts","../../../packages/geo/src/lib/search/search-selector/search-selector.component.html","../../../packages/geo/src/lib/search/search-selector/search-selector.component.ts","../../../packages/geo/src/lib/search/search-selector/search-selector.module.ts","../../../packages/geo/src/lib/search/search-settings/search-settings.component.html","../../../packages/geo/src/lib/search/search-settings/search-settings.component.ts","../../../packages/geo/src/lib/search/search-settings/search-settings.module.ts","../../../packages/geo/src/lib/search/search-bar/search-bar.component.html","../../../packages/geo/src/lib/search/search-bar/search-bar.component.ts","../../../packages/geo/src/lib/search/search-bar/search-url-param.directive.ts","../../../packages/geo/src/lib/search/search-bar/search-bar.module.ts","../../../packages/geo/src/lib/search/search-results/search-results-item.component.html","../../../packages/geo/src/lib/search/search-results/search-results-item.component.ts","../../../packages/geo/src/lib/search/search-results/search-results.component.html","../../../packages/geo/src/lib/search/search-results/search-results.component.ts","../../../packages/geo/src/lib/search/search-results/search-results-add-button.component.html","../../../packages/geo/src/lib/search/search-results/search-results-add-button.component.ts","../../../packages/geo/src/lib/search/search-results/search-results.module.ts","../../../packages/geo/src/lib/search/shared/search-pointer-summary.directive.ts","../../../packages/geo/src/lib/search/search.module.ts","../../../packages/geo/src/lib/toast/toast.component.html","../../../packages/geo/src/lib/toast/toast.component.ts","../../../packages/geo/src/lib/toast/toast.module.ts","../../../packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.component.ts","../../../packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.component.html","../../../packages/geo/src/lib/workspace/widgets/widgets.ts","../../../packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.module.ts","../../../packages/geo/src/lib/workspace/shared/wfs-workspace.ts","../../../packages/geo/src/lib/workspace/shared/wfs-workspace.service.ts","../../../packages/geo/src/lib/workspace/shared/wms-workspace.service.ts","../../../packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.component.ts","../../../packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.component.html","../../../packages/geo/src/lib/workspace/shared/edition-workspace.ts","../../../packages/geo/src/lib/workspace/shared/edition-workspace.service.ts","../../../packages/geo/src/lib/workspace/shared/feature-workspace.ts","../../../packages/geo/src/lib/workspace/shared/feature-workspace.service.ts","../../../packages/geo/src/lib/workspace/workspace-selector/workspace-selector.directive.ts","../../../packages/geo/src/lib/workspace/workspace-selector/workspace-selector.module.ts","../../../packages/geo/src/lib/workspace/workspace-updator/workspace-updator.directive.ts","../../../packages/geo/src/lib/workspace/workspace-updator/workspace-updator.module.ts","../../../packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.module.ts","../../../packages/geo/src/lib/workspace/workspace.module.ts","../../../packages/geo/src/lib/wkt/wkt.module.ts","../../../packages/geo/src/lib/geo.module.ts","../../../packages/geo/src/lib/directions/shared/store.ts","../../../packages/geo/src/lib/directions/directions-sources/osrm-directions-source.ts","../../../packages/geo/src/lib/directions/directions-sources/directions-source.provider.ts","../../../packages/geo/src/lib/search/shared/sources/cadastre.ts","../../../packages/geo/src/lib/search/shared/sources/cadastre.providers.ts","../../../packages/geo/src/lib/search/shared/sources/nominatim.ts","../../../packages/geo/src/lib/search/shared/sources/nominatim.providers.ts","../../../packages/geo/src/lib/search/shared/sources/storedqueries.ts","../../../packages/geo/src/lib/search/shared/sources/storedqueries.providers.ts","../../../packages/geo/src/lib/workspace/shared/workspace.utils.ts","../../../packages/geo/src/public_api.ts","../../../packages/geo/src/igo2-geo.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\n\nimport { MetadataOptions } from './metadata.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class MetadataService {\n  constructor() {}\n\n  open(metadata: MetadataOptions) {\n    if (metadata.extern) {\n      window.open(metadata.url, '_blank');\n    }\n  }\n}\n","<button\n  *ngIf=\"(options && options.metadata && options.metadata.url) || (options && options.metadata && options.metadata.abstract)\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.metadata.show' | translate\"\n  [color]=\"color\"\n  (click)=\"openMetadata(options.metadata)\">\n  <mat-icon svgIcon=\"information-outline\"></mat-icon>\n</button>\n","<h2 mat-dialog-title>{{ data.layerTitle }}</h2>\n<button class=\"close-button\" mat-button mat-dialog-close>X</button>\n<mat-dialog-content *ngIf=\"data.type !== 'arcgisrest'\" class=\"mat-typography\">\n  <h3>{{ data.abstract }}</h3>\n</mat-dialog-content>\n<mat-dialog-content *ngIf=\"data.type === 'arcgisrest'\" class=\"mat-typography\">\n  <h3 [innerHTML]=\"data.abstract\"></h3>\n</mat-dialog-content>\n","import { Component, Input, ChangeDetectionStrategy, Inject, ViewEncapsulation } from '@angular/core';\nimport { MatDialog, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\nimport {\n  MetadataOptions,\n  MetadataLayerOptions\n} from '../shared/metadata.interface';\nimport { MetadataService } from '../shared/metadata.service';\n\n@Component({\n  selector: 'igo-metadata-button',\n  templateUrl: './metadata-button.component.html',\n  styleUrls: ['./metadata-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MetadataButtonComponent {\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n  }\n  private _layer: Layer;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor(\n    private metadataService: MetadataService,\n    private dialog: MatDialog) {}\n\n  openMetadata(metadata: MetadataOptions) {\n    if (metadata.extern) {\n      this.metadataService.open(metadata);\n    } else if (!metadata.extern && metadata.abstract) {\n      this.dialog.open(MetadataAbstractComponent, {\n        data: {\n          layerTitle: this.layer.title,\n          abstract: metadata.abstract,\n          type: metadata.type\n        }\n      });\n    }\n  }\n\n  get options(): MetadataLayerOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.options;\n  }\n}\n\n@Component({\n  selector: 'igo-metadata-abstract',\n  templateUrl: './metadata-abstract.component.html',\n  styleUrls: ['./metadata-abstract.component.scss'],\n  encapsulation: ViewEncapsulation.None\n})\nexport class MetadataAbstractComponent {\n  constructor(@Inject(MAT_DIALOG_DATA) public data: MetadataOptions) {}\n}\n","import { MatDialogModule } from '@angular/material/dialog';\nimport { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { MetadataButtonComponent, MetadataAbstractComponent } from './metadata-button/metadata-button.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule,\n    IgoLanguageModule,\n    MatDialogModule\n  ],\n  exports: [\n    MetadataButtonComponent,\n    MetadataAbstractComponent],\n  declarations: [\n    MetadataButtonComponent,\n    MetadataAbstractComponent]\n})\nexport class IgoMetadataModule {\n  static forRoot(): ModuleWithProviders<IgoMetadataModule> {\n    return {\n      ngModule: IgoMetadataModule,\n      providers: []\n    };\n  }\n}\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n","export const FEATURE = 'Feature';\n\nexport enum FeatureMotion {\n  None,\n  Move,\n  Zoom,\n  Default\n}\n","import olSourceImage from 'ol/source/Image';\nimport { uuid, Watcher, SubjectStatus } from '@igo2/utils';\nimport { LanguageService, MessageService } from '@igo2/core';\nimport { ImageLayer } from '../shared/layers/image-layer';\n\n\nexport class ImageWatcher extends Watcher {\n  protected id: string;\n  protected loaded = 0;\n  protected loading = 0;\n\n  private source: olSourceImage;\n\n  private messageService: MessageService;\n  private languageService: LanguageService;\n\n  constructor(layer: ImageLayer, messageService: MessageService, languageService: LanguageService) {\n    super();\n    this.source = layer.options.source.ol;\n    this.id = uuid();\n    this.messageService = messageService;\n    this.languageService = languageService;\n  }\n\n  protected watch() {\n    this.source.on(`imageloadstart`, e => this.handleLoadStart(e));\n    this.source.on(`imageloadend`, e => this.handleLoadEnd(e));\n    this.source.on(`imageloaderror`, e => this.handleLoadEnd(e));\n    this.source.on(`imageloaderror`, e => this.handleLoadError(e));\n  }\n\n  protected unwatch() {\n    this.source.un(`imageloadstart`, e => this.handleLoadStart(e));\n    this.source.un(`imageloadend`, e => this.handleLoadEnd(e));\n    this.source.un(`imageloaderror`, e => this.handleLoadEnd(e));\n    this.source.un(`imageloaderror`, e => this.handleLoadError(e));\n  }\n\n  private handleLoadStart(event: any) {\n    if (!event.image.__watchers__) {\n      event.image.__watchers__ = [];\n    }\n    event.image.__watchers__.push(this.id);\n\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event) {\n    if (!event.image.__watchers__) {\n      return;\n    }\n\n    const watcherIndex = event.image.__watchers__.indexOf(this.id);\n    if (watcherIndex < 0) {\n      return;\n    }\n\n    event.image.__watchers__.splice(watcherIndex, 1);\n\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n\n  private handleLoadError(event) {\n\n    if (!event.image.__watchers__) {\n      return;\n    }\n    const title = this.languageService.translate.instant(\n      'igo.geo.dataSource.unavailableTitle'\n    );\n    const message = this.languageService.translate.instant(\n      'igo.geo.dataSource.unavailable', {value: event.target.params_.LAYERS}\n    );\n\n    this.messageService.error(message, title);\n    this.loaded = -1;\n    this.loading = 0;\n    this.status = SubjectStatus.Error;\n\n  }\n}\n","import { AnyLayerOptions } from \"../shared/layers/any-layer.interface\";\nimport { VectorTileLayerOptions } from \"../shared/layers/vectortile-layer.interface\";\n\n\nexport function computeMVTOptionsOnHover(layerOptions: AnyLayerOptions) {\n  const vectorTileLayerOptions = layerOptions as VectorTileLayerOptions;\n  if (\n    vectorTileLayerOptions.sourceOptions?.type === 'mvt' &&\n    (vectorTileLayerOptions.styleByAttribute?.hoverStyle || vectorTileLayerOptions.hoverStyle)) {\n    const fc = vectorTileLayerOptions.sourceOptions.featureClass;\n    vectorTileLayerOptions.sourceOptions.featureClass = fc ? fc : 'feature';\n  }\n  return layerOptions;\n}\n","import olLayer from 'ol/layer/Layer';\nimport olSource from 'ol/source/Source';\nimport { Message } from '@igo2/core';\n\nimport { DataSource } from '../../../datasource/shared/datasources/datasource';\nimport { AnyDataSourceOptions } from '../../../datasource/shared/datasources/any-datasource.interface';\nimport { MapExtent, MapViewOptions } from '../../../map/shared/map.interface';\n\nexport interface LayerOptions {\n  isIgoInternalLayer?: boolean; // useful when mapOffline directive set the resolution of the layers.\n  source?: DataSource;\n  sourceOptions?: AnyDataSourceOptions;\n  title?: string;\n  id?: string;\n  alias?: string;\n  baseLayer?: boolean;\n  opacity?: number;\n  visible?: boolean;\n  extent?: MapExtent;\n  zIndex?: number;\n  messages?: Message[];\n  minResolution?: number;\n  maxResolution?: number;\n  minScaleDenom?: number;\n  maxScaleDenom?: number;\n  showInLayerList?: boolean;\n  removable?: boolean;\n  workspace?: GeoWorkspaceOptions;\n  legendOptions?: LegendOptions;\n  ol?: olLayer<olSource>;\n  tooltip?: TooltipContent;\n  _internal?: { [key: string]: string };\n  active?: boolean;\n  check?: boolean;\n  linkedLayers?: LayersLink;\n}\n\nexport interface GeoWorkspaceOptions {\n  srcId?: string;\n  workspaceId?: string;\n  minResolution?: number;\n  maxResolution?: number;\n  enabled?: boolean;\n  queryOptions?: GeoWorkspaceQueryOptions;\n  pageSize?: number;\n  pageSizeOptions?: number[];\n}\n\nexport interface GeoWorkspaceQueryOptions {\n  mapQueryOnOpenTab?: boolean;\n  tabQuery?: boolean;\n}\n\nexport interface LayersLink {\n  linkId: string;\n  links?: LayersLinkProperties[];\n}\nexport interface LayersLinkProperties {\n  bidirectionnal?: boolean;\n  linkedIds: string[];\n  syncedDelete: boolean;\n  properties: LinkedProperties[];\n}\n\nexport enum LinkedProperties {\n  OPACITY = 'opacity',\n  VISIBLE = 'visible',\n  OGCFILTERS = 'ogcFilters',\n  MINRESOLUTION = 'minResolution',\n  MAXRESOLUTION = 'maxResolution',\n  ZINDEX = 'zIndex',\n  TIMEFILTER = 'timeFilter'\n}\n\nexport interface GroupLayers {\n  title: string;\n  layers?: LayerOptions;\n  collapsed?: boolean;\n}\n\nexport interface TooltipContent {\n  type?: TooltipType;\n  text?: string;\n}\nexport enum TooltipType {\n  TITLE = 'title',\n  ABSTRACT = 'abstract',\n  CUSTOM = 'custom'\n}\n\nexport interface LegendOptions {\n  collapsed?: boolean;\n  display?: boolean;\n  url?: string;\n  html?: string;\n  stylesAvailable?: ItemStyleOptions[];\n}\n\nexport interface LegendMapViewOptions extends MapViewOptions{\n  scale?: number;\n  size?: [number, number];\n}\n\nexport interface ItemStyleOptions {\n  name: string;\n  title?: string;\n}\n\nexport interface OutputLayerLegend {\n  title: string;\n  url: string;\n}\n","import { ArcGISRestDataSourceOptions } from './../datasource/shared/datasources/arcgisrest-datasource.interface';\nimport { Md5 } from 'ts-md5';\n\nimport { uuid } from '@igo2/utils';\n\nimport { AnyDataSourceOptions } from '../datasource/shared/datasources/any-datasource.interface';\nimport { DataSourceOptions } from '../datasource/shared/datasources/datasource.interface';\nimport { WMSDataSourceOptions } from '../datasource/shared/datasources/wms-datasource.interface';\nimport { WMTSDataSourceOptions } from '../datasource/shared/datasources/wmts-datasource.interface';\nimport { WFSDataSourceOptions } from '../datasource';\n\n/**\n * Generate a id from it's datasource options.\n * @param options Data source options\n * @returns A id\n */\nexport function generateIdFromSourceOptions(options: DataSourceOptions): string {\n  const generators = {\n    wms: generateWMSIdFromSourceOptions,\n    wmts: generateWMTSIdFromSourceOptions,\n    xyz: generateXYZIdFromSourceOptions,\n    feature: generateFeatureIdFromSourceOptions,\n    wfs: generateWfsIdFromSourceOptions,\n    arcgisrest: generateArcgisRestIdFromSourceOptions,\n    imagearcgisrest: generateArcgisRestIdFromSourceOptions,\n    tilearcgisrest: generateArcgisRestIdFromSourceOptions,\n    osm: (_options: AnyDataSourceOptions) => 'OSM',\n    tiledebug: (_options: AnyDataSourceOptions) => 'tiledebug'\n  };\n  const generator = generators[options.type] || generateId;\n  return generator(options);\n}\n\n/**\n * Generate a id from WMS data source options\n * @param options WMS data source options\n * @returns A md5 hash of the the url and layers\n */\nexport function generateWMSIdFromSourceOptions(options: WMSDataSourceOptions) {\n  const layers = options.params.LAYERS;\n  const url = standardizeUrl(options.url);\n  const chain = 'wms' + url + layers;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from WMTS data source options\n * @param options WMTS data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateWMTSIdFromSourceOptions(options: WMTSDataSourceOptions) {\n  const layer = options.layer;\n  const url = standardizeUrl(options.url);\n  const chain = 'wmts' + url + layer;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from XYZ data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateXYZIdFromSourceOptions(options: WMTSDataSourceOptions) {\n  const url = standardizeUrl(options.url);\n  const chain = 'xyz' + url;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from feature data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateFeatureIdFromSourceOptions(options: WMTSDataSourceOptions) {\n  if (!options.url) { return generateId(options); }\n  const url = standardizeUrl(options.url);\n  const chain = 'feature' + url;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from feature data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateWfsIdFromSourceOptions(options: WFSDataSourceOptions) {\n  if (!options.url || !options.params) { return generateId(options); }\n  const url = standardizeUrl(options.url);\n  const chain = 'wfs' + url + options.params.featureTypes;\n  return Md5.hashStr(chain) as string;\n}\n/**\n * Generate a id from ArcGIS Rest data source options\n * @param options ArcGIS Rest data source options\n * @returns A md5 hash of the url and layers\n */\nexport function generateArcgisRestIdFromSourceOptions(options: ArcGISRestDataSourceOptions) {\n  const layers = options.layer;\n  const url = standardizeUrl(options.url);\n  const chain = (options.type || 'arcgis') + url + layers;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a unique id\n * @returns A uuid\n */\nexport function generateId(_options: AnyDataSourceOptions) {\n  return uuid();\n}\n\nexport function standardizeUrl(url: string): string {\n  const absUrl = url.charAt(0) === '/' ? window.location.origin + url : url;\n  const urlDecomposed = absUrl.split(/[?&]/);\n  let urlStandardized = urlDecomposed.shift();\n  const paramsToKeep = urlDecomposed.filter(p => p.length !== 0 && p.charAt(0) !== '_');\n  if (paramsToKeep.length) {\n    urlStandardized += '?' + paramsToKeep.join('&');\n  }\n  return urlStandardized;\n}\n","import olSource from 'ol/source/Source';\nimport olVectorSource from 'ol/source/Vector';\nimport olClusterSource from 'ol/source/Cluster';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport {\n  DataSourceOptions,\n  Legend\n} from './datasource.interface';\n\nimport { DataService } from './data.service';\nimport { generateIdFromSourceOptions } from '../../../utils/id-generator';\nimport { LegendMapViewOptions, LegendOptions } from '../../../layer/shared/layers/layer.interface';\n\nexport abstract class DataSource {\n\n  public id: string;\n  public ol: olSource | olVectorSource<OlGeometry> | olClusterSource ;\n  private legend: Legend[];\n\n  constructor(\n    public options: DataSourceOptions = {},\n    protected dataService?: DataService\n  ) {\n    this.options = options;\n    this.id = this.options.id ||this.generateId();\n    this.ol = this.createOlSource();\n  }\n\n  protected abstract createOlSource(): olSource;\n\n  protected generateId(): string {\n    return generateIdFromSourceOptions(this.options);\n  }\n\n  public getLegend(style?: string, view?: LegendMapViewOptions): Legend[] {\n    return this.legend ? this.legend : [];\n  }\n\n  public setLegend(options: LegendOptions): Legend[] {\n    if (options.url) {\n      this.legend = [{ url: options.url} ];\n    } else if (options.html) {\n      this.legend = [{ html: options.html} ];\n    } else {\n      this.legend = [];\n    }\n\n    return this.legend;\n  }\n\n  protected abstract onUnwatch();\n}\n","export enum OgcFilterOperatorType {\n    BasicNumericOperator = 'basicnumericoperator',\n    Basic = 'basic',\n    BasicAndSpatial = 'basicandspatial',\n    Spatial = 'spatial',\n    All = 'all',\n    Time = 'time'\n}\n\nexport enum OgcFilterOperator {\n    BBOX = 'BBox',\n    PropertyIsBetween = 'PropertyIsBetween',\n    Contains = 'Contains',\n    During = 'During',\n    PropertyIsEqualTo = 'PropertyIsEqualTo',\n    PropertyIsGreaterThan = 'PropertyIsGreaterThan',\n    PropertyIsGreaterThanOrEqualTo = 'PropertyIsGreaterThanOrEqualTo',\n    Intersects = 'Intersects',\n    PropertyIsNull = 'PropertyIsNull',\n    PropertyIsLessThan = 'PropertyIsLessThan',\n    PropertyIsLessThanOrEqualTo = 'PropertyIsLessThanOrEqualTo',\n    PropertyIsLike = 'PropertyIsLike',\n    PropertyIsNotEqualTo = 'PropertyIsNotEqualTo',\n    Within = 'Within',\n    And = 'And',\n    Or = 'Or',\n    Not = 'Not'\n}\n","import * as olfilter from 'ol/format/filter';\nimport olFormatWKT from 'ol/format/WKT';\nimport olFormatWFS, { WriteGetFeatureOptions } from 'ol/format/WFS';\nimport olGeometry from 'ol/geom/Geometry';\n\nimport olProjection from 'ol/proj/Projection';\n\nimport { uuid, ObjectUtils } from '@igo2/utils';\n\nimport {\n  OgcFilter,\n  IgoOgcFilterObject,\n  AnyBaseOgcFilterOptions,\n  OgcInterfaceFilterOptions,\n  OgcFilterableDataSourceOptions,\n  OgcFiltersOptions,\n  IgoOgcSelector,\n  SelectorGroup,\n  OgcSelectorBundle\n} from './ogc-filter.interface';\nimport { OgcFilterOperatorType, OgcFilterOperator } from './ogc-filter.enum';\nimport { SourceFieldsOptionsParams } from '../../datasource/shared/datasources/datasource.interface';\nimport * as moment_ from 'moment';\nconst moment = moment_;\n\nexport class OgcFilterWriter {\n  private filterSequence: OgcInterfaceFilterOptions[] = [];\n  public operators = {\n    [OgcFilterOperator.PropertyIsEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.PropertyIsNotEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.PropertyIsLike as string]: {\n      spatial: false,\n      fieldRestrict: ['string']\n    },\n    [OgcFilterOperator.PropertyIsGreaterThan as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsGreaterThanOrEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsLessThan as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsLessThanOrEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsBetween as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.During as string]: { spatial: false, fieldRestrict: [] },\n    [OgcFilterOperator.PropertyIsNull as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.Intersects as string]: {\n      spatial: true,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.Within as string]: { spatial: true, fieldRestrict: [] },\n    [OgcFilterOperator.Contains as string]: { spatial: true, fieldRestrict: [] }\n  };\n\n  defineOgcFiltersDefaultOptions(\n    ogcFiltersOptions: OgcFiltersOptions,\n    fieldNameGeometry: string,\n    srcType?: string\n  ): OgcFiltersOptions {\n    let ogcFiltersDefaultValue = true; // default values for wfs.\n    if (srcType && srcType === 'wms') {\n      ogcFiltersDefaultValue = false;\n    }\n\n    ogcFiltersOptions = ogcFiltersOptions || {};\n    ogcFiltersOptions.enabled =\n      ogcFiltersOptions.enabled === undefined\n        ? ogcFiltersDefaultValue\n        : ogcFiltersOptions.enabled;\n    ogcFiltersOptions.editable =\n      ogcFiltersOptions.editable === undefined\n        ? ogcFiltersDefaultValue\n        : ogcFiltersOptions.editable;\n    ogcFiltersOptions.geometryName = fieldNameGeometry;\n\n    ogcFiltersOptions.advancedOgcFilters = true;\n    if (ogcFiltersOptions.enabled && (ogcFiltersOptions.pushButtons || ogcFiltersOptions.checkboxes\n      || ogcFiltersOptions.radioButtons || ogcFiltersOptions.select)) {\n      ogcFiltersOptions.advancedOgcFilters = false;\n    }\n    return ogcFiltersOptions;\n  }\n\n  public buildFilter(\n    filters?: IgoOgcFilterObject,\n    extent?: [number, number, number, number],\n    proj?: olProjection,\n    fieldNameGeometry?: string,\n    options?: OgcFilterableDataSourceOptions\n  ): string {\n    let ourBboxFilter;\n    let enableBbox: boolean;\n    if (/intersects|contains|within/gi.test(JSON.stringify(filters))) {\n      enableBbox = false;\n    } else {\n      enableBbox = true;\n    }\n    if (filters) {\n      fieldNameGeometry =\n        (filters as any).geometryName !== undefined\n          ? (filters as any).geometryName\n          : fieldNameGeometry;\n    }\n    if (extent && filters) {\n      ourBboxFilter = olfilter.bbox(fieldNameGeometry, extent, proj.getCode());\n    }\n    let filterAssembly: OgcFilter;\n    if (filters) {\n      filters = this.checkIgoFiltersProperties(\n        filters,\n        fieldNameGeometry,\n        proj\n      );\n      if (extent && enableBbox) {\n        filterAssembly = olfilter.and(\n          ourBboxFilter,\n          this.bundleFilter(filters, options)\n        );\n      } else {\n        filterAssembly = this.bundleFilter(filters, options);\n      }\n    } else {\n      return 'bbox=' + extent.join(',') + ',' + proj.getCode();\n    }\n\n    const wfsOptions: WriteGetFeatureOptions = {\n      srsName: '',\n      featureNS: '',\n      featurePrefix: '',\n      featureTypes: ['featureTypes'],\n      filter: filterAssembly,\n      outputFormat: '',\n      geometryName: fieldNameGeometry\n    };\n\n    const query = new olFormatWFS().writeGetFeature(wfsOptions);\n    const str = new XMLSerializer().serializeToString(query);\n    const regexp1 = /typenames *=|typename *=\\\"featureTypes\\\" *>/gi;\n    const regexp2 = /<\\/Query><\\/GetFeature>/gi;\n\n    return 'filter=' + str.split(regexp1)[1].split(regexp2)[0];\n  }\n\n  private bundleFilter(\n    filterObject: any,\n    options?: OgcFilterableDataSourceOptions\n  ) {\n    if (filterObject instanceof Array) {\n      const logicalArray = [];\n      filterObject.forEach((element) => {\n        logicalArray.push(this.bundleFilter(element, options));\n      });\n      return logicalArray;\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        return this.createFilter(\n          {\n            operator: filterObject.logical,\n            logicalArray: this.bundleFilter(filterObject.filters, options)\n          },\n          options\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        return this.createFilter(\n          filterObject as AnyBaseOgcFilterOptions,\n          options\n        );\n      }\n    }\n  }\n\n  private createFilter(\n    filterOptions,\n    options?: OgcFilterableDataSourceOptions\n  ): OgcFilter {\n    const operator = filterOptions.operator;\n    const logicalArray = filterOptions.logicalArray;\n\n    const wfsPropertyName = filterOptions.propertyName;\n    const wfsPattern = filterOptions.pattern;\n    const wfsMatchCase = filterOptions.matchCase\n      ? filterOptions.matchCase\n      : true;\n    const wfsWildCard = filterOptions.wildCard ? filterOptions.wildCard : '*';\n    const wfsSingleChar = filterOptions.singleChar\n      ? filterOptions.singleChar\n      : '.';\n    const wfsEscapeChar = filterOptions.escapeChar\n      ? filterOptions.escapeChar\n      : '!';\n\n    const wfsLowerBoundary = filterOptions.lowerBoundary;\n    const wfsUpperBoundary = filterOptions.upperBoundary;\n\n    const wfsGeometryName = filterOptions.geometryName;\n    const wfsExtent = filterOptions.extent;\n    const wfsWktGeometry = filterOptions.wkt_geometry;\n    const wfsSrsName = filterOptions.srsName\n      ? filterOptions.srsName\n      : 'EPSG:3857';\n\n    const wfsBegin = this.parseFilterOptionDate(\n      filterOptions.begin,\n      options ? options.minDate : undefined\n    );\n    const wfsEnd = this.parseFilterOptionDate(\n      filterOptions.end,\n      options ? options.maxDate : undefined\n    );\n\n    const wfsExpression = filterOptions.expression;\n\n    let geometry: olGeometry;\n    if (wfsWktGeometry) {\n      const wkt = new olFormatWKT();\n      geometry = wkt.readGeometry(wfsWktGeometry, {\n        dataProjection: wfsSrsName,\n        featureProjection: wfsSrsName || 'EPSG:3857'\n      });\n    }\n\n    switch (operator.toLowerCase()) {\n      case OgcFilterOperator.BBOX.toLowerCase():\n        return olfilter.bbox(wfsGeometryName, wfsExtent, wfsSrsName);\n      case OgcFilterOperator.PropertyIsBetween.toLowerCase():\n        return olfilter.between(\n          wfsPropertyName,\n          wfsLowerBoundary,\n          wfsUpperBoundary\n        );\n      case OgcFilterOperator.Contains.toLowerCase():\n        return olfilter.contains(wfsGeometryName, geometry, wfsSrsName);\n      case OgcFilterOperator.During.toLowerCase():\n        return olfilter.during(wfsPropertyName, wfsBegin, wfsEnd);\n      case OgcFilterOperator.PropertyIsEqualTo.toLowerCase():\n        return olfilter.equalTo(wfsPropertyName, wfsExpression, wfsMatchCase);\n      case OgcFilterOperator.PropertyIsGreaterThan.toLowerCase():\n        return olfilter.greaterThan(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo.toLowerCase():\n        return olfilter.greaterThanOrEqualTo(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.Intersects.toLowerCase():\n        return olfilter.intersects(wfsGeometryName, geometry, wfsSrsName);\n      case OgcFilterOperator.PropertyIsNull.toLowerCase():\n        return olfilter.isNull(wfsPropertyName);\n      case OgcFilterOperator.PropertyIsLessThan.toLowerCase():\n        return olfilter.lessThan(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo.toLowerCase():\n        return olfilter.lessThanOrEqualTo(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsLike.toLowerCase():\n        return olfilter.like(\n          wfsPropertyName,\n          wfsPattern.replace(/[()_]/gi, wfsSingleChar),\n          wfsWildCard,\n          wfsSingleChar,\n          wfsEscapeChar,\n          wfsMatchCase\n        );\n      case OgcFilterOperator.PropertyIsNotEqualTo.toLowerCase():\n        return olfilter.notEqualTo(\n          wfsPropertyName,\n          wfsExpression,\n          wfsMatchCase\n        );\n      case OgcFilterOperator.Within.toLowerCase():\n        return olfilter.within(wfsGeometryName, geometry, wfsSrsName);\n      // LOGICAL\n      case OgcFilterOperator.And.toLowerCase():\n        return olfilter.and.apply(null, logicalArray);\n      case OgcFilterOperator.Or.toLowerCase():\n        return olfilter.or.apply(null, logicalArray);\n      case OgcFilterOperator.Not.toLowerCase():\n        return olfilter.not.apply(null, logicalArray);\n\n      default:\n        return undefined;\n    }\n  }\n\n  public defineInterfaceFilterSequence(\n    filterObject: any,\n    geometryName,\n    logical = '',\n    level = -1\n  ): OgcInterfaceFilterOptions[] {\n    if (filterObject instanceof Array) {\n      filterObject.forEach((element) => {\n        this.filterSequence.concat(\n          this.defineInterfaceFilterSequence(\n            element,\n            geometryName,\n            logical,\n            level\n          )\n        );\n      });\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        level = level + 1;\n        this.filterSequence.concat(\n          this.defineInterfaceFilterSequence(\n            filterObject.filters,\n            geometryName,\n            filterObject.logical,\n            level\n          )\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        this.filterSequence.push(\n          this.addInterfaceFilter(filterObject, geometryName, level, logical)\n        );\n      }\n    }\n    return this.filterSequence;\n  }\n\n  public computeAllowedOperators(\n    fields?: SourceFieldsOptionsParams[],\n    propertyName?: string,\n    defaultOperatorsType?: OgcFilterOperatorType\n  ) {\n    let effectiveOperators: {} = {};\n    let allowedOperators;\n    let fieldsHasSpatialOperator: boolean;\n    let includeContains: boolean;\n\n    if (fields && propertyName) {\n      const srcField = fields.find((field) => field.name === propertyName);\n      allowedOperators =\n        srcField && srcField.allowedOperatorsType\n          ? srcField.allowedOperatorsType\n          : defaultOperatorsType;\n    }\n\n    if (fields) {\n      fields.map((field) => {\n        if (!field.allowedOperatorsType) {\n          return;\n        }\n        const allowedOperatorsType = field.allowedOperatorsType.toLowerCase();\n        if (\n          allowedOperatorsType === OgcFilterOperatorType.All.toLowerCase() ||\n          allowedOperatorsType ===\n            OgcFilterOperatorType.Spatial.toLowerCase() ||\n          allowedOperatorsType ===\n            OgcFilterOperatorType.BasicAndSpatial.toLowerCase()\n        ) {\n          fieldsHasSpatialOperator = true;\n          if (\n            allowedOperatorsType === OgcFilterOperatorType.All.toLowerCase()\n          ) {\n            includeContains = true;\n          }\n        }\n      });\n    }\n\n    allowedOperators = allowedOperators\n      ? allowedOperators\n      : OgcFilterOperatorType.BasicAndSpatial;\n\n    switch (allowedOperators.toLowerCase()) {\n      case OgcFilterOperatorType.All:\n        effectiveOperators = this.operators;\n        break;\n      case OgcFilterOperatorType.Spatial:\n        effectiveOperators = {\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.BasicAndSpatial:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.Basic:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          }\n        };\n        break;\n      case OgcFilterOperatorType.Time:\n        effectiveOperators = {\n          [OgcFilterOperator.During]: { spatial: false, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.BasicNumericOperator:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsGreaterThan]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsGreaterThanOrEqualTo]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsLessThan]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsLessThanOrEqualTo]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          }\n        };\n        break;\n      default:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n    }\n\n    if (fieldsHasSpatialOperator) {\n      (effectiveOperators as any).Intersects = {\n        spatial: true,\n        fieldRestrict: []\n      };\n      (effectiveOperators as any).Within = { spatial: true, fieldRestrict: [] };\n      if (includeContains) {\n        (effectiveOperators as any).Contains = {\n          spatial: true,\n          fieldRestrict: []\n        };\n      }\n    }\n\n    return effectiveOperators;\n  }\n\n  public addInterfaceFilter(\n    igoOgcFilterObject?,\n    geometryName?,\n    level = 0,\n    parentLogical = 'Or'\n  ): OgcInterfaceFilterOptions {\n    if (!igoOgcFilterObject) {\n      igoOgcFilterObject = { operator: 'PropertyIsEqualTo' };\n    }\n    const f = {\n      propertyName: '',\n      operator: '',\n      active: '',\n      filterid: uuid(),\n      step: '',\n      begin: '',\n      end: '',\n      sliderOptions: {},\n      lowerBoundary: '',\n      upperBoundary: '',\n      expression: '',\n      pattern: '',\n      wildCard: '*',\n      singleChar: '.',\n      escapeChar: '!',\n      matchCase: true,\n      igoSpatialSelector: '',\n      igoSNRC: '',\n      geometryName: '',\n      geometry: '',\n      wkt_geometry: '',\n      extent: '',\n      srsName: '',\n      parentLogical: '',\n      level: 0\n    };\n\n    return Object.assign(\n      f,\n      {\n        parentLogical,\n        level,\n        geometryName\n      },\n      igoOgcFilterObject\n    );\n  }\n\n  public checkIgoFiltersProperties(\n    filterObject: any,\n    fieldNameGeometry,\n    proj: olProjection,\n    active = false\n  ) {\n    const filterArray = [];\n    if (filterObject instanceof Array) {\n      filterObject.forEach((element) => {\n        filterArray.push(\n          this.checkIgoFiltersProperties(\n            element,\n            fieldNameGeometry,\n            proj,\n            active\n          )\n        );\n      });\n      return filterArray;\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        return Object.assign(\n          {},\n          {\n            logical: filterObject.logical,\n            filters: this.checkIgoFiltersProperties(\n              filterObject.filters,\n              fieldNameGeometry,\n              proj,\n              active\n            )\n          }\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        return this.addFilterProperties(\n          filterObject as OgcInterfaceFilterOptions,\n          fieldNameGeometry,\n          proj,\n          active\n        );\n      }\n    }\n  }\n\n  private addFilterProperties(\n    igoOgcFilterObject: OgcInterfaceFilterOptions,\n    fieldNameGeometry,\n    proj: olProjection,\n    active = false\n  ) {\n    const filterid = igoOgcFilterObject.hasOwnProperty('filterid')\n      ? igoOgcFilterObject.filterid\n      : uuid();\n    const status = igoOgcFilterObject.hasOwnProperty('active')\n      ? igoOgcFilterObject.active\n      : active;\n\n    const srsName = igoOgcFilterObject.hasOwnProperty('srsName')\n      ? igoOgcFilterObject.srsName\n      : proj\n      ? proj.getCode()\n      : 'EPSG:3857';\n\n    return Object.assign(\n      {},\n      {\n        filterid,\n        active: status,\n        igoSpatialSelector: 'fixedExtent',\n        srsName\n      },\n      igoOgcFilterObject,\n      { geometryName: fieldNameGeometry }\n    );\n  }\n\n  public rebuiltIgoOgcFilterObjectFromSequence(\n    sequence: OgcInterfaceFilterOptions[]\n  ): IgoOgcFilterObject {\n    if (sequence instanceof Array) {\n      if (sequence.length >= 1) {\n        let lastParentLogical = sequence[0].parentLogical;\n        let nextElement: any;\n        let logicalArray = [];\n        let lastProcessedFilter;\n        sequence.forEach((uiFilter) => {\n          const element = Object.assign({}, uiFilter);\n          const index = sequence.indexOf(uiFilter);\n          if (index >= 0 && index < sequence.length - 1) {\n            nextElement = sequence[index + 1];\n          } else {\n            nextElement = element;\n          }\n          delete element.active;\n          delete element.filterid;\n          delete element.parentLogical;\n          logicalArray.push(element);\n\n          if (sequence.length === 1) {\n            lastProcessedFilter = element;\n          } else if (lastParentLogical !== nextElement.parentLogical) {\n            if (logicalArray.length === 1) {\n              console.log(\n                'You must set at ' +\n                  'least two operator in a logical (' +\n                  lastParentLogical +\n                  ')'\n              );\n            } else {\n              lastProcessedFilter = Object.assign(\n                {},\n                { logical: lastParentLogical, filters: logicalArray }\n              );\n              logicalArray = [lastProcessedFilter];\n              lastParentLogical = nextElement.parentLogical;\n            }\n          }\n        });\n        return lastProcessedFilter;\n      } else {\n        return undefined;\n      }\n    } else {\n      return undefined;\n    }\n  }\n\n  private computeIgoSelector(selectors: IgoOgcSelector): IgoOgcSelector {\n    if (\n      selectors.groups.every((group) => group.computedSelectors !== undefined)\n    ) {\n      return selectors;\n    }\n    let selector: IgoOgcSelector;\n    if (selectors.groups && selectors.bundles) {\n      if (!selectors.bundles.every((bundle) => bundle.id !== undefined)) {\n        throw new Error(\n          'You must set an id for each of your bundles'\n        );\n      }\n      selector = ObjectUtils.copyDeep(selectors);\n      selector.groups.forEach((group) => {\n        group.title = group.title ? group.title : group.name;\n        group.enabled = group.enabled ? group.enabled : false;\n        group.computedSelectors = ObjectUtils.copyDeep(\n          selector.bundles.filter((b) => group.ids.includes(b.id))\n        );\n      });\n    } else if (!selectors.groups && selectors.bundles) {\n      selector = ObjectUtils.copyDeep(selectors);\n      selector.groups = [\n        {\n          title: 'group1',\n          name: 'group1',\n          computedSelectors: ObjectUtils.copyDeep(selector.bundles)\n        } as SelectorGroup\n      ];\n    } else {\n      selector = {\n        bundles: selectors as any,\n        groups: [\n          {\n            title: 'group1',\n            name: 'group1',\n            computedSelectors: ObjectUtils.copyDeep(\n              selectors\n            ) as OgcSelectorBundle[]\n          } as SelectorGroup\n        ],\n        selectorType: selector.selectorType\n      };\n    }\n    if (!selector.groups.find((selectorGroup) => selectorGroup.enabled)) {\n      selector.groups[0].enabled = true;\n    }\n    return selector;\n  }\n\n  public handleOgcFiltersAppliedValue(\n    options: OgcFilterableDataSourceOptions,\n    fieldNameGeometry: string,\n    extent?: [number, number, number, number],\n    proj?: olProjection\n  ): string {\n    const ogcFilters = options.ogcFilters;\n    if (!ogcFilters) {\n      return;\n    }\n    const conditions = [];\n    let filterQueryStringSelector = '';\n    let filterQueryStringAdvancedFilters = '';\n    if (ogcFilters.enabled && (ogcFilters.pushButtons || ogcFilters.checkboxes || ogcFilters.radioButtons || ogcFilters.select)) {\n      let selectors;\n      if (ogcFilters.pushButtons) {\n        selectors = ogcFilters.pushButtons;\n        const pushConditions = this.formatGroupAndFilter(ogcFilters, selectors);\n        for (const condition of pushConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.checkboxes) {\n        selectors = ogcFilters.checkboxes;\n        const checkboxConditions = this.formatGroupAndFilter(ogcFilters, selectors);\n        for (const condition of checkboxConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.radioButtons) {\n        selectors = ogcFilters.radioButtons;\n        const selectorsCorr = this.verifyMultipleEnableds(selectors);\n        const radioConditions = this.formatGroupAndFilter(ogcFilters, selectorsCorr);\n        for (const condition of radioConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.select) {\n        selectors = ogcFilters.select;\n        const selectorsCorr = this.verifyMultipleEnableds(selectors);\n        const selectConditions = this.formatGroupAndFilter(ogcFilters, selectorsCorr);\n        for (const condition of selectConditions) {\n          conditions.push(condition);\n        }\n      }\n\n      if (conditions.length >= 1) {\n        filterQueryStringSelector = this.buildFilter(\n          conditions.length === 1\n            ? conditions[0]\n            : { logical: 'And', filters: conditions },\n          extent,\n          proj,\n          ogcFilters.geometryName\n        );\n      }\n    }\n    if (ogcFilters.enabled && ogcFilters.filters) {\n      ogcFilters.geometryName = ogcFilters.geometryName || fieldNameGeometry;\n      const igoFilters = ogcFilters.filters;\n      filterQueryStringAdvancedFilters = this.buildFilter(\n        igoFilters,\n        extent,\n        proj,\n        ogcFilters.geometryName,\n        options\n      );\n    }\n\n    let filterQueryString = ogcFilters.advancedOgcFilters\n      ? filterQueryStringAdvancedFilters\n      : filterQueryStringSelector;\n    if (options.type === 'wms') {\n      filterQueryString = this.formatProcessedOgcFilter(\n        filterQueryString,\n        (options as any).params.LAYERS\n      );\n    }\n    if (options.type === 'wfs') {\n      filterQueryString = this.formatProcessedOgcFilter(\n        filterQueryString,\n        (options as any).params.featureTypes\n      );\n    }\n\n    return filterQueryString;\n  }\n\n  public verifyMultipleEnableds(selectors) {\n    selectors.bundles.forEach(bundle => {\n      if (!bundle.multiple) {\n        const enableds = bundle.selectors.reduce((list, filter, index) => (filter.enabled) === true ? list.concat(index) : list, []);\n        if (enableds.length > 1) {\n          enableds.splice(0, 1);\n          enableds.forEach(index => {\n            bundle.selectors[index].enabled = false;\n          });\n        }\n      }\n    });\n    return selectors;\n  }\n\n  public formatGroupAndFilter(ogcFilters: OgcFiltersOptions, selectors) {\n    selectors = this.computeIgoSelector(\n      selectors\n    );\n    const selectorBundle = selectors.groups.find(\n      (g) => g.enabled\n    ).computedSelectors;\n    const conditions = [];\n    selectorBundle.map((bundle) => {\n      const bundleCondition = [];\n      const selectorsType = bundle.selectors as any;\n      if (!selectorsType) {\n        return;\n      }\n      selectorsType\n        .filter((ogcselector) => ogcselector.enabled === true)\n        .forEach((enabledSelector) => bundleCondition.push(enabledSelector.filters));\n      if (bundleCondition.length === 1) {\n        conditions.push(bundleCondition[0]);\n      } else if (bundleCondition.length > 1) {\n        conditions.push({\n          logical: bundle.logical,\n          filters: bundleCondition\n        });\n      }\n    });\n\n    if (selectors.selectorType === 'pushButton') {\n      ogcFilters.pushButtons = selectors;\n    } else if (selectors.selectorType === 'checkbox') {\n      ogcFilters.checkboxes = selectors;\n    } else if (selectors.selectorType === 'radioButton') {\n      ogcFilters.radioButtons = selectors;\n    } else if (selectors.selectorType === 'select') {\n      ogcFilters.select = selectors;\n    }\n    return conditions;\n  }\n\n  public formatProcessedOgcFilter(\n    processedFilter: string,\n    layersOrTypenames: string\n  ): string {\n\n    if (!processedFilter) {return undefined;};\n    let appliedFilter = '';\n    if (processedFilter.length === 0 && layersOrTypenames.indexOf(',') === -1) {\n      appliedFilter = processedFilter;\n    } else {\n      layersOrTypenames.split(',').forEach((layerOrTypenames) => {\n        appliedFilter = `${appliedFilter}(${processedFilter.replace(\n          'filter=',\n          ''\n        )})`;\n      });\n    }\n    appliedFilter = appliedFilter.replace(/\\(\\)/g, '');\n    const filterValue =\n      appliedFilter.length > 0\n        ? appliedFilter.replace('filter=', '')\n        : undefined;\n    return filterValue;\n  }\n\n  public parseFilterOptionDate(value: string, defaultValue?: string): string {\n    if (!value) {\n      return defaultValue;\n    } else if (value === 'today') {\n      return undefined;\n    } else if (moment(value).isValid()) {\n      return value;\n    } else {\n      return undefined;\n    }\n  }\n}\n","export enum QueryFormat {\n  GML2 = 'gml2',\n  GML3 = 'gml3',\n  JSON = 'json',\n  GEOJSON = 'geojson',\n  GEOJSON2 = 'geojson2',\n  ESRIJSON = 'esrijson',\n  TEXT = 'text',\n  HTML = 'html',\n  HTMLGML2 = 'htmlgml2'\n}\n\nexport enum QueryFormatMimeType {\n  GML2 = 'application/vnd.ogc.gml',\n  GML3 = 'application/vnd.ogc.gml/3.1.1',\n  JSON = 'application/json',\n  GEOJSON = 'application/geojson',\n  GEOJSON2 = 'geojson',\n  ESRIJSON = 'application/json',\n  TEXT = 'text/plain',\n  HTML = 'text/html',\n  HTMLGML2 = 'text/html'\n}\n\nexport enum QueryHtmlTarget {\n  IFRAME = 'iframe',\n  BLANK = '_blank'\n}\n","import { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\nimport { OgcFiltersOptions } from '../../../filter/shared/ogc-filter.interface';\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\n\nimport * as OlFormat from 'ol/format';\nimport olFormatGML2 from 'ol/format/GML2';\nimport olFormatGML3 from 'ol/format/GML3';\nimport olFormatGML32 from 'ol/format/GML32';\nimport olFormatOSMXML from 'ol/format/OSMXML';\nimport olProjection from 'ol/proj/Projection';\n\nexport const defaultEpsg = 'EPSG:3857';\nexport const defaultMaxFeatures = 5000;\nexport const defaultWfsVersion = '2.0.0';\nexport const defaultFieldNameGeometry = 'geometry';\nexport const gmlRegex = new RegExp(/(.*)?gml(.*)?/gi);\nexport const jsonRegex = new RegExp(/(.*)?json(.*)?/gi);\n\n\n/**\n * This method build the WFS URL based on the layer property.\n * @param options  WFSDataSourceOptions The common wfs datasource options interface\n * @param extent  An extent like array [number, number, number, number]\n * @param proj  olProjection\n * @param ogcFilters  OgcFiltersOptions\n * @returns A string representing the datasource options, based on filter and views\n */\nexport function buildUrl(\n  options: WFSDataSourceOptions,\n  extent,\n  proj: olProjection,\n  ogcFilters: OgcFiltersOptions,\n  randomParam?: boolean): string {\n  const paramsWFS = options.paramsWFS;\n  const queryStringValues = formatWFSQueryString(options, undefined, options.paramsWFS.srsName);\n  let igoFilters;\n  if (ogcFilters && ogcFilters.enabled) {\n    igoFilters = ogcFilters.filters;\n  }\n  const ogcFilterWriter = new OgcFilterWriter();\n  const filterOrBox = ogcFilterWriter.buildFilter(igoFilters, extent, proj, ogcFilters.geometryName, options);\n  let filterOrPush = ogcFilterWriter.handleOgcFiltersAppliedValue(options, ogcFilters.geometryName, extent, proj);\n\n  let prefix = 'filter';\n  if (!filterOrPush) {\n    prefix = 'bbox';\n    filterOrPush = extent.join(',') + ',' + proj.getCode();\n  }\n\n  paramsWFS.xmlFilter = ogcFilters.advancedOgcFilters ? filterOrBox : `${prefix}=${filterOrPush}`;\n  let baseUrl = queryStringValues.find(f => f.name === 'getfeature').value;\n  const patternFilter = /(filter|bbox)=.*/gi;\n  baseUrl = patternFilter.test(paramsWFS.xmlFilter) ? `${baseUrl}&${paramsWFS.xmlFilter}` : baseUrl;\n  options.download = Object.assign({}, options.download, { dynamicUrl: baseUrl });\n  if (randomParam) {\n    baseUrl += `$&_t${new Date().getTime()}`;\n  }\n  return baseUrl.replace(/&&/g, '&');\n}\n\n\n/**\n * This method build/standardize WFS call query params based on the layer property.\n * @param wfsDataSourceOptions  WFSDataSourceOptions The common wfs datasource options interface\n * @param count  Number: Used to control the number of feature. Used to bypass whe wfs datasource options interface (maxFeatures)\n * @param epsg  String: Used to control the EPSG code (es: 'EPSG3857'). Used to bypass whe wfs datasource options interface (srsName)\n * @param properties  String: Used to control the queried fields  (WFS service).\n * @returns An array array of {name: '', value: ''} of predefined query params.\n */\nexport function formatWFSQueryString(\n  dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions,\n  count?: number,\n  epsg?: string,\n  properties?: string,\n  startIndex: number = 0,\n  forceDefaultOutputFormat: boolean = false\n): { name: string; value: string }[] {\n  const versionWfs200 = '2.0.0'; // not the same usage as defaultWfsVersion.\n  const url = dataSourceOptions.urlWfs;\n  const paramsWFS = dataSourceOptions.paramsWFS;\n  const effectiveCount = count || defaultMaxFeatures;\n  const effectiveStartIndex = paramsWFS.version === versionWfs200 ? `startIndex=${startIndex}` : '';\n  const epsgCode = epsg || defaultEpsg;\n  let outputFormat = paramsWFS.outputFormat\n    ? `outputFormat=${paramsWFS.outputFormat}`\n    : '';\n  let version = paramsWFS.version\n    ? `version=${paramsWFS.version}`\n    : `version=${defaultWfsVersion}`;\n  const paramTypename =\n    paramsWFS.version === versionWfs200 ? 'typenames' : 'typename';\n  const featureTypes = `${paramTypename}=${paramsWFS.featureTypes}`;\n  const paramMaxFeatures =\n    paramsWFS.version === versionWfs200 ? 'count' : 'maxFeatures';\n  let cnt = count\n    ? `${paramMaxFeatures}=${effectiveCount}`\n    : paramsWFS.maxFeatures\n    ? `${paramMaxFeatures}=${paramsWFS.maxFeatures}`\n    : `${paramMaxFeatures}=${effectiveCount}`;\n  if (forceDefaultOutputFormat) {\n      outputFormat = '';\n      version = 'version=1.1.0';\n      cnt = cnt.replace('count', 'maxFeatures');\n    }\n\n  const srs = epsg\n    ? `srsname=${epsgCode}`\n    : paramsWFS.srsName\n    ? 'srsname=' + paramsWFS.srsName\n    : `srsname=${epsgCode}`;\n\n  let propertyName = '';\n  let valueReference = '';\n  if (properties) {\n    propertyName = `propertyName=${properties}`;\n    valueReference = `valueReference=${properties}`;\n  }\n  const sourceFields = dataSourceOptions.sourceFields;\n  if (!propertyName && sourceFields && sourceFields.length > 0) {\n    const fieldsNames = [];\n    dataSourceOptions.sourceFields.forEach(sourcefield => {\n      fieldsNames.push(sourcefield.name);\n    });\n    propertyName = `propertyName=${fieldsNames.join(',')},${\n      paramsWFS.fieldNameGeometry\n    }`;\n  }\n\n  const separator = url.indexOf('?') === -1 ? '?' : '&';\n  const getCapabilities = `${url}${separator}service=WFS&request=GetCapabilities&${version}`;\n  let getFeature = `${url}${separator}service=WFS&request=GetFeature&${version}&${featureTypes}&`;\n  getFeature += `${outputFormat}&${srs}&${cnt}&${propertyName}&${effectiveStartIndex}`;\n\n  let getpropertyvalue = `${url}?service=WFS&request=GetPropertyValue&version=${versionWfs200}&${featureTypes}&`;\n  getpropertyvalue += `&${cnt}&${valueReference}`;\n\n  return [\n    { name: 'outputformat', value: outputFormat },\n    { name: 'version', value: version },\n    { name: 'typename', value: featureTypes },\n    { name: 'count', value: cnt },\n    { name: 'srsname', value: srs },\n    { name: 'propertyname', value: propertyName },\n    { name: 'valuereference', value: valueReference },\n    { name: 'getcapabilities', value: getCapabilities.replace(/&&/g, '&') },\n    { name: 'getfeature', value: getFeature.replace(/&&/g, '&') },\n    { name: 'getpropertyvalue', value: getpropertyvalue.replace(/&&/g, '&') }\n  ];\n}\n\n/**\n * Validate/Modify layer's wfs options based on :\n * 1- an Openlayers's issue with GML provided from WFS. Refer to\n * https://github.com/openlayers/openlayers/pull/6400\n * 2- Set default values for optionals parameters.\n * @param wfsDataSourceOptions  WFSDataSourceOptions The common wfs datasource options interface\n * @returns An array array of {name: '', value: ''} of predefined query params.\n */\nexport function checkWfsParams(wfsDataSourceOptions, srcType?: string) {\n  if (srcType && srcType === 'wfs') {\n    // reassignation of params to paramsWFS and url to urlWFS to have a common interface with wms-wfs datasources\n    wfsDataSourceOptions.paramsWFS = wfsDataSourceOptions.params;\n  }\n\n  const paramsWFS = wfsDataSourceOptions.paramsWFS;\n  wfsDataSourceOptions.urlWfs =\n    wfsDataSourceOptions.urlWfs || wfsDataSourceOptions.url;\n\n  paramsWFS.version = paramsWFS.version || defaultWfsVersion;\n  paramsWFS.fieldNameGeometry =\n    paramsWFS.fieldNameGeometry || defaultFieldNameGeometry;\n  paramsWFS.maxFeatures = paramsWFS.maxFeatures || defaultMaxFeatures;\n\n  let outputFormat;\n  if (paramsWFS.outputFormat) {\n    outputFormat = paramsWFS.outputFormat;\n  }\n\n  if (gmlRegex.test(outputFormat) || !outputFormat) {\n    paramsWFS.version = '1.1.0';\n  }\n  return Object.assign({}, wfsDataSourceOptions);\n}\n\nexport function getFormatFromOptions(\n  options: WFSDataSourceOptions | WMSDataSourceOptions\n) {\n  const wfsOptions = options as WFSDataSourceOptions;\n\n  let olFormatCls;\n  const outputFormat = wfsOptions.paramsWFS.outputFormat\n    ? wfsOptions.paramsWFS.outputFormat\n    : undefined;\n\n  if (!outputFormat) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls(wfsOptions.formatOptions);\n  }\n\n  if (OlFormat[outputFormat]) {\n    olFormatCls = OlFormat[outputFormat];\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('gml2')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({ ...wfsOptions.formatOptions, ...{ gmlFormat: olFormatGML2 }});\n  } else if (outputFormat.toLowerCase().match('gml32')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({ ...wfsOptions.formatOptions, ...{ gmlFormat: olFormatGML32 }});\n  } else if (outputFormat.toLowerCase().match('gml3')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({ ...wfsOptions.formatOptions, ...{ gmlFormat: olFormatGML3 }});\n  } else if (outputFormat.toLowerCase().match('topojson')) {\n    olFormatCls = OlFormat.TopoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('geojson')) {\n    olFormatCls = OlFormat.GeoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('esrijson')) {\n    olFormatCls = OlFormat.EsriJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('json')) {\n    olFormatCls = OlFormat.GeoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('gpx')) {\n    olFormatCls = OlFormat.GPX;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('WKT')) {\n    olFormatCls = OlFormat.WKT;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('osmxml')) {\n    olFormatCls = olFormatOSMXML;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('kml')) {\n    olFormatCls = OlFormat.KML;\n    return new olFormatCls(wfsOptions.formatOptions);\n  }\n\n  return new olFormatCls();\n}\n","import olSourceImageWMS from 'ol/source/ImageWMS';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\nimport { WFSService } from './wfs.service';\n\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\nimport { OgcFilterableDataSourceOptions, OgcFiltersOptions, OgcFilterDuringOptions } from '../../../filter/shared/ogc-filter.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\nimport {\n  formatWFSQueryString,\n  checkWfsParams,\n  defaultFieldNameGeometry\n} from './wms-wfs.utils';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { LegendMapViewOptions } from '../../../layer/shared/layers/layer.interface';\nimport { BehaviorSubject } from 'rxjs';\nimport { TimeFilterableDataSourceOptions, TimeFilterOptions } from '../../../filter/shared/time-filter.interface';\n\nexport class WMSDataSource extends DataSource {\n  public ol: olSourceImageWMS;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  set ogcFilters(value: OgcFiltersOptions) {\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters = value;\n  }\n  get ogcFilters(): OgcFiltersOptions {\n    return (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n  }\n\n  readonly ogcFilters$: BehaviorSubject<OgcFiltersOptions> = new BehaviorSubject(undefined);\n\n  set timeFilter(value: TimeFilterOptions ) {\n    (this.options as TimeFilterableDataSourceOptions).timeFilter = value;\n  }\n  get timeFilter(): TimeFilterOptions {\n    return (this.options as TimeFilterableDataSourceOptions).timeFilter;\n  }\n  readonly timeFilter$: BehaviorSubject<TimeFilterOptions> = new BehaviorSubject(undefined);\n\n  constructor(\n    public options: WMSDataSourceOptions,\n    protected wfsService: WFSService\n  ) {\n    super(options);\n    const sourceParams: any = options.params;\n\n    const dpi = sourceParams.DPI || 96;\n    sourceParams.DPI = dpi;\n    sourceParams.MAP_RESOLUTION = dpi;\n    sourceParams.FORMAT_OPTIONS = 'dpi:' + dpi;\n\n    if (options.refreshIntervalSec && options.refreshIntervalSec > 0) {\n      setInterval(() => {\n        this.refresh();\n      }, options.refreshIntervalSec * 1000); // Convert seconds to MS\n    }\n\n    let fieldNameGeometry = defaultFieldNameGeometry;\n\n    // ####   START if paramsWFS\n    if (options.paramsWFS) {\n      const wfsCheckup = checkWfsParams(options, 'wms');\n      ObjectUtils.mergeDeep(options.paramsWFS, wfsCheckup.paramsWFS);\n\n      fieldNameGeometry =\n        options.paramsWFS.fieldNameGeometry || fieldNameGeometry;\n\n      options.download = Object.assign({}, options.download, {\n        dynamicUrl: this.buildDynamicDownloadUrlFromParamsWFS(options)\n      });\n    } //  ####   END  if paramsWFS\n\n    if (!options.sourceFields || options.sourceFields.length === 0) {\n      options.sourceFields = [];\n    } else {\n      options.sourceFields.forEach(sourceField => {\n        sourceField.alias = sourceField.alias\n          ? sourceField.alias\n          : sourceField.name;\n        // to allow only a list of sourcefield with names\n      });\n    }\n    const initOgcFilters = (options as OgcFilterableDataSourceOptions)\n      .ogcFilters;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (!initOgcFilters) {\n      (options as OgcFilterableDataSourceOptions).ogcFilters = ogcFilterWriter.defineOgcFiltersDefaultOptions(\n        initOgcFilters,\n        fieldNameGeometry,\n        'wms'\n      );\n    } else {\n      initOgcFilters.advancedOgcFilters = (initOgcFilters.pushButtons || initOgcFilters.checkboxes\n        || initOgcFilters.radioButtons || initOgcFilters.select)\n        ? false\n        : true;\n      if (initOgcFilters.advancedOgcFilters && initOgcFilters.filters) {\n          const filterDuring = initOgcFilters.filters as OgcFilterDuringOptions;\n          if(filterDuring.calendarModeYear) {\n            initOgcFilters.advancedOgcFilters = false;\n          }\n      }\n      if (initOgcFilters.pushButtons){\n        initOgcFilters.pushButtons.selectorType = 'pushButton';\n      }\n      if (initOgcFilters.checkboxes){\n        initOgcFilters.checkboxes.selectorType = 'checkbox';\n      }\n      if (initOgcFilters.radioButtons){\n        initOgcFilters.radioButtons.selectorType = 'radioButton';\n      }\n      if (initOgcFilters.select){\n        initOgcFilters.select.selectorType = 'select';\n      }\n    }\n\n    if (\n      sourceParams.LAYERS.split(',').length > 1 &&\n      initOgcFilters &&\n      initOgcFilters.enabled\n    ) {\n      console.log('*******************************');\n      console.log(\n        'BE CAREFULL, YOUR WMS LAYERS (' +\n          sourceParams.LAYERS +\n          ') MUST SHARE THE SAME FIELDS TO ALLOW ogcFilters TO WORK !! '\n      );\n      console.log('*******************************');\n    }\n\n    if (\n      options.paramsWFS &&\n      initOgcFilters &&\n      initOgcFilters.enabled &&\n      initOgcFilters.editable &&\n      (options.sourceFields || []).filter(sf => !sf.values).length > 0) {\n      this.wfsService.getSourceFieldsFromWFS(options);\n    }\n\n    const filterQueryString = ogcFilterWriter.handleOgcFiltersAppliedValue(\n      options,\n      fieldNameGeometry\n    );\n    sourceParams.FILTER = filterQueryString;\n    this.setOgcFilters(initOgcFilters, true);\n\n    const timeFilterableDataSourceOptions = (options as TimeFilterableDataSourceOptions);\n    if (\n      timeFilterableDataSourceOptions?.timeFilterable &&\n      timeFilterableDataSourceOptions?.timeFilter) {\n      this.setTimeFilter(timeFilterableDataSourceOptions.timeFilter, true);\n    }\n  }\n\n  refresh() {\n    this.ol.updateParams({ igoRefresh: Math.random() });\n  }\n\n  private buildDynamicDownloadUrlFromParamsWFS(asWFSDataSourceOptions) {\n    const queryStringValues = formatWFSQueryString(asWFSDataSourceOptions);\n    const downloadUrl = queryStringValues.find(f => f.name === 'getfeature')\n      .value;\n    return downloadUrl;\n  }\n\n  protected createOlSource(): olSourceImageWMS {\n    return new olSourceImageWMS(Object.assign({ratio: 1}, this.options));\n  }\n\n  setOgcFilters(ogcFilters: OgcFiltersOptions, triggerEvent: boolean = false) {\n    this.ogcFilters = ogcFilters;\n    if (triggerEvent) {\n      this.ogcFilters$.next(this.ogcFilters);\n    }\n  }\n\n  setTimeFilter(timeFilter: TimeFilterOptions, triggerEvent: boolean = false) {\n    this.timeFilter = timeFilter;\n    if (triggerEvent) {\n      this.timeFilter$.next(this.timeFilter);\n    }\n  }\n\n  getLegend(style?: string, view?: LegendMapViewOptions): Legend[] {\n    let legend = super.getLegend();\n    if (legend.length > 0 && (style === undefined && !view?.scale)) {\n      return legend;\n    }\n\n    let contentDependent = false;\n    let projParam;\n\n    if (view?.size && view?.extent && view?.projection && this.options.contentDependentLegend) {\n      projParam = this.params.VERSION === '1.3.0' || this.params.VERSION === undefined ? 'CRS' : 'SRS';\n      contentDependent = true;\n    }\n\n    const sourceParams = this.params;\n\n    let layers = [];\n    if (sourceParams.LAYERS !== undefined) {\n      layers = sourceParams.LAYERS.split(',');\n    }\n\n    const baseUrl = this.options.url.replace(/\\?$/, '');\n    const params = [\n      'REQUEST=GetLegendGraphic',\n      'SERVICE=WMS',\n      'FORMAT=image/png',\n      'SLD_VERSION=1.1.0',\n      `VERSION=${sourceParams.VERSION || '1.3.0'}`\n    ];\n    if (style !== undefined) {\n      params.push(`STYLE=${style}`);\n    }\n    if (view?.scale !== undefined) {\n      params.push(`SCALE=${view.scale}`);\n    }\n    if (contentDependent) {\n      params.push(`WIDTH=${view.size[0]}`);\n      params.push(`HEIGHT=${view.size[1]}`);\n      params.push(`BBOX=${view.extent.join(',')}`);\n      params.push(`${projParam}=${view.projection}`);\n    }\n\n    legend = layers.map((layer: string) => {\n      const separator = baseUrl.match(/\\?/) ? '&' : '?';\n      return {\n        url: `${baseUrl}${separator}${params.join('&')}&LAYER=${layer}`,\n        title: layers.length > 1 ? layer : undefined,\n        currentStyle: style === undefined ? undefined : style as string\n      };\n    });\n\n    return legend;\n  }\n\n  public onUnwatch() {}\n}\n","import { Watcher } from '@igo2/utils';\nimport { Layer } from '../shared/layers/layer';\nimport olLayer from 'ol/layer/Layer';\nimport olSource from 'ol/source/Source';\nimport { DataSource } from '../../datasource/shared/datasources/datasource';\nimport { IgoMap } from '../../map/shared/map';\nimport { LayersLink, LinkedProperties } from '../shared/layers/layer.interface';\nimport { OgcFilterableDataSource, OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\nimport { TimeFilterableDataSource } from '../../filter/shared/time-filter.interface';\nimport { Subscription } from 'rxjs';\nimport { first } from 'rxjs/operators';\nimport olSourceImageWMS from 'ol/source/ImageWMS';\n\nexport class LayerSyncWatcher extends Watcher {\n    private ogcFilters$$: Subscription;\n    private timeFilter$$: Subscription;\n\n    private ol: olLayer<olSource>;\n    private layer: Layer;\n    private dataSource: DataSource;\n    private map: IgoMap;\n    private ogcFilterWriter;\n\n    constructor(layer: Layer, map: IgoMap) {\n        super();\n        this.ol = layer.ol;\n        this.layer = layer;\n        this.dataSource = layer.options.source;\n        this.map = map;\n        this.ogcFilterWriter = new OgcFilterWriter();\n    }\n\n    protected watch() {\n\n        this.ol.on('propertychange', evt => this.transferCommonProperties(evt));\n        if ((this.dataSource as OgcFilterableDataSource).ogcFilters$) {\n            this.ogcFilters$$ = (this.dataSource as OgcFilterableDataSource).ogcFilters$\n                .subscribe(ogcFilters => this.transferOgcFiltersProperties(ogcFilters));\n        }\n        if ((this.dataSource as TimeFilterableDataSource).timeFilter$) {\n            this.timeFilter$$ = (this.dataSource as TimeFilterableDataSource).timeFilter$\n                .subscribe(timeFilter => this.transferTimeFilterProperties(timeFilter));\n        }\n        this.syncChildLayers();\n    }\n\n    protected unwatch() {\n        this.ol.un('propertychange', evt => this.transferCommonProperties(evt));\n        if (this.ogcFilters$$) { this.ogcFilters$$.unsubscribe(); }\n        if (this.timeFilter$$) { this.timeFilter$$.unsubscribe(); }\n    }\n\n\n    private syncChildLayers() {\n        // Force the sync the child layers with parent on the first load.\n        if (!this.map) {\n            return;\n        }\n        this.map.status$\n            .pipe(first())\n            .subscribe(() => {\n                this.map.layers\n                    .filter(layer => layer.options.linkedLayers?.links)\n                    .map(layer => {\n                        layer.options.linkedLayers.links.map(link => {\n                            if (link.properties?.indexOf(LinkedProperties.VISIBLE) !== -1) {\n                                layer.ol.set('visible', !(layer.visible), false);\n                                layer.ol.set('visible', !(layer.visible), false);\n                                layer.visible = layer.visible;\n                            }\n                            if (link.properties?.indexOf(LinkedProperties.OPACITY) !== -1) {\n                                const baseOpacity = layer.ol.get('opacity');\n                                layer.ol.set('opacity', 0, false);\n                                layer.ol.set('opacity', baseOpacity, false);\n                                layer.opacity = layer.opacity;\n                            }\n                            if (link.properties?.indexOf(LinkedProperties.MINRESOLUTION) !== -1) {\n                                const baseMinResolution = layer.ol.get('minResolution');\n                                layer.ol.set('minResolution', 0, false);\n                                layer.ol.set('minResolution', baseMinResolution, false);\n                                layer.minResolution = layer.minResolution;\n                            }\n                            if (link.properties?.indexOf(LinkedProperties.MAXRESOLUTION) !== -1) {\n                                const baseMaxResolution = layer.ol.get('maxResolution');\n                                layer.ol.set('maxResolution', 0, false);\n                                layer.ol.set('maxResolution', baseMaxResolution, false);\n                                layer.minResolution = layer.minResolution;\n                            }\n                            if (link.properties?.indexOf(LinkedProperties.OGCFILTERS) !== -1) {\n                                const ogcFilters$ = (layer.dataSource as OgcFilterableDataSource).ogcFilters$;\n                                ogcFilters$.next(ogcFilters$.value);\n                            }\n                            if (link.properties?.indexOf(LinkedProperties.TIMEFILTER) !== -1) {\n                                const timeFilter$ = (layer.dataSource as TimeFilterableDataSource).timeFilter$;\n                                timeFilter$.next(timeFilter$.value);\n                            }\n                        });\n                    });\n            });\n    }\n\n    private transferCommonProperties(layerChange) {\n        const key = layerChange.key;\n        const layerChangeProperties = layerChange.target.getProperties();\n        const newValue = layerChangeProperties[key];\n\n        if (['visible', 'opacity', 'minResolution', 'maxResolution'].indexOf(key) === -1) {\n            return;\n        }\n        const linkedLayers = layerChangeProperties.linkedLayers as LayersLink;\n        if (!linkedLayers) {\n            return;\n        }\n        const currentLinkedId = linkedLayers.linkId;\n        const currentLinks = linkedLayers.links;\n        const isParentLayer = currentLinks ? true : false;\n\n        if (isParentLayer) {\n            // search for child layers\n            const silent = true;\n            currentLinks.map(link => {\n                if (!link.properties || link.properties.indexOf(key) === -1) {\n                    return;\n                }\n                link.linkedIds.map(linkedId => {\n                    const layerToApply = this.map.layers.find(layer => layer.options.linkedLayers?.linkId === linkedId);\n                    if (layerToApply) {\n                        layerToApply.ol.set(key, newValue, silent);\n                        if (key === 'visible') {\n                            layerToApply.visible$.next(newValue);\n                        }\n                    }\n                });\n            });\n        } else {\n            // search for parent layer\n            const silent = false;\n            this.map.layers.map(layer => {\n                if (layer.options.linkedLayers?.links) {\n                    layer.options.linkedLayers.links.map(l => {\n                        if (l.properties && l.properties.indexOf(key) !== -1 &&\n                            l.bidirectionnal !== false && l.linkedIds.indexOf(currentLinkedId) !== -1) {\n                            layer.ol.set(key, newValue, silent);\n                            if (key === 'visible') {\n                                layer.visible$.next(newValue);\n                            }\n                        }\n                    });\n                }\n            });\n        }\n    }\n\n    private transferOgcFiltersProperties(ogcFilters) {\n        const linkedLayers = this.ol.getProperties().linkedLayers as LayersLink;\n        if (!linkedLayers) {\n            return;\n        }\n        const currentLinkedId = linkedLayers.linkId;\n        const currentLinks = linkedLayers.links;\n        const isParentLayer = currentLinks ? true : false;\n        if (isParentLayer) {\n            // search for child layers\n            currentLinks.map(link => {\n                if (!link.properties || link.properties.indexOf(LinkedProperties.OGCFILTERS) === -1) {\n                    return;\n                }\n                link.linkedIds.map(linkedId => {\n                    const layerToApply = this.map.layers.find(layer => layer.options.linkedLayers?.linkId === linkedId);\n                    if (layerToApply) {\n                        const layerType = layerToApply.ol.getProperties().sourceOptions.type;\n                        (layerToApply.dataSource as OgcFilterableDataSource).setOgcFilters(ogcFilters, false);\n                        if (layerType === 'wfs') {\n                            layerToApply.ol.getSource().refresh();\n                        }\n                        if (layerType === 'wms') {\n                            let appliedOgcFilter;\n                            if (this.ol.getProperties().sourceOptions.type === 'wfs') {\n                                appliedOgcFilter = this.ogcFilterWriter.handleOgcFiltersAppliedValue(\n                                    this.layer.dataSource.options as OgcFilterableDataSourceOptions,\n                                    (this.dataSource.options as any).fieldNameGeometry,\n                                    undefined,\n                                    this.map.viewController.getOlProjection()\n                                );\n                            } else if (this.ol.getProperties().sourceOptions.type === 'wms') {\n                                appliedOgcFilter = (this.dataSource as WMSDataSource).ol.getParams().FILTER;\n                            }\n                            (layerToApply.dataSource as WMSDataSource).ol.updateParams({ FILTER: appliedOgcFilter });\n                        }\n                    }\n                });\n            });\n        } else {\n            // search for parent layer\n            this.map.layers.map(layer => {\n                if (layer.options.linkedLayers?.links) {\n                    layer.options.linkedLayers.links.map(l => {\n                        if (l.properties && l.properties.indexOf(LinkedProperties.OGCFILTERS) !== -1 &&\n                            l.bidirectionnal !== false && l.linkedIds.indexOf(currentLinkedId) !== -1) {\n                            const layerType = layer.ol.getProperties().sourceOptions.type;\n                            if (layerType === 'wfs') {\n                                (layer.dataSource as OgcFilterableDataSource).setOgcFilters(ogcFilters, true);\n                                layer.ol.getSource().refresh();\n                            }\n                            if (layerType === 'wms') {\n                                let appliedOgcFilter;\n                                if (this.ol.getProperties().sourceOptions.type === 'wfs') {\n                                    appliedOgcFilter = this.ogcFilterWriter.handleOgcFiltersAppliedValue(\n                                        layer.dataSource.options as OgcFilterableDataSourceOptions,\n                                        (this.dataSource.options as any).fieldNameGeometry,\n                                        undefined,\n                                        this.map.viewController.getOlProjection()\n                                    );\n\n                                } else if (this.ol.getProperties().sourceOptions.type === 'wms') {\n                                    appliedOgcFilter = (this.dataSource as WMSDataSource).ol.getParams().FILTER;\n                                }\n                                (layer.dataSource as WMSDataSource).ol.updateParams({ FILTER: appliedOgcFilter });\n                                (layer.dataSource as OgcFilterableDataSource).setOgcFilters(ogcFilters, true);\n                            }\n                        }\n                    });\n                }\n            });\n        }\n    }\n\n    private transferTimeFilterProperties(timeFilter) {\n        const linkedLayers = this.ol.getProperties().linkedLayers as LayersLink;\n        if (!linkedLayers) {\n            return;\n        }\n        const currentLinkedId = linkedLayers.linkId;\n        const currentLinks = linkedLayers.links;\n        const isParentLayer = currentLinks ? true : false;\n        if (isParentLayer) {\n            // search for child layers\n            currentLinks.map(link => {\n                if (!link.properties || link.properties.indexOf(LinkedProperties.TIMEFILTER) === -1) {\n                    return;\n                }\n                link.linkedIds.map(linkedId => {\n                    const childLayer = this.map.layers.find(layer =>\n                        layer.dataSource instanceof WMSDataSource &&\n                        layer.options.linkedLayers?.linkId === linkedId);\n                    if (childLayer) {\n                        (childLayer.dataSource as TimeFilterableDataSource).setTimeFilter(timeFilter, false);\n                        const appliedTimeFilter = (this.ol.getSource() as olSourceImageWMS).getParams().TIME;\n                        (childLayer.dataSource as WMSDataSource).ol.updateParams({ TIME: appliedTimeFilter });\n                    }\n                });\n            });\n        } else {\n            // search for parent layer\n            this.map.layers\n                .filter(layer => layer.dataSource instanceof WMSDataSource)\n                .map(parentLayer => {\n                    if (parentLayer.options.linkedLayers?.links) {\n                        parentLayer.options.linkedLayers.links.map(l => {\n                            if (l.properties && l.properties.indexOf(LinkedProperties.TIMEFILTER) !== -1 &&\n                                l.bidirectionnal !== false && l.linkedIds.indexOf(currentLinkedId) !== -1) {\n                                const appliedTimeFilter = (this.ol.getSource() as olSourceImageWMS).getParams().TIME;\n                                (parentLayer.dataSource as WMSDataSource).ol.updateParams({ TIME: appliedTimeFilter });\n                                (parentLayer.dataSource as TimeFilterableDataSource).setTimeFilter(timeFilter, true);\n                            }\n                        });\n                    }\n                });\n        }\n    }\n}\n","import olSourceTile from 'ol/source/Tile';\nimport { uuid, Watcher, SubjectStatus } from '@igo2/utils';\n\nimport { TileLayer } from '../shared/layers/tile-layer';\nimport { VectorTileLayer } from '../shared/layers/vectortile-layer';\n\nexport class TileWatcher extends Watcher {\n  private id: string;\n  private loaded = 0;\n  private loading = 0;\n\n  private source: olSourceTile;\n\n  constructor(layer: TileLayer | VectorTileLayer) {\n    super();\n    this.source = layer.options.source.ol;\n    this.id = uuid();\n  }\n\n  protected watch() {\n    this.source.on(`tileloadstart`, e => this.handleLoadStart(e));\n    this.source.on(`tileloadend`, e => this.handleLoadEnd(e));\n    this.source.on(`tileloaderror`, e => this.handleLoadEnd(e));\n  }\n\n  protected unwatch() {\n    this.source.un(`tileloadstart`, e => this.handleLoadStart(e));\n    this.source.un(`tileloadend`, e => this.handleLoadEnd(e));\n    this.source.un(`tileloaderror`, e => this.handleLoadEnd(e));\n  }\n\n  private handleLoadStart(event: any) {\n    // This is to avoid increasing\n    // the number of loaded tiles if a tile was loading\n    // before subscribing to this watcher\n    if (!event.tile.__watchers__) {\n      event.tile.__watchers__ = [];\n    }\n    event.tile.__watchers__.push(this.id);\n\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event) {\n    if (!event.tile.__watchers__) {\n      return;\n    }\n\n    const watcherIndex = event.tile.__watchers__.indexOf(this.id);\n    if (watcherIndex < 0) {\n      return;\n    }\n\n    event.tile.__watchers__.splice(watcherIndex, 1);\n\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n}\n","import { Layer } from '../shared/layers/layer';\nimport { LegendMapViewOptions, OutputLayerLegend } from '../shared/layers/layer.interface';\n\n/**\n * Get all the layers legend\n * @return Array of legend\n */\nexport function getLayersLegends(layers: Layer[], view?: LegendMapViewOptions): OutputLayerLegend[] {\n  const legends = [];\n\n  for (const layer of layers) {\n    if (layer.visible === false) { continue; }\n\n    const legendUrls = layer.dataSource.getLegend(undefined, view) || [];\n    for (const legendUrl of legendUrls) {\n      if (legendUrl.url === undefined) { continue; }\n\n      // Add legend info to the list\n      legends.push({\n        title: layer.title,\n        url: legendUrl.url\n      });\n    }\n  }\n\n  return legends;\n}\n","import olSourceVector from 'ol/source/Vector';\nimport * as olformat from 'ol/format';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { DataSource } from './datasource';\nimport { FeatureDataSourceOptions } from './feature-datasource.interface';\n\nexport class FeatureDataSource extends DataSource {\n  public options: FeatureDataSourceOptions;\n  public ol: olSourceVector<OlGeometry>;\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    const sourceOptions = {\n      format: this.getSourceFormatFromOptions(this.options)\n    };\n\n    return new olSourceVector(Object.assign(sourceOptions, this.options));\n  }\n\n  protected getSourceFormatFromOptions(options: FeatureDataSourceOptions) {\n    if (options.format) {\n      return options.format;\n    }\n    let olFormatCls;\n    const formatType = options.formatType;\n    if (!formatType) {\n      olFormatCls = olformat.GeoJSON;\n    } else {\n      olFormatCls = olformat[formatType];\n      if (olFormatCls === undefined) {\n        throw new Error('Invalid vector source format ${formatType}.');\n      }\n    }\n\n    const formatOptions = options.formatOptions;\n    let format;\n    if (formatOptions) {\n      format = new olFormatCls(formatOptions);\n    } else {\n      format = new olFormatCls();\n    }\n\n    return format;\n  }\n\n  public onUnwatch() {}\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n}\n","import olSourceCluster from 'ol/source/Cluster';\n\nimport { uuid } from '@igo2/utils';\n\nimport { FeatureDataSource } from './feature-datasource';\nimport { ClusterDataSourceOptions } from './cluster-datasource.interface';\n\nexport class ClusterDataSource extends FeatureDataSource {\n  public options: ClusterDataSourceOptions;\n  public ol: olSourceCluster;\n\n  protected createOlSource(): olSourceCluster {\n    this.options.format = this.getSourceFormatFromOptions(this.options);\n    this.options.source = super.createOlSource();\n    return new olSourceCluster(this.options);\n  }\n\n  protected generateId() {\n    return uuid();\n  }\n\n  public onUnwatch() {}\n}\n","import { uuid, Watcher, SubjectStatus } from '@igo2/utils';\n\nimport { VectorLayer } from '../shared/layers/vector-layer';\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\n\nexport class VectorWatcher extends Watcher {\n  private id: string;\n  private loaded = 0;\n  private loading = 0;\n\n  private layer: VectorLayer;\n\n  constructor(layer: VectorLayer) {\n    super();\n    this.layer = layer;\n    this.id = uuid();\n  }\n\n  protected watch() {\n    let olSource = this.layer.options.source.ol;\n    if (this.layer.dataSource instanceof ClusterDataSource) {\n      olSource = (this.layer.options.source.options as any).source;\n     }\n\n    if (olSource.getUrl()) {\n      olSource.on(`featuresloadstart`, e => this.handleLoadStart(e));\n      olSource.on(`featuresloadend`, e => this.handleLoadEnd(e));\n      olSource.on(`featuresloaderror`, e => this.handleLoadEnd(e));\n    }\n\n  }\n\n  protected unwatch() {\n    let olSource = this.layer.options.source.ol;\n    if (this.layer.dataSource instanceof ClusterDataSource) {\n      olSource = (this.layer.options.source.options as any).source;\n     }\n    if (olSource.getUrl()) {\n      olSource.un(`featuresloadstart`, e => this.handleLoadStart(e));\n      olSource.un(`featuresloadend`, e => this.handleLoadEnd(e));\n      olSource.un(`featuresloaderror`, e => this.handleLoadEnd(e));\n    }\n  }\n\n  private handleLoadStart(event: any) {\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event: any) {\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n}\n","import * as olproj from 'ol/proj';\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { MAC } from 'ol/has';\n\nimport { NumberUtils } from '@igo2/utils';\n\nimport { MapViewState } from './map.interface';\nimport { Projection } from './projection.interfaces';\n\n/**\n * This method extracts a coordinate tuple from a string.\n * @param str Any string\n * @param mapProjection string Map Projection\n * @param opts.forceNA boolean Force North America Zone\n * @returns object:\n *             lonLat: Coordinate,\n *             message: Message of error,\n *             radius: radius of the confience of coordinate,\n *             conf: confidence of the coordinate}\n */\nexport function stringToLonLat(\n  str: string,\n  mapProjection: string,\n  opts: { forceNA?: boolean } = {}\n): {\n  lonLat: [number, number] | undefined;\n  message: string;\n  radius: number | undefined;\n  conf: number | undefined;\n} {\n  let lonLat: [number, number];\n  let coordStr: string;\n  let negativeLon: string;\n  let degreesLon: string;\n  let minutesLon: string;\n  let secondsLon: string;\n  let directionLon: string;\n  let decimalLon: string;\n  let negativeLat: string;\n  let degreesLat: string;\n  let minutesLat: string;\n  let secondsLat: string;\n  let directionLat: string;\n  let decimalLat: string;\n  let zone: string;\n  let radius: string;\n  let conf: string;\n  let lon: any;\n  let lat: any;\n\n  const projectionPattern = '(\\\\s*;\\\\s*[\\\\d]{4,6})';\n  const toProjection = '4326';\n  let projectionStr: string;\n  const projectionRegex = new RegExp(projectionPattern, 'g');\n\n  const lonlatCoord = '([-+])?([\\\\d]{1,3})([,.](\\\\d+))?';\n  const lonLatPattern = `${lonlatCoord}[\\\\s,]+${lonlatCoord}`;\n  const lonLatRegex = new RegExp(`^${lonLatPattern}$`, 'g');\n\n  const dmsCoord =\n    '([0-9]{1,2})[:|]?\\\\s*([0-9]{1,2})?[:|\\'||]?\\\\s*([0-9]{1,2}(?:.[0-9]+){0,1})?\\\\s*[\"||]?\\\\s*';\n  const dmsCoordPattern = `${dmsCoord}([N|S|E|W|O]),?\\\\s*${dmsCoord}([N|S|E|W|O])`;\n  const dmsRegex = new RegExp(`^${dmsCoordPattern}$`, 'gi');\n\n  const patternUtm =\n    '(UTM)-?(\\\\d{1,2})[\\\\s,]*(\\\\d+[.,]?\\\\d+)[\\\\s,]+(\\\\d+[.,]?\\\\d+)';\n  const utmRegex = new RegExp(`^${patternUtm}`, 'gi');\n\n  const patternMtm =\n    '(MTM)-?(\\\\d{1,2})[\\\\s,]*(\\\\d+[.,]?\\\\d+)[\\\\s,]+(\\\\d+[.,]?\\\\d+)';\n  const mtmRegex = new RegExp(`^${patternMtm}`, 'gi');\n\n  const ddCoord = '([-+])?(\\\\d{1,3})[,.](\\\\d+)';\n  const patternDd = `${ddCoord}\\\\s*[,]?\\\\s*${ddCoord}`;\n  const ddRegex = new RegExp(`^${patternDd}`, 'g');\n\n  const dmdCoord =\n    '([-+])?(\\\\d{1,3})[\\\\s,.]{1}(\\\\d{1,2})[\\\\s,.]{1}(\\\\d{1,2})[.,]?(\\\\d{1,5})?';\n  const patternDmd = `${dmdCoord}\\\\s*[,.]?\\\\s*${dmdCoord}`;\n  const dmdRegex = new RegExp(`^${patternDmd}`, 'g');\n\n /* eslint-disable max-len */\n  const patternBELL =\n    'LAT\\\\s*[\\\\s:]*\\\\s*([-+])?(\\\\d{1,2})[\\\\s.,]?(\\\\d+)?[\\\\s.,]?\\\\s*(\\\\d{1,2}([.,]\\\\d+)?)?\\\\s*(N|S|E|W)?\\\\s*LONG\\\\s*[\\\\s:]*\\\\s*([-+])?(\\\\d{1,3})[\\\\s.,]?(\\\\d+)?[\\\\s.,]?\\\\s*(\\\\d{1,2}([.,]\\\\d+)?)?\\\\s*(N|S|E|W)?\\\\s*UNC\\\\s*[\\\\s:]?\\\\s*(\\\\d+)\\\\s*CONF\\\\s*[\\\\s:]?\\\\s*(\\\\d{1,3})';\n  const bellRegex = new RegExp(`^${patternBELL}?`, 'gi');\n\n  const mmCoord = '([-+]?\\\\d+)[,.]?(\\\\d+)?';\n  const mmPattern = `${mmCoord}[\\\\s,]+${mmCoord}`;\n  const mmRegex = new RegExp(`^${mmPattern}$`, 'g');\n\n  let isXYCoords = false;\n\n  str = str.toLocaleUpperCase().trim();\n\n  // Extract projection\n  if (projectionRegex.test(str)) {\n    [coordStr, projectionStr] = str.split(';').map(s => s.trim());\n  } else {\n    coordStr = str;\n  }\n  if (lonLatRegex.test(coordStr)) {\n    [\n      ,\n      negativeLon,\n      lon,\n      ,\n      decimalLon,\n      negativeLat,\n      lat,\n      ,\n      decimalLat\n    ] = coordStr.match(lonLatPattern);\n\n    lon = parseFloat((negativeLon ? negativeLon : '') + lon + '.' + decimalLon);\n    lat = parseFloat((negativeLat ? negativeLat : '') + lat + '.' + decimalLat);\n  } else if (dmsRegex.test(coordStr)) {\n    [\n      ,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      directionLon,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      directionLat\n    ] = coordStr.match(dmsCoordPattern);\n\n    if (directionLon === 'S' || directionLon === 'N') {\n      degreesLon = [degreesLat, (degreesLat = degreesLon)][0];\n      minutesLon = [minutesLat, (minutesLat = minutesLon)][0];\n      secondsLon = [secondsLat, (secondsLat = secondsLon)][0];\n      directionLon = [directionLat, (directionLat = directionLon)][0];\n    }\n\n    lon = convertDMSToDD(\n      parseFloat(degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat(degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (utmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, , zone, lon, lat] = coordStr.match(patternUtm);\n    const epsgUtm = Number(zone) < 10 ? `EPSG:3260${zone}` : `EPSG:326${zone}`;\n    [lon, lat] = olproj.transform(\n      [parseFloat(lon), parseFloat(lat)],\n      epsgUtm,\n      'EPSG:4326'\n    );\n  } else if (mtmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, , zone, lon, lat] = coordStr.match(patternMtm);\n    const epsgMtm =\n      Number(zone) < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + Number(zone)}`;\n    [lon, lat] = olproj.transform(\n      [parseFloat(lon), parseFloat(lat)],\n      epsgMtm,\n      'EPSG:4326'\n    );\n  } else if (dmdRegex.test(coordStr)) {\n    [\n      ,\n      negativeLon,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      decimalLon,\n      negativeLat,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      decimalLat\n    ] = coordStr.match(patternDmd);\n\n    lon = convertDMSToDD(\n      parseFloat((negativeLon ? negativeLon : '') + degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat((negativeLat ? negativeLat : '') + degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (ddRegex.test(coordStr)) {\n    [\n      ,\n      negativeLon,\n      degreesLon,\n      decimalLon,\n      negativeLat,\n      degreesLat,\n      decimalLat\n    ] = coordStr.match(patternDd);\n\n    lon = convertDMSToDD(\n      parseFloat((negativeLon ? negativeLon : '') + degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat((negativeLat ? negativeLat : '') + degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (bellRegex.test(coordStr)) {\n    [\n      ,\n      negativeLat,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      ,\n      directionLat,\n      negativeLon,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      ,\n      directionLon,\n      radius,\n      conf\n    ] = coordStr.match(patternBELL);\n\n    // Set default value for North America\n    if (!directionLon) {\n      directionLon = 'W';\n    }\n\n    // Check if real minutes or decimals\n    if (minutesLon && minutesLon.length > 2) {\n      lon = parseFloat(\n        (negativeLon ? negativeLon : '') + degreesLon + '.' + minutesLon\n      );\n    } else {\n      lon = convertDMSToDD(\n        parseFloat(degreesLon),\n        parseFloat(minutesLon),\n        parseFloat(secondsLon),\n        directionLon\n      );\n    }\n\n    if (minutesLat && minutesLat.length > 2) {\n      lat = parseFloat(\n        (negativeLat ? negativeLat : '') + degreesLat + '.' + minutesLat\n      );\n    } else {\n      lat = convertDMSToDD(\n        parseFloat(degreesLat),\n        parseFloat(minutesLat),\n        parseFloat(secondsLat),\n        directionLat\n      );\n    }\n  } else if (mmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, lon, decimalLon, lat, decimalLat] = coordStr.match(mmPattern);\n\n    if (decimalLon) {\n      lon = parseFloat(lon + '.' + decimalLon);\n    }\n\n    if (decimalLat) {\n      lat = parseFloat(lat + '.' + decimalLat);\n    }\n  } else {\n    return {\n      lonLat: undefined,\n      message: '',\n      radius: undefined,\n      conf: undefined\n    };\n  }\n\n  if (opts.forceNA && !isXYCoords) {\n    // Set a negative coordinate for North America zone\n    if (lon > 0 && lat > 0) {\n      if (lon > lat) {\n        lon = -lon;\n      } else {\n        lat = -lat;\n      }\n    }\n\n    // Reverse coordinate to respect lonLat convention\n    if (lon > lat) {\n      lon = [lat, (lat = lon)][0];\n    }\n  }\n\n  lonLat = [Number(lon), Number(lat)] as [number, number];\n\n  // Reproject the coordinate if projection parameter have been set and coord is not 4326\n  if (\n    (projectionStr !== undefined && projectionStr !== toProjection) ||\n    (lonLat[0] > 180 || lonLat[0] < -180) ||\n    (lonLat[1] > 90 || lonLat[1] < -90)\n  ) {\n    const source = projectionStr ? 'EPSG:' + projectionStr : mapProjection;\n    const dest = 'EPSG:' + toProjection;\n\n    try {\n      lonLat = olproj.transform(lonLat, source, dest) as [number, number];\n    } catch (e) {\n      return {\n        lonLat: undefined,\n        message: 'Projection ' + source + ' not supported',\n        radius: undefined,\n        conf: undefined\n      };\n    }\n  }\n  if (Math.abs(lonLat[0]) <= 180 && Math.abs(lonLat[1]) <= 90) {\n    return {\n      lonLat,\n      message: '',\n      radius: radius ? parseInt(radius, 10) : undefined,\n      conf: conf ? parseInt(conf, 10) : undefined\n    };\n  } else {\n    return {\n      lonLat: undefined,\n      message: 'Coordinate out of Longitude/Latitude bounds',\n      radius: undefined,\n      conf: undefined\n    };\n  }\n}\n\n/**\n * Convert degrees minutes seconds to dd\n * @param degrees Degrees\n * @param minutes Minutes\n * @param seconds Seconds\n * @param direction Direction\n */\nfunction convertDMSToDD(\n  degrees: number,\n  minutes: number,\n  seconds: number,\n  direction: string\n) {\n  minutes = minutes || 0;\n  seconds = seconds || 0;\n\n  const neg = degrees < 0;\n  let dd = Math.abs(degrees) + minutes / 60 + seconds / 3600;\n\n  if (neg || direction === 'S' || direction === 'W') {\n    dd = -dd;\n  } // Don't do anything for N or E\n  return dd;\n}\n\n/**\n * Convert dd to degrees minutes seconds\n * @param lonLatDD longitude and latitude in dd\n * @param decimal number of decimals for seconds\n * @returns longitude and latitude in dms\n */\nexport function convertDDToDMS(\n  lonLatDD: [number, number], decimal: number = 3\n): string[] {\n  const lonLatDMS = [];\n\n  lonLatDD.forEach(dd => {\n    const degrees = dd < 0 ? Math.ceil(dd) : Math.floor(dd);\n    const int = dd < 0 ? (degrees - dd) * 60 : (dd - degrees) * 60;\n    const minutes = Math.floor(int);\n    const seconds = ((int - minutes) * 60).toFixed(decimal);\n\n    lonLatDMS.push(`${degrees} ${minutes}' ${seconds}\"`);\n  });\n  return lonLatDMS;\n}\n\n/**\n * Return true of two view states are equal.\n * @param state1 View state\n * @param state2 View state\n * @returns True if the view states are equal\n */\nexport function viewStatesAreEqual(\n  state1: MapViewState,\n  state2: MapViewState\n): boolean {\n  if (state1 === undefined || state2 === undefined) {\n    return false;\n  }\n\n  const tolerance = 1 / 10000;\n  return (\n    state1.zoom === state2.zoom &&\n    Math.trunc(state1.center[0] / tolerance) ===\n      Math.trunc(state2.center[0] / tolerance) &&\n    Math.trunc(state1.center[1] / tolerance) ===\n      Math.trunc(state2.center[1] / tolerance)\n  );\n}\n\n/**\n * Format the scale to a human readable text\n * @param Scale of the map\n * @returns Human readable scale text\n */\nexport function formatScale(scale) {\n  scale = Math.round(scale);\n  if (scale < 10000) {\n    return scale + '';\n  }\n\n  scale = Math.round(scale / 1000);\n  if (scale < 1000) {\n    return scale + 'K';\n  }\n\n  scale = Math.round(scale / 1000);\n  return scale + 'M';\n}\n\n/**\n * Return the resolution from a scale denom\n * @param scale Scale denom\n * @param dpi DPI\n * @returns Resolution\n */\nexport function getResolutionFromScale(\n  scale: number,\n  dpi: number = 96\n): number {\n  const inchesPerMeter = 39.3701;\n  return scale / (inchesPerMeter * dpi);\n}\n\n/**\n * Return the resolution from a scale denom\n * @param Scale denom\n * @returns Resolution\n */\nexport function getScaleFromResolution(\n  resolution: number,\n  unit: string = 'm',\n  dpi: number = 96\n): number {\n  const inchesPerMeter = 39.3701;\n  return resolution * olproj.METERS_PER_UNIT[unit] * inchesPerMeter * dpi;\n}\n\n/**\n * Returns true if the CTRL key is pushed during an Ol MapBrowserPointerEvent\n * @param event OL MapBrowserPointerEvent\n * @returns Whether the CTRL key is pushed\n */\nexport function ctrlKeyDown(event: MapBrowserPointerEvent<any>): boolean {\n  const originalEvent = event.originalEvent;\n  return (\n    !originalEvent.altKey &&\n    (MAC ? originalEvent.metaKey : originalEvent.ctrlKey) &&\n    !originalEvent.shiftKey\n  );\n}\n\nexport function roundCoordTo(coord: [number, number], decimal: number = 3): [number, number] {\n  return [\n    NumberUtils.roundToNDecimal(coord[0], decimal),\n    NumberUtils.roundToNDecimal(coord[1], decimal)] as [number, number];\n}\n\n/**\n * Returns an array of converted coordinates.\n * Conversion is done for every configured projections\n * and for the current UTM zone and MTM zone.\n * @param lonLat [number, number] array of the coordinate to transform.\n * @param projections  Projection[] Array of destination projection.\n * @returns Returns an array of converted coordinates.\n */\nexport function lonLatConversion(\n  lonLat: [number, number],\n  projections: Projection[]\n): {\n  code: string;\n  alias: string;\n  coord: [number, number];\n  igo2CoordFormat: string;\n}[] {\n  const rawCoord3857 = olproj.transform(lonLat, 'EPSG:4326', 'EPSG:3857') as [number, number];\n  const convertedLonLat = [\n    {\n      code: 'EPSG:3857',\n      alias: 'Web Mercator',\n      coord: rawCoord3857,\n      igo2CoordFormat: `${roundCoordTo(rawCoord3857).join(', ')} ; 3857`\n    }\n  ];\n\n  // detect the current utm zone.\n  const utmZone = utmZoneFromLonLat(lonLat);\n  const epsgUtm = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n  const utmName = `UTM-${utmZone}`;\n  const rawCoordUtm = olproj.transform(lonLat, 'EPSG:4326', epsgUtm) as [number, number];\n  convertedLonLat.push({\n    code: epsgUtm,\n    alias: 'UTM',\n    coord: rawCoordUtm,\n    igo2CoordFormat: `${utmName} ${roundCoordTo(rawCoordUtm).join(', ')}`\n  });\n\n  // detect the current mtm zone.\n  const mtmZone = mtmZoneFromLonLat(lonLat);\n  if (mtmZone) {\n    const epsgMtm =\n      mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n    const mtmName = `MTM-${mtmZone}`;\n    const rawCoordMtm = olproj.transform(lonLat, 'EPSG:4326', epsgMtm) as [number, number];\n    convertedLonLat.push({\n      code: epsgMtm,\n      alias: 'MTM',\n      coord: rawCoordMtm,\n      igo2CoordFormat: `${mtmName} ${roundCoordTo(rawCoordMtm).join(', ')}`\n    });\n  }\n\n  projections.forEach(projection => {\n    const rawCoord = olproj.transform(lonLat, 'EPSG:4326', projection.code) as [number, number];\n    const numericEpsgCode = projection.code.split(':')[1];\n    convertedLonLat.push({\n      code: projection.code,\n      alias: projection.alias || projection.code,\n      coord: rawCoord,\n      igo2CoordFormat: `${roundCoordTo(rawCoord).join(\n        ', '\n      )} ; ${numericEpsgCode}`\n    });\n  });\n\n  return convertedLonLat;\n}\n\n/**\n * Detect the current utm zone of the lon/lat coordinate.\n * @param lonLat [number, number] array of the coordinate to detect the UTM zone.\n * @returns number The UTM zone.\n */\nexport function utmZoneFromLonLat(lonLat: [number, number]) {\n  return Math.ceil((lonLat[0] + 180) / 6);\n}\n\n/**\n * Detect the current mtm zone of the lon/lat coordinate.\n * @param lonLat [number, number] array of the coordinate to detect the MTM zone.\n * @returns number The MTM zone. Undefined if outside of the mtm application zone.\n */\nexport function mtmZoneFromLonLat(lonLat: [number, number]) {\n  const long = lonLat[0];\n  let mtmZone;\n  if (long < -51 && long > -54) {\n    mtmZone = 1;\n  }\n  if (long < -54 && long > -57) {\n    mtmZone = 2;\n  }\n  if (long < -57 && long > -60) {\n    mtmZone = 3;\n  }\n  if (long < -60 && long > -63) {\n    mtmZone = 4;\n  }\n  if (long < -63 && long > -66) {\n    mtmZone = 5;\n  }\n  if (long < -66 && long > -69) {\n    mtmZone = 6;\n  }\n  if (long < -69 && long > -72) {\n    mtmZone = 7;\n  }\n  if (long < -72 && long > -75) {\n    mtmZone = 8;\n  }\n  if (long < -75 && long > -78) {\n    mtmZone = 9;\n  }\n  if (long < -78 && long > -81) {\n    mtmZone = 10;\n  }\n  return mtmZone;\n}\n","import {\n  BehaviorSubject,\n  Observable,\n  Subject,\n  Subscription,\n  combineLatest\n} from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport olLayer from 'ol/layer/Layer';\nimport olSource from 'ol/source/Source';\n\nimport { AuthInterceptor } from '@igo2/auth';\nimport { SubjectStatus } from '@igo2/utils';\n\nimport { DataSource, Legend } from '../../../datasource';\nimport { IgoMap } from '../../../map/shared/map';\nimport { getResolutionFromScale } from '../../../map/shared/map.utils';\n\nimport { LayerOptions } from './layer.interface';\nimport { LayerSyncWatcher } from '../../utils/layerSync-watcher';\nimport { Message, MessageService } from '@igo2/core';\n\nexport abstract class Layer {\n  public collapsed: boolean;\n  public dataSource: DataSource;\n  public legend: Legend[];\n  public legendCollapsed: boolean = true;\n  public firstLoadComponent: boolean = true;\n  public map: IgoMap;\n  public ol: olLayer<olSource>;\n  public olLoadingProblem: boolean = false;\n  public status$: Subject<SubjectStatus>;\n  public hasBeenVisible$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n  private hasBeenVisible$$: Subscription;\n  private resolution$$: Subscription;\n\n  /**\n   * Define if a layer is generated by code OR defined by layer/context user layer.\n   * Useful for filtering layers list in mapOffline.directive or in the sharemap...\n   * return false by default.\n   */\n  get isIgoInternalLayer(): boolean {\n    return this.options.isIgoInternalLayer || false;\n  }\n\n  get id(): string {\n    return this.options.id || this.dataSource.id;\n  }\n\n  get alias(): string {\n    return this.options.alias;\n  }\n\n  get title(): string {\n    return this.options.title;\n  }\n\n  set title(title: string) {\n    this.options.title = title;\n  }\n\n  get zIndex(): number {\n    return this.ol.getZIndex();\n  }\n\n  set zIndex(zIndex: number) {\n    this.ol.setZIndex(zIndex);\n  }\n\n  get baseLayer(): boolean {\n    return this.options.baseLayer;\n  }\n\n  set baseLayer(baseLayer: boolean) {\n    this.options.baseLayer = baseLayer;\n  }\n\n  get opacity(): number {\n    return this.ol.get('opacity');\n  }\n\n  set opacity(opacity: number) {\n    this.ol.setOpacity(opacity);\n  }\n\n  set isInResolutionsRange(value: boolean) {\n    this.isInResolutionsRange$.next(value);\n  }\n  get isInResolutionsRange(): boolean {\n    return this.isInResolutionsRange$.value;\n  }\n  readonly isInResolutionsRange$: BehaviorSubject<\n    boolean\n  > = new BehaviorSubject(false);\n\n  set maxResolution(value: number) {\n    this.ol.setMaxResolution(value || Infinity);\n    this.updateInResolutionsRange();\n  }\n  get maxResolution(): number {\n    return this.ol.getMaxResolution();\n  }\n\n  set minResolution(value: number) {\n    this.ol.setMinResolution(value || 0);\n    this.updateInResolutionsRange();\n  }\n  get minResolution(): number {\n    return this.ol.getMinResolution();\n  }\n\n  set visible(value: boolean) {\n    this.ol.setVisible(value);\n    this.visible$.next(value);\n    if (!this.hasBeenVisible$.value && value){\n      this.hasBeenVisible$.next(value);\n    }\n    if (this.options?.messages && value) {\n      this.options?.messages\n        .filter(m => m.options?.showOnEachLayerVisibility)\n        .map(message =>\n          this.showMessage(message)\n        );\n    }\n  }\n  get visible(): boolean {\n    return this.visible$.value;\n  }\n  readonly visible$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n\n  get displayed(): boolean {\n    return this.visible && this.isInResolutionsRange;\n  }\n  readonly displayed$: Observable<boolean> = combineLatest([\n    this.isInResolutionsRange$,\n    this.visible$\n  ]).pipe(map((bunch: [boolean, boolean]) => bunch[0] && bunch[1]));\n\n  get showInLayerList(): boolean {\n    return this.options.showInLayerList !== false;\n  }\n\n  private layerSyncWatcher: LayerSyncWatcher;\n\n  constructor(\n    public options: LayerOptions,\n    protected messageService?: MessageService,\n    protected authInterceptor?: AuthInterceptor\n  ) {\n    this.dataSource = options.source;\n\n    this.ol = this.createOlLayer();\n    if (options.zIndex !== undefined) {\n      this.zIndex = options.zIndex;\n    }\n\n    if (options.baseLayer && options.visible === undefined) {\n      options.visible = false;\n    }\n\n    this.maxResolution = options.maxResolution || getResolutionFromScale(Number(options.maxScaleDenom));\n    this.minResolution = options.minResolution || getResolutionFromScale(Number(options.minScaleDenom));\n\n    this.visible = options.visible === undefined ? true : options.visible;\n    this.opacity = options.opacity === undefined ? 1 : options.opacity;\n\n    if (\n      options.legendOptions &&\n      (options.legendOptions.url || options.legendOptions.html)\n    ) {\n      this.legend = this.dataSource.setLegend(options.legendOptions);\n    }\n\n    this.legendCollapsed = options.legendOptions\n      ? options.legendOptions.collapsed\n        ? options.legendOptions.collapsed\n        : true\n      : true;\n\n    this.ol.set('_layer', this, true);\n  }\n\n  protected abstract createOlLayer(): olLayer<olSource>;\n\n  setMap(igoMap: IgoMap | undefined) {\n    this.map = igoMap;\n\n    this.unobserveResolution();\n    if (igoMap !== undefined) {\n      this.observeResolution();\n      this.layerSyncWatcher = new LayerSyncWatcher(this, this.map);\n      this.layerSyncWatcher.subscribe(() => {});\n      this.hasBeenVisible$$ = this.hasBeenVisible$.subscribe(() => {\n        if (this.options.messages && this.visible) {\n          this.options.messages.map(message => {\n            this.showMessage(message);\n          });\n        }\n      });\n    } else {\n      this.layerSyncWatcher.unsubscribe();\n    }\n  }\n\n  private showMessage(message: Message) {\n    if (!this.messageService) {\n      return;\n    }\n    message.title = message.title;\n    message.text = message.text;\n    this.messageService.message(message as Message);\n  }\n\n  private observeResolution() {\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(() =>\n      this.updateInResolutionsRange()\n    );\n  }\n\n  private unobserveResolution() {\n    if (this.resolution$$ !== undefined) {\n      this.resolution$$.unsubscribe();\n      this.resolution$$ = undefined;\n    }\n  }\n\n  private updateInResolutionsRange() {\n    if (this.map !== undefined) {\n      const resolution = this.map.viewController.getResolution();\n      const minResolution = this.minResolution;\n      const maxResolution = this.maxResolution === undefined ? Infinity : this.maxResolution;\n      this.isInResolutionsRange = resolution >= minResolution && resolution <= maxResolution;\n    } else {\n      this.isInResolutionsRange = false;\n    }\n  }\n}\n","import olLayerVector from 'ol/layer/Vector';\nimport olSourceVector from 'ol/source/Vector';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { unByKey } from 'ol/Observable';\nimport { easeOut } from 'ol/easing';\nimport { asArray as ColorAsArray } from 'ol/color';\nimport { getVectorContext } from 'ol/render';\nimport FormatType from 'ol/format/FormatType';\nimport olFeature from 'ol/Feature';\nimport olProjection from 'ol/proj/Projection';\nimport * as olproj from 'ol/proj';\n\nimport { FeatureDataSource } from '../../../datasource/shared/datasources/feature-datasource';\nimport { WFSDataSource } from '../../../datasource/shared/datasources/wfs-datasource';\nimport { ArcGISRestDataSource } from '../../../datasource/shared/datasources/arcgisrest-datasource';\nimport { WebSocketDataSource } from '../../../datasource/shared/datasources/websocket-datasource';\nimport { ClusterDataSource } from '../../../datasource/shared/datasources/cluster-datasource';\n\nimport { VectorWatcher } from '../../utils';\nimport { IgoMap } from '../../../map';\nimport { Layer } from './layer';\nimport { VectorLayerOptions } from './vector-layer.interface';\nimport { AuthInterceptor } from '@igo2/auth';\nimport { MessageService } from '@igo2/core';\nimport { WFSDataSourceOptions } from '../../../datasource/shared/datasources/wfs-datasource.interface';\nimport { buildUrl, defaultMaxFeatures } from '../../../datasource/shared/datasources/wms-wfs.utils';\nimport { OgcFilterableDataSourceOptions } from '../../../filter/shared/ogc-filter.interface';\nexport class VectorLayer extends Layer {\n  public dataSource:\n    | FeatureDataSource\n    | WFSDataSource\n    | ArcGISRestDataSource\n    | WebSocketDataSource\n    | ClusterDataSource;\n  public options: VectorLayerOptions;\n  public ol: olLayerVector<olSourceVector<OlGeometry>>;\n  private watcher: VectorWatcher;\n  private trackFeatureListenerId;\n\n  get browsable(): boolean {\n    return this.options.browsable !== false;\n  }\n\n  get exportable(): boolean {\n    return this.options.exportable !== false;\n  }\n\n  constructor(\n    options: VectorLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor\n  ) {\n    super(options, messageService, authInterceptor);\n    this.watcher = new VectorWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerVector<olSourceVector<OlGeometry>> {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceVector<OlGeometry>\n    });\n\n    if (this.options.animation) {\n      this.dataSource.ol.on(\n        'addfeature',\n        function(e) {\n          this.flash(e.feature);\n        }.bind(this)\n      );\n    }\n\n    if (this.options.trackFeature) {\n      this.enableTrackFeature(this.options.trackFeature);\n    }\n\n    const vector = new olLayerVector(olOptions);\n    const vectorSource = vector.getSource() as olSourceVector<OlGeometry>;\n    const url = vectorSource.getUrl();\n    if (url) {\n      let loader;\n      const wfsOptions = olOptions.sourceOptions as WFSDataSourceOptions;\n      if (wfsOptions?.type === 'wfs' && (wfsOptions.params || wfsOptions.paramsWFS)) {\n        loader = (extent, resolution, proj, success, failure) => {\n          this.customWFSLoader(\n            vectorSource,\n            wfsOptions,\n            this.authInterceptor,\n            extent,\n            resolution,\n            proj,\n            success,\n            failure\n          );\n        };\n      } else {\n        loader = (extent, resolution, proj, success, failure) => {\n          this.customLoader(\n            vectorSource,\n            url,\n            this.authInterceptor,\n            extent,\n            resolution,\n            proj,\n            success,\n            failure\n          );\n        };\n      }\n      if (loader) {\n        vectorSource.setLoader(loader);\n      }\n    }\n    return vector;\n  }\n\n  protected flash(feature) {\n    const start = new Date().getTime();\n    const listenerKey = this.ol.on('postrender', animate.bind(this));\n\n    function animate(event) {\n      const vectorContext = getVectorContext(event);\n      const frameState = event.frameState;\n      const flashGeom = feature.getGeometry().clone();\n      const elapsed = frameState.time - start;\n      const elapsedRatio = elapsed / this.options.animation.duration;\n      const opacity = easeOut(1 - elapsedRatio);\n      const newColor = ColorAsArray(this.options.animation.color || 'red');\n      newColor[3] = opacity;\n      let style = this.ol\n        .getStyleFunction()\n        .call(this, feature)\n        .find((style2) => {\n          return style2.getImage();\n        });\n      if (!style) {\n        style = this.ol.getStyleFunction().call(this, feature)[0];\n      }\n      const styleClone = style.clone();\n\n      switch (feature.getGeometry().getType()) {\n        case 'Point':\n          const radius =\n            easeOut(elapsedRatio) * (styleClone.getImage().getRadius() * 3);\n          styleClone.getImage().setRadius(radius);\n          styleClone.getImage().setOpacity(opacity);\n          break;\n        case 'LineString':\n          // TODO\n          if (styleClone.getImage()) {\n            styleClone.getImage().getStroke().setColor(newColor);\n            styleClone\n              .getImage()\n              .getStroke()\n              .setWidth(\n                easeOut(elapsedRatio) *\n                  (styleClone.getImage().getStroke().getWidth() * 3)\n              );\n          }\n          if (styleClone.getStroke()) {\n            styleClone.getStroke().setColor(newColor);\n            styleClone\n              .getStroke()\n              .setWidth(\n                easeOut(elapsedRatio) * (styleClone.getStroke().getWidth() * 3)\n              );\n          }\n          break;\n        case 'Polygon':\n          // TODO\n          if (styleClone.getImage()) {\n            styleClone.getImage().getFill().setColor(newColor);\n          }\n          if (styleClone.getFill()) {\n            styleClone.getFill().setColor(newColor);\n          }\n          break;\n      }\n\n      styleClone.setText('');\n      vectorContext.setStyle(styleClone);\n      vectorContext.drawGeometry(flashGeom);\n\n      if (elapsed > this.options.animation.duration) {\n        unByKey(listenerKey);\n        // remove last geometry\n        // there is a little flash before feature disappear, better solution ?\n        this.map.ol.render();\n        return;\n      }\n      // tell OpenLayers to continue postcompose animation\n      this.map.ol.render();\n    }\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n\n  public onUnwatch() {\n    this.dataSource.onUnwatch();\n    this.stopAnimation();\n  }\n\n  public stopAnimation() {\n    this.dataSource.ol.un(\n      'addfeature',\n      function(e) {\n        if (this.visible) {\n          this.flash(e.feature);\n        }\n      }.bind(this)\n    );\n  }\n\n  public enableTrackFeature(id: string | number) {\n    this.trackFeatureListenerId = this.dataSource.ol.on(\n      'addfeature',\n      this.trackFeature.bind(this, id)\n    );\n  }\n  public centerMapOnFeature(id: string | number) {\n    const feat = this.dataSource.ol.getFeatureById(id);\n    if (feat) {\n      this.map.ol.getView().setCenter(feat.getGeometry().getCoordinates());\n    }\n  }\n\n  public trackFeature(id, feat) {\n    if (feat.feature.getId() === id && this.visible) {\n      this.centerMapOnFeature(id);\n    }\n  }\n\n  public disableTrackFeature(id?: string | number) {\n    unByKey(this.trackFeatureListenerId);\n  }\n\n  /**\n   * Custom loader for a WFS datasource\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param options olOptions from source\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param resolution the current resolution\n   * @param proj the projection to retrieve the data\n   * @param success success callback\n   * @param failure failure callback\n   * @param randomParam random parameter to ensure cache is not causing problems in retrieving new data\n   */\n  public customWFSLoader(\n    vectorSource,\n    options,\n    interceptor,\n    extent,\n    resolution,\n    proj,\n    success,\n    failure,\n    randomParam?: boolean\n  ) {\n    {\n      const paramsWFS = options.paramsWFS;\n      const wfsProj = paramsWFS.srsName ? new olProjection({ code: paramsWFS.srsName }) : proj;\n      const currentExtent = olproj.transformExtent(extent, proj, wfsProj);\n      paramsWFS.srsName = paramsWFS.srsName || proj.getCode();\n      const url = buildUrl(\n        options,\n        currentExtent,\n        wfsProj,\n        (options as OgcFilterableDataSourceOptions).ogcFilters,\n        randomParam);\n      let startIndex = 0;\n      if (paramsWFS.version === '2.0.0' && paramsWFS.maxFeatures > defaultMaxFeatures) {\n        const nbOfFeature = 1000;\n        while (startIndex < paramsWFS.maxFeatures) {\n          let alteredUrl = url.replace('count=' + paramsWFS.maxFeatures, 'count=' + nbOfFeature);\n          alteredUrl = alteredUrl.replace('startIndex=0', '0');\n          alteredUrl += '&startIndex=' + startIndex;\n          alteredUrl.replace(/&&/g, '&');\n          this.getFeatures(vectorSource, interceptor, currentExtent, wfsProj, proj, alteredUrl, nbOfFeature, success, failure);\n          startIndex += nbOfFeature;\n        }\n      } else {\n        this.getFeatures(vectorSource, interceptor, currentExtent, wfsProj, proj, url, paramsWFS.maxFeatures, success, failure);\n      }\n    }\n  }\n\n\n  /**\n   * Custom loader to get feature from a WFS datasource\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param dataProjection the projection of the retrieved data\n   * @param featureProjection the projection of the created features\n   * @param url the url string to retrieve the data\n   * @param threshold the threshold to manage \"more features\" (TODO)\n   * @param success success callback\n   * @param failure failure callback\n   */\n  private getFeatures(\n    vectorSource: olSourceVector<OlGeometry>,\n    interceptor,\n    extent,\n    dataProjection,\n    featureProjection,\n    url: string,\n    threshold: number,\n    success, failure) {\n\n    const idAssociatedCall = (this.dataSource as WFSDataSource).mostRecentIdCallOGCFilter;\n    const xhr = new XMLHttpRequest();\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n    let modifiedUrl = url;\n    if (alteredUrlWithKeyAuth) {\n      modifiedUrl = alteredUrlWithKeyAuth;\n    }\n    xhr.open('GET', modifiedUrl);\n    if (interceptor) {\n      interceptor.interceptXhr(xhr, modifiedUrl);\n    }\n    const onError = () => {\n      vectorSource.removeLoadedExtent(extent);\n      failure();\n    };\n    xhr.onerror = onError;\n    xhr.onload = () => {\n      if (xhr.status === 200 && xhr.responseText.length > 0) {\n        const features =\n          vectorSource\n            .getFormat()\n            .readFeatures(xhr.responseText, { dataProjection, featureProjection }) as olFeature<OlGeometry>[];\n        // TODO Manage \"More feature\"\n        /*if (features.length === 0 || features.length < threshold ) {\n          console.log('No more data to download at this resolution');\n        }*/\n        // Avoids retrieving an older call that took longer to be process\n        if (idAssociatedCall === (this.dataSource as WFSDataSource).mostRecentIdCallOGCFilter)\n        {\n            vectorSource.addFeatures(features);\n            success(features);\n        }\n        else {\n            success([]);\n        }\n      } else {\n        onError();\n      }\n    };\n    xhr.send();\n  }\n\n  /**\n   * Custom loader for vector layer.\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param url the url string or function to retrieve the data\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param resolution the current resolution\n   * @param projection the projection to retrieve the data\n   */\n  private customLoader(\n    vectorSource,\n    url,\n    interceptor,\n    extent,\n    resolution,\n    projection,\n    success,\n    failure\n  ) {\n    const xhr = new XMLHttpRequest();\n    let modifiedUrl = url;\n    if (typeof url !== 'function') {\n      const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n      if (alteredUrlWithKeyAuth) {\n        modifiedUrl = alteredUrlWithKeyAuth;\n      }\n    } else {\n      modifiedUrl = url(extent, resolution, projection);\n    }\n    xhr.open( 'GET', modifiedUrl);\n    const format = vectorSource.getFormat();\n    if (format.getType() === FormatType.ARRAY_BUFFER) {\n      xhr.responseType = 'arraybuffer';\n    }\n    if (interceptor) {\n      interceptor.interceptXhr(xhr, modifiedUrl);\n    }\n\n    const onError = () => {\n      vectorSource.removeLoadedExtent(extent);\n      failure();\n    };\n    xhr.onerror = onError;\n    xhr.onload = () => {\n      // status will be 0 for file:// urls\n      if (!xhr.status || (xhr.status >= 200 && xhr.status < 300)) {\n        const type = format.getType();\n        let source;\n        if (type === FormatType.JSON || type === FormatType.TEXT) {\n          source = xhr.responseText;\n        } else if (type === FormatType.XML) {\n          source = xhr.responseXML;\n          if (!source) {\n            source = new DOMParser().parseFromString(\n              xhr.responseText,\n              'application/xml'\n            );\n          }\n        } else if (type === FormatType.ARRAY_BUFFER) {\n          source = xhr.response;\n        }\n        if (source) {\n          const features = format.readFeatures(source, { extent, featureProjection: projection });\n          vectorSource.addFeatures(features, format.readProjection(source));\n          success(features);\n        } else {\n          onError();\n        }\n      } else {\n        onError();\n      }\n    };\n    xhr.send();\n  }\n}\n","export abstract class DataService {\n    abstract getData(): string;\n}\n","import olSourceOSM from 'ol/source/OSM';\n\nimport { DataSource } from './datasource';\nimport { OSMDataSourceOptions } from './osm-datasource.interface';\n\nexport class OSMDataSource extends DataSource {\n  public options: OSMDataSourceOptions;\n  public ol: olSourceOSM;\n\n  protected createOlSource(): olSourceOSM {\n    if (!this.options.url) {\n      this.options.url = 'https://tile.openstreetmap.org/{z}/{x}/{y}.png';\n    }\n    return new olSourceOSM(this.options);\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceXYZ from 'ol/source/XYZ';\n\nimport { DataSource } from './datasource';\nimport { XYZDataSourceOptions } from './xyz-datasource.interface';\n\nexport class XYZDataSource extends DataSource {\n  public options: XYZDataSourceOptions;\n  public ol: olSourceXYZ;\n\n  protected createOlSource(): olSourceXYZ {\n    return new olSourceXYZ(this.options);\n  }\n\n  public onUnwatch() {}\n\n}\n","import olSourceVector from 'ol/source/Vector';\nimport * as OlLoadingStrategy from 'ol/loadingstrategy';\nimport olProjection from 'ol/proj/Projection';\nimport * as olproj from 'ol/proj';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { DataSource } from './datasource';\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WFSService } from './wfs.service';\n\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\nimport { OgcFilterableDataSourceOptions, OgcFiltersOptions } from '../../../filter/shared/ogc-filter.interface';\nimport {\n  defaultFieldNameGeometry,\n  checkWfsParams,\n  getFormatFromOptions,\n  buildUrl\n} from './wms-wfs.utils';\nimport { BehaviorSubject } from 'rxjs';\nimport { AuthInterceptor } from '@igo2/auth';\n\nexport class WFSDataSource extends DataSource {\n  public ol: olSourceVector<OlGeometry>;\n  public mostRecentIdCallOGCFilter: number = 0;\n\n  set ogcFilters(value: OgcFiltersOptions) {\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters = value;\n  }\n  get ogcFilters(): OgcFiltersOptions {\n    return (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n  }\n\n  readonly ogcFilters$: BehaviorSubject<OgcFiltersOptions> = new BehaviorSubject(undefined);\n\n  constructor(\n    public options: WFSDataSourceOptions,\n    protected wfsService: WFSService,\n    private authInterceptor?: AuthInterceptor\n  ) {\n    super(checkWfsParams(options, 'wfs'));\n\n    const ogcFilters = (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n    const fieldNameGeometry = this.options.paramsWFS.fieldNameGeometry || defaultFieldNameGeometry;\n    const ogcFilterWriter = new OgcFilterWriter();\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters =\n      ogcFilterWriter.defineOgcFiltersDefaultOptions(ogcFilters, fieldNameGeometry);\n    if (\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters.enabled &&\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters.editable &&\n      (options.sourceFields || []).filter(sf => !sf.values).length > 0\n    ) {\n      this.wfsService.getSourceFieldsFromWFS(this.options);\n    }\n\n    if (ogcFilters?.pushButtons){\n      ogcFilters.pushButtons.selectorType = 'pushButton';\n    }\n    if (ogcFilters?.checkboxes){\n      ogcFilters.checkboxes.selectorType = 'checkbox';\n    }\n    if (ogcFilters?.radioButtons){\n      ogcFilters.radioButtons.selectorType = 'radioButton';\n    }\n    if (ogcFilters?.select){\n      ogcFilters.select.selectorType = 'select';\n    }\n\n    this.setOgcFilters((this.options as OgcFilterableDataSourceOptions).ogcFilters, true);\n  }\n\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    const vectorSource = new olSourceVector({\n      format: getFormatFromOptions(this.options),\n      url: (extent, resolution, proj: olProjection) => {\n        const paramsWFS = this.options.paramsWFS;\n        const wfsProj = paramsWFS.srsName ? new olProjection({ code: paramsWFS.srsName }) : proj;\n        const ogcFilters = (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n        const currentExtent = olproj.transformExtent(extent, proj, wfsProj);\n        paramsWFS.srsName = paramsWFS.srsName || proj.getCode();\n        return buildUrl(this.options, currentExtent, wfsProj, ogcFilters);\n      },\n      strategy: OlLoadingStrategy.bbox\n    });\n    return vectorSource;\n  }\n\n  setOgcFilters(ogcFilters: OgcFiltersOptions, triggerEvent: boolean = false) {\n    this.ogcFilters = ogcFilters;\n    this.mostRecentIdCallOGCFilter += 1;\n    if (triggerEvent) {\n      this.ogcFilters$.next(this.ogcFilters);\n    }\n  }\n\n  public onUnwatch() { }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { combineLatest, Observable, of } from 'rxjs';\nimport olFeature from 'ol/Feature';\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\nimport { DataService } from './data.service';\nimport { formatWFSQueryString,\n          gmlRegex,\n          defaultEpsg,\n          defaultMaxFeatures,\n          getFormatFromOptions} from './wms-wfs.utils';\nimport { concatMap } from 'rxjs/operators';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n@Injectable({\n  providedIn: 'root'\n})\nexport class WFSService extends DataService {\n  constructor(private http: HttpClient) {\n    super();\n  }\n\n  getData() {\n    console.log('This is defining a data service.');\n    return 'This is defining a data service.';\n  }\n\n  public getSourceFieldsFromWFS(dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions) {\n    if (!dataSourceOptions.sourceFields || dataSourceOptions.sourceFields.length === 0 ) {\n      dataSourceOptions.sourceFields = [];\n      this.defineFieldAndValuefromWFS(dataSourceOptions).subscribe(getfeatureSourceField => {\n        dataSourceOptions.sourceFields = getfeatureSourceField;\n      });\n\n    } else {\n      this.defineFieldAndValuefromWFS(dataSourceOptions).subscribe(getfeatureSourceField => {\n        dataSourceOptions.sourceFields.forEach(sourcefield => {\n          if (sourcefield.alias === undefined) {\n            sourcefield.alias = sourcefield.name; // to allow only a list of sourcefield with names\n          }\n          if (sourcefield.values === undefined || sourcefield.values.length === 0) {\n            sourcefield.values = getfeatureSourceField.find(sf => sf.name === sourcefield.name).values;\n          }\n        });\n      });\n    }\n  }\n\n  private wfsGetFeature(\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions,\n    nb: number = defaultMaxFeatures,\n    epsgCode: string = defaultEpsg,\n    propertyName?: string,\n    startIndex: number = 0,\n    forceDefaultOutputFormat: boolean = false\n  ): Observable<any> {\n    const queryStringValues = formatWFSQueryString(dataSourceOptions, nb, epsgCode, propertyName, startIndex, forceDefaultOutputFormat );\n    const baseUrl = queryStringValues.find(f => f.name === 'getfeature').value;\n    const outputFormat = dataSourceOptions.paramsWFS.outputFormat;\n    if (forceDefaultOutputFormat || gmlRegex.test(outputFormat) || !outputFormat) {\n      return this.http.get(baseUrl, { responseType: 'text' });\n    } else {\n      return this.http.get(baseUrl);\n    }\n  }\n\n  defineFieldAndValuefromWFS(\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions\n  ): Observable<any> {\n    return new Observable(d => {\n      const sourceFields = [];\n      let fieldList;\n      let fieldListWoGeom;\n      let fieldListWoGeomStr;\n      let olFormats;\n      let effectiveOlFormats;\n\n      olFormats = getFormatFromOptions(dataSourceOptions);\n      const gmlDataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions = JSON.parse(\n        JSON.stringify(dataSourceOptions)\n      );\n      delete gmlDataSourceOptions.paramsWFS.outputFormat;\n      delete (gmlDataSourceOptions as WFSDataSourceOptions).formatOptions;\n\n      effectiveOlFormats = getFormatFromOptions(gmlDataSourceOptions);\n      let sourceFieldsToRetrieveValues = dataSourceOptions.sourceFields?.filter(f => !f.values).map(f => f.name);\n\n      // Validate if the service manage no outputformat (wfs 1.0.0 and GML is the default return)\n      this.wfsGetFeature(dataSourceOptions, 1, undefined, undefined, 0, true).pipe(\n        concatMap(res => String(res).toLowerCase().includes('exception') ? of(false) : of(true)),\n        concatMap(allowGml => {\n          // If the service return GML (return no exception)\n          return this.wfsGetFeature(dataSourceOptions, 1).pipe(\n            concatMap(firstFeature => {\n              const features = olFormats.readFeatures(firstFeature);\n              fieldList = features[0].getKeys();\n              if (dataSourceOptions.sourceFields || dataSourceOptions.sourceFields.length === 0) {\n                sourceFieldsToRetrieveValues = fieldList;\n              }\n              fieldListWoGeom = fieldList.filter(\n                field =>\n                  sourceFieldsToRetrieveValues.includes(field) &&\n                  field !== features[0].getGeometryName() &&\n                  !field.match(/boundedby/gi)\n              );\n              fieldListWoGeomStr = fieldListWoGeom.join(',');\n              const processingArray = [];\n              let startIndex = 0;\n              // If the service do not allow gml return, dice the call in multiple\n              // calls by increment of chunkSize with the original outputFormat\n              if (\n                !allowGml && dataSourceOptions.paramsWFS.version === '2.0.0' &&\n                dataSourceOptions.paramsWFS.maxFeatures > defaultMaxFeatures) {\n                const chunkSize = 1000;\n                while (startIndex < dataSourceOptions.paramsWFS.maxFeatures) {\n                  processingArray.push(this.wfsGetFeature(\n                    dataSourceOptions,\n                    chunkSize,\n                    dataSourceOptions.paramsWFS.srsName,\n                    fieldListWoGeomStr,\n                    startIndex\n                  ));\n                  startIndex += chunkSize;\n                }\n                effectiveOlFormats = olFormats;\n              } else {\n                processingArray.push(this.wfsGetFeature(\n                  dataSourceOptions,\n                  dataSourceOptions.paramsWFS.maxFeatures || defaultMaxFeatures,\n                  dataSourceOptions.paramsWFS.srsName,\n                  fieldListWoGeomStr,\n                  0, true\n                ));\n              }\n              return combineLatest(processingArray);\n            })\n          );\n        })).subscribe((results) => {\n          let mfeatures: olFeature<OlGeometry>[] = [];\n          results.map((result) => {\n            const loopFeatures = effectiveOlFormats.readFeatures(result);\n            mfeatures = mfeatures.concat(loopFeatures);\n          });\n          this.built_properties_value(mfeatures).forEach(element => {\n            sourceFields.push(element);\n          });\n          d.next(sourceFields);\n          d.complete();\n        });\n    });\n  }\n\n  private built_properties_value(features: olFeature<OlGeometry>[]): string[] {\n    if (features.length === 0) {\n      return [];\n    }\n    const kv = Object.assign({}, features[0].getProperties());\n    delete kv[features[0].getGeometryName()];\n    delete kv.boundedBy;\n    const sourceFields = [];\n    for (const property in kv) {\n      if (kv.hasOwnProperty(property)) {\n        const fieldType =\n          typeof features[0].get(property) === 'object'\n            ? undefined\n            : typeof features[0].get(property);\n        sourceFields.push({\n          name: property,\n          alias: property,\n          type: fieldType,\n          values: [kv[property]]\n        });\n      }\n    }\n    features.every((element) => {\n      const featureProperties = element.getProperties();\n      for (const key in featureProperties) {\n        if (featureProperties.hasOwnProperty(key) && key in kv) {\n          sourceFields.filter(f => f.name === key).forEach(v => {\n            if (v.values.indexOf(featureProperties[key]) === -1) {\n              v.values.push(featureProperties[key]);\n            }\n          });\n        }\n      }\n      return true;\n    });\n    return sourceFields;\n  }\n}\n","import olTileGridWMTS from 'ol/tilegrid/WMTS';\nimport * as olproj from 'ol/proj';\nimport {\n  getTopLeft as extentGetTopLeft,\n  getWidth as extentGetWidth\n} from 'ol/extent.js';\n\nexport function createDefaultTileGrid(epsg?: string): olTileGridWMTS {\n  const projection = epsg ? olproj.get(epsg) : olproj.get('EPSG:3857');\n  const projectionExtent = projection.getExtent();\n  const size = extentGetWidth(projectionExtent) / 256;\n  const resolutions = new Array(20);\n  const matrixIds = new Array(20);\n  for (let z = 0; z < 20; ++z) {\n    resolutions[z] = size / Math.pow(2, z);\n    matrixIds[z] = z;\n  }\n\n  return new olTileGridWMTS({\n    origin: extentGetTopLeft(projectionExtent),\n    resolutions,\n    matrixIds\n  });\n}\n","import { Options } from 'ol/source/WMTS';\nimport olSourceWMTS from 'ol/source/WMTS';\n\nimport { createDefaultTileGrid } from '../../utils/tilegrid';\nimport { DataSource } from './datasource';\nimport { WMTSDataSourceOptions } from './wmts-datasource.interface';\n\nexport class WMTSDataSource extends DataSource {\n  public options: WMTSDataSourceOptions;\n  public ol: olSourceWMTS;\n\n  constructor(options: WMTSDataSourceOptions) {\n    super(options);\n  }\n\n  protected createOlSource(): olSourceWMTS {\n    const sourceOptions = Object.assign(\n      {\n        tileGrid: createDefaultTileGrid(this.options.projection as string)\n      },\n      this.options\n    ) as Options;\n\n    return new olSourceWMTS(sourceOptions);\n  }\n\n  public onUnwatch() {}\n\n}\n","import olSourceCarto from 'ol/source/CartoDB';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { CartoDataSourceOptions } from './carto-datasource.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\n\nexport class CartoDataSource extends DataSource {\n  public ol: olSourceCarto;\n  public options: CartoDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): olSourceCarto {\n    const crossOrigin = this.options.crossOrigin\n      ? this.options.crossOrigin\n      : 'anonymous';\n    const sourceOptions = Object.assign(\n      {\n        crossOrigin\n      },\n      this.options\n    );\n    return new olSourceCarto(sourceOptions);\n  }\n\n  getLegend(): Legend[] {\n    const legend = super.getLegend();\n    if (legend.length > 0) {\n      return legend;\n    }\n\n    let htmlString = '<table>';\n    if (this.options.config.layers[0].legend !== null) {\n      this.options.config.layers[0].legend.items.forEach(f => {\n        if (f.visible === true) {\n          htmlString +=\n            '<tr><td>' +\n            '<p><font size=\"5\" color=\"' +\n            f.value +\n            '\"> &#9679</font></p></td>' +\n            '<td>' +\n            f.name +\n            '</td></tr>';\n        }\n      });\n      htmlString += '</table>';\n      return [{ html: htmlString }];\n    } else {\n      // Try to build the legend from the cartocss options\n      const layerOptions = this.options.config.layers[0].options;\n      // All available cartocss style options\n      const types = [\n        'polygon-fill:',\n        'marker-fill:',\n        'shield-fill:',\n        'building-fill:',\n        'line-color:'\n      ];\n      for (const oneType of types) {\n        if (layerOptions.cartocss.includes(oneType)) {\n          const type = layerOptions.cartocss.split(oneType).pop();\n          const color = type.substr(0, type.indexOf(';'));\n          if (color.includes('ramp')) {\n            const colors = color.split(', (')[1].split(',');\n            const data = color.split(', (')[2].split(',');\n            for (let j = 0; j < colors.length; j++) {\n              colors[j] = colors[j].replace(/(\"|\\))/g, '');\n              data[j] = data[j].replace(/(\"|\\))/g, '');\n              if (data[j].replace(/\\s+/g, '') === '=') {\n                data[j] = 'Autres';\n              }\n              htmlString +=\n                '<tr><td>' +\n                '<p><font size=\"5\" color=\"' +\n                colors[j] +\n                '\"> &#9679</font></p></td>' +\n                '<td>' +\n                data[j] +\n                '</td></tr>';\n            }\n            break;\n          } else {\n            const title = layerOptions.layer_name\n              ? layerOptions.layer_name\n              : '';\n            htmlString +=\n              '<tr><td>' +\n              '<p><font size=\"5\" color=\"' +\n              color +\n              '\"> &#9679</font></p>' +\n              '</td><td>' +\n              title +\n              '</td></tr>';\n            break;\n          }\n        }\n      }\n      htmlString += '</table>';\n      return [{ html: htmlString }];\n    }\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceVector from 'ol/source/Vector';\nimport olFormatEsriJSON from 'ol/format/EsriJSON';\nimport * as olloadingstrategy from 'ol/loadingstrategy';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { ArcGISRestDataSourceOptions } from './arcgisrest-datasource.interface';\n\nexport class ArcGISRestDataSource extends DataSource {\n  public ol: olSourceVector<OlGeometry>;\n  public options: ArcGISRestDataSourceOptions;\n\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    const esrijsonFormat = new olFormatEsriJSON();\n    return new olSourceVector({\n      attributions: this.options.params.attributions,\n      overlaps: false,\n      format: esrijsonFormat,\n      url: function(extent, resolution, proj) {\n        const baseUrl = this.options.url + '/' + this.options.layer + '/query/';\n        const geometry = encodeURIComponent(\n          '{\"xmin\":' +\n            extent[0] +\n            ',\"ymin\":' +\n            extent[1] +\n            ',\"xmax\":' +\n            extent[2] +\n            ',\"ymax\":' +\n            extent[3] +\n            ',\"spatialReference\":{\"wkid\":102100}}'\n        );\n        const params = [\n          'f=json',\n          `geometry=${geometry}`,\n          'geometryType=esriGeometryEnvelope',\n          'inSR=102100',\n          'spatialRel=esriSpatialRelIntersects',\n          'outFields=*',\n          'returnGeometry=true',\n          'outSR=102100'\n        ];\n        if (this.options.params.time) {\n          const time = `time=${this.options.params.time}`;\n          params.push(time);\n        }\n        if (this.options.params.customParams) {\n          this.options.params.customParams.forEach(element => {\n            params.push(element);\n          });\n        }\n        return `${baseUrl}?${params.join('&')}`;\n      }.bind(this),\n      strategy: olloadingstrategy.bbox\n    });\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.legendInfo;\n    const legend = super.getLegend();\n    if (legendInfo === undefined || legend.length > 0) {\n      return legend;\n    }\n    if (!legendInfo) {\n      return;\n    }\n    let htmlString = '<table>';\n    let src: string;\n    let label: string;\n    let svg: string;\n\n    if (legendInfo.legend) {\n      for (const legendElement of legendInfo.legend) {\n        src = this.htmlImgSrc(legendElement.contentType, legendElement.imageData);\n        label = legendElement.label ? legendElement.label.replace('<Null>', 'Null') : '';\n        htmlString +=\n          `<tr><td align='left'><img src=\"` +\n          src +\n          `\" alt ='' /></td><td class=\"mat-typography\">` +\n          label +\n          '</td></tr>';\n      }\n    } else if (legendInfo.type === \"uniqueValue\") {\n      for (const legendElement of legendInfo.uniqueValueInfos) {\n        label = legendElement.label.replace('<Null>', 'Null');\n        if (legendElement.symbol.type === 'esriPMS') {\n          src = this.htmlImgSrc(legendElement.symbol.contentType, legendElement.symbol.imageData);\n          htmlString +=\n            `<tr><td align='left'><img src=\"` +\n            src +\n            `\" alt ='' /></td><td class=\"mat-typography\">` +\n            label +\n            '</td></tr>';\n        } else if (legendElement.symbol.type !== 'esriPMS') {\n          svg = this.createSVG(legendElement.symbol);\n          htmlString += `<tr><td align='left'>` + svg + `</td><td class=\"mat-typography\">` + label + '</td></tr>';\n        }\n      }\n    } else if (legendInfo.type === \"simple\") {\n      label = legendInfo.label ? legendInfo.label.replace('<Null>', 'Null') : '';\n      if (legendInfo.symbol.type === 'esriPMS') {\n        src = this.htmlImgSrc(legendInfo.symbol.contentType, legendInfo.symbol.imageData);\n        htmlString +=\n          `<tr><td align='left'><img src=\"` +\n          src +\n          `\" alt ='' /></td><td class=\"mat-typography\">` +\n          label +\n          '</td></tr>';\n      } else if (legendInfo.symbol.type !== 'esriPMS') {\n        svg = this.createSVG(legendInfo.symbol);\n        htmlString += `<tr><td align='left'>` + svg + `</td><td class=\"mat-typography\">` + label + '</td></tr>';\n      }\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  htmlImgSrc(contentType: string, imageData: string): string {\n    return `data:${contentType};base64,${imageData}`;\n  }\n\n  createSVG(symbol): string {\n    let svg: string = '';\n\n    const color: Array<number> = symbol.color ? symbol.color : [0, 0, 0, 0];\n\n    if (symbol.type === 'esriSLS') {\n      const width: number = symbol.width ? symbol.width : 0;\n\n      const stroke: string = `stroke:rgba(` + color[0] + ',' + color[1] + ',' + color[2] + ',' + color[3] + ')';\n      const strokeWidth: string = `stroke-width:` + width;\n\n      if (symbol.style === 'esriSLSSolid') {\n        svg = `<svg height=\"30\" width=\"30\"><line x1=\"0\" y1=\"15\" x2=\"30\" y2=\"15\" style=\"` + stroke + ';' + strokeWidth + `\"/></svg>`;\n      } else if (symbol.style === 'esriSLSDash') {\n        const strokeDashArray: string = `stroke-dasharray=\"5,5\"`;\n        svg = `<svg height=\"30\" width=\"30\"><line x1=\"0\" y1=\"15\" x2=\"30\" y2=\"15\" style=\"` + stroke + ';' + strokeWidth + `\" `+ strokeDashArray + `/></svg>`;\n      }\n    } else if (symbol.style === 'esriSMSCircle' || symbol.style === 'esriSFSSolid') {\n      const outlineColor = symbol.outline.color;\n      const outlineWidth = symbol.outline.width;\n      const size = symbol.size;\n\n      const stroke = `stroke:rgba(` + outlineColor[0] + ',' + outlineColor[1] + ',' + outlineColor[2] + ',' + outlineColor[3] + ')';\n      const strokeWidth = `stroke-width:` + outlineWidth;\n      const fill = `fill:rgba(` + color[0] + ',' + color[1] + ',' + color[2] + ',' + color[3] + ')';\n\n      if (symbol.style === 'esriSMSCircle') {\n        svg = `<svg height=\"30\" width=\"30\"><circle cx=\"15\" cy=\"15\" r=\"` + size/2 + `\" style=\"` + stroke + ';' + strokeWidth + ';' + fill + `\"/></svg>`;\n      } else {\n        svg = `<svg height=\"30\" width=\"30\"><rect x=\"5\" y=\"5\" width=\"20\" height=\"20\" style =\"` + stroke + ';' + strokeWidth + ';' + fill + `\"/></svg>`;\n      }\n    }\n    return svg;\n  }\n\n  public onUnwatch() {}\n}\n","import ImageArcGISRest from 'ol/source/ImageArcGISRest';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { ArcGISRestImageDataSourceOptions } from './imagearcgisrest-datasource.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\nexport class ImageArcGISRestDataSource extends DataSource {\n  public ol: ImageArcGISRest;\n  public options: ArcGISRestImageDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): ImageArcGISRest {\n    const params = this.options.layer === undefined ? this.options.params : Object.assign(\n      {LAYERS: `show:${this.options.layer}`},\n      this.options.params\n    );\n\n    if (typeof params.renderingRule === 'object') {\n      params.renderingRule = JSON.stringify(params.renderingRule);\n    }\n\n    return new ImageArcGISRest({\n      ratio: 1,\n      params,\n      url: this.options.url\n    });\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.legendInfo;\n    const legend = super.getLegend();\n    if (legendInfo === undefined || this.options.layer === undefined || legend.length > 0) {\n      return legend;\n    }\n\n    if (!legendInfo) {\n      return;\n    }\n    let htmlString = '<table>';\n\n    for (const legendElement of legendInfo.legend) {\n      const src = `${this.options.url}/${legendInfo.layerId}/images/${legendElement.url}`;\n      const label = legendElement.label.replace('<Null>', 'Null');\n      htmlString +=\n        `<tr><td align='left'><img src=\"` +\n        src +\n        `\" alt ='' /></td><td class=\"mat-typography\">` +\n        label +\n        '</td></tr>';\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceTileArcGISRest from 'ol/source/TileArcGISRest';\nimport { Options } from 'ol/source/TileArcGISRest';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { TileArcGISRestDataSourceOptions } from './tilearcgisrest-datasource.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\n\nexport class TileArcGISRestDataSource extends DataSource {\n  public ol: olSourceTileArcGISRest;\n  public options: TileArcGISRestDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): olSourceTileArcGISRest {\n    return new olSourceTileArcGISRest(this.options as Options);\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.legendInfo;\n    const legend = super.getLegend();\n    if (legendInfo === undefined || this.options.layer === undefined || legend.length > 0) {\n      return legend;\n    }\n\n    if (!legendInfo) {\n      return;\n    }\n    let htmlString = '<table>';\n\n    for (const legendElement of legendInfo.legend) {\n      const src = `${this.options.url}/${legendInfo.layerId}/images/${legendElement.url}`;\n      const label = legendElement.label.replace('<Null>', 'Null');\n      htmlString +=\n        `<tr><td align='left'><img src=\"` +\n        src +\n        `\" alt ='' /></td><td class=\"mat-typography\">` +\n        label +\n        '</td></tr>';\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  public onUnwatch() {}\n}\n","import TileDebug from 'ol/source/TileDebug';\nimport TileGrid from 'ol/tilegrid/TileGrid';\n\nimport { DataSource } from './datasource';\nimport { TileDebugDataSourceOptions } from './tiledebug-datasource.interface';\n\nexport class TileDebugDataSource extends DataSource {\n  public options: TileDebugDataSourceOptions;\n  public ol: TileDebug;\n\n  protected createOlSource(): TileDebug {\n    const baseOptions = JSON.parse(JSON.stringify(this.options)); // to avoid to alter the original options\n    if (this.options.tileGrid) {\n      delete baseOptions.tileGrid;\n      baseOptions.tileGrid = new TileGrid(this.options.tileGrid);\n    }\n    return new TileDebug(baseOptions);\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceVector from 'ol/source/Vector';\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { FeatureDataSource } from './feature-datasource';\nimport { WebSocketDataSourceOptions } from './websocket-datasource.interface';\n\nexport class WebSocketDataSource extends FeatureDataSource {\n  public ws: WebSocket;\n  public options: WebSocketDataSourceOptions;\n\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    this.createWebSocket();\n    this.options.format = this.getSourceFormatFromOptions(this.options);\n    return super.createOlSource();\n  }\n\n  private createWebSocket() {\n    this.ws = new WebSocket(this.options.url);\n    this.ws.onmessage = this.onMessage.bind(this);\n\n    if (this.options.onclose) {\n      this.ws.onclose = this.onClose.bind(this);\n    }\n\n    if (this.options.onerror) {\n      this.ws.onerror = this.onError.bind(this);\n    }\n\n    if (this.options.onopen) {\n      this.ws.onopen = this.onOpen.bind(this);\n    }\n  }\n\n  onMessage(event) {\n    const featureAdded = this.options.format.readFeature(event.data) as olFeature<OlGeometry>;\n\n    switch (this.options.onmessage) {\n      case 'update':\n        // ol don't add if same ID\n        const featureToRemove = this.ol.getFeatureById(featureAdded.getId());\n        if (featureToRemove) {\n          this.ol.removeFeature(featureToRemove);\n        }\n        this.ol.addFeature(featureAdded);\n        break;\n      case 'delete':\n        this.ol.clear(true);\n        this.ol.addFeature(featureAdded);\n        break;\n      case 'add':\n      default:\n        this.ol.addFeature(featureAdded);\n    }\n  }\n\n  onClose(event) {\n    // thrown message to user\n  }\n\n  onError(event) {\n    // thrown message to user\n  }\n\n  onOpen(event) {\n    // thrown message to user ?\n  }\n\n  public onUnwatch() {\n    this.ws.close();\n  }\n}\n","import { Md5 } from 'ts-md5';\nimport feature from 'ol/Feature';\nimport olSourceVectorTile from 'ol/source/VectorTile';\nimport olFormatMVT from 'ol/format/MVT';\n\nimport { uuid } from '@igo2/utils';\n\nimport { DataSource } from './datasource';\nimport { MVTDataSourceOptions } from './mvt-datasource.interface';\n\nexport class MVTDataSource extends DataSource {\n  public options: MVTDataSourceOptions;\n  public ol: olSourceVectorTile;\n\n  protected createOlSource(): olSourceVectorTile {\n    let mvtFormat;\n    if (this.options.featureClass === 'feature') {\n      mvtFormat = new olFormatMVT({featureClass: feature});\n    } else {\n      mvtFormat = new olFormatMVT();\n    }\n    this.options.format = mvtFormat;\n    return new olSourceVectorTile(this.options);\n  }\n\n  protected generateId() {\n    if (!this.options.url) {\n        return uuid();\n    }\n    const chain = 'mvt' + this.options.url;\n    return Md5.hashStr(chain) as string;\n  }\n\n  public onUnwatch() {}\n}\n","import * as olstyle from 'ol/style';\nimport * as olproj from 'ol/proj';\n\nexport class EsriStyleGenerator {\n  public _converters: any;\n  public _renderers: any;\n\n  constructor() {\n    this._converters = {};\n    this._converters.esriPMS = EsriStyleGenerator._convertEsriPMS;\n    this._converters.esriSFS = EsriStyleGenerator._convertEsriSFS;\n    this._converters.esriSLS = EsriStyleGenerator._convertEsriSLS;\n    this._converters.esriSMS = EsriStyleGenerator._convertEsriSMS;\n    this._converters.esriTS = EsriStyleGenerator._convertEsriTS;\n    this._renderers = {};\n    this._renderers.uniqueValue = this._renderUniqueValue;\n    this._renderers.simple = this._renderSimple;\n    this._renderers.classBreaks = this._renderClassBreaks;\n  }\n  static _convertPointToPixel(point) {\n    return point / 0.75;\n  }\n  static _transformColor(color): [number, number, number, number] {\n    // alpha channel is different, runs from 0-255 but in ol3 from 0-1\n    return [color[0], color[1], color[2], color[3] / 255];\n  }\n\n  static _getResolutionForScale(scale, units) {\n    const dpi = 96;\n    const mpu = olproj.METERS_PER_UNIT[units];\n    const inchesPerMeter = 39.3701;\n    return parseFloat(scale) / (mpu * inchesPerMeter * dpi);\n  }\n\n  /* convert an Esri Text Symbol */\n  static _convertEsriTS(symbol) {\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n    const text = symbol.text !== undefined ? symbol.text : undefined;\n    return new olstyle.Style({\n      text: new olstyle.Text({\n        fill: new olstyle.Fill({\n          color: EsriStyleGenerator._transformColor(symbol.color)\n        }),\n        font:\n          symbol.font.style +\n          ' ' +\n          symbol.font.weight +\n          ' ' +\n          symbol.font.size +\n          ' px ' +\n          symbol.font.family,\n        textBaseline: symbol.verticalAlignment,\n        textAlign: symbol.horizontalAlignment,\n        offsetX: EsriStyleGenerator._convertPointToPixel(symbol.xoffset),\n        offsetY: EsriStyleGenerator._convertPointToPixel(symbol.yoffset),\n        rotation,\n        text\n      })\n    });\n  }\n  /* convert an Esri Picture Marker Symbol */\n  static _convertEsriPMS(symbol) {\n    const src = 'data:' + symbol.contentType + ';base64, ' + symbol.imageData;\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n\n    return new olstyle.Style({\n      image: new olstyle.Icon({\n        src,\n        rotation\n      })\n    });\n  }\n  /* convert an Esri Simple Fill Symbol */\n  static _convertEsriSFS(symbol) {\n    // there is no support in openlayers currently for fill patterns, so style is not interpreted\n    const fill = new olstyle.Fill({\n      color: EsriStyleGenerator._transformColor(symbol.color)\n    });\n    const stroke = symbol.outline\n      ? EsriStyleGenerator._convertOutline(symbol.outline)\n      : undefined;\n    return new olstyle.Style({\n      fill,\n      stroke\n    });\n  }\n  static _convertOutline(outline) {\n    let lineDash;\n    const color = EsriStyleGenerator._transformColor(outline.color);\n    if (outline.style === 'esriSLSDash') {\n      lineDash = [5];\n    } else if (outline.style === 'esriSLSDashDot') {\n      lineDash = [5, 5, 1, 2];\n    } else if (outline.style === 'esriSLSDashDotDot') {\n      lineDash = [5, 5, 1, 2, 1, 2];\n    } else if (outline.style === 'esriSLSDot') {\n      lineDash = [1, 2];\n    } else if (outline.style === 'esriSLSNull') {\n      // line not visible, make color fully transparent\n      color[3] = 0;\n    }\n    return new olstyle.Stroke({\n      color,\n      lineDash,\n      width: EsriStyleGenerator._convertPointToPixel(outline.width)\n    });\n  }\n  /* convert an Esri Simple Line Symbol */\n  static _convertEsriSLS(symbol) {\n    return new olstyle.Style({\n      stroke: EsriStyleGenerator._convertOutline(symbol)\n    });\n  }\n  static _transformAngle(angle) {\n    if (angle === 0 || angle === undefined) {\n      return undefined;\n    }\n    const normalRad = (angle * Math.PI) / 180;\n    const ol3Rad = -normalRad + Math.PI / 2;\n    if (ol3Rad < 0) {\n      return 2 * Math.PI + ol3Rad;\n    } else {\n      return ol3Rad;\n    }\n  }\n  /* convert an Esri Simple Marker Symbol */\n  static _convertEsriSMS(symbol) {\n    const fill = new olstyle.Fill({\n      color: EsriStyleGenerator._transformColor(symbol.color)\n    });\n    const stroke = symbol.outline\n      ? EsriStyleGenerator._convertOutline(symbol.outline)\n      : undefined;\n    const radius = EsriStyleGenerator._convertPointToPixel(symbol.size) / 2;\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n    if (symbol.style === 'esriSMSCircle') {\n      return new olstyle.Style({\n        image: new olstyle.Circle({\n          radius,\n          fill,\n          stroke\n        })\n      });\n    } else if (symbol.style === 'esriSMSCross') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          radius2: 0,\n          angle: 0,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSDiamond') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSSquare') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          angle: Math.PI / 4,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSX') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          radius2: 0,\n          angle: Math.PI / 4,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSTriangle') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 3,\n          radius,\n          angle: 0,\n          rotation\n        })\n      });\n    }\n  }\n\n  _convertLabelingInfo(labelingInfo, mapUnits) {\n    const styles = [];\n    for (let i = 0, ii = labelingInfo.length; i < ii; ++i) {\n      const labelExpression = labelingInfo[i].labelExpression;\n      // only limited support for label expressions\n      const field = labelExpression.substr(\n        labelExpression.indexOf('[') + 1,\n        labelExpression.indexOf(']') - 1\n      );\n      const symbol = labelingInfo[i].symbol;\n      const maxScale = labelingInfo[i].maxScale;\n      const minScale = labelingInfo[i].minScale;\n      let minResolution = null;\n      if (maxScale !== 0) {\n        minResolution = EsriStyleGenerator._getResolutionForScale(\n          maxScale,\n          mapUnits\n        );\n      }\n      let maxResolution = null;\n      if (minScale !== 0) {\n        maxResolution = EsriStyleGenerator._getResolutionForScale(\n          minScale,\n          mapUnits\n        );\n      }\n      const style = this._converters[symbol.type].call(this, symbol);\n      styles.push(\n        (() => {\n          return function(feature, resolution) {\n            let visible = true;\n            if (this.minResolution !== null && this.maxResolution !== null) {\n              visible =\n                resolution < this.maxResolution &&\n                resolution >= this.minResolution;\n            } else if (this.minResolution !== null) {\n              visible = resolution >= this.minResolution;\n            } else if (this.maxResolution !== null) {\n              visible = resolution < this.maxResolution;\n            }\n            if (visible) {\n              const value = feature.get(this.field);\n              this.style.getText().setText(value);\n              return [this.style];\n            }\n          };\n        })().bind({\n          minResolution,\n          maxResolution,\n          field,\n          style\n        })\n      );\n    }\n    return styles;\n  }\n\n  _renderSimple(renderer) {\n    const style = this._converters[renderer.symbol.type].call(\n      this,\n      renderer.symbol\n    );\n    return (() => {\n      return () => {\n        return [style];\n      };\n    })();\n  }\n  _renderClassBreaks(renderer) {\n    const defaultSymbol = renderer.defaultSymbol;\n    const defaultStyle = this._converters[defaultSymbol.type].call(\n      this,\n      defaultSymbol\n    );\n    const field = renderer.field;\n    const classes = [];\n    for (let i = 0, ii = renderer.classBreakInfos.length; i < ii; ++i) {\n      const classBreakInfo = renderer.classBreakInfos[i];\n      let min;\n      if (\n        classBreakInfo.classMinValue === null ||\n        classBreakInfo.classMinValue === undefined\n      ) {\n        if (i === 0) {\n          min = renderer.minValue;\n        } else {\n          min = renderer.classBreakInfos[i - 1].classMaxValue;\n        }\n      } else {\n        min = classBreakInfo.classMinValue;\n      }\n      const max = classBreakInfo.classMaxValue;\n      const symbol = classBreakInfo.symbol;\n      const style = this._converters[symbol.type].call(this, symbol);\n      classes.push({ min, max, style });\n    }\n    return (() => {\n      return (feature) => {\n        const value = feature.get(field);\n        for (let i = 0, ii = classes.length; i < ii; ++i) {\n          let condition;\n          if (i === 0) {\n            condition = value >= classes[i].min && value <= classes[i].max;\n          } else {\n            condition = value > classes[i].min && value <= classes[i].max;\n          }\n          if (condition) {\n            return [classes[i].style];\n          }\n        }\n        return [defaultStyle];\n      };\n    })();\n  }\n  _renderUniqueValue(renderer) {\n    const defaultSymbol = renderer.defaultSymbol;\n    let defaultStyle = [];\n    if (defaultSymbol) {\n      defaultStyle = [\n        this._converters[defaultSymbol.type].call(this, defaultSymbol)\n      ];\n    }\n    const field = renderer.field1;\n    const infos = renderer.uniqueValueInfos;\n    const me = this;\n    return (() => {\n      const hash = {};\n      for (let i = 0, ii = infos.length; i < ii; ++i) {\n        const info = infos[i];\n        const symbol = info.symbol;\n        hash[info.value] = [me._converters[symbol.type].call(me, symbol)];\n      }\n\n      return (feature) => {\n        const style = hash[feature.get(field)];\n        return style ? style : defaultStyle;\n      };\n    })();\n  }\n  generateStyle(layerInfo, mapUnits) {\n    const drawingInfo = layerInfo.drawingInfo;\n    let styleFunctions = [];\n    const drawingInfoStyle = this._renderers[drawingInfo.renderer.type].call(\n      this,\n      drawingInfo.renderer\n    );\n    if (drawingInfoStyle !== undefined) {\n      styleFunctions.push(drawingInfoStyle);\n    }\n    if (layerInfo.labelingInfo) {\n      const labelingInfoStyleFunctions = this._convertLabelingInfo(\n        layerInfo.labelingInfo,\n        mapUnits\n      );\n      styleFunctions = styleFunctions.concat(labelingInfoStyleFunctions);\n    }\n    if (styleFunctions.length === 1) {\n      return styleFunctions[0];\n    } else {\n      return (() => {\n        return (feature, resolution) => {\n          let styles = [];\n          for (let i = 0, ii = styleFunctions.length; i < ii; ++i) {\n            const result = styleFunctions[i].call(null, feature, resolution);\n            if (result) {\n              styles = styles.concat(result);\n            }\n          }\n          return styles;\n        };\n      })();\n    }\n  }\n}\n","export enum TimeFilterType {\n    DATE = 'date',\n    TIME = 'time',\n    DATETIME = 'datetime',\n    YEAR = 'year',\n}\n\nexport enum TimeFilterStyle {\n    CALENDAR = 'calendar',\n    SLIDER = 'slider',\n}\n","import { Injectable } from '@angular/core';\n\nimport { IgoMap } from './map';\n\n/**\n * MapService\n *\n * This service tracks the IgoMap instance, if any.\n * Currently, only one map instance is supported\n * but support for multiple maps may be added in the future.\n * This will impact other services such as the OverlayService\n * because these maps won't be sharing overlayed features.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class MapService {\n  private map: IgoMap;\n\n  constructor() {}\n\n  getMap(): IgoMap {\n    return this.map;\n  }\n\n  setMap(map: IgoMap) {\n    this.map = map;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport {\n  HttpClient,\n  HttpParams\n} from '@angular/common/http';\nimport { Observable, forkJoin, of } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\nimport { Cacheable } from 'ts-cacheable';\n\nimport { WMSCapabilities, WMTSCapabilities, EsriJSON } from 'ol/format';\nimport { optionsFromCapabilities } from 'ol/source/WMTS.js';\nimport olAttribution from 'ol/control/Attribution';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { MapService } from '../../map/shared/map.service';\nimport { getResolutionFromScale } from '../../map/shared/map.utils';\nimport { EsriStyleGenerator } from '../utils/esri-style-generator';\nimport {\n  QueryFormat,\n  QueryFormatMimeType\n} from '../../query/shared/query.enums';\n\nimport {\n  WMTSDataSourceOptions,\n  WMSDataSourceOptions,\n  CartoDataSourceOptions,\n  ArcGISRestDataSourceOptions,\n  TileArcGISRestDataSourceOptions,\n  ArcGISRestImageDataSourceOptions\n} from './datasources';\nimport {\n  LegendOptions,\n  ItemStyleOptions\n} from '../../layer/shared/layers/layer.interface';\nimport {\n  TimeFilterType,\n  TimeFilterStyle\n} from '../../filter/shared/time-filter.enum';\nimport * as olproj from 'ol/proj';\n\nexport enum TypeCapabilities {\n  wms = 'wms',\n  wmts = 'wmts',\n  arcgisrest = 'esriJSON',\n  imagearcgisrest = 'esriJSON',\n  tilearcgisrest = 'esriJSON'\n}\n\nexport type TypeCapabilitiesStrings = keyof typeof TypeCapabilities;\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CapabilitiesService {\n  private parsers = {\n    wms: new WMSCapabilities(),\n    wmts: new WMTSCapabilities(),\n    esriJSON: new EsriJSON()\n  };\n\n  constructor(private http: HttpClient, private mapService: MapService) {}\n\n  getWMSOptions(\n    baseOptions: WMSDataSourceOptions\n  ): Observable<WMSDataSourceOptions> {\n    const url = baseOptions.url;\n    const version = (baseOptions.params as any).VERSION;\n\n    return this.getCapabilities('wms', url, version).pipe(\n      map((capabilities: any) => {\n        return capabilities\n          ? this.parseWMSOptions(baseOptions, capabilities)\n          : undefined;\n      })\n    );\n  }\n\n  getWMTSOptions(\n    baseOptions: WMTSDataSourceOptions\n  ): Observable<WMTSDataSourceOptions> {\n    const url = baseOptions.url;\n    const version = baseOptions.version;\n\n    const options = this.getCapabilities('wmts', url, version).pipe(\n      map((capabilities: any) => {\n        return capabilities\n          ? this.parseWMTSOptions(baseOptions, capabilities)\n          : undefined;\n      })\n    );\n    return options;\n  }\n\n  getCartoOptions(\n    baseOptions: CartoDataSourceOptions\n  ): Observable<CartoDataSourceOptions> {\n    const baseUrl =\n      'https://' +\n      baseOptions.account +\n      '.carto.com/api/v2/viz/' +\n      baseOptions.mapId +\n      '/viz.json';\n\n    return this.http\n      .jsonp(baseUrl, 'callback')\n      .pipe(\n        map((cartoOptions: any) =>\n          this.parseCartoOptions(baseOptions, cartoOptions)\n        )\n      );\n  }\n\n  getArcgisOptions(\n    baseOptions: ArcGISRestDataSourceOptions\n  ): Observable<ArcGISRestDataSourceOptions> {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const modifiedUrl = baseOptions.url.replace('FeatureServer', 'MapServer');\n    const legendUrl = modifiedUrl + '/legend?f=json';\n    const serviceCapabilities = this.getCapabilities('arcgisrest', baseOptions.url);\n    const arcgisOptions = this.http.get(baseUrl);\n    const legend = this.http.get(legendUrl).pipe(\n      map((res: any) => res),\n      catchError((err) => {\n        console.log('No legend associated with this Feature Service');\n        return of(err);\n      })\n    );\n    return forkJoin([arcgisOptions, legend, serviceCapabilities]).pipe(\n      map((res: any) => {\n        return this.parseArcgisOptions(baseOptions, res[0], res[1], res[2]);\n      })\n    );\n  }\n\n  getImageArcgisOptions(\n    baseOptions: ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions\n  ): Observable<ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions> {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const modifiedUrl = baseOptions.url.replace('FeatureServer', 'MapServer');\n    const legendUrl = modifiedUrl + '/legend?f=json';\n    const serviceCapabilities = this.getCapabilities('imagearcgisrest', baseOptions.url);\n    const arcgisOptions = this.http.get(baseUrl);\n    const legend = this.http.get(legendUrl).pipe(\n      map((res: any) => res),\n      catchError((err) => {\n        console.log('No legend associated with this Image Service');\n        return of(err);\n      })\n    );\n    return forkJoin([arcgisOptions, legend, serviceCapabilities]).pipe(\n      map((res: any) => {\n        return this.parseTileOrImageArcgisOptions(baseOptions, res[0], res[1], res[2]);\n      })\n    );\n  }\n\n  getTileArcgisOptions(\n    baseOptions: TileArcGISRestDataSourceOptions\n  ): Observable<ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions> {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const legendUrl = baseOptions.url + '/legend?f=json';\n    const serviceCapabilities = this.getCapabilities('tilearcgisrest', baseOptions.url);\n    const arcgisOptions = this.http.get(baseUrl);\n    const legendInfo = this.http.get(legendUrl).pipe(\n      map((res: any) => res),\n      catchError((err) => {\n        console.log('No legend associated with this Tile Service');\n        return of(err);\n      })\n    );\n    return forkJoin([arcgisOptions, legendInfo, serviceCapabilities]).pipe(\n      map((res: any) =>\n        this.parseTileOrImageArcgisOptions(baseOptions, res[0], res[1], res[2])\n      )\n    );\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  getCapabilities(\n    service: TypeCapabilitiesStrings,\n    baseUrl: string,\n    version?: string\n  ): Observable<any> {\n    const params = new HttpParams({\n      fromObject: {\n        request: 'GetCapabilities',\n        service: service.toUpperCase(),\n        version: version || '1.3.0',\n        _i: 'true'\n      }\n    });\n\n    let request;\n    if (TypeCapabilities[service] === 'esriJSON') {\n      request = this.http.get(baseUrl + '?f=json');\n    } else {\n      request = this.http.get(baseUrl, {\n        params,\n        responseType: 'text'\n      });\n    }\n\n    return request.pipe(\n      map((res) => {\n        if (TypeCapabilities[service] === 'esriJSON') {\n          return res as object;\n        }\n        if (\n          String(res).toLowerCase().includes('serviceexception') &&\n          String(res).toLowerCase().includes('access denied')\n        ) {\n          throw {\n            error: {\n              message: 'Service error getCapabilities: Access is denied'\n            }\n          };\n        } else {\n          return this.parsers[service].read(res);\n        }\n      }),\n      catchError((e) => {\n        if (typeof e.error !== 'undefined') {\n          e.error.caught = true;\n        }\n        throw e;\n      })\n    );\n  }\n\n  private parseWMSOptions(\n    baseOptions: WMSDataSourceOptions,\n    capabilities: any\n  ): WMSDataSourceOptions {\n    const layers = (baseOptions.params as any).LAYERS;\n    const layer = this.findDataSourceInCapabilities(\n      capabilities.Capability.Layer,\n      layers\n    );\n\n    if (!layer) {\n      throw {\n        error: {\n          message: 'Layer not found'\n        }\n      };\n    }\n    const metadata = layer.DataURL ? layer.DataURL[0] : undefined;\n    const abstract = layer.Abstract ? layer.Abstract : undefined;\n    const keywordList = layer.KeywordList ? layer.KeywordList : undefined;\n    let queryable = layer.queryable;\n    const timeFilter = this.getTimeFilter(layer);\n    const timeFilterable = timeFilter && Object.keys(timeFilter).length > 0;\n    const legendOptions = layer.Style ? this.getStyle(layer.Style) : undefined;\n    let isExtentInGeographic = true;\n    if (layer.EX_GeographicBoundingBox) {\n      layer.EX_GeographicBoundingBox.forEach((coord, index) => {\n        if (index < 2 && (coord > 180 || coord < -180)) {\n          isExtentInGeographic = false;\n        }\n        if (index >= 2 && (coord > 90 || coord < -90)) {\n          isExtentInGeographic = false;\n        }\n      });\n    } else {\n      isExtentInGeographic = false;\n    }\n\n    const extent = isExtentInGeographic ?\n        olproj.transformExtent(layer.EX_GeographicBoundingBox, 'EPSG:4326', this.mapService.getMap().projection) :\n        undefined;\n\n    let queryFormat: QueryFormat;\n    const queryFormatMimeTypePriority = [\n      QueryFormatMimeType.GEOJSON,\n      QueryFormatMimeType.GEOJSON2,\n      QueryFormatMimeType.GML3,\n      QueryFormatMimeType.GML2,\n      QueryFormatMimeType.JSON,\n      QueryFormatMimeType.HTML\n    ];\n\n    for (const mimeType of queryFormatMimeTypePriority) {\n      if (\n        capabilities.Capability.Request.GetFeatureInfo.Format.indexOf(\n          mimeType\n        ) !== -1\n      ) {\n        const keyEnum = Object.keys(QueryFormatMimeType).find(\n          (key) => QueryFormatMimeType[key] === mimeType\n        );\n        queryFormat = QueryFormat[keyEnum];\n        break;\n      }\n    }\n    if (!queryFormat) {\n      queryable = false;\n    }\n\n    const options: WMSDataSourceOptions = ObjectUtils.removeUndefined({\n      _layerOptionsFromSource: {\n        title: layer.Title,\n        maxResolution: getResolutionFromScale(layer.MaxScaleDenominator),\n        minResolution: getResolutionFromScale(layer.MinScaleDenominator),\n        extent,\n        metadata: {\n          url: metadata ? metadata.OnlineResource : undefined,\n          extern: metadata ? true : undefined,\n          abstract,\n          keywordList\n        },\n        legendOptions\n      },\n      queryable,\n      queryFormat,\n      timeFilter: timeFilterable ? timeFilter : undefined,\n      timeFilterable: timeFilterable ? true : undefined,\n      minDate: timeFilterable ? timeFilter.min : undefined,\n      maxDate: timeFilterable ? timeFilter.max : undefined,\n      stepDate: timeFilterable ? timeFilter.step : undefined\n    });\n\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseWMTSOptions(\n    baseOptions: WMTSDataSourceOptions,\n    capabilities: any\n  ): WMTSDataSourceOptions {\n    // Put Title source in _layerOptionsFromSource. (For source & catalog in _layerOptionsFromSource, if not already on config)\n    const layer = capabilities.Contents.Layer.find(\n      (el) => el.Identifier === baseOptions.layer\n    );\n\n    const options = optionsFromCapabilities(capabilities, baseOptions);\n\n    const ouputOptions = Object.assign(options, baseOptions);\n    const sourceOptions = ObjectUtils.removeUndefined({\n      _layerOptionsFromSource: {\n        title: layer.Title\n      }\n    });\n\n    return ObjectUtils.mergeDeep(sourceOptions, ouputOptions);\n  }\n\n  private parseCartoOptions(\n    baseOptions: CartoDataSourceOptions,\n    cartoOptions: any\n  ): CartoDataSourceOptions {\n    const layers = [];\n    const params = cartoOptions.layers[1].options.layer_definition;\n    params.layers.forEach((element) => {\n      layers.push({\n        type: element.type.toLowerCase(),\n        options: element.options,\n        legend: element.legend\n      });\n    });\n    const options = ObjectUtils.removeUndefined({\n      config: {\n        version: params.version,\n        layers\n      }\n    });\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseArcgisOptions(\n    baseOptions: ArcGISRestDataSourceOptions,\n    arcgisOptions: any,\n    legend: any,\n    serviceCapabilities: any,\n  ): ArcGISRestDataSourceOptions {\n    const title = arcgisOptions.name;\n    let legendInfo: any;\n\n    if (legend.layers) {\n      legendInfo = legend.layers.find(x => x.layerName === title);\n    } else if (arcgisOptions.drawingInfo?.renderer) {\n      legendInfo = arcgisOptions.drawingInfo.renderer;\n    } else {\n      legendInfo = undefined;\n    }\n\n    let style;\n    if (arcgisOptions.drawingInfo) {\n      const styleGenerator = new EsriStyleGenerator();\n      const units = arcgisOptions.units === 'esriMeters' ? 'm' : 'degrees';\n      style = styleGenerator.generateStyle(arcgisOptions, units);\n    }\n    const attributions = new olAttribution({\n      target: arcgisOptions.copyrightText\n    });\n    let timeExtent;\n    let timeFilter;\n    if (arcgisOptions.timeInfo) {\n      const time = arcgisOptions.timeInfo.timeExtent;\n      timeExtent = time[0] + ',' + time[1];\n      const min = new Date();\n      min.setTime(time[0]);\n      const max = new Date();\n      max.setTime(time[1]);\n      timeFilter = {\n        min: min.toUTCString(),\n        max: max.toUTCString(),\n        range: true,\n        type: TimeFilterType.DATETIME,\n        style: TimeFilterStyle.CALENDAR\n      };\n    }\n    const params = Object.assign(\n      {},\n      {\n        style,\n        LAYERS: baseOptions.layer ? 'show:' + baseOptions.layer : undefined,\n        time: timeExtent\n      }\n    );\n    const options = ObjectUtils.removeUndefined({\n      params,\n      _layerOptionsFromSource: {\n        title,\n        minResolution: getResolutionFromScale(arcgisOptions.maxScale),\n        maxResolution: getResolutionFromScale(arcgisOptions.minScale),\n        metadata: {\n          extern: false,\n          abstract: arcgisOptions.description || serviceCapabilities.serviceDescription\n        },\n      },\n      legendInfo,\n      timeFilter,\n      sourceFields: arcgisOptions.fields,\n      queryTitle: arcgisOptions.displayField\n    });\n    options.attributions = attributions;\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseTileOrImageArcgisOptions(\n    baseOptions: TileArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions,\n    arcgisOptions: any,\n    legend: any,\n    serviceCapabilities: any\n  ): TileArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions {\n    const title = arcgisOptions.name;\n    const legendInfo = legend.layers ? legend.layers.find(x => x.layerName === title) : undefined;\n    const attributions = new olAttribution({\n      target: arcgisOptions.copyrightText\n    });\n    let timeExtent;\n    let timeFilter;\n    if (arcgisOptions.timeInfo) {\n      const time = arcgisOptions.timeInfo.timeExtent;\n      timeExtent = time[0] + ',' + time[1];\n      const min = new Date();\n      min.setTime(time[0]);\n      const max = new Date();\n      max.setTime(time[1]);\n      timeFilter = {\n        min: min.toUTCString(),\n        max: max.toUTCString(),\n        range: true,\n        type: TimeFilterType.DATETIME,\n        style: TimeFilterStyle.CALENDAR\n      };\n    }\n    const params = Object.assign(\n      {},\n      {\n        LAYERS: baseOptions.layer ? 'show:' + baseOptions.layer : undefined,\n        time: timeExtent\n      }\n    );\n    const options = ObjectUtils.removeUndefined({\n      params,\n      _layerOptionsFromSource: {\n        title,\n        minResolution: getResolutionFromScale(arcgisOptions.maxScale),\n        maxResolution: getResolutionFromScale(arcgisOptions.minScale),\n        metadata: {\n          extern: false,\n          abstract: arcgisOptions.description || serviceCapabilities.serviceDescription\n        },\n      },\n      legendInfo,\n      timeFilter,\n      sourceFields: arcgisOptions.fields,\n      queryTitle: arcgisOptions.displayField\n    });\n    options.attributions = attributions;\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private findDataSourceInCapabilities(layerArray, name): any {\n    if (Array.isArray(layerArray)) {\n      let layer;\n      layerArray.find((value) => {\n        layer = this.findDataSourceInCapabilities(value, name);\n        return layer !== undefined;\n      }, this);\n\n      return layer;\n    } else if (layerArray.Layer) {\n      return this.findDataSourceInCapabilities(layerArray.Layer, name);\n    } else {\n      if (layerArray.Name && layerArray.Name === name) {\n        return layerArray;\n      }\n      return undefined;\n    }\n  }\n\n  getTimeFilter(layer) {\n    let dimension;\n\n    if (layer.Dimension) {\n      const timeFilter: any = {};\n      dimension = layer.Dimension[0];\n\n      if (dimension.values) {\n        const minMaxDim = dimension.values.split('/');\n        timeFilter.min = minMaxDim[0] !== undefined ? minMaxDim[0] : undefined;\n        timeFilter.max = minMaxDim[1] !== undefined ? minMaxDim[1] : undefined;\n        timeFilter.step = minMaxDim[2] !== undefined ? minMaxDim[2] : undefined;\n      }\n\n      if (dimension.default) {\n        timeFilter.value = dimension.default;\n      }\n      return timeFilter;\n    }\n  }\n\n  getStyle(Style): LegendOptions {\n    const styleOptions: ItemStyleOptions[] = Style.map((style) => {\n      return {\n        name: style.Name,\n        title: style.Title\n      };\n    })\n      // Handle repeat the style \"default\" in output  (MapServer or OpenLayer)\n      .filter(\n        (item, index, self) =>\n          self.findIndex((i: ItemStyleOptions) => i.name === item.name) ===\n          index\n      );\n\n    const legendOptions: LegendOptions = {\n      stylesAvailable: styleOptions\n    } as LegendOptions;\n\n    return legendOptions;\n  }\n}\n","import { Observable } from 'rxjs';\n\nimport {\n  ArcGISRestDataSourceOptions,\n  ArcGISRestImageDataSourceOptions,\n  TileArcGISRestDataSourceOptions,\n  WMSDataSourceOptions\n} from '../datasources';\n\nexport abstract class OptionsService {\n  abstract getWMSOptions(\n    _baseOptions: WMSDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<WMSDataSourceOptions>;\n  abstract getArcgisRestOptions(\n    _baseOptions: ArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<ArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions>;\n}\n","import { Injectable } from '@angular/core';\n\nimport proj4 from 'proj4';\nimport * as olproj from 'ol/proj';\nimport * as olproj4 from 'ol/proj/proj4';\n\nimport { ConfigService } from '@igo2/core';\n\nimport { Projection } from './projection.interfaces';\n\n/**\n * When injected, this service automatically registers and\n * projection defined in the application config. A custom projection\n * needs to be registered to be usable by OL.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ProjectionService {\n\n  constructor(private config: ConfigService) {\n    const projections = this.config.getConfig('projections') || [];\n    projections.forEach((projection: Projection) => {\n      projection.alias = projection.alias ? projection.alias : projection.code;\n      this.registerProjection(projection);\n    });\n\n    // register all utm zones\n    for (let utmZone = 1; utmZone < 61; utmZone++) {\n      const code = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n      const def = `+proj=utm +zone=${utmZone} +datum=WGS84 +units=m +no_defs`;\n      const proj: Projection = { code, def, extent : undefined};\n      this.registerProjection(proj);\n    }\n\n    // register all mtm zones\n    for (let mtmZone = 1; mtmZone < 11; mtmZone++) {\n      const code = mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n      let lon0;\n      if (Number(mtmZone) <= 2) {\n        lon0 = -50 - Number(mtmZone) * 3;\n      } else if (Number(mtmZone) >= 12) {\n        lon0 = -81 - (Number(mtmZone) - 12) * 3;\n      } else {\n        lon0 = -49.5 - Number(mtmZone) * 3;\n      }\n      const def = `+proj=tmerc +lat_0=0 +lon_0=${lon0} +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs\"`;\n      const proj: Projection = { code, def, extent : undefined};\n      this.registerProjection(proj);\n    }\n  }\n\n  /**\n   * Define a proj4 projection and register it in OL\n   * @param projection Projection\n   */\n  registerProjection(projection: Projection) {\n    proj4.defs(projection.code, projection.def);\n    olproj4.register(proj4);\n    if (projection.extent) {\n      olproj.get(projection.code).setExtent(projection.extent);\n    }\n  }\n\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { forkJoin, of, Observable, BehaviorSubject } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\n\nimport { CapabilitiesService } from './capabilities.service';\nimport { OptionsService } from './options/options.service';\nimport { WFSService } from './datasources/wfs.service';\nimport {\n  DataSource,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  FeatureDataSource,\n  FeatureDataSourceOptions,\n  XYZDataSource,\n  XYZDataSourceOptions,\n  TileDebugDataSource,\n  TileDebugDataSourceOptions,\n  WFSDataSource,\n  WFSDataSourceOptions,\n  WMTSDataSource,\n  WMTSDataSourceOptions,\n  WMSDataSource,\n  WMSDataSourceOptions,\n  CartoDataSource,\n  CartoDataSourceOptions,\n  ArcGISRestDataSource,\n  ArcGISRestDataSourceOptions,\n  ImageArcGISRestDataSource,\n  ArcGISRestImageDataSourceOptions,\n  TileArcGISRestDataSource,\n  TileArcGISRestDataSourceOptions,\n  WebSocketDataSource,\n  AnyDataSourceOptions,\n  MVTDataSource,\n  MVTDataSourceOptions,\n  ClusterDataSource,\n  ClusterDataSourceOptions\n} from './datasources';\nimport { ObjectUtils } from '@igo2/utils';\nimport { LanguageService, MessageService } from '@igo2/core';\nimport { ProjectionService } from '../../map/shared/projection.service';\nimport { AuthInterceptor } from '@igo2/auth';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DataSourceService {\n  public datasources$ = new BehaviorSubject<DataSource[]>([]);\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    @Optional() private optionsService: OptionsService,\n    private wfsDataSourceService: WFSService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private projectionService: ProjectionService,\n    private authInterceptor?: AuthInterceptor\n  ) {}\n\n  createAsyncDataSource(context: AnyDataSourceOptions, detailedContextUri?: string): Observable<DataSource> {\n    if (!context.type) {\n      console.error(context);\n      throw new Error('Datasource needs a type');\n    }\n    let dataSource;\n    switch (context.type.toLowerCase()) {\n      case 'osm':\n        dataSource = this.createOSMDataSource(context as OSMDataSourceOptions);\n        break;\n      case 'vector':\n        dataSource = this.createFeatureDataSource(\n          context as FeatureDataSourceOptions\n        );\n        break;\n      case 'wfs':\n        dataSource = this.createWFSDataSource(context as WFSDataSourceOptions);\n        break;\n      case 'wms':\n        const wmsContext = context as WMSDataSourceOptions;\n        ObjectUtils.removeDuplicateCaseInsensitive(wmsContext.params);\n        dataSource = this.createWMSDataSource(wmsContext, detailedContextUri);\n        break;\n      case 'wmts':\n        dataSource = this.createWMTSDataSource(\n          context as WMTSDataSourceOptions\n        );\n        break;\n      case 'xyz':\n        dataSource = this.createXYZDataSource(context as XYZDataSourceOptions);\n        break;\n      case 'tiledebug':\n        dataSource = this.createTileDebugDataSource(context as TileDebugDataSource);\n        break;\n      case 'carto':\n        dataSource = this.createCartoDataSource(\n          context as CartoDataSourceOptions\n        );\n        break;\n      case 'arcgisrest':\n        dataSource = this.createArcGISRestDataSource(\n          context as ArcGISRestDataSourceOptions, detailedContextUri\n        );\n        break;\n      case 'imagearcgisrest':\n        dataSource = this.createArcGISRestImageDataSource(\n          context as ArcGISRestImageDataSourceOptions, detailedContextUri\n        );\n        break;\n      case 'websocket':\n        dataSource = this.createWebSocketDataSource(\n          context as FeatureDataSourceOptions\n        );\n        break;\n      case 'mvt':\n        dataSource = this.createMVTDataSource(context as MVTDataSourceOptions);\n        break;\n      case 'tilearcgisrest':\n        dataSource = this.createTileArcGISRestDataSource(\n          context as TileArcGISRestDataSourceOptions, detailedContextUri\n        );\n        break;\n      case 'cluster':\n        dataSource = this.createClusterDataSource(\n          context as ClusterDataSourceOptions\n        );\n        break;\n      default:\n        console.error(context);\n        throw new Error('Invalid datasource type');\n    }\n\n    this.datasources$.next(this.datasources$.value.concat([dataSource]));\n\n    return dataSource;\n  }\n\n  private createOSMDataSource(\n    context: OSMDataSourceOptions\n  ): Observable<OSMDataSource> {\n    return new Observable(d => d.next(new OSMDataSource(context)));\n  }\n\n  private createFeatureDataSource(\n    context: FeatureDataSourceOptions\n  ): Observable<FeatureDataSource> {\n    return new Observable(d => d.next(new FeatureDataSource(context)));\n  }\n\n  private createWebSocketDataSource(\n    context: FeatureDataSourceOptions\n  ): Observable<WebSocketDataSource> {\n    return new Observable(d => d.next(new WebSocketDataSource(context)));\n  }\n\n  private createWFSDataSource(\n    context: WFSDataSourceOptions\n  ): Observable<WFSDataSource> {\n    return new Observable(d =>\n      d.next(new WFSDataSource(context, this.wfsDataSourceService, this.authInterceptor))\n    );\n  }\n\n  private createWMSDataSource(context: WMSDataSourceOptions, detailedContextUri?: string): Observable<any> {\n    const observables = [];\n    if (context.optionsFromCapabilities) {\n      observables.push(\n        this.capabilitiesService.getWMSOptions(context).pipe(\n          catchError(e => {\n            const title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            const message = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailable',\n              { value: context.params.LAYERS }\n            );\n\n            this.messageService.error(message, title);\n            throw e;\n          })\n        )\n      );\n    }\n\n    if (this.optionsService && context.optionsFromApi === true) {\n      observables.push(\n        this.optionsService.getWMSOptions(context, detailedContextUri).pipe(\n          catchError(e => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n\n    observables.push(of(context));\n\n    return forkJoin(observables).pipe(\n      map((options: WMSDataSourceOptions[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new WMSDataSource(optionsMerged, this.wfsDataSourceService);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createWMTSDataSource(\n    context: WMTSDataSourceOptions\n  ): Observable<WMTSDataSource> {\n    if (context.optionsFromCapabilities) {\n      return this.capabilitiesService.getWMTSOptions(context).pipe(\n        map((options: WMTSDataSourceOptions) => {\n          return options ? new WMTSDataSource(options) : undefined;\n        }),\n        catchError(() => {\n          const title = this.languageService.translate.instant(\n            'igo.geo.dataSource.unavailableTitle'\n          );\n          const message = this.languageService.translate.instant(\n            'igo.geo.dataSource.unavailable',\n            { value: context.layer }\n          );\n\n          this.messageService.error(message, title);\n          return of(undefined);\n        })\n      );\n    }\n\n    return new Observable(d => d.next(new WMTSDataSource(context)));\n  }\n\n  private createXYZDataSource(\n    context: XYZDataSourceOptions\n  ): Observable<XYZDataSource> {\n    return new Observable(d => d.next(new XYZDataSource(context)));\n  }\n\n  private createTileDebugDataSource(\n    context: TileDebugDataSourceOptions\n  ): Observable<TileDebugDataSource> {\n    return new Observable(d => d.next(new TileDebugDataSource(context)));\n  }\n\n  private createCartoDataSource(\n    context: CartoDataSourceOptions\n  ): Observable<CartoDataSource> {\n    if (context.mapId) {\n      return this.capabilitiesService\n        .getCartoOptions(context)\n        .pipe(\n          map((options: CartoDataSourceOptions) => new CartoDataSource(options))\n        );\n    }\n    return new Observable(d => d.next(new CartoDataSource(context)));\n  }\n\n  private createArcGISRestDataSource(\n    context: ArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<ArcGISRestDataSource> {\n    const observables = [];\n    observables.push(this.capabilitiesService.getArcgisOptions(context).pipe(\n      catchError(e => {\n        const title = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailableTitle'\n        );\n        const message = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailable',\n          { value: context.layer }\n        );\n\n        this.messageService.error(message, title);\n        throw e;\n      })\n    ));\n    if (this.optionsService && context.optionsFromApi === true) {\n      observables.push(\n        this.optionsService.getArcgisRestOptions(context, detailedContextUri).pipe(\n          catchError(e => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: ArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new ArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createArcGISRestImageDataSource(\n    context: ArcGISRestImageDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<ArcGISRestImageDataSourceOptions> {\n    const observables = [];\n\n    observables.push(this.capabilitiesService.getImageArcgisOptions(context).pipe(\n      catchError(e => {\n        const title = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailableTitle'\n        );\n        const message = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailable',\n          { value: context.params.LAYERS }\n        );\n\n        this.messageService.error(message, title);\n        throw e;\n      })\n    ));\n    if (this.optionsService && context.optionsFromApi === true) {\n      observables.push(\n        this.optionsService.getArcgisRestOptions(context, detailedContextUri).pipe(\n          catchError(e => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: ImageArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new ImageArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createTileArcGISRestDataSource(\n    context: TileArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<TileArcGISRestDataSource> {\n    const observables = [];\n    observables.push(this.capabilitiesService.getImageArcgisOptions(context).pipe(\n      catchError(e => {\n        const title = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailableTitle'\n        );\n        const message = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailable',\n          { value: context.params.LAYERS }\n        );\n\n        this.messageService.error(message, title);\n        throw e;\n      })\n    ));\n    if (this.optionsService && context.optionsFromApi === true) {\n      observables.push(\n        this.optionsService.getArcgisRestOptions(context, detailedContextUri).pipe(\n          catchError(e => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: TileArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new TileArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createMVTDataSource(\n    context: MVTDataSourceOptions\n  ): Observable<MVTDataSource> {\n    return new Observable(d => d.next(new MVTDataSource(context)));\n  }\n\n  private createClusterDataSource(\n    context: ClusterDataSourceOptions\n  ): Observable<ClusterDataSource> {\n    return new Observable(d => d.next(new ClusterDataSource(context)));\n  }\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\nimport { Observable, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport {\n  ArcGISRestDataSourceOptions,\n  ArcGISRestImageDataSourceOptions,\n  TileArcGISRestDataSourceOptions,\n  WMSDataSourceOptions\n} from '../datasources';\nimport { OptionsService } from './options.service';\nimport { OptionsApiOptions } from './options-api.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class OptionsApiService extends OptionsService {\n  private urlApi: string;\n  private provideContextUri: boolean;\n\n  constructor(\n    private http: HttpClient,\n    @Inject('options') options: OptionsApiOptions = {}\n  ) {\n    super();\n    this.urlApi = options.url || this.urlApi;\n    this.provideContextUri = options.provideContextUri || this.provideContextUri;\n  }\n\n  getWMSOptions(\n    baseOptions: WMSDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<WMSDataSourceOptions> {\n    if (!this.urlApi) {\n      return of({} as WMSDataSourceOptions);\n    }\n    let params = new HttpParams({\n      fromObject: {\n        type: baseOptions.type,\n        url: baseOptions.url,\n        layers: baseOptions.params.LAYERS\n      }\n    });\n\n    if (detailedContextUri && this.provideContextUri) {\n      params = params.append('context', detailedContextUri);\n    }\n\n    const request = this.http.get(this.urlApi, {\n      params\n    });\n\n    return request.pipe(\n      map(\n        (res: {\n          sourceOptions: WMSDataSourceOptions;\n          layerOptions: { [keys: string]: string };\n        }) => {\n          if (!res || !res.sourceOptions) {\n            return {} as WMSDataSourceOptions;\n          }\n          if (res.layerOptions) {\n            res.sourceOptions._layerOptionsFromSource = res.layerOptions;\n          }\n          return res.sourceOptions;\n        }\n      )\n    );\n  }\n\n\n  getArcgisRestOptions(\n    baseOptions: ArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<ArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions> {\n    if (!this.urlApi) {\n      return of({} as ArcGISRestImageDataSourceOptions);\n    }\n    let params = new HttpParams({\n      fromObject: {\n        type: baseOptions.type,\n        url: baseOptions.url,\n        layers: baseOptions.layer\n      }\n    });\n\n    if (detailedContextUri && this.provideContextUri) {\n      params = params.append('context', detailedContextUri);\n    }\n\n    const request = this.http.get(this.urlApi, {\n      params\n    });\n\n    return request.pipe(\n      map(\n        (res: {\n          sourceOptions: ArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions;\n          layerOptions: { [keys: string]: string };\n        }) => {\n          if (!res || !res.sourceOptions) {\n            return {} as ArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions;\n          }\n          if (res.layerOptions) {\n            res.sourceOptions._layerOptionsFromSource = res.layerOptions;\n          }\n          return res.sourceOptions;\n        }\n      )\n    );\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService } from '@igo2/core';\n\nimport { OptionsService } from './options.service';\nimport { OptionsApiService } from './options-api.service';\n\nexport function optionsApiFactory(\n  http: HttpClient,\n  configService: ConfigService\n) {\n  return new OptionsApiService(\n    http,\n    configService.getConfig('optionsApi'),\n  );\n}\n\nexport function provideOptionsApi() {\n  return {\n    provide: OptionsService,\n    useFactory: optionsApiFactory,\n    deps: [HttpClient, ConfigService]\n  };\n}\n","import * as olextent from 'ol/extent';\nimport * as olproj from 'ol/proj';\nimport * as olstyle from 'ol/style';\nimport OlFeature from 'ol/Feature';\nimport OlGeometryLayout from 'ol/geom/GeometryLayout';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlPoint from 'ol/geom/Point';\nimport OlLineString from 'ol/geom/LineString';\nimport OlRenderFeature from 'ol/render/Feature';\nimport OlFormatGeoJSON from 'ol/format/GeoJSON';\nimport OlLayer from 'ol/layer/Layer';\nimport OlSource from 'ol/source/Source';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { uuid } from '@igo2/utils';\n\nimport {\n  EntityKey,\n  getEntityId,\n  getEntityTitle,\n  getEntityRevision,\n  getEntityIcon,\n  getEntityProperty\n} from '@igo2/common';\n\nimport { IgoMap } from '../../map';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { FeatureDataSource } from '../../datasource';\nimport { FEATURE, FeatureMotion } from './feature.enums';\nimport { Feature, FeatureGeometry } from './feature.interfaces';\nimport { FeatureStore } from './store';\n\n/**\n * Create an Openlayers feature object out of a feature definition.\n * The output object has a reference to the feature id.\n * @param feature Feature definition\n * @param projectionOut Feature object projection\n * @returns OpenLayers feature object\n */\nexport function featureToOl(\n  feature: Feature,\n  projectionOut: string,\n  getId?: (Feature) => EntityKey\n): OlFeature<OlGeometry> {\n  getId = getId ? getId : getEntityId;\n\n  const olFormat = new OlFormatGeoJSON();\n  const olFeature = olFormat.readFeature(feature, {\n    dataProjection: feature.projection,\n    featureProjection: projectionOut\n  });\n\n  olFeature.setId(getId(feature));\n\n  const title = getEntityTitle(feature);\n  if (title !== undefined) {\n    olFeature.set('_title', title, true);\n  }\n\n  if (feature.extent !== undefined) {\n    olFeature.set('_extent', feature.extent, true);\n  }\n\n  if (feature.projection !== undefined) {\n    olFeature.set('_projection', feature.projection, true);\n  }\n\n  const mapTitle = getEntityProperty(feature, 'meta.mapTitle');\n  if (mapTitle !== undefined) {\n    olFeature.set('_mapTitle', mapTitle, true);\n  }\n\n  olFeature.set('_entityRevision', getEntityRevision(feature), true);\n\n  const icon = getEntityIcon(feature);\n  if (icon !== undefined) {\n    olFeature.set('_icon', icon, true);\n  }\n\n  if (feature.meta && feature.meta.style) {\n    olFeature.set('_style', feature.meta.style, true);\n  }\n\n  if (feature.sourceId) {\n    olFeature.set('_sourceId', feature.sourceId, true);\n  }\n\n  return olFeature;\n}\n\nexport function renderFeatureFromOl(\n  olRenderFeature: OlRenderFeature,\n  projectionIn: string,\n  olLayer?: OlLayer<OlSource>,\n  projectionOut = 'EPSG:4326'\n): Feature {\n  let geom;\n  let title;\n  let exclude;\n  let excludeOffline;\n\n  if (olLayer) {\n    title = olLayer.get('title');\n    if (olLayer.get('sourceOptions')) {\n      exclude = olLayer.get('sourceOptions').excludeAttribute;\n      excludeOffline = olLayer.get('sourceOptions').excludeAttributeOffline;\n    }\n  } else {\n    title = olRenderFeature.get('_title');\n  }\n\n  const olFormat = new OlFormatGeoJSON();\n  const properties = olRenderFeature.getProperties();\n  const geometryType = olRenderFeature.getType();\n\n  if (geometryType === 'Polygon') {\n    const ends = olRenderFeature.getEnds() as number[];\n    geom = new OlPolygon(\n      olRenderFeature.getFlatCoordinates(),\n      OlGeometryLayout.XY,\n      ends\n    );\n  } else if (geometryType === 'Point') {\n    geom = new OlPoint(olRenderFeature.getFlatCoordinates(), OlGeometryLayout.XY);\n  } else if (geometryType === 'LineString') {\n    geom = new OlLineString(\n      olRenderFeature.getFlatCoordinates(),\n      OlGeometryLayout.XY\n    );\n  }\n\n  const geometry = olFormat.writeGeometryObject(geom, {\n    dataProjection: projectionOut,\n    featureProjection: projectionIn\n  }) as FeatureGeometry;\n\n  const id = olRenderFeature.getId() ? olRenderFeature.getId() : uuid();\n  const mapTitle = olRenderFeature.get('_mapTitle');\n  const extent = olproj.transformExtent(olRenderFeature.getExtent(), projectionIn, projectionOut) as [number, number, number, number];\n  return {\n    type: FEATURE,\n    projection: projectionOut,\n    extent,\n    meta: {\n      id,\n      title: title ? title : mapTitle ? mapTitle : id,\n      mapTitle,\n      excludeAttribute: exclude,\n      excludeAttributeOffline: excludeOffline\n    },\n    properties,\n    geometry,\n    ol: olRenderFeature\n  };\n}\n/**\n * Create a feature object out of an OL feature\n * The output object has a reference to the feature id.\n * @param olFeature OL Feature\n * @param projectionIn OL feature projection\n * @param olLayer OL Layer\n * @param projectionOut Feature projection\n * @returns Feature\n */\nexport function featureFromOl(\n  olFeature: OlFeature<OlGeometry>,\n  projectionIn: string,\n  olLayer?: OlLayer<OlSource>,\n  projectionOut = 'EPSG:4326'\n): Feature {\n  let title;\n  let exclude;\n  let excludeOffline;\n  let idColumn; // for arcgisrest and tilearcgisrest source\n  const olFormat = new OlFormatGeoJSON();\n\n  const keys = olFeature.getKeys().filter((key: string) => {\n    return !key.startsWith('_') && key !== 'geometry';\n  });\n  const properties = keys.reduce((acc: object, key: string) => {\n    acc[key] = olFeature.get(key);\n    return acc;\n  }, {});\n\n  const geometry = olFormat.writeGeometryObject(olFeature.getGeometry(), {\n    dataProjection: projectionOut,\n    featureProjection: projectionIn\n  }) as FeatureGeometry;\n\n  if (olLayer) {\n    title = olLayer.get('title');\n    const sourceOptions = olLayer.get('sourceOptions');\n    if (sourceOptions) {\n      exclude = sourceOptions.excludeAttribute;\n      excludeOffline = sourceOptions.excludeAttributeOffline;\n      idColumn =\n        sourceOptions.idColumn ||\n        ((sourceOptions.type === 'arcgisrest' || sourceOptions.type === 'tilearcgisrest') ? 'OBJECTID' : undefined );\n    }\n  } else {\n    title = olFeature.get('_title');\n  }\n  const mapTitle = olFeature.get('_mapTitle');\n  const id = olFeature.getId() ? olFeature.getId() : olFeature.get(idColumn) ? olFeature.get(idColumn) : uuid();\n  const newFeature = olFeature.get('_newFeature');\n\n  return {\n    type: FEATURE,\n    projection: projectionOut,\n    extent: olFeature.get('_extent'),\n    meta: {\n      id,\n      title: title ? title : mapTitle ? mapTitle : id,\n      mapTitle,\n      revision: olFeature.getRevision(),\n      style: olFeature.get('_style'),\n      excludeAttribute: exclude,\n      excludeAttributeOffline: excludeOffline\n    },\n    properties,\n    geometry,\n    ol: olFeature\n  };\n}\n\n/**\n * Compute an OL feature extent in it's map projection\n * @param map Map\n * @param olFeature OL feature\n * @returns Extent in the map projection\n */\nexport function computeOlFeatureExtent(\n  map: IgoMap,\n  olFeature: OlFeature<OlGeometry>\n): [number, number, number, number] {\n  let olExtent = olextent.createEmpty();\n\n  const olFeatureExtent = olFeature.get('_extent');\n  const olFeatureProjection = olFeature.get('_projection');\n  if (olFeatureExtent !== undefined && olFeatureProjection !== undefined) {\n    olExtent = olproj.transformExtent(\n      olFeatureExtent,\n      olFeatureProjection,\n      map.projection\n    );\n  } else {\n    const olGeometry = olFeature.getGeometry();\n    if (olGeometry !== null) {\n      olExtent = olGeometry.getExtent();\n    }\n  }\n\n  return olExtent as [number, number, number, number];\n}\n\n/**\n * Compute a multiple OL features extent in their map projection\n * @param map Map\n * @param olFeatures OL features\n * @returns Extent in the map projection\n */\nexport function computeOlFeaturesExtent(\n  map: IgoMap,\n  olFeatures: OlFeature<OlGeometry>[]\n): [number, number, number, number] {\n  const extent = olextent.createEmpty();\n\n  olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n    const featureExtent = computeOlFeatureExtent(map, olFeature);\n    olextent.extend(extent, featureExtent);\n  });\n\n  return extent as [number, number, number, number];\n}\n\n/**\n * Scale an extent.\n * @param extent Extent\n * @param Scaling factors for top, right, bottom and left directions, in that order\n * @returns Scaled extent\n */\nexport function scaleExtent(\n  extent: [number, number, number, number],\n  scale: [number, number, number, number]\n): [number, number, number, number] {\n  const [width, height] = olextent.getSize(extent);\n  return [\n    scale[3] ? extent[0] - width * scale[3] : extent[0],\n    scale[2] ? extent[1] - height * scale[2] : extent[1],\n    scale[1] ? extent[2] + width * scale[1] : extent[2],\n    scale[0] ? extent[3] + height * scale[0] : extent[3]\n  ];\n}\n\n/**\n * Return true if features are out of view.\n * If features are too close to the edge, they are considered out of view.\n * We define the edge as 5% of the extent size.\n * @param map Map\n * @param featuresExtent The features's extent\n * @returns Return true if features are out of view\n */\nexport function featuresAreOutOfView(\n  map: IgoMap,\n  featuresExtent: [number, number, number, number]\n) {\n  const mapExtent = map.viewController.getExtent();\n  const edgeRatio = 0.05;\n  const scale = [-1, -1, -1, -1].map(x => x * edgeRatio);\n  const viewExtent = scaleExtent(mapExtent, scale as [\n    number,\n    number,\n    number,\n    number\n  ]);\n\n  return !olextent.containsExtent(viewExtent, featuresExtent);\n}\n\n/**\n * Return true if features are too deep into the view. This results\n * in features being too small.\n * Features are considered too small if their extent occupies less than\n * 1% of the map extent.\n * @param map Map\n * @param featuresExtent The features's extent\n * @param areaRatio The features extent to view extent acceptable ratio\n * @returns Return true if features are too deep in the view\n */\nexport function featuresAreTooDeepInView(\n  map: IgoMap,\n  featuresExtent: [number, number, number, number],\n  areaRatio?: number\n) {\n  // An area ratio of 0.004 means that the feature extent's width and height\n  // should be about 1/16 of the map extent's width and height\n  areaRatio = areaRatio ? areaRatio : 0.004;\n  const mapExtent = map.viewController.getExtent();\n  const mapExtentArea = olextent.getArea(mapExtent);\n  const featuresExtentArea = olextent.getArea(featuresExtent);\n\n  if (featuresExtentArea === 0 && map.viewController.getZoom() > 13) {\n    // In case it's a point\n    return false;\n  }\n\n  return featuresExtentArea / mapExtentArea < areaRatio;\n}\n\n/**\n * Fit view to include the features extent.\n * By default, this method will let the features occupy about 50% of the viewport.\n * @param map Map\n * @param olFeatures OL features\n * @param motion To motion to the new map view\n * @param scale If this is defined, the original view will be scaled\n *  by that factor before any logic is applied.\n */\nexport function moveToOlFeatures(\n  map: IgoMap,\n  olFeatures: OlFeature<OlGeometry>[],\n  motion: FeatureMotion = FeatureMotion.Default,\n  scale?: [number, number, number, number],\n  areaRatio?: number\n) {\n  const featuresExtent = computeOlFeaturesExtent(map, olFeatures);\n  let viewExtent = featuresExtent;\n  if (scale !== undefined) {\n    viewExtent = scaleExtent(viewExtent, scale);\n  }\n\n  if (motion === FeatureMotion.Zoom) {\n    map.viewController.zoomToExtent(viewExtent);\n  } else if (motion === FeatureMotion.Move) {\n    map.viewController.moveToExtent(viewExtent);\n  } else if (motion === FeatureMotion.Default) {\n    if (\n      featuresAreOutOfView(map, featuresExtent) ||\n      featuresAreTooDeepInView(map, featuresExtent, areaRatio)\n    ) {\n      map.viewController.zoomToExtent(viewExtent);\n    }\n  }\n}\n\n/**\n * Hide an OL feature\n * @param olFeature OL feature\n */\nexport function hideOlFeature(olFeature: OlFeature<OlGeometry>) {\n  olFeature.setStyle(new olstyle.Style({}));\n}\n\n/**\n * Try to bind a layer to a store if none is bound already.\n * The layer will also be added to the store's map.\n * If no layer is given to that function, a basic one will be created.\n * @param store The store to bind the layer\n * @param layer An optional VectorLayer\n */\nexport function tryBindStoreLayer(store: FeatureStore, layer?: VectorLayer) {\n  if (store.layer !== undefined) {\n    if (store.layer.map === undefined) {\n      store.map.addLayer(store.layer);\n    }\n    return;\n  }\n\n  layer = layer\n    ? layer\n    : new VectorLayer({\n        source: new FeatureDataSource()\n      });\n  store.bindLayer(layer);\n  if (store.layer.map === undefined) {\n    store.map.addLayer(store.layer);\n  }\n}\n\n/**\n * Compute a diff between a source array of Ol features and a target array\n * @param source Source array of OL features\n * @param starget Target array of OL features\n * @returns Features to add and remove\n */\nexport function computeOlFeaturesDiff(\n  source: OlFeature<OlGeometry>[],\n  target: OlFeature<OlGeometry>[]\n): {\n  add: OlFeature<OlGeometry>[];\n  remove: OlFeature<OlGeometry>[];\n} {\n  const olFeaturesMap = new Map();\n  target.forEach((olFeature: OlFeature<OlGeometry>) => {\n    olFeaturesMap.set(olFeature.getId(), olFeature);\n  });\n\n  const olFeaturesToRemove = [];\n  source.forEach((olFeature: OlFeature<OlGeometry>) => {\n    const newOlFeature = olFeaturesMap.get(olFeature.getId());\n    if (newOlFeature === undefined) {\n      olFeaturesToRemove.push(olFeature);\n    } else if (\n      newOlFeature.get('_entityRevision') !== olFeature.get('_entityRevision')\n    ) {\n      olFeaturesToRemove.push(olFeature);\n    } else {\n      olFeaturesMap.delete(newOlFeature.getId());\n    }\n  });\n\n  const olFeaturesToAddIds = Array.from(olFeaturesMap.keys());\n  const olFeaturesToAdd = target.filter((olFeature: OlFeature<OlGeometry>) => {\n    return olFeaturesToAddIds.indexOf(olFeature.getId()) >= 0;\n  });\n\n  return {\n    add: olFeaturesToAdd,\n    remove: olFeaturesToRemove\n  };\n}\n","import OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport {\n  getEntityId,\n  EntityKey,\n  EntityStore\n} from '@igo2/common';\n\nimport { FeatureDataSource } from '../../datasource';\nimport { VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\n\nimport { FeatureMotion } from './feature.enums';\nimport { Feature, FeatureStoreOptions } from './feature.interfaces';\nimport { computeOlFeaturesDiff, featureFromOl, featureToOl, moveToOlFeatures } from './feature.utils';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * features and the map layer to display them on. Synchronization\n * between the store and the layer is handled by strategies.\n */\nexport class FeatureStore<T extends Feature = Feature> extends EntityStore<T> {\n\n  /**\n   * Vector layer to display the features on\n   */\n  layer: VectorLayer;\n\n  /**\n   * The map the layer is bound to\n   */\n  readonly map: IgoMap;\n\n  /**\n   * The layer's data source\n   */\n  get source(): FeatureDataSource {\n    return this.layer ? this.layer.dataSource as FeatureDataSource : undefined;\n  }\n\n  constructor(entities: T[], options: FeatureStoreOptions) {\n    super(entities, options);\n    this.map = options.map;\n  }\n\n  /**\n   * Bind this store to a vector layer\n   * @param layer Vector layer\n   * @returns Feature store\n   */\n  bindLayer(layer: VectorLayer): FeatureStore {\n    this.layer = layer;\n    return this;\n  }\n\n  /**\n   * Set the layer's features and perform a motion to make them visible. Strategies\n   * make extensive use of that method.\n   * @param features Features\n   * @param motion Optional: The type of motion to perform\n   */\n  setLayerFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    viewScale?: [number, number, number, number],\n    areaRatio?: number,\n    getId?: (Feature) => EntityKey\n  ) {\n    getId = getId ? getId : getEntityId;\n    this.checkLayer();\n\n    const olFeatures = features\n      .map((feature: Feature) => featureToOl(feature, this.map.projection, getId));\n    this.setLayerOlFeatures(olFeatures, motion, viewScale, areaRatio);\n  }\n\n  /**\n   * Set the store's features from an array of OL features.\n   * @param olFeatures Ol features\n   */\n  setStoreOlFeatures(olFeatures: OlFeature<OlGeometry>[]) {\n    this.checkLayer();\n\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      olFeature.set('_featureStore', this, true);\n      return featureFromOl(olFeature, this.layer.map.projection);\n    });\n    this.load(features as T[]);\n  }\n\n  /**\n   * Remove all features from the layer\n   */\n  clearLayer() {\n    this.checkLayer();\n    this.source.ol.clear();\n  }\n\n  /**\n   * Check wether a layer is bound or not and throw an error if not.\n   */\n  private checkLayer() {\n    if (this.layer === undefined) {\n      throw new Error('This FeatureStore is not bound to a layer.');\n    }\n  }\n\n  /**\n   * Set the layer's features and perform a motion to make them visible.\n   * @param features Openlayers feature objects\n   * @param motion Optional: The type of motion to perform\n   */\n  public setLayerOlFeatures(\n    olFeatures: OlFeature<OlGeometry>[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    viewScale?: [number, number, number, number],\n    areaRatio?: number\n  ) {\n    const olSource = this.layer.ol.getSource();\n    const diff = computeOlFeaturesDiff(olSource.getFeatures(), olFeatures);\n    if (diff.remove.length > 0) {\n      this.removeOlFeaturesFromLayer(diff.remove);\n    }\n\n    if (diff.add.length > 0) {\n      this.addOlFeaturesToLayer(diff.add);\n    }\n\n    if (diff.add.length > 0) {\n      // If features are added, do a motion toward the newly added features\n      moveToOlFeatures(this.map, diff.add, motion, viewScale, areaRatio);\n    } else if (diff.remove.length > 0) {\n      // Else, do a motion toward all the features\n      moveToOlFeatures(this.map, olFeatures, motion, viewScale, areaRatio);\n    }\n  }\n\n  /**\n   * Add features to the the layer\n   * @param features Openlayers feature objects\n   */\n  private addOlFeaturesToLayer(olFeatures: OlFeature<OlGeometry>[]) {\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      olFeature.set('_featureStore', this, true);\n    });\n    this.source.ol.addFeatures(olFeatures);\n  }\n\n  /**\n   * Remove features from the the layer\n   * @param features Openlayers feature objects\n   */\n  private removeOlFeaturesFromLayer(olFeatures: OlFeature<OlGeometry>[]) {\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      this.source.ol.removeFeature(olFeature);\n    });\n  }\n\n}\n","import * as olextent from 'ol/extent';\n\nimport { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureStore } from '../store';\nimport { FeatureStoreInMapExtentStrategyOptions } from '../feature.interfaces';\nimport { Subscription } from 'rxjs';\nimport { skipWhile } from 'rxjs/operators';\n\n/**\n * This strategy maintain the store features updated while the map is moved.\n * The features's state inside the map are tagged inMapExtent = true;\n */\nexport class FeatureStoreInMapExtentStrategy extends EntityStoreStrategy {\n\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n  private states$$: Subscription[] = [];\n  private empty$$: Subscription;\n\n  constructor(protected options: FeatureStoreInMapExtentStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n    this.empty$$ = store.empty$\n      .pipe(skipWhile((empty) => !empty))\n      .subscribe(() => this.updateEntitiesInExtent(store));\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.updateEntitiesInExtent(store);\n    this.states$$.push(store.layer.map.viewController.state$.subscribe(() => {\n      this.updateEntitiesInExtent(store);\n    }));\n  }\n\n  private updateEntitiesInExtent(store) {\n    if (store?.layer?.map?.viewController) {\n      store.state.updateAll({ inMapExtent: false });\n      const mapExtent = store.layer.map.viewController.getExtent();\n      let entitiesInMapExtent = [];\n      let entitiesWithNoGeom = [];\n      for (const entity of store.entities$.value) {\n        if (entity.ol) {\n          if (olextent.intersects(entity.ol.getGeometry().getExtent(), mapExtent)) {\n            entitiesInMapExtent.push(entity);\n          }\n        } else {\n          entitiesWithNoGeom.push(entity);\n        }\n      }\n      if (entitiesInMapExtent.length > 0) {\n        store.state.updateMany(entitiesInMapExtent, { inMapExtent: true }, false);\n      }\n      if (entitiesWithNoGeom.length > 0) {\n        store.state.updateMany(entitiesWithNoGeom, { inMapExtent: true }, false);\n      }\n    }\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    this.stores$$.clear();\n    this.states$$.map(state => state.unsubscribe());\n    if (this.empty$$) { this.empty$$.unsubscribe(); }\n  }\n}\n","import { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureStore } from '../store';\nimport { FeatureStoreInMapResolutionStrategyOptions } from '../feature.interfaces';\nimport { Subscription } from 'rxjs';\n\n\n/**\n * This strategy maintain the store features updated while the map is scrolled.\n * The features's state inside the map's resolution are tagged inMapResolution = true;\n */\nexport class FeatureStoreInMapResolutionStrategy extends EntityStoreStrategy {\n\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n  private resolution$$: Subscription[] = [];\n  private empty$$: Subscription;\n\n  constructor(protected options: FeatureStoreInMapResolutionStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n    this.empty$$ = store.empty$\n      .subscribe(() => this.updateEntitiesInResolution(store, store.layer.map.viewController.getResolution()));\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.updateEntitiesInResolution(store, store.layer.map.viewController.getResolution());\n    this.resolution$$.push(store.layer.map.viewController.resolution$.subscribe((res) => {\n      this.updateEntitiesInResolution(store, res);\n    }));\n  }\n\n  private updateEntitiesInResolution(store, mapResolution: number) {\n    if (mapResolution > store.layer.minResolution && mapResolution < store.layer.maxResolution) {\n      store.state.updateAll({ inMapResolution: true });\n    } else {\n      store.state.updateAll({ inMapResolution: false });\n    }\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    this.stores$$.clear();\n    this.resolution$$.map(state => state.unsubscribe());\n    if (this.empty$$) { this.empty$$.unsubscribe(); }\n  }\n}\n","import { Subscription } from 'rxjs';\n\nimport { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureMotion } from '../feature.enums';\nimport { Feature, FeatureStoreLoadingStrategyOptions } from '../feature.interfaces';\nimport { FeatureStore } from '../store';\n\n/**\n * This strategy loads a store's features into it's layer counterpart.\n * The store -> layer binding is a one-way binding. That means any entity\n * added to the store will be added to the layer but the opposite is false.\n *\n * Important: This strategy observes filtered entities, not raw entities. This\n * is not configurable yet.\n */\nexport class FeatureStoreLoadingStrategy extends EntityStoreStrategy {\n\n  /**\n   * Subscription to the store's features\n   */\n  private stores$$ = new Map<FeatureStore, Subscription>();\n\n  private motion: FeatureMotion;\n\n  constructor(protected options: FeatureStoreLoadingStrategyOptions) {\n    super(options);\n    this.setMotion(options.motion);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for entities changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for entities changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Define the motion to apply on load\n   * @param motion Feature motion\n   */\n  setMotion(motion: FeatureMotion) {\n    this.motion = motion;\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for entities changes in a store.\n   * Important: Never observe a store's sorted entities. It makes no sense\n   * to display sorted entities (instead of unsorted) on a layer and it\n   * would potentially result in a lot of useless computation.\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    const subscription = store.view.all$()\n      .subscribe((features: Feature[]) => this.onFeaturesChange(features, store));\n    this.stores$$.set(store, subscription);\n  }\n\n  /**\n   * Stop watching for entities changes in a store.\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const subscription = this.stores$$.get(store);\n    if (subscription !== undefined) {\n      subscription.unsubscribe();\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for entities changes in all stores.\n   */\n  private unwatchAll() {\n    Array.from(this.stores$$.entries()).forEach((entries: [FeatureStore, Subscription]) => {\n      entries[1].unsubscribe();\n    });\n    this.stores$$.clear();\n  }\n\n  /**\n   * Load features into a layer or clear the layer if the array of features is empty.\n   * @param features Store filtered features\n   * @param store Feature store\n   */\n  private onFeaturesChange(features: Feature[], store: FeatureStore) {\n    if (features.length === 0) {\n      store.clearLayer();\n    } else {\n      store.setLayerFeatures(\n        features,\n        this.selectMotion(store),\n        this.options.viewScale,\n        this.options.areaRatio,\n        this.options.getFeatureId\n      );\n    }\n  }\n\n  /**\n   * Selects the best motion\n   * @param store A FeatureStore to apply the motion\n   * @returns The motion selected\n   */\n  private selectMotion(store: FeatureStore) {\n    if (this.motion !== undefined) { return this.motion; }\n\n    if (store.pristine === true) {\n      // If features have just been loaded into the store, move/zoom on them\n      return FeatureMotion.Default;\n    } else if (store.count > store.view.count) {\n      // If features have been filtered, move/zoom on the remaining ones\n      return FeatureMotion.Default;\n    } else {\n      // On insert, update or delete, do nothing\n      return FeatureMotion.None;\n    }\n  }\n}\n","import OlEvent from 'ol/events/Event';\n\nimport { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureStore } from '../store';\nimport { FeatureStoreLoadingLayerStrategyOptions } from '../feature.interfaces';\nimport { ClusterDataSource } from '../../../datasource/shared/datasources/cluster-datasource';\n\n/**\n * This strategy loads a layer's features into it's store counterpart.\n * The layer -> store binding is a one-way binding. That means any OL feature\n * added to the layer will be added to the store but the opposite is false.\n *\n * Important: In it's current state, this strategy is to meant to be combined\n * with a standard Loading strategy and it would probably cause recursion issues.\n */\nexport class FeatureStoreLoadingLayerStrategy extends EntityStoreStrategy {\n\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n\n  constructor(protected options: FeatureStoreLoadingLayerStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.onSourceChanges(store);\n    const olSource = store.layer.ol.getSource();\n    olSource.on('change', (event: OlEvent) => {\n      this.onSourceChanges(store);\n    });\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    Array.from(this.stores$$.entries()).forEach((entries: [FeatureStore, string]) => {\n    });\n    this.stores$$.clear();\n  }\n\n  /**\n   * Load features from an OL source into a  store or clear the store if the source is empty\n   * @param features Store filtered features\n   * @param store Feature store\n   */\n  private onSourceChanges(store: FeatureStore) {\n    let olFeatures = store.layer.ol.getSource().getFeatures();\n\n    if (store.layer.dataSource instanceof ClusterDataSource) {\n      olFeatures = (olFeatures as any).flatMap((cluster: any) =>\n        cluster.get('features')\n      );\n    }\n    if (olFeatures.length === 0) {\n      store.clear();\n    } else {\n      store.setStoreOlFeatures(olFeatures);\n    }\n  }\n}\n","import OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlDragBoxInteraction, { DragBoxEvent } from 'ol/interaction/DragBox';\nimport { DragBoxEvent as OlDragBoxEvent } from 'ol/interaction/DragBox';\nimport { EventsKey } from 'ol/events';\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { unByKey } from 'ol/Observable';\n\nimport { Subscription, combineLatest } from 'rxjs';\nimport { map, debounceTime, skip } from 'rxjs/operators';\n\nimport { EntityKey, EntityRecord, EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureDataSource } from '../../../datasource';\nimport { VectorLayer } from '../../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../../map/shared/map';\nimport { ctrlKeyDown } from '../../../map/shared/map.utils';\n\nimport {\n  Feature,\n  FeatureStoreSelectionStrategyOptions\n} from '../feature.interfaces';\nimport { FeatureStore } from '../store';\nimport { FeatureMotion } from '../feature.enums';\n\nexport class OlDragSelectInteraction extends OlDragBoxInteraction {\n  constructor(options) {\n    super(options);\n  }\n}\n\n/**\n * This strategy synchronizes a store and a layer selected entities.\n * The store <-> layer binding is a two-way binding.\n *\n * In many cases, a single strategy bound to multiple stores\n * will yield better results that multiple strategies with each their\n * own store. In the latter scenario, a click on overlapping features\n * would trigger the strategy of each layer and they would cancel\n * each other as well as move the map view around needlessly.\n */\nexport class FeatureStoreSelectionStrategy extends EntityStoreStrategy {\n  /**\n   * Listener to the map click event that allows selecting a feature\n   * by clicking on the map\n   */\n  private mapClickListener;\n\n  private olDragSelectInteraction: OlDragSelectInteraction;\n\n  private olDragSelectInteractionEndKey: EventsKey | EventsKey[];\n\n  /**\n   * Subscription to all stores selected entities\n   */\n  private stores$$: Subscription;\n\n  private motion: FeatureMotion;\n\n  /**\n   * The map the layers belong to\n   */\n  get map(): IgoMap {\n    return this.options.map;\n  }\n\n  /**\n   * A feature store that'll contain the selected features. It has it's own\n   * layer, shared by all the stores this staretgy is bound to.\n   */\n  get overlayStore(): FeatureStore {\n    return this._overlayStore;\n  }\n  private _overlayStore: FeatureStore;\n\n  constructor(protected options: FeatureStoreSelectionStrategyOptions) {\n    super(options);\n    this.setMotion(options.motion);\n    this._overlayStore = this.createOverlayStore();\n  }\n\n  /**\n   * Bind this strategy to a store and force this strategy's\n   * reactivation to properly setup watchers.\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      // Force reactivation\n      this.activate();\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and force this strategy's\n   * reactivation to properly setup watchers.\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      // Force reactivation\n      this.activate();\n    }\n  }\n\n  /**\n   * Define the motion to apply on select\n   * @param motion Feature motion\n   */\n  setMotion(motion: FeatureMotion) {\n    this.motion = motion;\n  }\n\n  /**\n   * Unselect all entities, from all stores\n   */\n  unselectAll() {\n    this.stores.forEach((store: FeatureStore) => {\n      store.state.updateAll({ selected: false });\n    });\n  }\n\n  /**\n   * Clear the overlay\n   */\n  clear() {\n    this.overlayStore.source.ol.clear();\n    this.overlayStore.clear();\n  }\n\n  /**\n   * Deactivate the selection without removing the selection\n   * overlay.\n   */\n  deactivateSelection() {\n    this.unlistenToMapClick();\n    this.removeDragBoxInteraction();\n    this.unwatchAll();\n  }\n\n  /**\n   * Add the overlay layer, setup the map click lsitener and\n   * start watching for stores selection\n   * @internal\n   */\n  protected doActivate() {\n    this.addOverlayLayer();\n    this.listenToMapClick();\n    if (this.options.dragBox === true) {\n      this.addDragBoxInteraction();\n    }\n    this.watchAll();\n  }\n\n  /**\n   * Remove the overlay layer, remove the map click lsitener and\n   * stop watching for stores selection\n   * @internal\n   */\n  protected doDeactivate() {\n    this.deactivateSelection();\n    this.removeOverlayLayer();\n  }\n\n  /**\n   * Create a single observable of all the stores. With a single observable,\n   * features can be added all at once to the overlay layer and a single\n   * motion can be performed. Multiple observable would have\n   * a cancelling effect on each other.\n   */\n  private watchAll() {\n    this.unwatchAll();\n\n    const stores$ = this.stores.map((store: FeatureStore) => {\n      return store.stateView\n        .manyBy$((record: EntityRecord<Feature>) => {\n          return record.state.selected === true;\n        })\n        .pipe(\n          map((records: EntityRecord<Feature>[]) =>\n            records.map((record) => record.entity)\n          )\n        );\n    });\n    this.stores$$ = combineLatest(stores$)\n      .pipe(\n        debounceTime(5),\n        skip(1), // Skip intial selection\n        map((features: Array<Feature[]>) =>\n          features.reduce((a, b) => a.concat(b))\n        )\n      )\n      .subscribe((features: Feature[]) => this.onSelectFromStore(features));\n  }\n\n  /**\n   * Stop watching for selection in all stores.\n   */\n  private unwatchAll() {\n    if (this.stores$$ !== undefined) {\n      this.stores$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Add a 'singleclick' listener to the map that'll allow selecting\n   * features by clicking on the map. The selection will be performed\n   * only on the layers bound to this strategy.\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => {\n        this.onMapClick(event);\n      }\n    );\n  }\n\n  /**\n   * Remove the map click listener\n   */\n  private unlistenToMapClick() {\n    unByKey(this.mapClickListener);\n  }\n\n  /**\n   * On map click, select feature at pixel\n   * @param event OL MapBrowserPointerEvent\n   */\n  private onMapClick(event: MapBrowserPointerEvent<any>) {\n    const exclusive = !ctrlKeyDown(event);\n    const reverse = !exclusive;\n    const olFeatures = event.map.getFeaturesAtPixel(event.pixel, {\n      hitTolerance: this.options.hitTolerance || 0,\n      layerFilter: olLayer => {\n        const storeOlLayer = this.stores.find((store: FeatureStore) => {\n          return store.layer.ol === olLayer;\n        });\n        return storeOlLayer !== undefined;\n      }\n    }) as OlFeature<OlGeometry>[];\n    this.onSelectFromMap(olFeatures, exclusive, reverse);\n  }\n\n  /**\n   * Add a drag box interaction and, on drag box end, select features\n   */\n  private addDragBoxInteraction() {\n    let olDragSelectInteraction;\n    const olInteractions = this.map.ol.getInteractions().getArray();\n\n    // There can only be one dragbox interaction, so find the current one, if any\n    // Don't keep a reference to the current dragbox because we don't want\n    // to remove it when this startegy is deactivated\n    for (const olInteraction of olInteractions) {\n      if (olInteraction instanceof OlDragSelectInteraction) {\n        olDragSelectInteraction = olInteraction;\n        break;\n      }\n    }\n    // If no drag box interaction is found, create a new one and add it to the map\n    if (olDragSelectInteraction === undefined) {\n      olDragSelectInteraction = new OlDragSelectInteraction({\n        condition: ctrlKeyDown\n      });\n      this.map.ol.addInteraction(olDragSelectInteraction);\n      this.olDragSelectInteraction = olDragSelectInteraction;\n    }\n\n    this.olDragSelectInteractionEndKey = olDragSelectInteraction.on(\n      'boxend',\n      (event: DragBoxEvent) => this.onDragBoxEnd(event)\n    );\n  }\n\n  /**\n   * Remove drag box interaction\n   */\n  private removeDragBoxInteraction() {\n    if (this.olDragSelectInteractionEndKey !== undefined) {\n      unByKey(this.olDragSelectInteractionEndKey);\n    }\n    if (this.olDragSelectInteraction !== undefined) {\n      this.map.ol.removeInteraction(this.olDragSelectInteraction);\n    }\n    this.olDragSelectInteraction = undefined;\n  }\n\n  /**\n   * On dragbox end, select features in drag box\n   * @param event OL MapBrowserPointerEvent\n   */\n  private onDragBoxEnd(event: OlDragBoxEvent) {\n    const exclusive = !ctrlKeyDown(event.mapBrowserEvent);\n    const target = event.target as any;\n    const extent = target.getGeometry().getExtent();\n    const olFeatures = this.stores.reduce(\n      (acc: OlFeature<OlGeometry>[], store: FeatureStore) => {\n        const olSource = store.layer.ol.getSource();\n        acc.push(...olSource.getFeaturesInExtent(extent));\n        return acc;\n      },\n      []\n    );\n    this.onSelectFromMap(olFeatures, exclusive, false);\n  }\n\n  /**\n   * When features are selected from the store, add\n   * them to this startegy's overlay layer (select on map)\n   * @param features Store features\n   */\n  private onSelectFromStore(features: Feature[]) {\n    const motion = this.motion;\n    const olOverlayFeatures = this.overlayStore.layer.ol\n      .getSource()\n      .getFeatures();\n    const overlayFeaturesKeys = olOverlayFeatures.map((olFeature: OlFeature<OlGeometry>) =>\n      olFeature.getId()\n    );\n    const featuresKeys = features.map(this.overlayStore.getKey);\n\n    let doMotion;\n    if (features.length === 0) {\n      doMotion = false;\n    } else {\n      doMotion =\n        overlayFeaturesKeys.length !== featuresKeys.length ||\n        !overlayFeaturesKeys.every(\n          (key: EntityKey) => featuresKeys.indexOf(key) >= 0\n        );\n    }\n\n    this.overlayStore.setLayerFeatures(\n      features,\n      doMotion ? motion : FeatureMotion.None,\n      this.options.viewScale,\n      this.options.areaRatio,\n      this.options.getFeatureId\n    );\n  }\n\n  /**\n   * When features are selected from the map, also select them\n   * in their store.\n   * @param olFeatures OL feature objects\n   */\n  private onSelectFromMap(\n    olFeatures: OlFeature<OlGeometry>[],\n    exclusive: boolean,\n    reverse: boolean\n  ) {\n    const groupedFeatures = this.groupFeaturesByStore(olFeatures);\n\n    this.stores.forEach((store: FeatureStore) => {\n      const features = groupedFeatures.get(store);\n      if (features === undefined && exclusive === true) {\n        this.unselectAllFeaturesFromStore(store);\n      } else if (features === undefined && exclusive === false) {\n        // Do nothing\n      } else {\n        this.selectFeaturesFromStore(store, features, exclusive, reverse);\n      }\n    });\n  }\n\n  /**\n   * Select features in store\n   * @param store: Feature store\n   * @param features Features\n   */\n  private selectFeaturesFromStore(\n    store: FeatureStore,\n    features: Feature[],\n    exclusive: boolean,\n    reverse: boolean\n  ) {\n    if (reverse === true) {\n      store.state.reverseMany(features, ['selected']);\n    } else {\n      store.state.updateMany(features, { selected: true }, exclusive);\n    }\n  }\n\n  /**\n   * Unselect all features from store\n   * @param store: Feature store\n   */\n  private unselectAllFeaturesFromStore(store: FeatureStore) {\n    store.state.updateAll({ selected: false });\n  }\n\n  /**\n   * This method returns a store -> features mapping from a list\n   * of OL selected features. OL features keep a reference to the store\n   * they are from.\n   * @param olFeatures: OL feature objects\n   * @returns Store -> features mapping\n   */\n  private groupFeaturesByStore(\n    olFeatures: OlFeature<OlGeometry>[]\n  ): Map<FeatureStore, Feature[]> {\n    const groupedFeatures = new Map<FeatureStore, Feature[]>();\n    if (olFeatures === null || olFeatures === undefined) {\n      return groupedFeatures;\n    }\n\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      const store = olFeature.get('_featureStore');\n      if (store === undefined) {\n        return;\n      }\n\n      let features = groupedFeatures.get(store);\n      if (features === undefined) {\n        features = [];\n        groupedFeatures.set(store, features);\n      }\n\n      const feature = store.get(olFeature.getId());\n      if (feature !== undefined) {\n        features.push(feature);\n      }\n    });\n\n    return groupedFeatures;\n  }\n\n  /**\n   * Create an overlay store that'll contain the selected features.\n   * @returns Overlay store\n   */\n  private createOverlayStore(): FeatureStore {\n    const overlayLayer = this.options.layer\n      ? this.options.layer\n      : this.createOverlayLayer();\n    return new FeatureStore([], { map: this.map }).bindLayer(overlayLayer);\n  }\n\n  /**\n   * Create an overlay store that'll contain the selected features.\n   * @returns Overlay layer\n   */\n  private createOverlayLayer(): VectorLayer {\n    return new VectorLayer({\n      zIndex: 300,\n      source: new FeatureDataSource(),\n      style: undefined,\n      showInLayerList: false,\n      exportable: false,\n      browsable: false\n    });\n  }\n\n  /**\n   * Add the overlay store's layer to the map to display the selected\n   * features.\n   */\n  private addOverlayLayer() {\n    if (this.overlayStore.layer.map === undefined) {\n      this.map.addLayer(this.overlayStore.layer);\n    }\n  }\n\n  /**\n   * Remove the overlay layer from the map\n   */\n  private removeOverlayLayer() {\n    this.overlayStore.source.ol.clear();\n    this.map.removeLayer(this.overlayStore.layer);\n  }\n}\n","import { FeatureStore } from './store';\nimport { FeatureStoreSelectionStrategy } from './strategies/selection';\nimport { FeatureStoreLoadingStrategy } from './strategies/loading';\n\n/**\n * Try to add a loading strategy to a store and activate it.\n * If no strategy is given to that function, a basic one will be created.\n * @param store The store to bind the loading strategy\n * @param strategy An optional loading strategy\n */\nexport function tryAddLoadingStrategy(\n  store: FeatureStore,\n  strategy?: FeatureStoreLoadingStrategy\n) {\n  if (store.getStrategyOfType(FeatureStoreLoadingStrategy) !== undefined) {\n    store.activateStrategyOfType(FeatureStoreLoadingStrategy);\n    return;\n  }\n\n  strategy = strategy ? strategy : new FeatureStoreLoadingStrategy({});\n  store.addStrategy(strategy);\n  strategy.activate();\n}\n\n/**\n * Try to add a selection strategy to a store and activate it.\n * If no strategy is given to that function, a basic one will be created.\n * @param store The store to bind the selection strategy\n * @param [strategy] An optional selection strategy\n */\nexport function tryAddSelectionStrategy(\n  store: FeatureStore,\n  strategy?: FeatureStoreSelectionStrategy\n) {\n  if (store.getStrategyOfType(FeatureStoreSelectionStrategy) !== undefined) {\n    store.activateStrategyOfType(FeatureStoreSelectionStrategy);\n    return;\n  }\n  strategy = strategy\n    ? strategy\n    : new FeatureStoreSelectionStrategy({\n        map: store.map\n      });\n  store.addStrategy(strategy);\n  strategy.activate();\n}\n","import * as olstyle from 'ol/style';\nimport { asArray as ColorAsArray } from 'ol/color';\n\n/**\n * Create a marker style for points\n * @returns Style\n */\nexport function createOverlayMarkerStyle({\n  text,\n  opacity = 1,\n  markerColor = [0, 161, 222],\n  markerOutlineColor = [255, 255, 255]\n}: {\n  text?: string;\n  opacity?: number;\n  markerColor?: string | number[];\n  markerOutlineColor?: string | number[];\n} = {}): olstyle.Style {\n  let iconColor;\n  let svgIconColor;\n  let svgOutlineColor;\n  let svg;\n\n  const isIE = /msie\\s|trident\\/|edge\\//i.test(window.navigator.userAgent); // To fix IE11 svg bug (temporarly)\n\n  const newColor = ColorAsArray(markerColor).slice(0);\n  const newOutlineColor = ColorAsArray(markerOutlineColor).slice(0);\n\n  if (newColor.length === 4 && (typeof markerColor !== 'string' || /^#[0-9A-F]{8}$/i.test(markerColor as string))) {\n    opacity = newColor[3];\n  }\n\n  svgIconColor = `\"rgba(${newColor[0]},${newColor[1]},${newColor[2]},${opacity})\"`;\n  iconColor = markerColor;\n\n  svgOutlineColor = `\"rgb(${newOutlineColor[0]},${newOutlineColor[1]},${newOutlineColor[2]})\"`;\n\n  svg =\n    'data:image/svg+xml;utf8,<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" height=\"36\" width=\"36\" viewBox=\"0 0 36 36\">' +\n    '<path fill=' +\n    svgIconColor +\n    ' stroke=' +\n    svgOutlineColor +\n    ` stroke-width=\"2\" d=\"M 17.692635,32.565644 C 15.71852,30.330584 13.290925,27.058065 11.6766,24.455732 9.3398623,20.688851 7.8905694,17.205334 7.6297492,14.728733 7.5616025,14.081649 7.5739557,12.528552 7.6513363,12.014724 8.1013861,9.0262716 9.8047068,6.3655569 12.310675,4.7364878 c 1.113691,-0.7239832 2.508083,-1.2834131 3.776687,-1.5152052 0.242945,-0.044389 0.451656,-0.09393 0.463804,-0.1100911 0.01215,-0.016161 0.638282,-0.025502 1.391411,-0.02076 1.088235,0.00685 1.450932,0.024316 1.766871,0.085071 2.650763,0.5097353 4.947142,1.8701891 6.498786,3.8501033 0.628018,0.8013587 1.297046,2.0200608 1.640967,2.9891872 0.191065,0.538399 0.427644,1.447408 0.477391,1.834287 0.0164,0.127546 0.0434,0.231902 0.06,0.231902 0.0166,0 0.03122,0.626135 0.03249,1.391411 0.0013,0.765276 -0.011,1.391411 -0.02726,1.391411 -0.01626,0 -0.05449,0.154049 -0.08495,0.342331 -0.08815,0.544879 -0.387235,1.721449 -0.604837,2.379406 -1.209421,3.656888 -4.014463,8.349762 -7.849521,13.132357 -0.790496,0.985807 -1.795217,2.167992 -1.842543,2.167992 -0.01896,0 -0.161766,-0.144111 -0.317336,-0.320246 z m 1.066937,-15.36525 c 0.133519,-0.02121 0.248766,-0.05657 0.256105,-0.07859 0.0073,-0.02202 0.04918,-0.03066 0.09298,-0.0192 0.0438,0.01145 0.107628,-0.0072 0.141834,-0.04137 0.03421,-0.03421 0.08456,-0.05474 0.111888,-0.04563 0.02733,0.0091 0.07703,-0.01077 0.110429,-0.04417 0.03341,-0.03341 0.08416,-0.05293 0.112796,-0.04338 0.02863,0.0095 0.08974,-0.01867 0.135802,-0.06271 0.04606,-0.04403 0.111902,-0.08625 0.146319,-0.09381 0.204084,-0.04483 0.762371,-0.519108 1.079463,-0.917027 0.26749,-0.335672 0.570987,-0.878795 0.529019,-0.946701 -0.01496,-0.0242 -0.0067,-0.044 0.01835,-0.044 0.05645,0 0.196809,-0.467982 0.158801,-0.529481 -0.01521,-0.02461 -0.0043,-0.04475 0.02427,-0.04475 0.03157,0 0.04365,-0.04329 0.03082,-0.11043 -0.01161,-0.06074 -0.0066,-0.110429 0.01124,-0.110429 0.01779,0 0.03235,-0.258405 0.03235,-0.574233 0,-0.315829 -0.01545,-0.574234 -0.03434,-0.574234 -0.01889,0 -0.02437,-0.03811 -0.01219,-0.08469 0.04412,-0.168712 -0.336329,-1.152668 -0.481536,-1.245401 -0.02327,-0.01486 -0.04022,-0.03992 -0.03765,-0.05568 0.01222,-0.07498 -0.156557,-0.318365 -0.406379,-0.586027 -0.295921,-0.317054 -0.773059,-0.690104 -0.83427,-0.652274 -0.0206,0.01273 -0.03745,0.0024 -0.03745,-0.02289 0,-0.06107 -0.433076,-0.2789369 -0.487546,-0.245273 -0.02338,0.01445 -0.04251,0.0068 -0.04251,-0.01695 0,-0.056281 -0.393995,-0.1865457 -0.613804,-0.2029397 -0.0943,-0.00703 -0.188579,-0.023183 -0.209503,-0.035888 -0.02092,-0.012705 -0.276571,-0.023337 -0.568105,-0.023627 -0.534044,-5.301e-4 -1.12638,0.091025 -1.12638,0.1741017 0,0.023781 -0.01713,0.032648 -0.03808,0.019705 -0.05054,-0.031232 -0.403641,0.1088602 -0.403641,0.1601422 0,0.02204 -0.01988,0.02779 -0.04417,0.01278 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01988,0.0371 -0.04417,0.02209 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01915,0.03755 -0.04256,0.02308 -0.02341,-0.01447 -0.08138,0.01252 -0.128834,0.05997 -0.04745,0.04745 -0.0974,0.07515 -0.111001,0.06155 -0.0136,-0.0136 -0.03722,0.0078 -0.05248,0.0476 -0.01526,0.03978 -0.0411,0.06408 -0.0574,0.054 -0.03277,-0.02025 -0.462299,0.323995 -0.491977,0.394291 -0.01026,0.02429 -0.07454,0.0912 -0.142856,0.148686 -0.248033,0.208705 -0.730279,0.974169 -0.672565,1.067553 0.0145,0.02346 0.0059,0.04266 -0.01914,0.04266 -0.05907,0 -0.241471,0.599428 -0.208527,0.685278 0.01385,0.0361 0.0044,0.06564 -0.02098,0.06564 -0.02539,0 -0.04169,0.0646 -0.03622,0.143558 0.0055,0.07896 -0.0042,0.213129 -0.02144,0.29816 -0.04741,0.233576 0.0511,1.055502 0.167516,1.397721 0.126048,0.370516 0.310099,0.740163 0.426484,0.856548 0.04776,0.04776 0.07554,0.08684 0.06174,0.08684 -0.0138,0 0.01516,0.05653 0.06436,0.125632 0.131301,0.184396 0.499365,0.587266 0.518785,0.567846 0.0092,-0.0092 0.09821,0.06081 0.197812,0.155562 0.09961,0.09475 0.190589,0.162786 0.202187,0.151188 0.0116,-0.0116 0.05991,0.01774 0.107361,0.06519 0.04745,0.04745 0.105426,0.07444 0.128834,0.05997 0.02341,-0.01447 0.04256,-0.0057 0.04256,0.01958 0,0.06106 0.344664,0.23496 0.399061,0.201341 0.02346,-0.0145 0.04266,-0.0059 0.04266,0.01914 0,0.05907 0.599429,0.241471 0.685279,0.208527 0.0361,-0.01385 0.06564,-0.0065 0.06564,0.01645 0,0.05196 1.079115,0.04833 1.413314,-0.0048 z\"></path>` +\n    '</svg>';\n\n  let src;\n  if (isIE) {\n    switch (markerColor) {\n      case 'blue' || [0, 161, 222] || '#00a1de':\n        iconColor = 'blue';\n        break;\n      case 'red' || '#f64139':\n        iconColor = 'red';\n        break;\n      case 'yellow' || '#ffd700':\n        iconColor = 'yellow';\n        break;\n      case 'green' || '#008000':\n        iconColor = 'green';\n        break;\n      default:\n        iconColor = 'blue';\n        break;\n    }\n    src = './assets/igo2/geo/icons/place_' + iconColor + '_36px.svg';\n  } else {\n    src = svg;\n  }\n\n  return new olstyle.Style({\n    image: new olstyle.Icon({\n      src: svg,\n      opacity,\n      imgSize: [36, 36], // for ie\n      anchor: [0.5, 0.92]\n    }),\n    text: new olstyle.Text({\n      text,\n      font: '12px Calibri,sans-serif',\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n","import { Injectable } from '@angular/core';\n\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olstyle from 'ol/style';\nimport OlFeature from 'ol/Feature';\nimport { StyleByAttribute } from './vector-style.interface';\n\nimport { ClusterParam } from './clusterParam';\nimport { createOverlayMarkerStyle } from '../../overlay/shared/overlay-marker-style.utils';\nimport RenderFeature from 'ol/render/Feature';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StyleService {\n  public style: olstyle.Style;\n\n  createStyle(options: { [key: string]: any }) {\n    if (!options) {\n      return createOverlayMarkerStyle();\n    }\n    if (typeof options === 'function' || options instanceof olstyle.Style) {\n      return options;\n    }\n    return this.parseStyle('style', options);\n  }\n\n  private parseStyle(key: string, value: any) {\n    const styleOptions = {};\n    const olCls = this.getOlCls(key);\n\n    if (olCls && value instanceof Object) {\n      Object.keys(value).forEach(_key => {\n        const olKey = this.getOlKey(_key);\n        styleOptions[olKey] = this.parseStyle(_key, value[_key]);\n      });\n      return new olCls(styleOptions);\n    } else {\n      return value;\n    }\n  }\n\n  private getOlKey(key: any) {\n    let olKey;\n    switch (key.toLowerCase()) {\n      case 'circle':\n      case 'regularshape':\n      case 'icon':\n        olKey = 'image';\n        break;\n      default:\n        break;\n    }\n\n    return olKey || key;\n  }\n\n  private getOlCls(key: any) {\n    let olCls = olstyle[key.charAt(0).toUpperCase() + key.slice(1)];\n    if (key === 'regularshape') {\n      olCls = olstyle.RegularShape;\n    }\n    if (key === 'backgroundFill') {\n      olCls = olstyle.Fill;\n    }\n    if (key === 'backgroundStroke') {\n      olCls = olstyle.Stroke;\n    }\n\n    return olCls;\n  }\n\n  createStyleByAttribute(feature: RenderFeature | OlFeature<OlGeometry>, styleByAttribute: StyleByAttribute) {\n\n    let style;\n    const type = styleByAttribute.type ? styleByAttribute.type : this.guessTypeFeature(feature);\n    const attribute = styleByAttribute.attribute;\n    const data = styleByAttribute.data;\n    const stroke = styleByAttribute.stroke;\n    const width = styleByAttribute.width;\n    const fill = styleByAttribute.fill;\n    const anchor = styleByAttribute.anchor;\n    const radius = styleByAttribute.radius;\n    const icon = styleByAttribute.icon;\n    const scale = styleByAttribute.scale;\n    const size = data ? data.length : 0;\n    const label = styleByAttribute.label ? styleByAttribute.label.attribute : undefined;\n    let labelStyle = styleByAttribute.label?.style ? this.parseStyle('text', styleByAttribute.label.style) : undefined;\n    if (!labelStyle && label) {\n        labelStyle = new olstyle.Text();\n    }\n    const baseStyle = styleByAttribute.baseStyle;\n\n    if (labelStyle) {\n      labelStyle.setText(this.getLabel(feature, label));\n    }\n\n    if (type === 'circle') {\n      for (let i = 0; i < size; i++) {\n        const val =\n          typeof feature.get(attribute) !== 'undefined' && feature.get(attribute) !== null\n            ? feature.get(attribute)\n            : '';\n        if (val === data[i] || val.toString().match(new RegExp(data[i], 'gmi'))) {\n          if (icon) {\n            style = [\n              new olstyle.Style({\n                image: new olstyle.Icon({\n                  color: fill ? fill[i] : undefined,\n                  src: icon[i],\n                  scale: scale ? scale[i] : 1,\n                  anchor: anchor ? anchor[i] : [0.5, 0.5]\n                }),\n                text: labelStyle instanceof olstyle.Text ? labelStyle : undefined\n              })\n            ];\n            return style;\n          }\n          style = [\n            new olstyle.Style({\n              image: new olstyle.Circle({\n                radius: radius ? radius[i] : 4,\n                stroke: new olstyle.Stroke({\n                  color: stroke ? stroke[i] : 'black',\n                  width: width ? width[i] : 1\n                }),\n                fill: new olstyle.Fill({\n                  color: fill ? fill[i] : 'black'\n                })\n              }),\n              text: labelStyle instanceof olstyle.Text ? labelStyle : undefined\n            })\n          ];\n          return style;\n        }\n      }\n      if (!(feature as OlFeature<OlGeometry>).getStyle()) {\n        if (baseStyle) {\n          style = this.createStyle(baseStyle);\n          if (labelStyle) {\n            style.setText(labelStyle);\n          }\n          return style;\n        }\n        style = [\n          new olstyle.Style({\n            image: new olstyle.Circle({\n              radius: 4,\n              stroke: new olstyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olstyle.Fill({\n                color: '#bbbbf2'\n              })\n            })\n          })\n        ];\n        return style;\n      }\n    } else if (type === 'regular') {\n      for (let i = 0; i < size; i++) {\n        const val =\n        typeof feature.get(attribute) !== 'undefined' && feature.get(attribute) !== null\n            ? feature.get(attribute)\n            : '';\n        if (val === data[i] || val.toString().match(new RegExp(data[i], 'gmi'))) {\n          style = [\n            new olstyle.Style({\n              stroke: new olstyle.Stroke({\n                color: stroke ? stroke[i] : 'black',\n                width: width ? width[i] : 1\n              }),\n              fill: new olstyle.Fill({\n                color: fill ? fill[i] : 'rgba(255,255,255,0.4)'\n              }),\n              text: labelStyle instanceof olstyle.Text ? labelStyle : undefined\n            })\n          ];\n          return style;\n        }\n      }\n      if (feature instanceof OlFeature) {\n        if (!feature.getStyle()) {\n          if (baseStyle) {\n            style = this.createStyle(baseStyle);\n            if (labelStyle) {\n              style.setText(labelStyle);\n            }\n            return style;\n          }\n          style = [\n            new olstyle.Style({\n              stroke: new olstyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olstyle.Fill({\n                color: '#bbbbf2'\n              })\n            })\n          ];\n          return style;\n        }\n      }\n    }\n  }\n\n  createClusterStyle(feature, clusterParam: ClusterParam = {}, layerStyle) {\n    let style;\n    const size = feature.get('features').length;\n    if (size !== 1) {\n      if (clusterParam.clusterRanges) {\n        for (const r of clusterParam.clusterRanges) {\n          if (\n            (!r.minRadius || r.minRadius <= size) &&\n            (!r.maxRadius || r.maxRadius >= size)\n          ) {\n            style = this.createStyle(r.style) as olstyle.Circle;\n\n            if (r.showRange) {\n              const text = new olstyle.Text({\n                text: size.toString(),\n                fill: new olstyle.Fill({\n                  color: '#fff'\n                })\n              });\n              style.setText(text);\n            }\n\n            if (r.dynamicRadius) {\n              let clusterRadius: number;\n              const radiusMin = style.getRadius();\n              clusterRadius = 5 * Math.log(size);\n              if (clusterRadius < radiusMin) {\n                clusterRadius = radiusMin;\n              }\n              style.image_.setRadius(clusterRadius);\n            }\n            break;\n          }\n        }\n      }\n\n      if (!style) {\n        let clusterRadius: number;\n        if (clusterParam.radiusCalc) {\n          clusterRadius = clusterParam.radiusCalc(size);\n        } else {\n          const radiusMin = 6;\n          clusterRadius = 5 * Math.log(size);\n          if (clusterRadius < radiusMin) {\n            clusterRadius = radiusMin;\n          }\n        }\n\n        style = [\n          new olstyle.Style({\n            image: new olstyle.Circle({\n              radius: clusterRadius,\n              stroke: new olstyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olstyle.Fill({\n                color: 'rgba(24, 134, 45, 0.5)'\n              })\n            }),\n            text: new olstyle.Text({\n              text: size.toString(),\n              fill: new olstyle.Fill({\n                color: '#fff'\n              })\n            })\n          })\n        ];\n      }\n    } else {\n      style = this.createStyle(layerStyle);\n    }\n    return style;\n  }\n\n  getLabel(feature, labelMatch): string {\n    let label = labelMatch;\n    if (!label) {\n      return;\n    }\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\n\n    labelToGet.forEach(v => {\n      label = label.replace(v[0], feature.get(v[1]));\n    });\n\n    // Nothing done? check feature's attribute\n    if (labelToGet.length === 0 && label === labelMatch) {\n      label = feature.get(labelMatch) || labelMatch;\n    }\n\n    return label;\n  }\n\n  private guessTypeFeature(feature) {\n    switch (feature.getGeometry().getType()) {\n      case 'Point':\n      case 'MultiPoint':\n      case 'Circle':\n        return 'circle';\n      default:\n        return 'regular';\n    }\n  }\n}\n","import * as olstyle from 'ol/style';\nimport OlFeature from 'ol/Feature';\nimport { asArray as ColorAsArray } from 'ol/color';\n\nimport { FeatureDataSource } from '../../datasource';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { StyleService } from '../../layer/shared/style.service';\nimport { createOverlayMarkerStyle } from './overlay-marker-style.utils';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\n/**\n * Create an overlay layer and it's source\n * @returns Overlay layer\n */\nexport function createOverlayLayer(): VectorLayer {\n  const overlayDataSource = new FeatureDataSource();\n  return new VectorLayer({\n    title: 'Overlay',\n    zIndex: 300,\n    source: overlayDataSource,\n    style: createOverlayLayerStyle()\n  });\n}\n\n/**\n * Create an overlay style with markers for points and a basic stroke/fill\n * combination for lines and polygons\n * @returns Style function\n */\nfunction createOverlayLayerStyle(): (olFeature: OlFeature<OlGeometry>) => olstyle.Style {\n  const defaultStyle = createOverlayDefaultStyle();\n  const markerStyle = createOverlayMarkerStyle();\n\n  let style;\n\n  return (olFeature: OlFeature<OlGeometry>) => {\n    if (olFeature.getId() === 'bufferFeature') {\n      style = createBufferStyle(\n        olFeature.get('bufferStroke'),\n        2,\n        olFeature.get('bufferFill'),\n        olFeature.get('bufferText')\n      );\n      return style;\n    } else {\n      const customStyle = olFeature.get('_style');\n      if (customStyle) {\n        const styleService = new StyleService();\n        return styleService.createStyle(customStyle);\n      }\n      const geometryType = olFeature.getGeometry().getType();\n      style = geometryType === 'Point' ? markerStyle : defaultStyle;\n      style.getText().setText(olFeature.get('_mapTitle'));\n      return style;\n    }\n  };\n}\n\n/**\n * Create a basic style for lines and polygons\n * @returns Style\n */\nexport function createOverlayDefaultStyle({\n  text,\n  strokeWidth = 2,\n  fillColor = [0, 161, 222, 0.3],\n  strokeColor = [0, 161, 222, 0.9],\n}: {\n  text?: string;\n  strokeWidth?: number;\n  fillColor?: string | number[];\n  strokeColor?: string | number[];\n} = {}): olstyle.Style {\n  const fillWithOpacity = ColorAsArray(fillColor).slice(0);\n  const strokeWithOpacity = ColorAsArray(strokeColor).slice(0);\n\n  const stroke = new olstyle.Stroke({\n    width: strokeWidth,\n    color: strokeWithOpacity\n  });\n\n  const fill = new olstyle.Fill({\n    color: fillWithOpacity\n  });\n\n  return new olstyle.Style({\n    stroke,\n    fill,\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke,\n      fill\n    }),\n    text: new olstyle.Text({\n      text,\n      font: '12px Calibri,sans-serif',\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n\nfunction createBufferStyle(\n  strokeRGBA: [number, number, number, number] = [0, 161, 222, 1],\n  strokeWidth: number = 2,\n  fillRGBA: [number, number, number, number] = [0, 161, 222, 0.15],\n  bufferRadius?\n): olstyle.Style {\n  const stroke = new olstyle.Stroke({\n    width: strokeWidth,\n    color: strokeRGBA\n  });\n\n  const fill = new olstyle.Fill({\n    color: fillRGBA\n  });\n\n  return new olstyle.Style({\n    stroke,\n    fill,\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke,\n      fill\n    }),\n    text: new olstyle.Text({\n      font: '12px Calibri,sans-serif',\n      text: bufferRadius,\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n","import OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport {\n  Feature,\n  FeatureMotion,\n  featureToOl,\n  moveToOlFeatures\n} from '../../feature/shared';\nimport { FeatureDataSource } from '../../datasource';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../map/shared/map';\n\nimport { createOverlayLayer } from './overlay.utils';\n\n/**\n * This class is simply a shortcut for adding features to a map.\n * It does nothing more than a standard layer but it's shipped with\n * a defautl style based on the geometry type of the features it contains.\n * @todo Enhance that by using a FeatureStore and strategies.\n */\nexport class Overlay {\n  /**\n   * The map to add the layer to\n   */\n  private map: IgoMap;\n\n  /**\n   * Overlay layer\n   */\n  private layer: VectorLayer;\n\n  /**\n   * Overlay layer's data source\n   */\n  get dataSource(): FeatureDataSource {\n    return this.layer.dataSource as FeatureDataSource;\n  }\n\n  constructor(map?: IgoMap) {\n    this.layer = createOverlayLayer();\n    this.setMap(map);\n  }\n\n  /**\n   * Bind this to a map and add the overlay layer to that map\n   * @param map Map\n   */\n  setMap(map: IgoMap) {\n    if (map === undefined) {\n      if (this.map !== undefined) {\n        this.map.ol.removeLayer(this.layer.ol);\n      }\n    } else {\n      map.ol.addLayer(this.layer.ol);\n    }\n    this.map = map;\n  }\n\n  /**\n   * Set the overlay features and, optionally, move to them\n   * @param features Features\n   * @param motion Optional: Apply this motion to the map view\n   * @param sourceId Optional: Remove features of certain sourceId (ex: 'Map' for query features)\n   */\n  setFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    sourceId?: string\n  ) {\n    if (sourceId) {\n      for (const olFeature of this.dataSource.ol.getFeatures()) {\n        if (olFeature.get('_sourceId') === sourceId) {\n          this.removeOlFeature(olFeature);\n        }\n      }\n    } else {\n      this.clear();\n    }\n    this.addFeatures(features, motion);\n  }\n\n  /**\n   * Add a feature to the  overlay and, optionally, move to it\n   * @param feature Feature\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addFeature(feature: Feature, motion: FeatureMotion = FeatureMotion.Default) {\n    this.addFeatures([feature], motion);\n  }\n\n  /**\n   * Add features to the  overlay and, optionally, move to them\n   * @param features Features\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    const olFeatures = [];\n    features.forEach((feature: Feature) => {\n      const olFeature = featureToOl(feature, this.map.projection);\n      const olGeometry = olFeature.getGeometry();\n      if (olGeometry === null) {\n        return;\n      }\n      olFeatures.push(olFeature);\n    });\n\n    this.addOlFeatures(olFeatures, motion);\n  }\n\n  /**\n   * Add a OpenLayers feature to the  overlay and, optionally, move to it\n   * @param olFeature OpenLayers Feature\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addOlFeature(\n    olFeature: OlFeature<OlGeometry>,\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    this.addOlFeatures([olFeature], motion);\n  }\n\n  /**\n   * Add OpenLayers features to the overlay and, optionally, move to them\n   * @param olFeatures OpenLayers Features\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addOlFeatures(\n    olFeatures: OlFeature<OlGeometry>[],\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    this.dataSource.ol.addFeatures(olFeatures);\n    moveToOlFeatures(this.map, olFeatures, motion);\n  }\n\n  /**\n   * Remove a feature from the overlay\n   * @param feature Feature\n   */\n  removeFeature(feature: Feature) {\n    this.removeFeatures([feature]);\n  }\n\n  /**\n   * Remove features from the overlay\n   * @param features Features\n   */\n  removeFeatures(features: Feature[]) {\n    features.forEach((feature: Feature) => {\n      if (feature.meta) {\n        if (this.dataSource.ol.getFeatureById(feature.meta.id)) {\n          this.removeOlFeature(this.dataSource.ol.getFeatureById(feature.meta.id));\n        }\n      }\n    });\n  }\n\n  /**\n   * Remove an OpenLayers feature from the overlay\n   * @param olFeature OpenLayers Feature\n   */\n  removeOlFeature(olFeature: OlFeature<OlGeometry>) {\n    this.dataSource.ol.removeFeature(olFeature);\n  }\n\n  /**\n   * Clear the overlay\n   */\n  clear() {\n    this.dataSource.ol.clear();\n  }\n}\n","import { Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nimport { Watcher, SubjectStatus } from '@igo2/utils';\nimport { Layer } from '../../layer/shared/layers';\n\nexport class LayerWatcher extends Watcher {\n  private loaded = 0;\n  private loading = 0;\n  private layers: Layer[] = [];\n  private subscriptions: Subscription[] = [];\n\n  constructor() {\n    super();\n  }\n\n  watch() {}\n\n  unwatch() {\n    this.layers.forEach(layer => this.unwatchLayer(layer), this);\n  }\n\n  watchLayer(layer: Layer) {\n    if (layer.status$ === undefined) {\n      return;\n    }\n\n    this.layers.push(layer);\n\n    const layer$$ = layer.status$\n      .pipe(distinctUntilChanged())\n      .subscribe(status => {\n        if (status === SubjectStatus.Error) {\n          this.loading = 0;\n          this.loaded = -1;\n        }\n        if (status === SubjectStatus.Working) {\n          this.loading += 1;\n        } else if (status === SubjectStatus.Done) {\n          this.loaded += 1;\n        }\n\n        if (this.loaded >= this.loading) {\n          this.loading = this.loaded = 0;\n          this.status = SubjectStatus.Done;\n        } else if (this.loading > 0) {\n          this.status = SubjectStatus.Working;\n        }\n      });\n\n    this.subscriptions.push(layer$$);\n  }\n\n  unwatchLayer(layer: Layer) {\n    layer.status$.next(SubjectStatus.Done);\n    const index = this.layers.indexOf(layer);\n    if (index >= 0) {\n      const status = (layer as any).watcher.status;\n      if (\n        [SubjectStatus.Working, SubjectStatus.Waiting].indexOf(status) !== -1\n      ) {\n        this.loaded += 1;\n      }\n      this.subscriptions[index].unsubscribe();\n      this.subscriptions.splice(index, 1);\n      this.layers.splice(index, 1);\n      (layer as any).watcher.unwatch();\n    }\n  }\n}\n","export enum MapViewAction {\n  Move,\n  Zoom\n}\n","import { EventsKey } from 'ol/events';\nimport OlMap from 'ol/Map';\nimport { unByKey } from 'ol/Observable';\n\n/**\n * Base map controller\n */\nexport class MapController {\n\n  /**\n   * OL Map\n   */\n  protected olMap: OlMap;\n\n  /**\n   * Array of observer keys\n   */\n  protected observerKeys: EventsKey[] = [];\n\n  /**\n   * Return the OL map this controller is bound to\n   * @returns OL Map\n   */\n  getOlMap(): OlMap {\n    return this.olMap;\n  }\n\n  /**\n   * Add or remove this controller to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    if (olMap !== undefined && this.getOlMap() !== undefined) {\n      throw new Error('This controller is already bound to a map.');\n    }\n\n    if (olMap === undefined) {\n      this.teardownObservers();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n  }\n\n  /**\n   * Teardown any observers\n   */\n  teardownObservers() {\n    this.observerKeys.forEach((key: EventsKey) => unByKey(key));\n    this.observerKeys = [];\n  }\n\n}\n","import OlMap from 'ol/Map';\nimport OlMapEvent from 'ol/MapEvent';\n\nimport { BehaviorSubject, Subject, Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport * as oleasing from 'ol/easing';\nimport * as olproj from 'ol/proj';\nimport OlProjection from 'ol/proj/Projection';\nimport OlView from 'ol/View';\n\nimport { MapViewAction } from '../map.enums';\nimport { MapExtent, MapViewState } from '../map.interface';\nimport { getScaleFromResolution, viewStatesAreEqual } from '../map.utils';\nimport { MapController } from './controller';\nimport { EventsKey } from 'ol/events';\n\nexport interface MapViewControllerOptions {\n  stateHistory: boolean;\n}\n\n/**\n * Controller to handle map view interactions\n */\nexport class MapViewController extends MapController {\n  /**\n   * Observable of the current resolution\n   */\n  resolution$ = new BehaviorSubject<number>(undefined);\n\n  /**\n   * Observable of the current state\n   */\n  state$ = new BehaviorSubject<MapViewState>(undefined);\n\n  /**\n   * View Padding\n   */\n  padding = [0, 0, 0, 0];\n\n  /**\n   * Max zoom after set extent\n   */\n  maxZoomOnExtent = 19;\n\n  /**\n   * Max extent possible when zooming\n   */\n  maxLayerZoomExtent: MapExtent;\n\n  /**\n   * Extent stream\n   */\n  private extent$ = new Subject<{ extent: MapExtent; action: MapViewAction }>();\n\n  /**\n   * Subscription to the movement stream\n   */\n  private extent$$: Subscription;\n\n  /**\n   * History of states\n   */\n  private states: MapViewState[] = [];\n\n  /**\n   * Current state index\n   */\n  private stateIndex: number = 0;\n\n  /**\n   * Whether the view controller should keep the view's state history\n   */\n  get stateHistory(): boolean {\n    return this.options ? this.options.stateHistory === true : false;\n  }\n\n  /**\n   * OL View\n   */\n  get olView(): OlView {\n    return this.olMap.getView();\n  }\n\n  constructor(private options?: MapViewControllerOptions) {\n    super();\n  }\n\n  /**\n   * Add or remove this controller to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    super.setOlMap(olMap);\n    this.setupObservers();\n  }\n\n  /**\n   * Observe move moveend and subscribe to the extent stream\n   */\n  setupObservers() {\n    if (this.stateHistory === true) {\n      this.observerKeys.push(\n        this.olMap.on('moveend', (event: OlMapEvent) => this.onMoveEnd(event)) as EventsKey\n      );\n    }\n\n    this.extent$$ = this.extent$\n      .pipe(debounceTime(25))\n      .subscribe((value: { extent: MapExtent; action: MapViewAction }) => {\n        this.setExtent(value.extent, value.action);\n      });\n  }\n\n  /**\n   * Teardown any observers\n   */\n  teardownObservers() {\n    super.teardownObservers();\n    if (this.extent$$ !== undefined) {\n      this.extent$$.unsubscribe();\n      this.extent$$ = undefined;\n    }\n  }\n\n  /**\n   * Get the view's OL projection\n   * @returns OL projection\n   */\n  getOlProjection(): OlProjection {\n    return this.olView.getProjection();\n  }\n\n  /**\n   * Get the current map view center\n   * @param projection Output projection\n   * @returns Center\n   */\n  getCenter(projection?: string | OlProjection): [number, number] {\n    let center = this.olView.getCenter() as [number, number];\n    if (projection && center) {\n      center = olproj.transform(center, this.getOlProjection(), projection) as [number, number];\n    }\n    return center;\n  }\n\n  /**\n   * Get the current view extent\n   * @param projection Output projection\n   * @returns Extent\n   */\n  getExtent(projection?: string | OlProjection): MapExtent {\n    let extent = this.olView.calculateExtent(this.olMap.getSize());\n    if (projection && extent) {\n      extent = olproj.transformExtent(\n        extent,\n        this.getOlProjection(),\n        projection\n      );\n    }\n    return extent as [number, number, number, number];\n  }\n\n  /**\n   * Get the current scale\n   * @param dpi Dot per inches\n   * @returns View scale\n   */\n  getScale(dpi = 96) {\n    return getScaleFromResolution(\n      this.getResolution(),\n      this.getOlProjection().getUnits(),\n      dpi\n    );\n  }\n\n  /**\n   * Get the current resolution\n   * @returns Projection denominator\n   */\n  getResolution(): number {\n    return this.olView.getResolution();\n  }\n\n  /**\n   * Get the current zoom level\n   * @returns Zoom level\n   */\n  getZoom(): number {\n    return Math.round(this.olView.getZoom());\n  }\n\n  /**\n   * Zoom in\n   */\n  zoomIn() {\n    this.zoomTo(this.olView.getZoom() + 1);\n  }\n\n  /**\n   * Zoom out\n   */\n  zoomOut() {\n    this.zoomTo(this.olView.getZoom() - 1);\n  }\n\n  /**\n   * Zoom to specific zoom level\n   * @param zoom Zoom level\n   */\n  zoomTo(zoom: number) {\n    this.olView.cancelAnimations();\n    this.olView.animate({\n      zoom,\n      duration: 250,\n      easing: oleasing.easeOut\n    });\n  }\n\n  /**\n   * Move to extent after a short delay (100ms) unless\n   * a new movement gets registered in the meantime.\n   * @param extent Extent to move to\n   */\n  moveToExtent(extent: [number, number, number, number]) {\n    this.extent$.next({ extent, action: MapViewAction.Move });\n  }\n\n  /**\n   * Zoom to extent after a short delay (100ms) unless\n   * a new movement gets registered in the meantime.\n   * @param extent Extent to zoom to\n   */\n  zoomToExtent(extent: [number, number, number, number]) {\n    this.extent$.next({ extent, action: MapViewAction.Zoom });\n  }\n\n  /**\n   * Return the current view rotation\n   * @returns Rotation angle in degrees\n   */\n  getRotation(): number {\n    return this.olView.getRotation();\n  }\n\n  /**\n   * Reset the view rotation to 0\n   */\n  resetRotation() {\n    this.olView.animate({ rotation: 0 });\n  }\n\n  /**\n   * Whether the view has a previous state\n   * @returns True if the view has a previous state\n   */\n  hasPreviousState(): boolean {\n    return this.states.length > 1 && this.stateIndex > 0;\n  }\n\n  /**\n   * Whether the view has a next state\n   * @returns True if the view has a next state\n   */\n  hasNextState(): boolean {\n    return this.states.length > 1 && this.stateIndex < this.states.length - 1;\n  }\n\n  /**\n   * Restore the previous view state\n   */\n  previousState() {\n    if (this.hasPreviousState()) {\n      this.setStateIndex(this.stateIndex - 1);\n    }\n  }\n\n  /**\n   * Restore the next view state\n   */\n  nextState() {\n    if (this.hasNextState()) {\n      this.setStateIndex(this.stateIndex + 1);\n    }\n  }\n\n  /**\n   * Clear the state history\n   */\n  clearStateHistory() {\n    this.states = [];\n    this.stateIndex = 0;\n  }\n\n  /**\n   * Update the the view to it's intial state\n   */\n  setInitialState() {\n    if (this.states.length > 0) {\n      this.setStateIndex(0);\n    }\n  }\n\n  /**\n   * Move to the extent retrieved from the stream\n   * @param extent Extent\n   * @param action Either zoom or move\n   * @param animation With or without animation to the target extent.\n   */\n  private setExtent(\n    extent: MapExtent,\n    action: MapViewAction,\n    animation: boolean = true\n  ) {\n    const olView = this.olView;\n    olView.cancelAnimations();\n    const duration = animation ? 500 : 0;\n    const zoom = olView.getZoom();\n\n    const fromCenter = olView.getCenter();\n    const toCenter = [\n      extent[0] + (extent[2] - extent[0]) / 2,\n      extent[1] + (extent[3] - extent[1]) / 2\n    ];\n    const distCenter = Math.sqrt(\n      Math.pow(fromCenter[0] - toCenter[0], 2) +\n        Math.pow(fromCenter[1] - toCenter[1], 2)\n    );\n    const fromExtent = olView.calculateExtent();\n    const fromSize = Math.sqrt(\n      Math.pow(fromExtent[2] - fromExtent[0], 2) +\n        Math.pow(fromExtent[3] - fromExtent[1], 2)\n    );\n    const toSize = Math.sqrt(\n      Math.pow(extent[2] - extent[0], 2) + Math.pow(extent[3] - extent[1], 2)\n    );\n    const moySize = (toSize + fromSize) / 2;\n    const xSize = distCenter / moySize;\n\n    const maxZoom =\n      action === MapViewAction.Move || zoom > this.maxZoomOnExtent\n        ? zoom\n        : this.maxZoomOnExtent;\n\n    olView.fit(extent, {\n      size: this.olMap.getSize(),\n      maxZoom,\n      padding: this.padding,\n      duration: xSize > 4 ? 0 : duration,\n      callback: (isFinished: boolean) => {\n        if (!isFinished) {\n          olView.fit(extent, {\n            size: this.olMap.getSize(),\n            maxZoom,\n            padding: this.padding,\n            duration: xSize > 4 ? 0 : duration\n          });\n        }\n      }\n    });\n  }\n\n  /**\n   * Set the view state index\n   * @param index State index\n   */\n  private setStateIndex(index: number) {\n    this.stateIndex = index;\n    this.setState(this.states[index]);\n  }\n\n  /**\n   * Set the view state\n   * @param state View state\n   */\n  private setState(state: MapViewState) {\n    this.olView.animate({\n      resolution: state.resolution,\n      center: state.center,\n      duration: 0\n    });\n  }\n\n  /**\n   * On move end, get the view state and record it.\n   * @param event Map event\n   */\n  private onMoveEnd(event: OlMapEvent) {\n    const resolution = this.getResolution();\n    if (this.resolution$.value !== resolution) {\n      this.resolution$.next(resolution);\n    }\n\n    const state = {\n      resolution,\n      center: this.getCenter(),\n      zoom: this.getZoom()\n    };\n\n    if (this.stateHistory === true) {\n      const stateIndex = this.stateIndex;\n      const stateAtIndex =\n        this.states.length === 0 ? undefined : this.states[stateIndex];\n      if (!viewStatesAreEqual(state, stateAtIndex)) {\n        this.states = this.states.slice(0, stateIndex + 1).concat([state]);\n        this.stateIndex = this.states.length - 1;\n      }\n    }\n\n    this.state$.next(state);\n  }\n}\n","import olMap from 'ol/Map';\nimport olView from 'ol/View';\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport olGeolocation from 'ol/Geolocation';\nimport olControlAttribution from 'ol/control/Attribution';\nimport olControlScaleLine from 'ol/control/ScaleLine';\nimport * as olproj from 'ol/proj';\nimport * as olproj4 from 'ol/proj/proj4';\nimport olPoint from 'ol/geom/Point';\nimport OlProjection from 'ol/proj/Projection';\nimport * as olinteraction from 'ol/interaction';\nimport olCircle from 'ol/geom/Circle';\nimport * as olstyle from 'ol/style';\n\nimport proj4 from 'proj4';\nimport { BehaviorSubject, Subject, Subscription } from 'rxjs';\n\nimport { SubjectStatus } from '@igo2/utils';\n\nimport { Layer } from '../../layer/shared/layers';\nimport { Overlay } from '../../overlay/shared/overlay';\n\nimport { LayerWatcher } from '../utils/layer-watcher';\nimport {\n  MapViewOptions,\n  MapOptions,\n  MapAttributionOptions,\n  MapScaleLineOptions,\n  MapExtent,\n  MapControlsOptions\n} from './map.interface';\nimport { MapViewController } from './controllers/view';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { FeatureMotion } from '../../feature/shared/feature.enums';\n\n// TODO: This class is messy. Clearly define it's scope and the map browser's.\n// Move some stuff into controllers.\nexport class IgoMap {\n  public ol: olMap;\n  public offlineButtonToggle$ = new BehaviorSubject<boolean>(false);\n  public layers$ = new BehaviorSubject<Layer[]>([]);\n  public status$: Subject<SubjectStatus>;\n  public alwaysTracking: boolean;\n  public positionFollower: boolean = true;\n  public geolocation$ = new BehaviorSubject<olGeolocation>(undefined);\n  public geolocationPositionFeature: olFeature<OlGeometry>;\n  public geolocationAccuracyFeature: olFeature<OlGeometry>;\n  public bufferGeom: olCircle;\n  public bufferFeature: olFeature<OlGeometry>;\n  public buffer: Overlay;\n  public overlay: Overlay;\n  public queryResultsOverlay: Overlay;\n  public searchResultsOverlay: Overlay;\n  public viewController: MapViewController;\n  public swipeEnabled$ = new BehaviorSubject<boolean>(false);\n  public mapCenter$ = new BehaviorSubject<boolean>(false);\n  public selectedFeatures$ = new BehaviorSubject<Layer[]>(null);\n\n  public bufferDataSource: FeatureDataSource;\n\n  private layerWatcher: LayerWatcher;\n  private geolocation: olGeolocation;\n  private geolocation$$: Subscription;\n\n  private options: MapOptions;\n  private defaultOptions: Partial<MapOptions> = {\n    controls: { attribution: false }\n  };\n\n  get layers(): Layer[] {\n    return this.layers$.value;\n  }\n\n  get projection(): string {\n    return this.viewController.getOlProjection().getCode();\n  }\n\n  constructor(options?: MapOptions) {\n    this.options = Object.assign({}, this.defaultOptions, options);\n    this.layerWatcher = new LayerWatcher();\n    this.status$ = this.layerWatcher.status$;\n    olproj4.register(proj4);\n    this.init();\n  }\n\n  init() {\n    const controls = [];\n    if (this.options.controls) {\n      if (this.options.controls.attribution) {\n        const attributionOpt = (this.options.controls.attribution === true\n          ? {}\n          : this.options.controls.attribution) as MapAttributionOptions;\n        controls.push(new olControlAttribution(attributionOpt));\n      }\n      if (this.options.controls.scaleLine) {\n        const scaleLineOpt = (this.options.controls.scaleLine === true\n          ? {}\n          : this.options.controls.scaleLine) as MapScaleLineOptions;\n        controls.push(new olControlScaleLine(scaleLineOpt));\n      }\n    }\n    let interactions = {};\n    if (this.options.interactions === false) {\n      interactions = {\n        altShiftDragRotate: false,\n        doubleClickZoom: false,\n        keyboard: false,\n        mouseWheelZoom: false,\n        shiftDragZoom: false,\n        dragPan: false,\n        pinchRotate: false,\n        pinchZoom: false\n      };\n    }\n\n    this.ol = new olMap({\n      interactions: olinteraction.defaults(interactions),\n      controls\n    });\n\n    this.setView(this.options.view || {});\n    this.viewController = new MapViewController({\n      stateHistory: true\n    });\n    this.viewController.setOlMap(this.ol);\n    this.overlay = new Overlay(this);\n    this.queryResultsOverlay = new Overlay(this);\n    this.searchResultsOverlay = new Overlay(this);\n    this.buffer = new Overlay(this);\n  }\n\n  setTarget(id: string) {\n    this.ol.setTarget(id);\n    if (id !== undefined) {\n      this.layerWatcher.subscribe(() => { }, null);\n    } else {\n      this.layerWatcher.unsubscribe();\n    }\n  }\n\n  updateView(options: MapViewOptions) {\n    const currentView = this.ol.getView();\n    const viewOptions = Object.assign(\n      {\n        zoom: currentView.getZoom()\n      },\n      currentView.getProperties()\n    );\n\n    this.setView(Object.assign(viewOptions, options));\n    if (options.maxZoomOnExtent) {\n      this.viewController.maxZoomOnExtent = options.maxZoomOnExtent;\n    }\n  }\n\n  /**\n   * Set the map view\n   * @param options Map view options\n   */\n  setView(options: MapViewOptions) {\n    if (this.viewController !== undefined) {\n      this.viewController.clearStateHistory();\n    }\n\n    options = Object.assign({ constrainResolution: true }, options);\n    const view = new olView(options);\n    this.ol.setView(view);\n\n    this.unsubscribeGeolocate();\n    if (options) {\n      if (options.maxLayerZoomExtent) {\n        this.viewController.maxLayerZoomExtent = options.maxLayerZoomExtent;\n      }\n\n      if (options.center) {\n        const projection = view.getProjection().getCode();\n        const center = olproj.fromLonLat(options.center, projection);\n        view.setCenter(center);\n      }\n\n      if (options.geolocate) {\n        this.geolocate(true);\n      }\n\n      if (options.alwaysTracking) {\n        this.alwaysTracking = true;\n      }\n    }\n  }\n\n  updateControls(value: MapControlsOptions) {\n    if (value === undefined) {\n      return;\n    }\n\n    const controls = [];\n    if (value.attribution) {\n      const attributionOpt = (value.attribution === true\n        ? {}\n        : value.attribution) as MapAttributionOptions;\n      controls.push(new olControlAttribution(attributionOpt));\n    }\n    if (value.scaleLine) {\n      const scaleLineOpt = (value.scaleLine === true\n        ? {}\n        : value.scaleLine) as MapScaleLineOptions;\n      controls.push(new olControlScaleLine(scaleLineOpt));\n    }\n\n    const currentControls = Object.assign([], this.ol.getControls().getArray());\n    currentControls.forEach(control => {\n      this.ol.removeControl(control);\n    });\n    controls.forEach(control => {\n      this.ol.addControl(control);\n    });\n  }\n\n  /**\n   * Deprecated\n   * TODO: Move to ViewController and update every place it's used\n   */\n  getCenter(projection?: string | OlProjection): [number, number] {\n    return this.viewController.getCenter(projection);\n  }\n\n  /**\n   * Deprecated\n   * TODO: Move to ViewController and update every place it's used\n   */\n  getExtent(projection?: string | OlProjection): MapExtent {\n    return this.viewController.getExtent(projection);\n  }\n\n  // TODO: Move to ViewController and update every place it's used\n  getZoom(): number {\n    return this.viewController.getZoom();\n  }\n\n  changeBaseLayer(baseLayer: Layer) {\n    if (!baseLayer) {\n      return;\n    }\n\n    for (const bl of this.getBaseLayers()) {\n      bl.visible = false;\n    }\n\n    baseLayer.visible = true;\n\n    this.viewController.olView.setMinZoom(\n      baseLayer.dataSource.options.minZoom || (this.options.view || {}).minZoom\n    );\n    this.viewController.olView.setMaxZoom(\n      baseLayer.dataSource.options.maxZoom || (this.options.view || {}).maxZoom\n    );\n  }\n\n  getBaseLayers(): Layer[] {\n    return this.layers.filter((layer: Layer) => layer.baseLayer === true);\n  }\n\n  getLayerById(id: string): Layer {\n    return this.layers.find((layer: Layer) => layer.id && layer.id === id);\n  }\n\n  getLayerByAlias(alias: string): Layer {\n    return this.layers.find(\n      (layer: Layer) => layer.alias && layer.alias === alias\n    );\n  }\n\n  getLayerByOlUId(olUId: string): Layer {\n    return this.layers.find(\n      (layer: Layer) => (layer.ol as any).ol_uid && (layer.ol as any).ol_uid === olUId\n    );\n  }\n\n  /**\n   * Add a single layer\n   * @param layer Layer to add\n   * @param push DEPRECATED\n   */\n  addLayer(layer: Layer, push = true) {\n    this.addLayers([layer]);\n  }\n\n  /**\n   * Add many layers\n   * @param layers Layers to add\n   * @param push DEPRECATED\n   */\n  addLayers(layers: Layer[], push = true) {\n    let offsetZIndex = 0;\n    let offsetBaseLayerZIndex = 0;\n    const addedLayers = layers\n      .map((layer: Layer) => {\n        if (!layer) { return; }\n        const offset = layer.zIndex\n          ? 0\n          : layer.baseLayer\n            ? offsetBaseLayerZIndex++\n            : offsetZIndex++;\n        return this.doAddLayer(layer, offset);\n      })\n      .filter((layer: Layer | undefined) => layer !== undefined);\n    this.setLayers([].concat(this.layers, addedLayers));\n  }\n\n  /**\n   * Remove a single layer\n   * @param layer Layer to remove\n   */\n  removeLayer(layer: Layer) {\n    this.removeLayers([layer]);\n  }\n\n  /**\n   * Remove many layers\n   * @param layers Layers to remove\n   */\n  removeLayers(layers: Layer[]) {\n    const newLayers = this.layers$.value.slice(0);\n    const layersToRemove = [];\n    layers.forEach((layer: Layer) => {\n      const index = newLayers.indexOf(layer);\n      if (index >= 0) {\n        layersToRemove.push(layer);\n        newLayers.splice(index, 1);\n        this.handleLinkedLayersDeletion(layer, layersToRemove);\n        layersToRemove.map(linkedLayer => {\n          layersToRemove.push(linkedLayer);\n          const linkedIndex = newLayers.indexOf(linkedLayer);\n          if (linkedIndex >= 0) {\n            newLayers.splice(linkedIndex, 1);\n          }\n        });\n      }\n    });\n\n    layersToRemove.forEach((layer: Layer) => this.doRemoveLayer(layer));\n    this.setLayers(newLayers);\n  }\n\n  /**\n   * Build a list of linked layers to delete\n   * @param srcLayer Layer that has triggered the deletion\n   * @param layersToRemove list to append the layer to delete into\n   */\n  handleLinkedLayersDeletion(srcLayer: Layer, layersToRemove: Layer[]) {\n    const linkedLayers = srcLayer.options.linkedLayers;\n    if (!linkedLayers) {\n      return;\n    }\n    const currentLinkedId = linkedLayers.linkId;\n    const currentLinks = linkedLayers.links;\n    const isParentLayer = currentLinks ? true : false;\n    if (isParentLayer) {\n      // search for child layers\n      currentLinks.map(link => {\n        if (!link.syncedDelete) {\n          return;\n        }\n        link.linkedIds.map(linkedId => {\n          const layerToApply = this.layers.find(layer => layer.options.linkedLayers?.linkId === linkedId);\n          if (layerToApply) {\n            layersToRemove.push(layerToApply);\n          }\n        });\n      });\n    } else {\n      // search for parent layer\n      this.layers.map(layer => {\n        if (layer.options.linkedLayers?.links) {\n          layer.options.linkedLayers.links.map(l => {\n            if (\n              l.syncedDelete && l.bidirectionnal !== false &&\n              l.linkedIds.indexOf(currentLinkedId) !== -1) {\n              layersToRemove.push(layer);\n              this.handleLinkedLayersDeletion(layer, layersToRemove);\n            }\n          });\n        }\n      });\n    }\n  }\n\n  /**\n   * Remove all layers\n   */\n  removeAllLayers() {\n    this.layers.forEach((layer: Layer) => this.doRemoveLayer(layer));\n    this.layers$.next([]);\n  }\n\n  raiseLayer(layer: Layer) {\n    const index = this.getLayerIndex(layer);\n    if (index > 1) {\n      this.moveLayer(layer, index, index - 1);\n    }\n  }\n\n  raiseLayers(layers: Layer[]) {\n    for (const layer of layers) {\n      this.raiseLayer(layer);\n    }\n  }\n\n  lowerLayer(layer: Layer) {\n    const index = this.getLayerIndex(layer);\n    if (index < this.layers.length - 1) {\n      this.moveLayer(layer, index, index + 1);\n    }\n  }\n\n  lowerLayers(layers: Layer[]) {\n    const reverseLayers = layers.reverse();\n    for (const layer of reverseLayers) {\n      this.lowerLayer(layer);\n    }\n  }\n\n  moveLayer(layer: Layer, from: number, to: number) {\n    const layerTo = this.layers[to];\n    const zIndexTo = layerTo.zIndex;\n    const zIndexFrom = layer.zIndex;\n\n    if (layerTo.baseLayer || layer.baseLayer) {\n      return;\n    }\n\n    layer.zIndex = zIndexTo;\n    layerTo.zIndex = zIndexFrom;\n\n    this.layers[to] = layer;\n    this.layers[from] = layerTo;\n    this.layers$.next(this.layers.slice(0));\n  }\n\n  /**\n   * Add a layer to the OL map and start watching. If the layer is already\n   * added to this map, make it visible but don't add it one again.\n   * @param layer Layer\n   * @returns The layer added, if any\n   */\n  private doAddLayer(layer: Layer, offsetZIndex: number) {\n    if (layer.baseLayer && layer.visible) {\n      this.changeBaseLayer(layer);\n    }\n\n    const existingLayer = this.getLayerById(layer.id);\n    if (existingLayer !== undefined) {\n      existingLayer.visible = true;\n      return;\n    }\n\n    if (!layer.baseLayer && layer.zIndex) {\n      layer.zIndex += 10;\n    }\n\n    if (layer.zIndex === undefined || layer.zIndex === 0) {\n      const maxZIndex = Math.max(\n        layer.baseLayer ? 0 : 10,\n        ...this.layers\n          .filter(\n            (l) => l.baseLayer === layer.baseLayer && l.zIndex < 200 // zIndex > 200 = system layer\n          )\n          .map((l) => l.zIndex)\n      );\n      layer.zIndex = maxZIndex + 1 + offsetZIndex;\n    }\n\n    if (layer.baseLayer && layer.zIndex > 9) {\n      layer.zIndex = 10; // baselayer must have zIndex < 10\n    }\n\n    layer.setMap(this);\n    this.layerWatcher.watchLayer(layer);\n    this.ol.addLayer(layer.ol);\n\n    return layer;\n  }\n\n  /**\n   * Remove a layer from the OL map and stop watching\n   * @param layer Layer\n   */\n  private doRemoveLayer(layer: Layer) {\n    this.layerWatcher.unwatchLayer(layer);\n    this.ol.removeLayer(layer.ol);\n    layer.setMap(undefined);\n  }\n\n  /**\n   * Update the layers observable\n   * @param layers Layers\n   */\n  private setLayers(layers: Layer[]) {\n    this.layers$.next(this.sortLayersByZIndex(layers).slice(0));\n  }\n\n  /**\n   * Sort layers by descending zIndex\n   * @param layers Array of layers\n   * @returns The original array, sorted by zIndex\n   */\n  private sortLayersByZIndex(layers: Layer[]) {\n    // Sort by descending zIndex\n    return layers.sort(\n      (layer1: Layer, layer2: Layer) => layer2.zIndex - layer1.zIndex\n    );\n  }\n\n  /**\n   * Get layer index in the map's inenr array of layers\n   * @param layer Layer\n   * @returns The layer index\n   */\n  private getLayerIndex(layer: Layer) {\n    return this.layers.findIndex((_layer: Layer) => _layer === layer);\n  }\n\n  // TODO: Create a GeolocationController with everything below\n  geolocate(track = false) {\n    let first = true;\n    if (this.geolocation$$) {\n      track = this.geolocation.getTracking();\n      this.unsubscribeGeolocate();\n    }\n    this.startGeolocation();\n\n    this.geolocation$$ = this.geolocation$.subscribe((geolocation) => {\n      if (!geolocation) {\n        return;\n      }\n      const accuracy = geolocation.getAccuracy();\n      const coordinates = geolocation.getPosition();\n      if (accuracy < 10000) {\n        const positionGeometry = coordinates ? new olPoint(coordinates) : null;\n\n        const accuracyGeometry = geolocation.getAccuracyGeometry();\n        const accuracyExtent = accuracyGeometry.getExtent();\n\n        [this.geolocationPositionFeature, this.geolocationAccuracyFeature].map(feature => {\n          if (feature && this.overlay.dataSource.ol.getFeatureById(feature.getId())) {\n            this.overlay.dataSource.ol.removeFeature(feature);\n          }\n        });\n\n        if (this.bufferFeature) {\n          this.buffer.dataSource.ol.removeFeature(this.bufferFeature);\n        }\n\n        this.geolocationPositionFeature = new olFeature({ geometry: positionGeometry });\n        this.geolocationPositionFeature.setId('geolocationPositionFeature');\n\n        this.geolocationPositionFeature.setStyle(\n          new olstyle.Style({\n            image: new olstyle.Circle({\n              radius: 6,\n              fill: new olstyle.Fill({\n                color: '#3399CC',\n              }),\n              stroke: new olstyle.Stroke({\n                color: '#fff',\n                width: 2,\n              }),\n            }),\n          })\n        );\n\n\n        this.geolocationAccuracyFeature = new olFeature({ geometry: accuracyGeometry });\n        this.geolocationAccuracyFeature.setId('geolocationAccuracyFeature');\n        if (this.alwaysTracking) {\n          [this.geolocationPositionFeature, this.geolocationAccuracyFeature].map(feature => {\n            this.overlay.addOlFeature(\n              feature,\n              this.positionFollower ? FeatureMotion.Move : FeatureMotion.None\n            );\n          });\n\n        } else {\n          [this.geolocationPositionFeature, this.geolocationAccuracyFeature].map(feature => {\n            this.overlay.addOlFeature(\n              feature\n            );\n          });\n        }\n\n        if (this.ol.getView().get('options_')?.buffer) {\n          const bufferRadius = this.ol.getView().get('options_').buffer.bufferRadius;\n          this.bufferGeom = new olCircle(coordinates, bufferRadius);\n          const bufferStroke = this.ol.getView().get('options_').buffer.bufferStroke;\n          const bufferFill = this.ol.getView().get('options_').buffer.bufferFill;\n\n          let bufferText;\n          if (this.ol.getView().get('options_').buffer.showBufferRadius) {\n            bufferText = bufferRadius.toString() + 'm';\n          } else {\n            bufferText = '';\n          }\n\n          this.bufferFeature = new olFeature(this.bufferGeom);\n          this.bufferFeature.setId('bufferFeature');\n          this.bufferFeature.set('bufferStroke', bufferStroke);\n          this.bufferFeature.set('bufferFill', bufferFill);\n          this.bufferFeature.set('bufferText', bufferText);\n          this.buffer.addOlFeature(this.bufferFeature, FeatureMotion.None);\n        }\n        if (first) {\n          this.viewController.zoomToExtent(accuracyExtent as [number, number, number, number]);\n          this.positionFollower = !this.positionFollower;\n        }\n      } else if (first) {\n        const view = this.ol.getView();\n        view.setCenter(coordinates);\n        view.setZoom(14);\n      }\n      if (track !== true && this.alwaysTracking !== true) {\n        this.unsubscribeGeolocate();\n      }\n      first = false;\n    });\n  }\n\n  unsubscribeGeolocate() {\n    this.stopGeolocation();\n    if (this.geolocation$$) {\n      this.geolocation$$.unsubscribe();\n      this.geolocation$$ = undefined;\n    }\n  }\n\n  private startGeolocation() {\n    if (!this.geolocation) {\n      this.geolocation = new olGeolocation({\n        trackingOptions: {\n          enableHighAccuracy: true\n        },\n        projection: this.projection,\n        tracking: true\n      });\n\n      this.geolocation.on('change', (evt) => {\n        this.geolocation$.next(this.geolocation);\n      });\n    } else {\n      this.geolocation.setTracking(true);\n    }\n  }\n\n  private stopGeolocation() {\n    if (this.geolocation) {\n      this.geolocation.setTracking(false);\n    }\n  }\n\n  onOfflineToggle(offline: boolean) {\n    this.offlineButtonToggle$.next(offline);\n  }\n}\n","import {\n  Component,\n  Input,\n  OnInit,\n  AfterViewInit,\n  OnDestroy\n} from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport { SubjectStatus } from '@igo2/utils';\nimport { ActivityService } from '@igo2/core';\n\nimport { IgoMap } from '../shared/map';\nimport { MapControlsOptions, MapViewOptions } from '../shared/map.interface';\n\n@Component({\n  selector: 'igo-map-browser',\n  templateUrl: './map-browser.component.html',\n  styleUrls: ['./map-browser.component.scss']\n})\nexport class MapBrowserComponent implements OnInit, AfterViewInit, OnDestroy {\n  private activityId: string;\n  private status$$: Subscription;\n\n  @Input() map: IgoMap;\n\n  @Input()\n  get view(): MapViewOptions {\n    return this._view;\n  }\n  set view(value: MapViewOptions) {\n    this._view = value;\n    if (this.map !== undefined) {\n      this.map.updateView(value);\n    }\n  }\n  private _view: MapViewOptions;\n\n  get controls(): MapControlsOptions {\n    return this._controls;\n  }\n\n  set controls(value: MapControlsOptions) {\n    this._controls = value;\n    if (this.map !== undefined) {\n      this.map.updateControls(value);\n    }\n  }\n  private _controls: MapControlsOptions;\n\n  public id = `igo-map-target-${new Date().getTime()}`;\n\n  constructor(private activityService: ActivityService) {}\n\n  ngOnInit() {\n    this.status$$ = this.map.status$.subscribe(status =>\n      this.handleStatusChange(status)\n    );\n  }\n\n  ngAfterViewInit() {\n    this.map.setTarget(this.id);\n  }\n\n  ngOnDestroy() {\n    this.map.setTarget(undefined);\n    this.activityService.unregister(this.activityId);\n    this.status$$.unsubscribe();\n  }\n\n  private handleStatusChange(status: SubjectStatus) {\n    if (status === SubjectStatus.Working && this.activityId === undefined) {\n      this.activityId = this.activityService.register();\n    } else if (status === SubjectStatus.Done && this.activityId !== undefined) {\n      this.activityService.unregister(this.activityId);\n      this.activityId = undefined;\n    }\n  }\n}\n","<div [id]=\"id\" class=\"igo-map-browser-target\"></div>\n<ng-content></ng-content>\n","import { Directive, AfterViewInit } from '@angular/core';\nimport {\n  NetworkService,\n  ConnectionState,\n  MessageService,\n  LanguageService\n} from '@igo2/core';\n\nimport { IgoMap } from './map';\nimport { MapBrowserComponent } from '../map-browser/map-browser.component';\nimport { FeatureDataSourceOptions } from '../../datasource/shared/datasources/feature-datasource.interface';\nimport { XYZDataSourceOptions } from '../../datasource/shared/datasources/xyz-datasource.interface';\nimport { MVTDataSourceOptions } from '../../datasource/shared/datasources/mvt-datasource.interface';\nimport { ClusterDataSourceOptions } from '../../datasource/shared/datasources/cluster-datasource.interface';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\nimport { MVTDataSource } from '../../datasource/shared/datasources/mvt-datasource';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { XYZDataSource } from '../../datasource/shared/datasources/xyz-datasource';\n\n@Directive({\n  selector: '[igoMapOffline]'\n})\nexport class MapOfflineDirective implements AfterViewInit {\n  private component: MapBrowserComponent;\n  private offlineButtonStatus: boolean = false;\n  private networkState: ConnectionState = {\n    connection: true\n  };\n  private offlineButtonState: ConnectionState = {\n    connection: true\n  };\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  private previousMessageId;\n\n  constructor(\n    component: MapBrowserComponent,\n    private networkService: NetworkService,\n    private messageService: MessageService,\n    private languageService: LanguageService\n  ) {\n    this.component = component;\n  }\n\n  ngAfterViewInit() {\n    this.map.offlineButtonToggle$.subscribe((offlineButtonToggle: boolean) => {\n      if (this.previousMessageId) {\n        this.messageService.remove(this.previousMessageId);\n      }\n      this.offlineButtonStatus = offlineButtonToggle;\n      const translate = this.languageService.translate;\n      if (this.offlineButtonStatus && this.networkState.connection) {\n        const message = translate.instant('igo.geo.network.offline.message');\n        const title = translate.instant('igo.geo.network.offline.title');\n        const messageObj = this.messageService.info(message, title);\n        this.previousMessageId = messageObj.toastId;\n        this.offlineButtonState.connection = false;\n        this.changeLayer();\n      } else if (!this.offlineButtonStatus && !this.networkState.connection) {\n        const message = translate.instant('igo.geo.network.offline.message');\n        const title = translate.instant('igo.geo.network.offline.title');\n        const messageObj = this.messageService.info(message, title);\n        this.previousMessageId = messageObj.toastId;\n        this.offlineButtonState.connection = false;\n        this.changeLayer();\n      } else if (!this.offlineButtonStatus && this.networkState.connection) {\n        let message;\n        let title;\n        const messageObs = translate.get('igo.geo.network.online.message');\n        const titleObs = translate.get('igo.geo.network.online.title');\n        messageObs.subscribe((message1: string) => {\n          message = message1;\n        });\n        titleObs.subscribe((title1: string) => {\n          title = title1;\n        });\n        if (message) {\n          const messageObj = this.messageService.info(message, title);\n          this.previousMessageId = messageObj.toastId;\n        }\n        this.offlineButtonState.connection = true;\n        this.changeLayer();\n      }\n    });\n\n    this.networkService.currentState().subscribe((state: ConnectionState) => {\n      this.networkState = state;\n      if (!this.offlineButtonStatus) {\n        this.changeLayer();\n      }\n    });\n\n    this.map.layers$.subscribe((layers: Layer[]) => {\n      this.changeLayer();\n    });\n  }\n\n  private changeLayer() {\n    let sourceOptions;\n    const layerList = this.map.layers$.value;\n    layerList.forEach(layer => {\n      if (layer.isIgoInternalLayer) {\n        return;\n      }\n      if (layer.options.source instanceof MVTDataSource) {\n        sourceOptions = layer.options.sourceOptions as MVTDataSourceOptions;\n        layer.ol.getSource().refresh();\n      } else if (layer.options.source instanceof XYZDataSource) {\n        sourceOptions = layer.options.sourceOptions as XYZDataSourceOptions;\n      } else if (layer.options.source instanceof ClusterDataSource) {\n        sourceOptions = layer.options.sourceOptions as ClusterDataSourceOptions;\n      } else if (layer.options.source instanceof FeatureDataSource) {\n        sourceOptions = layer.options.sourceOptions as FeatureDataSourceOptions;\n      } else {\n        if (\n          this.networkState.connection === false ||\n          this.offlineButtonState.connection === false\n        ) {\n          layer.ol.setMaxResolution(0);\n          return;\n        } else if (\n          this.networkState.connection === true ||\n          this.offlineButtonState.connection === true\n        ) {\n          layer.ol.setMaxResolution(Infinity);\n          return;\n        }\n      }\n\n      if (sourceOptions) {\n        if (\n          (sourceOptions.pathOffline &&\n            this.networkState.connection === false) ||\n          (sourceOptions.pathOffline &&\n            this.offlineButtonState.connection === false)\n        ) {\n          if (\n            sourceOptions.type === 'vector' ||\n            sourceOptions.type === 'cluster'\n          ) {\n            return;\n          }\n          (layer.ol.getSource() as any).setUrl(sourceOptions.pathOffline);\n        } else if (\n          (sourceOptions.pathOffline &&\n            this.networkState.connection === false) ||\n          (sourceOptions.pathOffline &&\n            this.offlineButtonState.connection === true)\n        ) {\n          if (\n            sourceOptions.type === 'vector' ||\n            sourceOptions.type === 'cluster'\n          ) {\n            return;\n          }\n          (layer.ol.getSource() as any).setUrl(sourceOptions.url);\n        } else {\n          if (\n            this.networkState.connection === false ||\n            this.offlineButtonState.connection === false\n          ) {\n            layer.ol.setMaxResolution(0);\n          } else if (\n            this.networkState.connection === true ||\n            this.offlineButtonState.connection === true\n          ) {\n            layer.ol.setMaxResolution(Infinity);\n          }\n        }\n      } else {\n        if (\n          this.networkState.connection === false ||\n          this.offlineButtonState.connection === false\n        ) {\n          layer.ol.setMaxResolution(0);\n        } else if (\n          this.networkState.connection === true ||\n          this.offlineButtonState.connection === true\n        ) {\n          layer.ol.setMaxResolution(Infinity);\n        }\n      }\n    });\n  }\n}\n","import {\n  Directive,\n  Input,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  Self,\n  OnInit\n} from '@angular/core';\n\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\n\nimport { transform } from 'ol/proj';\nimport { MediaService } from '@igo2/core';\nimport { unByKey } from 'ol/Observable';\n/**\n * This directive return the pointer coordinate (on click or pointermove)\n * in [longitude, latitude], delayed by in input (pointerMoveDelay)\n * to avoid too many emitted values.\n */\n@Directive({\n  selector: '[igoPointerPosition]'\n})\nexport class PointerPositionDirective implements OnInit, OnDestroy {\n\n  private lastTimeoutRequest;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  /**\n   * Listener to the map click event\n   */\n  private mapClickListener;\n\n  /**\n   * Delay before emitting an event\n   */\n  @Input() pointerPositionDelay: number = 1000;\n\n  /**\n   * Event emitted when the pointer move, delayed by pointerMoveDelay\n   */\n  @Output() pointerPositionCoord = new EventEmitter<[number, number]>();\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private mediaService: MediaService\n  ) { }\n\n  /**\n   * Start listening to pointermove\n   * @internal\n   */\n  ngOnInit(): void {\n    this.listenToMapPointerMove();\n    this.listenToMapClick();\n  }\n\n  /**\n   * Stop listening to pointermove\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unlistenToMapClick();\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: MapBrowserPointerEvent<any>) => this.onPointerEvent(event, this.pointerPositionDelay)\n    );\n  }\n\n  /**\n   * On map click\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => this.onPointerEvent(event, 0)\n    );\n  }\n\n  /**\n   * Stop listening for map pointermove\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Stop listening for map clicks\n   */\n  private unlistenToMapClick() {\n    this.mapClickListener = undefined;\n  }\n\n  /**\n   * emit delayed coordinate (longitude, latitude array) based on pointerMoveDelay or on click\n   * @param event OL map browser pointer event\n   */\n  private onPointerEvent(event: MapBrowserPointerEvent<any>, delay: number) {\n    if (event.dragging || this.mediaService.isTouchScreen()) {return; }\n    if (typeof this.lastTimeoutRequest !== 'undefined') { // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n    }\n\n    const lonlat = transform(event.coordinate, this.mapProjection, 'EPSG:4326') as [number, number];\n    this.lastTimeoutRequest = setTimeout(() => {\n      this.pointerPositionCoord.emit(lonlat);\n    }, delay);\n  }\n}\n","import olLayerImage from 'ol/layer/Image';\nimport olSourceImage from 'ol/source/Image';\n\nimport { AuthInterceptor } from '@igo2/auth';\n\nimport { ImageWatcher } from '../../utils';\nimport { IgoMap } from '../../../map';\n\nimport { WMSDataSource } from '../../../datasource/shared/datasources/wms-datasource';\n\nimport { Layer } from './layer';\nimport { ImageLayerOptions } from './image-layer.interface';\nimport { ImageArcGISRestDataSource } from '../../../datasource/shared/datasources/imagearcgisrest-datasource';\nimport { LanguageService, MessageService } from '@igo2/core';\n\nexport class ImageLayer extends Layer {\n  public dataSource: WMSDataSource | ImageArcGISRestDataSource;\n  public options: ImageLayerOptions;\n  public ol: olLayerImage<olSourceImage>;\n\n  private watcher: ImageWatcher;\n\n  constructor(\n    options: ImageLayerOptions,\n    public messageService: MessageService,\n    private languageService: LanguageService,\n    public authInterceptor?: AuthInterceptor\n  ) {\n    super(options, messageService, authInterceptor);\n    this.watcher = new ImageWatcher(this, this.messageService, this.languageService);\n    this.status$ = this.watcher.status$;\n    this.status$.subscribe(valStatus => {\n      if (valStatus === 0) {\n        this.olLoadingProblem = true;\n      }\n    });\n  }\n\n  protected createOlLayer(): olLayerImage<olSourceImage> {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceImage\n    });\n\n    const image = new olLayerImage(olOptions);\n    if (this.authInterceptor) {\n      (image.getSource() as any).setImageLoadFunction((tile, src) => {\n        this.customLoader(tile, src, this.authInterceptor, this.messageService, this.languageService);\n      });\n    }\n\n    return image;\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n\n  private customLoader(tile, src: string, interceptor: AuthInterceptor, messageService: MessageService, languageService: LanguageService) {\n    const xhr = new XMLHttpRequest();\n\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(src);\n    let url = src;\n    if (alteredUrlWithKeyAuth) {\n      url = alteredUrlWithKeyAuth;\n    }\n    xhr.open('GET', url);\n    const intercepted = interceptor.interceptXhr(xhr, url);\n    if (!intercepted) {\n      xhr.abort();\n      tile.getImage().src = url;\n      return;\n    }\n\n    xhr.responseType = 'arraybuffer';\n\n    xhr.onload = function() {\n      const arrayBufferView = new Uint8Array((this as any).response);\n      const responseString = new TextDecoder().decode(arrayBufferView);\n      if (responseString.includes('ServiceExceptionReport')) {\n        messageService.error(languageService.translate.instant(\n          'igo.geo.dataSource.optionsApiUnavailable'\n        ),\n        languageService.translate.instant(\n          'igo.geo.dataSource.unavailableTitle'\n        ));\n      }\n      const blob = new Blob([arrayBufferView], { type: 'image/png' });\n      const urlCreator = window.URL;\n      const imageUrl = urlCreator.createObjectURL(blob);\n      tile.getImage().src = imageUrl;\n    };\n    xhr.send();\n  }\n}\n","import olLayerTile from 'ol/layer/Tile';\nimport olSourceTile from 'ol/source/Tile';\nimport Tile from 'ol/Tile';\n\nimport { TileWatcher } from '../../utils';\nimport { IgoMap } from '../../../map';\n\nimport { OSMDataSource } from '../../../datasource/shared/datasources/osm-datasource';\nimport { WMTSDataSource } from '../../../datasource/shared/datasources/wmts-datasource';\nimport { XYZDataSource } from '../../../datasource/shared/datasources/xyz-datasource';\nimport { CartoDataSource } from '../../../datasource/shared/datasources/carto-datasource';\nimport { TileArcGISRestDataSource } from '../../../datasource/shared/datasources/tilearcgisrest-datasource';\nimport { TileDebugDataSource } from '../../../datasource/shared/datasources/tiledebug-datasource';\n\nimport { Layer } from './layer';\nimport { TileLayerOptions } from './tile-layer.interface';\n\nimport { MessageService } from '@igo2/core';\nimport { AuthInterceptor } from '@igo2/auth';\nexport class TileLayer extends Layer {\n  public dataSource:\n    | OSMDataSource\n    | WMTSDataSource\n    | XYZDataSource\n    | TileDebugDataSource\n    | CartoDataSource\n    | TileArcGISRestDataSource;\n  public options: TileLayerOptions;\n  public ol: olLayerTile<olSourceTile>;\n\n  private watcher: TileWatcher;\n\n  constructor(\n    options: TileLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor) {\n    super(options, messageService);\n\n    this.watcher = new TileWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerTile<olSourceTile> {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol\n    });\n    const tileLayer = new olLayerTile(olOptions);\n    const tileSource = tileLayer.getSource();\n    tileSource.setTileLoadFunction((tile: Tile, url: string) => {\n      this.customLoader(tile, url, this.authInterceptor);\n    });\n\n    return tileLayer;\n  }\n\n  /**\n   * Custom loader for tile layer.\n   * @internal\n   * @param tile the current tile\n   * @param url the url string or function to retrieve the data\n   */\n  customLoader(tile, url: string, interceptor: AuthInterceptor ) {\n\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n    let modifiedUrl = url;\n    if (alteredUrlWithKeyAuth) {\n      modifiedUrl = alteredUrlWithKeyAuth;\n    }\n    tile.getImage().src = modifiedUrl;\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n}\n","import olLayerVectorTile from 'ol/layer/VectorTile';\nimport olSourceVectorTile from 'ol/source/VectorTile';\n\nimport { MVTDataSource } from '../../../datasource/shared/datasources/mvt-datasource';\n\nimport { Layer } from './layer';\nimport { VectorTileLayerOptions } from './vectortile-layer.interface';\nimport { TileWatcher } from '../../utils';\nimport { AuthInterceptor } from '@igo2/auth';\nimport { IgoMap } from '../../../map';\nimport { MessageService } from '@igo2/core';\nimport VectorTile from 'ol/VectorTile';\n\nexport class VectorTileLayer extends Layer {\n  public dataSource: MVTDataSource;\n  public options: VectorTileLayerOptions;\n  public ol: olLayerVectorTile;\n\n  private watcher: TileWatcher;\n\n  constructor(\n    options: VectorTileLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor) {\n    super(options, messageService, authInterceptor);\n    this.watcher = new TileWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerVectorTile {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceVectorTile\n    });\n\n    const vectorTile = new olLayerVectorTile(olOptions);\n    const vectorTileSource = vectorTile.getSource() as olSourceVectorTile;\n\n    vectorTileSource.setTileLoadFunction((tile: VectorTile, url: string) => {\n      const loader = this.customLoader(url, tile.getFormat(), this.authInterceptor, tile.onLoad.bind(tile));\n      if (loader) {\n        tile.setLoader(loader);\n      }\n    }\n    );\n\n    return vectorTile;\n  }\n\n  /**\n   * Custom loader for vector tile layer. Modified from the loadFeaturesXhr function in ol\\featureloader.js\n   * @internal\n   * @param url the url string or function to retrieve the data\n   * @param format the format of the tile\n   * @param interceptor the interceptor of the data\n   * @param success On success event action to trigger\n   * @param failure On failure event action to trigger TODO\n   */\n  customLoader(url, format, interceptor, success, failure?) {\n    return ((extent, resolution, projection) => {\n      const xhr = new XMLHttpRequest();\n      let modifiedUrl = url;\n      if (typeof url !== 'function') {\n        const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n        if (alteredUrlWithKeyAuth) {\n          modifiedUrl = alteredUrlWithKeyAuth;\n        }\n      } else {\n        modifiedUrl = url(extent, resolution, projection);\n      }\n      xhr.open( 'GET', modifiedUrl);\n      if (interceptor) {\n        interceptor.interceptXhr(xhr, modifiedUrl);\n      }\n\n      if (format.getType() === 'arraybuffer') {\n        xhr.responseType = 'arraybuffer';\n      }\n      xhr.onload = (event) => {\n        if (!xhr.status || xhr.status >= 200 && xhr.status < 300) {\n          const type = format.getType();\n          let source;\n          if (type === 'json' || type === 'text') {\n            source = xhr.responseText;\n          }\n          else if (type === 'xml') {\n            source = xhr.responseXML;\n            if (!source) {\n              source = new DOMParser().parseFromString(xhr.responseText, 'application/xml');\n            }\n          }\n          else if (type === 'arraybuffer') {\n            source = xhr.response;\n          }\n          if (source) {\n            success.call(this, format.readFeatures(source, {\n              extent,\n              featureProjection: projection\n            }), format.readProjection(source));\n          }\n          else {\n            // TODO\n            failure.call(this);\n          }\n        } else {\n          // TODO\n          failure.call(this);\n        }\n      };\n      xhr.onerror = () => {\n        // TODO\n        failure.call(this);\n      };\n      xhr.send();\n    });\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n}\n","import {\n  Directive,\n  Input,\n  OnDestroy,\n  Self,\n  OnInit,\n  HostListener\n} from '@angular/core'\n  ;\nimport olLayerVectorTile from 'ol/layer/VectorTile';\nimport olLayerVector from 'ol/layer/Vector';\n\nimport { Subscription } from 'rxjs';\nimport olVectorTileSource from 'ol/source/VectorTile';\n\nimport type { default as OlMapBrowserEvent } from 'ol/MapBrowserEvent';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\n\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlFeature from 'ol/Feature';\nimport * as OlStyle from 'ol/style';\nimport * as OlGeom from 'ol/geom';\n\nimport { EntityStore } from '@igo2/common';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { VectorLayer, Layer, VectorTileLayer } from '../../layer/shared/layers';\nimport { take } from 'rxjs/operators';\nimport { tryBindStoreLayer } from '../../feature/shared/feature.utils';\nimport { FeatureStore } from '../../feature/shared/store';\nimport { FeatureMotion } from '../../feature/shared/feature.enums';\nimport { MediaService } from '@igo2/core';\nimport { StyleService } from '../../layer/shared/style.service';\nimport { unByKey } from 'ol/Observable';\nimport RenderFeature from 'ol/render/Feature';\nimport { StyleByAttribute } from '../../layer/shared/vector-style.interface';\n\n/**\n * This directive makes the mouse coordinate trigger a reverse search on available search sources.\n * The search results are placed into a label, on a cross icon, representing the mouse coordinate.\n * By default, no search sources. Config in config file must be defined.\n * the layer level.\n */\n@Directive({\n  selector: '[igoHoverFeature]'\n})\nexport class HoverFeatureDirective implements OnInit, OnDestroy {\n\n  public store: FeatureStore<Feature>;\n  private pointerHoverFeatureStore: EntityStore<OlFeature<OlGeometry>> = new EntityStore<OlFeature<OlGeometry>>([]);\n  private lastTimeoutRequest;\n  private store$$: Subscription;\n  private layers$$: Subscription;\n\n  private selectionLayer: olLayerVectorTile;\n  private selectionMVT = {};\n  private mvtStyleOptions: StyleByAttribute;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  private singleClickMapListener;\n\n  private hoverFeatureId: string = 'hoverFeatureId';\n  /**\n   * The delay where the mouse must be motionless before trigger the reverse search\n   */\n  @Input() igoHoverFeatureDelay: number = 1000;\n\n  /**\n   * If the user has enabled or not the directive\n   */\n  @Input() igoHoverFeatureEnabled: boolean = false;\n\n  @HostListener('mouseout')\n  mouseout() {\n    clearTimeout(this.lastTimeoutRequest);\n    this.clearLayer();\n  }\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private mediaService: MediaService,\n    private styleService: StyleService,\n  ) { }\n\n  /**\n   * Start listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnInit() {\n    this.listenToMapPointerMove();\n    this.subscribeToPointerStore();\n    this.listenToMapClick();\n\n    this.map.status$.pipe(take(1)).subscribe(() => {\n      this.store = new FeatureStore<Feature>([], { map: this.map });\n      this.initStore();\n    });\n\n    // To handle context change without using the contextService.\n    this.layers$$ = this.map.layers$.subscribe((layers: Layer[]) => {\n      if (this.store && !layers.find(l => l.id === 'hoverFeatureId')) {\n        this.initStore();\n      }\n    });\n\n  }\n\n  /**\n   * Initialize the pointer position store\n   * @internal\n   */\n  private initStore() {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      isIgoInternalLayer: true,\n      id: 'hoverFeatureId',\n      title: 'hoverFeature',\n      zIndex: 900,\n      source: new FeatureDataSource(),\n      showInLayerList: false,\n      exportable: false,\n      browsable: false,\n      style: hoverFeatureMarker\n    });\n    tryBindStoreLayer(store, layer);\n\n    this.selectionLayer = new olLayerVectorTile({\n      map: this.map.ol,\n      zIndex: 901,\n      renderMode: \"vector\",\n      declutter: true,\n      source: new olVectorTileSource({}),\n      style: (feature) => {\n        if (this.mvtStyleOptions && feature.getId() in this.selectionMVT) {\n          return this.createHoverStyle(feature, this.mvtStyleOptions);\n        }\n      }\n    });\n  }\n\n  createHoverStyle(feature: RenderFeature | OlFeature<OlGeometry>, hoverStyle: StyleByAttribute) {\n    const localHoverStyle = { ...hoverStyle };\n    let label = hoverStyle.label ? hoverStyle.label.attribute : undefined;\n    let hasLabelStyle = hoverStyle.label?.style ? true : false;\n\n    if (!feature.get('_isLabel')) {\n      localHoverStyle.label = undefined;\n      hasLabelStyle = false;\n      label = undefined;\n    } else {\n      // clear the style for label....\n      const size = localHoverStyle.data ? localHoverStyle.data.length : 0;\n      const radius = [];\n      const stroke = [];\n      const width = [];\n      const fill = [];\n      for (let i = 0; i < size; i++) {\n        radius.push(0);\n        stroke.push('rgba(255, 255, 255, 0)');\n        width.push(0);\n        fill.push('rgba(255, 255, 255, 0)');\n      }\n      localHoverStyle.radius = radius;\n      localHoverStyle.stroke = stroke;\n      localHoverStyle.width = width;\n      localHoverStyle.fill = fill;\n    }\n    if (!hasLabelStyle && label) {\n      localHoverStyle.label.style =\n      {\n        textAlign: 'left',\n        textBaseline: 'top',\n        font: '12px Calibri,sans-serif',\n        fill: { color: '#000' },\n        backgroundFill: { color: 'rgba(255, 255, 255, 0.5)' },\n        backgroundStroke: { color: 'rgba(200, 200, 200, 0.75)', width: 2 },\n        stroke: { color: '#fff', width: 3 },\n        overflow: true,\n        offsetX: 10,\n        offsetY: 20,\n        padding: [2.5, 2.5, 2.5, 2.5]\n      };\n    }\n    return this.styleService.createStyleByAttribute(feature, localHoverStyle);\n  }\n\n  /**\n   * Stop listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unsubscribeToPointerStore();\n    this.unlistenToMapSingleClick();\n    this.layers$$.unsubscribe();\n  }\n\n  /**\n   * Subscribe to pointermove result store\n   * @internal\n   */\n  subscribeToPointerStore() {\n    this.store$$ = this.pointerHoverFeatureStore.entities$.subscribe(resultsUnderPointerPosition => {\n      this.entitiesToPointerOverlay(resultsUnderPointerPosition);\n    });\n  }\n\n  /**\n   * convert store entities to a pointer position overlay with label summary on.\n   * @param event OL map browser pointer event\n   */\n  private entitiesToPointerOverlay(resultsUnderPointerPosition: OlFeature<OlGeometry>[]) {\n\n    this.addFeatureOverlay(resultsUnderPointerPosition);\n\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: OlMapBrowserEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * On map singleclick\n   */\n  private listenToMapClick() {\n    this.singleClickMapListener = this.map.ol.on(\n      'singleclick',\n      (event: OlMapBrowserEvent<any>) => this.onMapSingleClickEvent(event)\n    );\n  }\n\n  /**\n   * Unsubscribe to pointer store.\n   * @internal\n   */\n  unsubscribeToPointerStore() {\n    this.store$$.unsubscribe();\n  }\n\n  /**\n   * Stop listening for map pointermove\n   * @internal\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Stop listening for map singleclick\n   * @internal\n   */\n  private unlistenToMapSingleClick() {\n    unByKey(this.singleClickMapListener);\n    this.singleClickMapListener = undefined;\n  }\n\n  /**\n   * Trigger clear layer on singleclick.\n   * @param event OL map browser singleclick event\n   */\n  private onMapSingleClickEvent(event: OlMapBrowserEvent<any>) {\n    this.clearLayer();\n  }\n\n  /**\n   * Trigger hover when the mouse is motionless during the defined delay (pointerMoveDelay).\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: OlMapBrowserEvent<any>) {\n    if (\n      event.dragging || !this.igoHoverFeatureEnabled ||\n      this.mediaService.isTouchScreen()) {\n      this.clearLayer();\n      return;\n    }\n    if (typeof this.lastTimeoutRequest !== 'undefined') { // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n    }\n    this.clearLayer();\n    let maximumZindex = -Infinity;\n    let topMostOlLayer;\n    const pixel = this.map.ol.getPixelFromCoordinate(event.coordinate);\n    this.lastTimeoutRequest = setTimeout(() => {\n\n      // retrieve the topmost layer with feature to only apply the hover on this layer.\n      this.map.ol.forEachFeatureAtPixel(pixel, (mapFeature: RenderFeature | OlFeature<OlGeometry>, layerOL: any) => {\n        if (!layerOL) {\n          return;\n        }\n        const igoLayer = this.map.getLayerByOlUId((layerOL as any).ol_uid);\n        if (!this.canProcessHover(igoLayer as any)) {\n          return;\n        }\n        if (igoLayer.zIndex <= maximumZindex) {\n          return;\n        }\n        maximumZindex = igoLayer.zIndex;\n        topMostOlLayer = layerOL;\n\n      }, {\n        hitTolerance: 10, layerFilter: olLayer => olLayer instanceof olLayerVector || olLayer instanceof olLayerVectorTile\n      });\n      if (!topMostOlLayer) {\n        return;\n      }\n\n      this.clearLayer();\n      this.map.ol.forEachFeatureAtPixel(pixel, (mapFeature: RenderFeature | OlFeature<OlGeometry>, layerOL: any) => {\n        if (mapFeature.get('hoverSummary') === undefined) {\n          let igoLayer;\n          if (layerOL instanceof olLayerVector) {\n            igoLayer = this.map.getLayerByOlUId((layerOL as any).ol_uid) as VectorLayer;\n            if (!this.canProcessHover(igoLayer)) {\n              return;\n            }\n            let localOlFeature = this.handleRenderFeature(mapFeature);\n            this.setLayerStyleFromOptions(igoLayer, localOlFeature);\n            const featuresToLoad = [localOlFeature];\n            localOlFeature.set(\"_isLabel\", false);\n            const myLabelOlFeature = new OlFeature();\n            myLabelOlFeature.setProperties(localOlFeature.getProperties());\n            const labelGeom =\n              localOlFeature.getGeometry().getType() === 'Point' ? localOlFeature.getGeometry() : new OlGeom.Point(event.coordinate);\n            myLabelOlFeature.setGeometry(labelGeom);\n            myLabelOlFeature.setId(localOlFeature.getId());\n            myLabelOlFeature.set(\"_isLabel\", true);\n            this.setLayerStyleFromOptions(igoLayer, myLabelOlFeature);\n            featuresToLoad.push(myLabelOlFeature);\n            this.pointerHoverFeatureStore.load(featuresToLoad);\n            return true;\n          }\n          if (layerOL instanceof olLayerVectorTile) {\n            igoLayer = this.map.getLayerByOlUId((layerOL as any).ol_uid) as VectorTileLayer;\n            if (!this.canProcessHover(igoLayer)) {\n              return;\n            }\n            if (igoLayer?.options?.styleByAttribute?.hoverStyle) {\n              this.mvtStyleOptions = igoLayer.options.styleByAttribute.hoverStyle;\n            } else if (igoLayer?.options?.hoverStyle) {\n              this.mvtStyleOptions = igoLayer.options.hoverStyle;\n            }\n            this.selectionLayer.setSource(layerOL.getSource());\n            layerOL.getFeatures(event.pixel).then((mvtFeatures: (RenderFeature | OlFeature<OlGeometry>)[]) => {\n              if (!mvtFeatures.length) {\n                this.selectionMVT = {};\n                this.selectionLayer.changed();\n                this.clearLayer();\n                return;\n              }\n              const feature = mvtFeatures[0];\n              if (!feature) {\n                this.clearLayer();\n                return;\n              }\n              let localOlFeature = this.handleRenderFeature(feature);\n              localOlFeature.set(\"_isLabel\", false);\n              const myLabelOlFeature = new OlFeature();\n              myLabelOlFeature.setProperties(localOlFeature.getProperties());\n              const labelGeom =\n              localOlFeature.getGeometry().getType() === 'Point' ? localOlFeature.getGeometry() : new OlGeom.Point(event.coordinate);\n              myLabelOlFeature.setGeometry(labelGeom);\n              myLabelOlFeature.setId(localOlFeature.getId());\n              myLabelOlFeature.set(\"_isLabel\", true);\n              this.setLayerStyleFromOptions(igoLayer, myLabelOlFeature);\n              this.pointerHoverFeatureStore.load([myLabelOlFeature]);\n              this.selectionMVT[feature.getId()] = localOlFeature;\n              this.selectionLayer.changed();\n            });\n          }\n        }\n        return true;\n      }, {\n        hitTolerance: 10, layerFilter: olLayer => olLayer === topMostOlLayer\n      });\n    }, this.igoHoverFeatureDelay);\n  }\n\n  canProcessHover(igoLayer: VectorLayer | VectorTileLayer): boolean {\n    if (!igoLayer) {\n      return false;\n    }\n    if (!igoLayer.visible) {\n      return false;\n    }\n    if (!igoLayer.options) {\n      return false;\n    }\n\n    if (!igoLayer.options.styleByAttribute && !igoLayer.options.hoverStyle) {\n      return false;\n    }\n\n    if (\n      (igoLayer.options.styleByAttribute && !igoLayer.options.styleByAttribute.hoverStyle) &&\n      !igoLayer.options.hoverStyle) {\n      return false;\n    }\n    return true;\n  }\n\n  handleRenderFeature(feature: RenderFeature | OlFeature<OlGeometry>): OlFeature<OlGeometry> {\n    let localFeature: OlFeature<OlGeometry>;\n    if (feature instanceof RenderFeature) {\n      localFeature = new OlFeature({\n        geometry: this.getGeometry(feature)\n      });\n      localFeature.setId(feature.getId());\n    } else if (feature instanceof OlFeature) {\n      localFeature = feature;\n    }\n    return localFeature;\n  }\n\n  /**\n   * Add a feature to the pointer store\n   * @param text string\n   */\n  private addFeatureOverlay(hoverEntity: OlFeature<OlGeometry>[]) {\n\n    if (hoverEntity.length > 0) {\n\n      const result = hoverEntity[0];\n      this.clearLayer();\n      const feature = new OlFeature({\n        geometry: result.getGeometry(),\n        meta: { id: this.hoverFeatureId },\n        hoverSummary: this.getHoverSummary(result.getProperties())\n      });\n\n      this.store.setLayerOlFeatures([feature], FeatureMotion.None);\n    }\n  }\n\n  private setLayerStyleFromOptions(igoLayer: VectorLayer | VectorTileLayer, feature: OlFeature<OlGeometry>) {\n    if (igoLayer?.options?.styleByAttribute?.hoverStyle) {\n      this.store.layer.ol.setStyle(this.createHoverStyle(feature, igoLayer.options.styleByAttribute.hoverStyle));\n      return;\n    }\n    if (igoLayer?.options?.hoverStyle) {\n      this.store.layer.ol.setStyle(this.createHoverStyle(feature, igoLayer.options.hoverStyle));\n    }\n  }\n\n  private getHoverSummary(properties): string {\n    let summary = '';\n    for (const [key, value] of Object.entries(properties)) {\n      if (!key.startsWith('_') && key !== 'geometry') {\n        summary += `${key}: ${value}` + '\\n';\n      }\n    }\n    return summary.length >= 2 ? summary.slice(0, -2) : summary;\n  }\n\n  private getGeometry(feature): OlGeom.Geometry {\n    let geom;\n    if (!feature.getOrientedFlatCoordinates) {\n      geom = feature.getGeometry();\n    } else {\n\n      const coords = feature.getOrientedFlatCoordinates();\n      const flatCoords = [];\n\n      coords.forEach((c, idx) => {\n        if (idx % 2 === 0) {\n          flatCoords.push([parseFloat(coords[idx]), parseFloat(coords[idx + 1])]);\n        }\n      });\n\n      // TODO: test MultiX\n      switch (feature.getType()) {\n        case 'Point':\n          geom = new OlGeom.Point(flatCoords);\n          break;\n        case 'Polygon':\n          geom = new OlGeom.Polygon([flatCoords]);\n          break;\n        case 'LineString':\n          geom = new OlGeom.LineString([flatCoords]);\n          break;\n      }\n    }\n\n    return geom;\n  }\n\n\n  /**\n   * Clear the pointer store features\n   */\n  private clearLayer() {\n    this.selectionMVT = {};\n    if (this.selectionLayer) {\n      this.selectionLayer.changed();\n    }\n    if (this.store) {\n      this.store.clearLayer();\n    }\n  }\n}\n\n/**\n * Create a default style for the pointer position and it's label summary.\n * @param feature OlFeature\n * @returns OL style function\n */\nexport function hoverFeatureMarker(feature: OlFeature<OlGeom.Geometry>, resolution: number): OlStyle.Style[] {\n\n  const olStyleText = new OlStyle.Style({\n    text: new OlStyle.Text({\n      text: feature.get('hoverSummary'),\n      textAlign: 'left',\n      textBaseline: 'top',\n      font: '12px Calibri,sans-serif',\n      fill: new OlStyle.Fill({ color: '#000' }),\n      backgroundFill: new OlStyle.Fill({ color: 'rgba(255, 255, 255, 0.5)' }),\n      backgroundStroke: new OlStyle.Stroke({ color: 'rgba(200, 200, 200, 0.75)', width: 2 }),\n      stroke: new OlStyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true,\n      offsetX: 10,\n      offsetY: 20,\n      padding: [2.5, 2.5, 2.5, 2.5]\n    })\n  });\n\n  const olStyle = [olStyleText];\n  switch (feature.getGeometry().getType()) {\n    case 'Point':\n      olStyle.push(new OlStyle.Style({\n        image: new OlStyle.Circle({\n          radius: 10,\n          stroke: new OlStyle.Stroke({\n            color: 'blue',\n            width: 3\n          })\n        })\n      }));\n      break;\n    default:\n      olStyle.push(new OlStyle.Style({\n        stroke: new OlStyle.Stroke({\n          color: 'white',\n          width: 5\n        })\n      }));\n      olStyle.push(new OlStyle.Style({\n        stroke: new OlStyle.Stroke({\n          color: 'blue',\n          width: 3\n        })\n      }));\n  }\n\n  return olStyle;\n\n}\n","import { ProjectionsLimitationsOptions } from './projection.interfaces';\n\n/**\n * Return a number of zone MTM for a longitude for province of Quebec only\n * @param lon number\n * @returns zone\n */\nexport function zoneMtm(lon: number): number {\n    let lonMin = -54;\n    const lonMax = -81;\n    if (lon < lonMax || lon > lonMin) {\n      return 0;\n    }\n    else {\n      const deltaLon = 3;\n      let zone = 2;\n      while (Math.abs(lon - lonMin) > deltaLon) {\n        lonMin = lonMin - deltaLon;\n        zone++;\n      }\n      return zone;\n    }\n  }\n/**\n * Return a number of zone UTM for a longitude\n * @param lon number\n * @returns zone\n */\nexport function zoneUtm(lon: number): number {\n  let lonMin = -180;\n  const lonMax = 180;\n  const deltaLon = 6;\n  let zone = 1;\n  while (Math.abs(lon - lonMin) > deltaLon) {\n    lonMin = lonMin + deltaLon;\n    zone++;\n  }\n  return zone;\n}\n\n/**\n * Compute the contraints of projections\n * @param projectionsLimitations: ProjectionsLimitationsOptions\n * @returns projectionsContraints: ProjectionsLimitationsOptions\n */\nexport function computeProjectionsConstraints(\n    projectionsLimitations: ProjectionsLimitationsOptions):\n    ProjectionsLimitationsOptions {\n    const mtmZone = projectionsLimitations.mtmZone;\n    const utmZone = projectionsLimitations.utmZone;\n    const projectionsConstraints = {\n        projFromConfig: projectionsLimitations.projFromConfig === false ? false : true,\n        nad83: projectionsLimitations.nad83 === false ? false : true,\n        wgs84: projectionsLimitations.wgs84 === false ? false : true,\n        webMercator: projectionsLimitations.webMercator === false ? false : true,\n        utm: projectionsLimitations.utm === false ? false : true,\n        mtm: projectionsLimitations.mtm === false ? false : true,\n        utmZone: {\n        minZone: utmZone && utmZone.minZone ? utmZone.minZone : 17,\n        maxZone: utmZone && utmZone.maxZone ? utmZone.maxZone : 21,\n        },\n        mtmZone: {\n        minZone: mtmZone && mtmZone.minZone ? mtmZone.minZone : 2,\n        maxZone: mtmZone && mtmZone.maxZone ? mtmZone.maxZone : 10,\n        }\n    };\n    return projectionsConstraints;\n  }\n","import { Component, Input } from '@angular/core';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-zoom-button',\n  templateUrl: './zoom-button.component.html',\n  styleUrls: ['./zoom-button.component.scss']\n})\nexport class ZoomButtonComponent {\n\n  @Input() map: IgoMap;\n\n  @Input() color: string;\n\n  get zoom(): number { return this.map.viewController.getZoom(); }\n\n  get minZoom(): number { return this.map.viewController.olView.getMinZoom() || 1; }\n\n  get maxZoom(): number { return this.map.viewController.olView.getMaxZoom(); }\n\n  constructor() {}\n}\n","<div class=\"igo-zoom-button-container\">\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.zoomIn' | translate: {zoom: zoom + 1}\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    [disabled]=\"zoom >= maxZoom\"\n    (click)=\"map.viewController.zoomIn()\">\n    <mat-icon svgIcon=\"plus\"></mat-icon>\n  </button>\n\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.zoomOut' | translate: {zoom: zoom - 1}\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    [disabled]=\"zoom <= minZoom\"\n    (click)=\"map.viewController.zoomOut()\">\n    <mat-icon svgIcon=\"minus\"></mat-icon>\n  </button>\n</div>\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\n\n@Component({\n  selector: 'igo-menu-button',\n  templateUrl: './menu-button.component.html',\n  styleUrls: ['./menu-button.component.scss']\n})\nexport class MenuButtonComponent {\n\n  @Input()\n  get sidenavOpened(): boolean {\n    return this._sidenavOpenend;\n  }\n  set sidenavOpened(value: boolean) {\n    this._sidenavOpenend = value;\n    this.getClassMenuButton();\n  }\n  private _sidenavOpenend: boolean;\n\n  @Output() openSidenav = new EventEmitter<any>();\n\n  public menuButtonReverseColor = false;\n\n  public menuButtonClass;\n\n  constructor(public configService: ConfigService) {\n    if (\n      typeof this.configService.getConfig('menuButtonReverseColor') !==\n      'undefined'\n    ) {\n      this.menuButtonReverseColor = this.configService.getConfig(\n        'menuButtonReverseColor'\n      );\n    }\n  }\n\n  getClassMenuButton() {\n    if (this.sidenavOpened) {\n      this.menuButtonClass = {\n        'menu-button': this.menuButtonReverseColor === false,\n        'menu-button-reverse-color': this.menuButtonReverseColor === true\n      };\n    } else {\n      this.menuButtonClass = {\n        'menu-button': this.menuButtonReverseColor === false,\n        'menu-button-reverse-color-close': this.menuButtonReverseColor === true\n      };\n    }\n  }\n\n  onToggleSidenavClick() {\n    this.openSidenav.emit();\n  }\n}\n","<button\n    mat-icon-button\n    id= \"menu-button\"\n    [ngClass]=\"menuButtonClass\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"(sidenavOpened ? 'menu.close' : 'menu.open') | translate\"\n    (click)=\"onToggleSidenavClick()\">\n    <mat-icon svgIcon=\"menu\"></mat-icon>\n</button>\n","import { Component, Input } from '@angular/core';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-geolocate-button',\n  templateUrl: './geolocate-button.component.html',\n  styleUrls: ['./geolocate-button.component.scss']\n})\nexport class GeolocateButtonComponent {\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get color(): string {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color: string;\n\n  constructor() {}\n}\n","<div class=\"igo-geolocate-button-container\">\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.geolocate' | translate\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    (click)=\"map.geolocate()\">\n    <mat-icon svgIcon=\"crosshairs-gps\"></mat-icon>\n  </button>\n</div>\n","import { ConfigService } from '@igo2/core';\r\nimport { Component, Input } from '@angular/core';\r\nimport { IgoMap } from '../shared/map';\r\nimport { MapExtent } from '../shared/map.interface';\r\nimport * as olproj from 'ol/proj';\r\n/*\r\nButton to center the map to the home extent\r\n*/\r\n@Component({\r\n  selector: 'igo-home-extent-button',\r\n  templateUrl:'./home-extent-button.component.html',\r\n  styleUrls: ['./home-extent-button.component.scss'],\r\n})\r\nexport class HomeExtentButtonComponent {\r\n  @Input() map: IgoMap;\r\n  @Input() color: string;\r\n  @Input() extentOverride?: MapExtent\r\n  @Input() centerOverride?: [number, number];\r\n  @Input() zoomOverride?: number;\r\n\r\n  private homeExtentButtonExtent;\r\n  private homeExtentButtonCenter;\r\n  private homeExtentButtonZoom;\r\n\r\n constructor(public configService: ConfigService) {\r\n      this.computeHomeExtent();\r\n  }\r\n\r\n  computeHomeExtent() {\r\n    this.homeExtentButtonExtent = this.extentOverride || this.configService.getConfig('homeExtentButton.homeExtButtonExtent');\r\n    this.homeExtentButtonCenter = this.centerOverride || this.configService.getConfig('homeExtentButton.homeExtButtonCenter');\r\n    this.homeExtentButtonZoom = this.zoomOverride || this.configService.getConfig('homeExtentButton.homeExtButtonZoom');\r\n\r\n    // priority over extent if these 2 properties are defined;\r\n    if (this.centerOverride && this.zoomOverride) {\r\n      this.homeExtentButtonExtent = undefined;\r\n    }\r\n  }\r\n\r\n  onToggleClick() {\r\n    this.computeHomeExtent();\r\n    if (this.homeExtentButtonExtent) {\r\n      this.map.viewController.zoomToExtent(this.homeExtentButtonExtent);\r\n    } else if (this.homeExtentButtonCenter && this.homeExtentButtonZoom) {\r\n      const center = olproj.fromLonLat(this.homeExtentButtonCenter, this.map.viewController.olView.getProjection().getCode());\r\n      this.map.viewController.olView.setCenter(center);\r\n      this.map.viewController.zoomTo(this.homeExtentButtonZoom);\r\n    }\r\n  }\r\n}\r\n","<div class=\"igo-home-extent-button-container\"><button\r\n    mat-icon-button\r\n    [matTooltip]=\"'igo.geo.mapButtons.home-extent' | translate\"\r\n            matTooltipPosition=\"left\"\r\n    [color]=\"color\"\r\n    (click)=\"onToggleClick()\"><mat-icon svgIcon = \"home-map-marker\"></mat-icon></button></div>\r\n","<div *ngIf=\"visible\" class=\"igo-user-button-container\">\n  <div>\n    <button\n      mat-icon-button\n      [matTooltip]=\"checked ? ('igo.geo.mapButtons.online' | translate): ('igo.geo.mapButtons.offline' | translate)\"\n      matTooltipPosition=\"left\"\n      [ngClass]=\"[btnStyle]\"\n      [color]=\"checked ? color : [colorOff]\"\n      (click)=\"onToggle()\"\n      (click)=\"map.onOfflineToggle(check)\">\n      <mat-icon svgIcon=\"wifi-strength-off\"></mat-icon>\n    </button>\n  </div>\n</div>","import { Component, Input, EventEmitter, Output } from '@angular/core';\nimport { IgoMap } from '../shared/map';\nimport { ConfigService } from '@igo2/core';\n\n@Component({\n  selector: 'igo-offline-button',\n  templateUrl: './offline-button.component.html',\n  styleUrls: ['./offline-button.component.scss']\n})\n\nexport class OfflineButtonComponent {\n\n  btnStyle: string = 'baseStyle';\n  colorOff: string = 'rgb(255,255,255)';\n\n  @Output() change = new EventEmitter<boolean>();\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get color(): string {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color: string;\n\n  @Input() public check: boolean = false;\n\n  get checked(): boolean {\n    return this.check;\n  }\n\n  public visible = false;\n\n  constructor(\n    private config: ConfigService\n    ) {\n    this.visible = this.config.getConfig('offlineButton') ? true : false;\n  }\n\n  onToggle() {\n    this.check = !this.check;\n    if (this.check) {\n      this.btnStyle = 'toggleStyle';\n    } else {\n      this.btnStyle = 'baseStyle';\n    }\n  }\n}\n","import {\n  trigger,\n  state,\n  style,\n  transition,\n  animate,\n  AnimationTriggerMetadata\n} from '@angular/animations';\n\nexport function baseLayersSwitcherSlideInOut(): AnimationTriggerMetadata {\n  return trigger('baseLayerSwitcherState', [\n    state(\n      'collapseIcon',\n      style({\n        height: '40px',\n        width: '40px',\n        overflow: 'hidden'\n      })\n    ),\n    state(\n      'collapseMap',\n      style({\n        height: '85px',\n        overflow: 'hidden'\n      })\n    ),\n    state(\n      'expand',\n      style({\n        overflow: 'hidden'\n      })\n    ),\n    transition('collapse => expand', animate('200ms')),\n    transition('expand => collapse', animate('200ms'))\n  ]);\n}\n","<div *ngIf=\"baseLayers.length > 0\"\n     class=\"igo-baselayers-switcher-container\"\n     [ngClass]=\"{'container-expand': expand}\"\n     [@baseLayerSwitcherState]=\"expand ? 'expand' : useStaticIcon ? 'collapseIcon' : 'collapseMap'\"\n     (@baseLayerSwitcherState.start)=\"showButton=false\"\n     (@baseLayerSwitcherState.done)=\"showButton=true\"\n     (click)=\"collapseOrExpand()\">\n\n     <div *ngIf=\"useStaticIcon && !expand && showButton\" class=\"igo-baselayers-switcher-button-container\">\n       <button\n         mat-icon-button\n         [matTooltip]=\"'igo.geo.mapButtons.baselayerSwitcher' | translate\"\n         matTooltipPosition=\"right\"\n         color=\"primary\">\n         <mat-icon svgIcon=\"image-multiple\"></mat-icon>\n       </button>\n     </div>\n\n     <igo-mini-basemap class=\"mat-typography\" *ngFor=\"let baseLayer of baseLayers; let i = index\"\n       [map]=\"map\"\n       [baseLayer]=\"baseLayer\"\n       [title]=\"(baseLayers.length > 2 && !expand) ? ('igo.geo.baselayersSwitcher.title' | translate) : baseLayer.title\"\n       [display]=\"expand || (i === 0 && !useStaticIcon)\"\n       [disabled]=\"!expand && baseLayers.length > 1\">\n     </igo-mini-basemap>\n\n    <div class=\"more-baselayers\">\n      <mat-icon class=\"material-icons mat-icon mat-list-avatar\" color=\"primary\" svgIcon=\"menu-down\"></mat-icon>\n    </div>\n\n</div>\n","import { Component, Input, AfterViewInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport { MediaService, Media } from '@igo2/core';\nimport { Layer } from '../../layer';\nimport { IgoMap } from '../shared';\nimport { baseLayersSwitcherSlideInOut } from './baselayers-switcher.animation';\n\n@Component({\n  selector: 'igo-baselayers-switcher',\n  templateUrl: './baselayers-switcher.component.html',\n  styleUrls: ['./baselayers-switcher.component.scss'],\n  animations: [baseLayersSwitcherSlideInOut()]\n})\nexport class BaseLayersSwitcherComponent implements AfterViewInit, OnDestroy {\n  @Input() map: IgoMap;\n  @Input() useStaticIcon: boolean;\n\n  public _baseLayers: Layer[] = [];\n  public expand = false;\n  public showButton = true;\n\n  private layers$$: Subscription;\n\n  constructor(private mediaService: MediaService) {\n    const media = this.mediaService.media$.value;\n    if (media === Media.Mobile && this.useStaticIcon === undefined) {\n      this.useStaticIcon = true;\n    }\n  }\n\n  ngAfterViewInit() {\n    this.layers$$ = this.map.layers$.subscribe(arrayLayers => {\n      this._baseLayers = arrayLayers.filter(l => l.baseLayer);\n    });\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n  }\n\n  collapseOrExpand() {\n    if (this.baseLayers.length > 1 || this.useStaticIcon) {\n      this.expand = !this.expand;\n    } else {\n      this.expand = false;\n    }\n  }\n\n  get baseLayers(): Layer[] {\n    const mapResolution = this.map.viewController.getResolution();\n    const mapZoom = this.map.viewController.getZoom();\n\n    const bl = this._baseLayers.filter(l => {\n      return (\n        (!l.options.maxResolution ||\n          mapResolution <= l.options.maxResolution) &&\n        (!l.options.minResolution || mapResolution >= l.options.minResolution) &&\n        (!l.options.source.options.maxZoom || mapZoom <= l.options.source.options.maxZoom) &&\n        (!l.options.source.options.minZoom || mapZoom >= l.options.source.options.minZoom)\n      );\n    });\n\n    const blHidden = bl.filter(l => !l.visible);\n    return blHidden.length + 1 === bl.length ? blHidden : bl;\n  }\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable, of } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\nimport stylefunction from 'ol-mapbox-style/dist/stylefunction';\nimport { AuthInterceptor } from '@igo2/auth';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { Style } from 'ol/style';\n\nimport {\n  OSMDataSource,\n  FeatureDataSource,\n  XYZDataSource,\n  TileDebugDataSource,\n  WFSDataSource,\n  WMTSDataSource,\n  WMSDataSource,\n  CartoDataSource,\n  ImageArcGISRestDataSource,\n  ArcGISRestDataSource,\n  TileArcGISRestDataSource,\n  WebSocketDataSource,\n  MVTDataSource,\n  ClusterDataSource\n} from '../../datasource';\n\nimport { DataSourceService } from '../../datasource/shared/datasource.service';\n\nimport {\n  Layer,\n  ImageLayer,\n  ImageLayerOptions,\n  TileLayer,\n  TileLayerOptions,\n  VectorLayer,\n  VectorLayerOptions,\n  AnyLayerOptions,\n  VectorTileLayer,\n  VectorTileLayerOptions\n} from './layers';\n\nimport { computeMVTOptionsOnHover } from '../utils/layer.utils';\nimport { StyleService } from './style.service';\nimport { LanguageService, MessageService } from '@igo2/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LayerService {\n  constructor(\n    private http: HttpClient,\n    private styleService: StyleService,\n    private dataSourceService: DataSourceService,\n    private messageService: MessageService,\n    private languageService: LanguageService,\n    @Optional() private authInterceptor: AuthInterceptor\n  ) {}\n\n  createLayer(layerOptions: AnyLayerOptions): Layer {\n    if (!layerOptions.source) {\n      return;\n    }\n\n    if (\n      layerOptions.source.options &&\n      layerOptions.source.options._layerOptionsFromSource\n    ) {\n      layerOptions = ObjectUtils.mergeDeep(\n        layerOptions.source.options._layerOptionsFromSource,\n        layerOptions || {}\n      );\n    }\n\n    let layer;\n    switch (layerOptions.source.constructor) {\n      case OSMDataSource:\n      case WMTSDataSource:\n      case XYZDataSource:\n      case TileDebugDataSource:\n      case CartoDataSource:\n      case TileArcGISRestDataSource:\n        layer = this.createTileLayer(layerOptions as TileLayerOptions);\n        break;\n      case FeatureDataSource:\n      case WFSDataSource:\n      case ArcGISRestDataSource:\n      case WebSocketDataSource:\n      case ClusterDataSource:\n        layer = this.createVectorLayer(layerOptions as VectorLayerOptions);\n        break;\n      case ImageArcGISRestDataSource:\n      case WMSDataSource:\n        layer = this.createImageLayer(layerOptions as ImageLayerOptions);\n        break;\n      case MVTDataSource:\n        const _layerOptions = computeMVTOptionsOnHover(layerOptions);\n        layer = this.createVectorTileLayer(\n          _layerOptions as VectorTileLayerOptions\n        );\n        break;\n      default:\n        break;\n    }\n\n    return layer;\n  }\n\n  createAsyncLayer(_layerOptions: AnyLayerOptions, detailedContextUri?: string): Observable<Layer> {\n    const layerOptions = computeMVTOptionsOnHover(_layerOptions);\n    if (layerOptions.source) {\n      return new Observable(d => d.next(this.createLayer(layerOptions)));\n    }\n\n    return this.dataSourceService\n      .createAsyncDataSource(layerOptions.sourceOptions, detailedContextUri)\n      .pipe(\n        map(source => {\n          if (source === undefined) {\n            return undefined;\n          }\n          return this.createLayer(Object.assign(layerOptions, { source }));\n        })\n      );\n  }\n\n  private createImageLayer(layerOptions: ImageLayerOptions): ImageLayer {\n    return new ImageLayer(layerOptions, this.messageService, this.languageService, this.authInterceptor);\n  }\n\n  private createTileLayer(layerOptions: TileLayerOptions): TileLayer {\n    return new TileLayer(layerOptions, this.messageService, this.authInterceptor);\n  }\n\n  private createVectorLayer(layerOptions: VectorLayerOptions): VectorLayer {\n    let style: Style;\n    let igoLayer: VectorLayer;\n    if (layerOptions.style !== undefined) {\n      style = this.styleService.createStyle(layerOptions.style);\n    }\n\n    if (layerOptions.source instanceof ArcGISRestDataSource) {\n      const source = layerOptions.source as ArcGISRestDataSource;\n      style = source.options.params.style;\n    } else if (layerOptions.styleByAttribute) {\n      const serviceStyle = this.styleService;\n      layerOptions.style = feature => {\n        return serviceStyle.createStyleByAttribute(\n          feature,\n          layerOptions.styleByAttribute\n        );\n      };\n      igoLayer = new VectorLayer(layerOptions, this.messageService, this.authInterceptor);\n    }\n\n    if (layerOptions.source instanceof ClusterDataSource) {\n      const serviceStyle = this.styleService;\n      const baseStyle = layerOptions.clusterBaseStyle;\n      layerOptions.style = feature => {\n        return serviceStyle.createClusterStyle(\n          feature,\n          layerOptions.clusterParam,\n          baseStyle\n        );\n      };\n      igoLayer = new VectorLayer(layerOptions, this.messageService, this.authInterceptor);\n    }\n\n    const layerOptionsOl = Object.assign({}, layerOptions, {\n      style\n    });\n\n    if (!igoLayer) {\n      igoLayer = new VectorLayer(layerOptionsOl, this.messageService, this.authInterceptor);\n    }\n\n    this.applyMapboxStyle(igoLayer, layerOptionsOl as any);\n\n    return igoLayer;\n  }\n\n  private createVectorTileLayer(\n    layerOptions: VectorTileLayerOptions\n  ): VectorTileLayer {\n    let style: Style;\n    let igoLayer: VectorTileLayer;\n\n    if (layerOptions.style !== undefined) {\n      style = this.styleService.createStyle(layerOptions.style);\n    }\n\n    if (layerOptions.styleByAttribute) {\n      const serviceStyle = this.styleService;\n      layerOptions.style = feature => {\n        return serviceStyle.createStyleByAttribute(\n          feature,\n          layerOptions.styleByAttribute\n        );\n      };\n      igoLayer = new VectorTileLayer(layerOptions, this.messageService, this.authInterceptor);\n    }\n\n    const layerOptionsOl = Object.assign({}, layerOptions, {\n      style\n    });\n\n    if (!igoLayer) {\n      igoLayer = new VectorTileLayer(layerOptionsOl, this.messageService, this.authInterceptor);\n    }\n\n    this.applyMapboxStyle(igoLayer, layerOptionsOl);\n    return igoLayer;\n  }\n\n  private applyMapboxStyle(layer: Layer, layerOptions: VectorTileLayerOptions) {\n    if (layerOptions.mapboxStyle) {\n      this.getMapboxGlStyle(layerOptions.mapboxStyle.url).subscribe(res => {\n        stylefunction(layer.ol, res, layerOptions.mapboxStyle.source);\n      });\n    }\n  }\n\n  public getMapboxGlStyle(url: string) {\n    return this.http.get(url).pipe(\n      map((res: any) => res),\n      catchError(err => {\n        console.log('No style was found');\n        return of(err);\n      })\n    );\n  }\n}\n","<div class=\"igo-mini-basemap-container\">\n\n  <div *ngIf=\"display\" (click)=\"changeBaseLayer(baseLayer)\">\n    <igo-map-browser [map]=\"basemap\"></igo-map-browser>\n    <div *ngIf='title' class='igo-mini-basemap-title'> {{title}} </div>\n  </div>\n\n</div>\n","import {\n  Component,\n  Input,\n  AfterViewInit,\n  OnDestroy,\n  ApplicationRef\n} from '@angular/core';\n\nimport { Layer, LayerOptions } from '../../layer/shared';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { IgoMap } from '../shared';\n\nimport OlMap from 'ol/Map';\nimport OlView from 'ol/View';\n\n@Component({\n  selector: 'igo-mini-basemap',\n  templateUrl: './mini-basemap.component.html',\n  styleUrls: ['./mini-basemap.component.scss']\n})\nexport class MiniBaseMapComponent implements AfterViewInit, OnDestroy {\n\n  @Input() map: IgoMap;\n  @Input() disabled: boolean;\n  @Input() display: boolean;\n  @Input() title: string;\n\n  @Input()\n  get baseLayer(): Layer {\n    return this._baseLayer;\n  }\n  set baseLayer(value: Layer) {\n    this._baseLayer = value;\n    this.handleBaseLayerChanged(value);\n  }\n  private _baseLayer: Layer;\n\n  public basemap = new IgoMap({\n    controls: {},\n    interactions: false\n  });\n\n  constructor(\n    private layerService: LayerService,\n    private appRef: ApplicationRef\n  ) { }\n\n  ngAfterViewInit() {\n    this.handleMainMapViewChange(this.map.ol.getView());\n    this.map.viewController.olView.on('change', change => {\n      this.handleMainMapViewChange((change.target as OlView));\n    });\n    this.map.ol.on('pointerdrag', change => {\n      this.handleMainMapViewChange((change.target as OlMap).getView());\n    });\n  }\n\n  ngOnDestroy() {\n    this.map.viewController.olView.un('change', change => {\n      this.handleMainMapViewChange((change.target as OlView));\n    });\n    this.map.ol.un('pointerdrag', change => {\n      this.handleMainMapViewChange((change.target as OlMap).getView());\n    });\n  }\n\n  changeBaseLayer(baseLayer: Layer) {\n    if (this.disabled) {\n      return;\n    }\n    this.map.changeBaseLayer(baseLayer);\n    this.appRef.tick();\n  }\n\n  private handleMainMapViewChange(mainMapView) {\n    const mainMapViewProperties = mainMapView.getProperties();\n    this.basemap.viewController.olView.setResolution(mainMapViewProperties.resolution);\n    this.basemap.viewController.olView.setRotation(mainMapViewProperties.rotation);\n    this.basemap.viewController.olView.setCenter(this.map.viewController.getCenter());\n  }\n\n  private handleBaseLayerChanged(baselayer: Layer) {\n    this.basemap.removeAllLayers();\n\n    const options: any = Object.assign(\n      Object.create(baselayer.options),\n      baselayer.options,\n      {\n        visible: true,\n        baseLayer: false\n      }\n    );\n\n    const layer = this.layerService.createLayer(options);\n    this.basemap.addLayer(layer);\n    this.handleLinkedBaseLayer(layer);\n  }\n\n  private handleLinkedBaseLayer(baselayer: Layer) {\n    const linkedLayers = baselayer.options.linkedLayers;\n    if (!linkedLayers) {\n      return;\n    }\n    const currentLinkedId = linkedLayers.linkId;\n    const currentLinks = linkedLayers.links;\n    const isParentLayer = currentLinks ? true : false;\n    if (isParentLayer && currentLinkedId === baselayer.options.linkedLayers.linkId) {\n      // search for child layers\n      currentLinks.map(link => {\n        link.linkedIds.map(linkedId => {\n          const layerToApply = this.map.layers.find(l => l.options.linkedLayers?.linkId === linkedId);\n          if (layerToApply) {\n            const linkedLayerOptions: any = Object.assign(\n              Object.create(layerToApply.options),\n              layerToApply.options,\n              {\n                zIndex: 9000,\n                visible: true,\n                baseLayer: false,\n              } as LayerOptions\n            );\n            this.basemap.addLayer(this.layerService.createLayer(linkedLayerOptions));\n          }\n        });\n      });\n    }\n  }\n}\n","<div *ngIf=\"rotated && !showIfNoRotation\" class=\"igo-rotation-button-container\"\n  [matTooltip]=\"rotated ? ('igo.geo.mapButtons.resetRotation' | translate): ('igo.geo.mapButtons.tipRotation' | translate)\"\n  matTooltipPosition=\"left\">\n  <button mat-icon-button matTooltipPosition=\"left\" [color]=\"color\" [disabled]=\"!rotated\"\n    (click)=\"map.viewController.resetRotation()\">\n    <mat-icon [ngStyle]=\"rotationStyle(map.viewController.getRotation())\" svgIcon=\"navigation\">\n    </mat-icon>\n  </button>\n</div>\n\n<div *ngIf=\"showIfNoRotation\" class=\"igo-rotation-button-container\"\n  [matTooltip]=\"rotated ? ('igo.geo.mapButtons.resetRotation' | translate): ('igo.geo.mapButtons.tipRotation' | translate)\"\n  matTooltipPosition=\"left\">\n  <button mat-icon-button matTooltipPosition=\"left\" [color]=\"color\" [disabled]=\"!rotated\"\n    (click)=\"map.viewController.resetRotation()\">\n    <mat-icon [ngStyle]=\"rotationStyle(map.viewController.getRotation())\" svgIcon=\"navigation\">\n    </mat-icon>\n  </button>\n</div>","import { Component, Input } from '@angular/core';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-rotation-button',\n  templateUrl: './rotation-button.component.html',\n  styleUrls: ['./rotation-button.component.scss']\n})\nexport class RotationButtonComponent {\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get showIfNoRotation(): boolean {\n    return this._showIfNoRotation;\n  }\n  set showIfNoRotation(value: boolean) {\n    this._showIfNoRotation = value;\n  }\n  private _showIfNoRotation: boolean;\n\n  @Input()\n  get color(): string {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color: string;\n\n  get rotated(): boolean {\n    return this.map.viewController.getRotation() !== 0;\n  }\n\n  constructor() {}\n\n  rotationStyle(radians): {} {\n    const rotation = 'rotate(' + radians + 'rad)';\n    return {\n      transform: rotation\n    };\n  }\n}\n","import { Component, Input, AfterViewInit, OnDestroy } from '@angular/core';\nimport { Layer } from '../../layer';\nimport { IgoMap } from '../shared/map';\nimport { getRenderPixel } from 'ol/render';\nimport { Subscription } from 'rxjs';\n\n/**\n * Tool to swipe the layers\n */\n@Component({\n  selector: 'igo-swipe-control',\n  templateUrl: './swipe-control.component.html',\n  styleUrls: ['./swipe-control.component.scss']\n})\n\nexport class SwipeControlComponent implements AfterViewInit, OnDestroy {\n\n\n  /**\n   * Get an active map\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * The list of layers for swipe\n   */\n  private layers: Layer[];\n\n  /**\n   * Final position of the swiped element\n   */\n  private pos1: number;\n\n  /**\n   * Intermediate position of the swiped element\n   */\n  private pos3: number;\n\n  /**\n   * State of draggable action\n   */\n  private inDragAction: boolean = false;\n\n  /**\n   * Listener of toggle from advanced-map-tool\n   */\n  private swipeEnabled$$: Subscription;\n\n  /**\n   * Binder of prerender on the same element\n   */\n  private boundPrerender = this.prerender.bind(this);\n\n  constructor() {\n   }\n\n  /**\n   * Get the list of layers for swipe and activate of deactivate the swipe\n   * @internal\n   */\n  ngAfterViewInit(): void {\n    this.getListOfLayers();\n    this.swipeEnabled$$ = this.map.swipeEnabled$.subscribe(value => {\n        value ? this.displaySwipe() : this.displaySwipeOff();\n      });\n    this.letZoom();\n  }\n\n  /**\n   * Clear the overlay layer and any interaction added by this component.\n   * @internal\n   */\n  ngOnDestroy(): void {\n    this.swipeEnabled$$.unsubscribe();\n    this.map.swipeEnabled$.unsubscribe();\n    this.displaySwipeOff();\n  }\n\n  /**\n   * Display a swipe-element and render the layers\n   */\n  displaySwipe() {\n    this.swipeId.style.visibility = 'visible';\n    this.layers.map(layer => layer.ol.on('prerender', this.boundPrerender));\n    this.layers.map(layer => layer.ol.on('postrender', this.postrender));\n    this.map.ol.render();\n  }\n\n  /**\n   * Clear a swipe-element and render the layers on the initial state\n   */\n  displaySwipeOff() {\n    this.swipeId.style.visibility = 'hidden';\n    this.layers.map(layer => layer.ol.un('prerender', this.boundPrerender));\n    this.layers.map(layer => layer.ol.un('postrender', this.postrender));\n    this.map.ol.render();\n    this.layers = [];\n  }\n\n  /**\n   * Getter of element\n   */\n  get swipeId() {\n    return document.getElementById('igo-layer-swipe');\n  }\n\n  /**\n   * Get the list of layers for swipe\n   */\n  getListOfLayers() {\n    this.map.selectedFeatures$.subscribe(layers => {\n      this.layers = [];\n      if (layers !== null) {\n        for (const layer of layers) {\n          if (!this.layers.includes(layer)) {\n            this.layers.push(layer);\n          }\n        }\n      }\n    });\n  }\n\n  /**\n   * Get a position of click or touch\n   */\n  dragDown(event) {\n    this.inDragAction = true;\n    event.preventDefault();\n    if (event.type === 'mousedown'){\n        this.pos3 = event.clientX;\n        this.mouseSwipe();\n        document.onmouseup = this.closeDragMouseElement;\n    }\n    else if (event.type === 'touchstart'){\n        document.getElementById('arrows').style.visibility = 'hidden';\n        this.pos3 = event.touches[0].clientX;\n        this.touchSwipe();\n        document.ontouchend = this.closeDragTouchElement;\n    }\n  }\n\n  /**\n   * Moving a line with a mouse\n   */\n  mouseSwipe(){\n    document.addEventListener('mousemove', event => {\n      if (this.inDragAction){\n        event.preventDefault();\n        this.pos1 = this.pos3 - event.clientX;\n        this.pos3 = event.clientX;\n        this.swipeId.style.left = (this.swipeId.offsetLeft - this.pos1) + 'px';\n      }\n      this.map.ol.render();\n    });\n  }\n\n  /**\n   * Moving a line with a touch\n   */\n  touchSwipe(){\n    document.addEventListener('touchmove', event => {\n      if (this.inDragAction) {\n        event.preventDefault();\n        document.getElementById('arrows').style.visibility = 'hidden';\n        this.pos1 = this.pos3 - event.changedTouches[0].clientX;\n        this.pos3 = event.changedTouches[0].clientX;\n        this.swipeId.style.left = (this.swipeId.offsetLeft - this.pos1) + 'px';\n      }\n      this.map.ol.render();\n    });\n  }\n\n  /**\n   * Deactivate a listener of a mouse-action\n   */\n  closeDragMouseElement() {\n    document.onmouseup = null;\n    document.onmousemove = null;\n    this.inDragAction = false;\n  }\n\n  /**\n   * Deactivate a listener of a touch-action\n   */\n  closeDragTouchElement() {\n    document.ontouchend = null;\n    document.ontouchmove = null;\n    document.getElementById('arrows').style.visibility = 'visible';\n    this.inDragAction = false;\n  }\n\n  /**\n   * Cut the image of a layer by the position of swiped-element\n   */\n  prerender(event) {\n      const ctx = event.context;\n      const mapSize = this.map.ol.getSize();\n      const width = this.swipeId.offsetLeft ;\n      const tl = getRenderPixel(event, [width, 0]);\n      const tr = getRenderPixel(event, [0, 0]);\n      const bl = getRenderPixel(event, [width, mapSize[1]]);\n      const br = getRenderPixel(event, [0, mapSize[1]]);\n      ctx.save();\n      ctx.beginPath();\n      ctx.moveTo(tl[0], tl[1]);\n      ctx.lineTo(bl[0], bl[1]);\n      ctx.lineTo(br[0], br[1]);\n      ctx.lineTo(tr[0], tr[1]);\n      ctx.closePath();\n      ctx.clip();\n  }\n\n  /**\n   * Save a current state of the context\n   */\n  postrender(event){\n    event.context.restore();\n    event.context.save();\n  }\n\n  /**\n   * Zoom on div\n   */\n     private letZoom() {\n      document.getElementById('igo-layer-swipe').addEventListener('wheel', event => {\n        event.deltaY > 0 ? this.map.viewController.zoomOut() : this.map.viewController.zoomIn();\n      }, true);\n    }\n}\n","<div class=\"igo-swipe-control-container\"  id=\"igo-layer-swipe\"\n  (mousedown)=\"dragDown($event)\"\n  (mouseup)=\"closeDragMouseElement()\"\n  (touchstart)=\"dragDown($event)\"\n  (touchend)=\"closeDragTouchElement()\">\n  <div class=\"igo-swipe-control-line\" ></div>\n  \n  <div class=\"igo-swipe-control-arrows\" id=\"arrows\">\n    <div class=\"igo-arrow-left\"></div>\n    <div class=\"igo-arrow-right\"></div>\n  </div>\n</div>\n","import { AfterViewInit, Component, Input, OnDestroy } from '@angular/core';\nimport { IgoMap } from '../shared/map';\nimport { Subscription } from 'rxjs';\n\n/**\n * Tool to display the center of the map\n */\n@Component({\n  selector: 'igo-map-center',\n  templateUrl: './map-center.component.html',\n  styleUrls: ['./map-center.component.scss']\n})\n\nexport class MapCenterComponent implements AfterViewInit, OnDestroy {\n\n  /**\n   * Get an active map\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * Listener of toggle from advanced-map-tool\n   */\n  private displayCenter$$: Subscription;\n  constructor() { }\n\n  /**\n   * Set a visibility for cursor of the center of the map\n   */\n  ngAfterViewInit() {\n    if (this.map) {\n      this.displayCenter$$ = this.map.mapCenter$.subscribe(value => {\n        value ?\n          document.getElementById('mapCenter').style.visibility = 'visible' :\n          document.getElementById('mapCenter').style.visibility = 'hidden';\n      });\n    }\n    this.letZoom();\n  }\n\n  /**\n   * Destroyer of a component\n   */\n  ngOnDestroy() {\n    if (this.displayCenter$$) {\n      this.displayCenter$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Zoom on div\n   */\n  private letZoom() {\n    document.getElementById('mapCenter').addEventListener('wheel', event => {\n      event.deltaY > 0 ? this.map.viewController.zoomOut() : this.map.viewController.zoomIn();\n    }, true);\n  }\n}\n","<div\n    class=\"mapCenter\"\n    id=\"mapCenter\">\n    <div class=\"vertical\"></div>\n    <div class=\"horizontal\"></div>\n</div>\n","<div *ngIf=\"infoContent && infoContent.length\" class=\"infoSection\">\n    <pre>{{infoContent}}</pre>\n</div>","import { Component, Input } from '@angular/core';\n\n@Component({\n  selector: 'igo-info-section',\n  templateUrl: './info-section.component.html',\n  styleUrls: ['./info-section.component.scss']\n})\nexport class InfoSectionComponent {\n\n  @Input() infoContent: string = '';\n\n  constructor() {}\n\n}\n","export enum CatalogItemType {\n  Layer = 'layer',\n  Group = 'group'\n}\n\nexport enum TypeCatalog {\n  wms, wmts, baselayers, arcgisrest, tilearcgisrest, imagearcgisrest, composite\n}\n\nexport type TypeCatalogStrings = keyof typeof TypeCatalog;\n","import { Observable } from 'rxjs';\n\nimport { TooltipType } from '../../layer';\nimport { TimeFilterOptions } from '../../filter';\nimport { QueryFormat, QueryHtmlTarget } from '../../query';\n\nimport { ICatalog, ICompositeCatalog , CatalogItem, CatalogItemGroup } from './catalog.interface';\nimport { CatalogService } from './catalog.service';\nimport { TypeCatalog, TypeCatalogStrings } from './catalog.enum';\n\nexport abstract class Catalog implements ICatalog {\n\n    // ICatalog -----------------------------\n    id: string;\n    title: string;\n    url: string;\n    removable?: boolean;\n    externalProvider?: boolean;\n    abstract?: string;\n    forcedProperties?: any[];\n    items?: CatalogItem[];\n    type?: TypeCatalogStrings;\n    version?: string;\n    matrixSet?: string;\n    requestEncoding?: string;\n    regFilters?: string[];\n    groupImpose?: CatalogItemGroup;\n    groupSeparator?: string;\n    timeFilter?: TimeFilterOptions;\n    queryFormat?: QueryFormat;\n    queryHtmlTarget?: QueryHtmlTarget;\n    queryParams?: { [key: string]: string; };\n    sourceOptions?: { [key: string]: any; };\n    count?: number;\n    tooltipType?: TooltipType.ABSTRACT | TooltipType.TITLE;\n    sortDirection?: 'asc' | 'desc';\n    setCrossOriginAnonymous?: boolean;\n    showLegend?: boolean;\n    // ICatalog -----------------------------\n\n    protected catalogService: CatalogService;\n\n    constructor(options: Catalog, service: CatalogService) {\n        Object.assign(this, options);\n        this.catalogService = service;\n    }\n\n    public abstract collectCatalogItems(): Observable<CatalogItem[]>;\n}\n\nclass WMSCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.wms];\n        this.type = TypeCatalog[sType];\n    }\n\n    public collectCatalogItems(): Observable<CatalogItem[]> {\n        return this.catalogService.loadCatalogWMSLayerItems(this);\n    }\n}\n\nclass WMTSCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.wmts];\n        this.type = TypeCatalog[sType];\n    }\n\n    public collectCatalogItems(): Observable<CatalogItem[]> {\n        return this.catalogService.loadCatalogWMTSLayerItems(this);\n    }\n}\n\nclass BaselayersCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.baselayers];\n        this.type = TypeCatalog[sType];\n    }\n\n    public collectCatalogItems(): Observable<CatalogItemGroup[]> {\n        return this.catalogService.loadCatalogBaseLayerItems(this);\n    }\n}\n\nclass ArcGISRestCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.arcgisrest];\n        this.type = TypeCatalog[sType];\n    }\n\n    public collectCatalogItems() {\n        return this.catalogService.loadCatalogArcGISRestItems(this);\n    }\n}\n\nclass TileOrImageArcGISRestCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService, typeCatalog: TypeCatalog) {\n        super(options, service);\n        this.type = TypeCatalog[TypeCatalog[typeCatalog]];\n    }\n\n    public collectCatalogItems() {\n        return this.catalogService.loadCatalogArcGISRestItems(this);\n    }\n}\n\nexport class CompositeCatalog extends Catalog implements ICompositeCatalog {\n    composite: ICatalog[];\n\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.composite];\n        this.type = TypeCatalog[sType];\n        this.url = null;\n    }\n\n    public collectCatalogItems(): Observable<CatalogItem[]> {\n        return this.catalogService.loadCatalogCompositeLayerItems(this);\n    }\n}\n\nexport class CatalogFactory {\n\n    public static createInstanceCatalog(options: Catalog, service: CatalogService): Catalog {\n\n        let catalog: Catalog;\n        if (options.hasOwnProperty('composite')) {\n            catalog = new CompositeCatalog(options, service);\n        } else if (options.type === TypeCatalog[TypeCatalog.baselayers]) {\n            catalog = new BaselayersCatalog(options, service);\n        } else if (options.type === TypeCatalog[TypeCatalog.arcgisrest]) {\n            catalog = new ArcGISRestCatalog(options, service);\n        } else if (options.type === TypeCatalog[TypeCatalog.tilearcgisrest]) {\n            catalog = new TileOrImageArcGISRestCatalog(options, service, TypeCatalog.tilearcgisrest);\n        } else if (options.type === TypeCatalog[TypeCatalog.imagearcgisrest]) {\n            catalog = new TileOrImageArcGISRestCatalog(options, service, TypeCatalog.imagearcgisrest);\n        } else if (options.type === TypeCatalog[TypeCatalog.wmts]) {\n            catalog = new WMTSCatalog(options, service);\n        } else {\n            catalog = new WMSCatalog(options, service);\n        }\n\n        return catalog;\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable, of } from 'rxjs';\nimport { map, mergeMap } from 'rxjs/operators';\n\nimport * as striptags_ from 'striptags';\n\nimport * as olformat from 'ol/format';\nimport * as olextent from 'ol/extent';\nimport olFormatGML2 from 'ol/format/GML2';\nimport olFormatGML3 from 'ol/format/GML3';\nimport olFormatEsriJSON from 'ol/format/EsriJSON';\nimport olFeature from 'ol/Feature';\nimport * as olgeom from 'ol/geom';\n\nimport { uuid } from '@igo2/utils';\nimport { Feature, FeatureGeometry } from '../../feature/shared/feature.interfaces';\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport {\n  WMSDataSource,\n  CartoDataSource,\n  TileArcGISRestDataSource,\n  WMSDataSourceOptions,\n  ImageArcGISRestDataSource\n} from '../../datasource';\n\nimport {\n  QueryFormat,\n  QueryFormatMimeType,\n  QueryHtmlTarget\n} from './query.enums';\nimport {\n  QueryOptions,\n  QueryableDataSource,\n  QueryableDataSourceOptions\n} from './query.interfaces';\nimport { MapExtent } from '../../map/shared/map.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class QueryService {\n  public queryEnabled = true;\n\n  constructor(private http: HttpClient) {}\n\n  query(layers: Layer[], options: QueryOptions): Observable<Feature[]>[] {\n    return layers\n      .filter((layer: Layer) => layer.visible && layer.isInResolutionsRange)\n      .map((layer: Layer) => this.queryLayer(layer, options));\n  }\n\n  queryLayer(layer: Layer, options: QueryOptions): Observable<Feature[]> {\n    const url = this.getQueryUrl(layer.dataSource, options, false, layer.map.viewController.getExtent());\n    if (!url) {\n      return of([]);\n    }\n\n    if (\n      (layer.dataSource as QueryableDataSource).options.queryFormat ===\n      QueryFormat.HTMLGML2\n    ) {\n      const urlGml = this.getQueryUrl(layer.dataSource, options, true);\n      return this.http.get(urlGml, { responseType: 'text' }).pipe(\n        mergeMap(gmlRes => {\n          const mergedGML = this.mergeGML(gmlRes, url, layer);\n          const imposedGeom = mergedGML[0];\n          const imposedProperties = mergedGML[1];\n          return this.http\n            .get(url, { responseType: 'text' })\n            .pipe(\n              map(res =>\n                this.extractData(res, layer, options, url, imposedGeom, imposedProperties)\n              )\n            );\n        })\n      );\n    }\n\n    const request = this.http.get(url, { responseType: 'text' });\n    return request.pipe(map(res => this.extractData(res, layer, options, url)));\n  }\n\n  private mergeGML(gmlRes, url, layer: Layer): [FeatureGeometry, { [key: string]: any }] {\n    const parser = new olFormatGML2();\n    let features = parser.readFeatures(gmlRes);\n    // Handle non standard GML output (MapServer)\n    if (features.length === 0) {\n      const wmsParser = new olformat.WMSGetFeatureInfo();\n      features = wmsParser.readFeatures(gmlRes);\n    }\n    const olmline = new olgeom.MultiLineString([]);\n    let pts;\n    const ptsArray = [];\n    let olmpoly = new olgeom.MultiPolygon([]);\n    let firstFeatureType;\n    const nbFeatures = features.length;\n\n    // Check if geometry intersect bbox\n    // for geoserver getfeatureinfo response in data projection, not call projection\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const bboxRaw = searchParams.bbox;\n    const bbox = bboxRaw.split(',');\n    const bboxExtent = olextent.createEmpty();\n    olextent.extend(bboxExtent, bbox);\n    const outBboxExtent = false;\n    let titleContent;\n    let queryTileField;\n    if (layer.options?.source?.options) {\n      const dataSourceOptions = layer.options.source\n        .options as QueryableDataSourceOptions;\n      if (dataSourceOptions.queryTitle) {\n        queryTileField = dataSourceOptions.queryTitle;\n      }\n    }\n    features.map(feature => {\n\n      if (queryTileField) {\n        let queryTitleContent = feature.getProperties()[queryTileField];\n        if (queryTitleContent) {\n          titleContent = !titleContent ? queryTitleContent : `${titleContent},${queryTitleContent}`;\n        }\n      }\n      /*  if (!feature.getGeometry().simplify(100).intersectsExtent(bboxExtent)) {\n        outBboxExtent = true;\n        // TODO: Check to project the geometry?\n      }*/\n      const featureGeometryCoordinates = feature.getGeometry().getCoordinates();\n      const featureGeometryType = feature.getGeometry().getType();\n\n      if (!firstFeatureType && !outBboxExtent) {\n        firstFeatureType = featureGeometryType;\n      }\n      if (!outBboxExtent) {\n        switch (featureGeometryType) {\n          case 'Point':\n            if (nbFeatures === 1) {\n              pts = new olgeom.Point(featureGeometryCoordinates, 'XY');\n            } else {\n              ptsArray.push(featureGeometryCoordinates);\n            }\n            break;\n          case 'LineString':\n            olmline.appendLineString(\n              new olgeom.LineString(featureGeometryCoordinates, 'XY')\n            );\n            break;\n          case 'Polygon':\n            olmpoly.appendPolygon(\n              new olgeom.Polygon(featureGeometryCoordinates, 'XY')\n            );\n            break;\n          case 'MultiPolygon':\n            olmpoly = new olgeom.MultiPolygon(featureGeometryCoordinates, 'XY');\n            break;\n          default:\n            return;\n        }\n      }\n    });\n\n    let olmpts;\n    if (ptsArray.length === 0 && pts) {\n      olmpts = {\n        type: pts.getType(),\n        coordinates: pts.getCoordinates()\n      };\n    } else {\n      olmpts = {\n        type: 'Polygon',\n        coordinates: [this.convexHull(ptsArray)]\n      };\n    }\n\n    let returnGeometry;\n    switch (firstFeatureType) {\n      case 'LineString':\n        returnGeometry = {\n          type: olmline.getType(),\n          coordinates: olmline.getCoordinates()\n        };\n      case 'Point':\n        return olmpts;\n      case 'Polygon':\n        returnGeometry = {\n          type: olmpoly.getType(),\n          coordinates: olmpoly.getCoordinates()\n        };\n      case 'MultiPolygon':\n        returnGeometry = {\n          type: olmpoly.getType(),\n          coordinates: olmpoly.getCoordinates()\n        };\n    }\n    const imposedProperties = {};\n\n    if (queryTileField) {\n      imposedProperties[queryTileField] = titleContent;\n    }\n\n    return [ returnGeometry, imposedProperties];\n\n\n  }\n\n  cross(a, b, o) {\n    return (a[0] - o[0]) * (b[1] - o[1]) - (a[1] - o[1]) * (b[0] - o[0]);\n  }\n\n  /**\n   * @param points An array of [X, Y] coordinates\n   * This method is use instead of turf.js convexHull because Turf needs at least 3 point to make a hull.\n   * https://en.wikibooks.org/wiki/Algorithm_Implementation/Geometry/Convex_hull/Monotone_chain#JavaScript\n   */\n  convexHull(points) {\n    points.sort((a, b) => {\n      return a[0] === b[0] ? a[1] - b[1] : a[0] - b[0];\n    });\n\n    const lower = [];\n    for (const point of points) {\n      while (\n        lower.length >= 2 &&\n        this.cross(lower[lower.length - 2], lower[lower.length - 1], point) <= 0\n      ) {\n        lower.pop();\n      }\n      lower.push(point);\n    }\n\n    const upper = [];\n    for (let i = points.length - 1; i >= 0; i--) {\n      while (\n        upper.length >= 2 &&\n        this.cross(\n          upper[upper.length - 2],\n          upper[upper.length - 1],\n          points[i]\n        ) <= 0\n      ) {\n        upper.pop();\n      }\n      upper.push(points[i]);\n    }\n\n    upper.pop();\n    lower.pop();\n    return lower.concat(upper);\n  }\n\n  private extractData(\n    res,\n    layer: Layer,\n    options: QueryOptions,\n    url: string,\n    imposedGeometry?,\n    imposedProperties?: { [key: string]: any }\n  ): Feature[] {\n    const queryDataSource = layer.dataSource as QueryableDataSource;\n\n    const allowedFieldsAndAlias = this.getAllowedFieldsAndAlias(layer);\n    let features = [];\n    switch (queryDataSource.options.queryFormat) {\n      case QueryFormat.GML3:\n        features = this.extractGML3Data(\n          res,\n          layer.zIndex,\n          allowedFieldsAndAlias\n        );\n        break;\n      case QueryFormat.JSON:\n      case QueryFormat.GEOJSON:\n      case QueryFormat.GEOJSON2:\n        features = this.extractGeoJSONData(res, layer.zIndex, allowedFieldsAndAlias);\n        break;\n      case QueryFormat.ESRIJSON:\n        features = this.extractEsriJSONData(res, layer.zIndex, allowedFieldsAndAlias);\n        break;\n      case QueryFormat.TEXT:\n        features = this.extractTextData(res);\n        break;\n      case QueryFormat.HTML:\n        features = this.extractHtmlData(\n          res,\n          queryDataSource.queryHtmlTarget,\n          url\n        );\n        break;\n      case QueryFormat.HTMLGML2:\n        features = this.extractHtmlData(\n          res,\n          queryDataSource.queryHtmlTarget,\n          url,\n          imposedGeometry,\n          imposedProperties\n        );\n        break;\n      case QueryFormat.GML2:\n      default:\n        features = this.extractGML2Data(res, layer, allowedFieldsAndAlias);\n        break;\n    }\n\n    if (features.length > 0 && features[0].geometry === null) {\n      const geomToAdd = this.createGeometryFromUrlClick(url);\n\n      for (const feature of features) {\n        feature.geometry = geomToAdd;\n      }\n    }\n\n    return features.map((feature: Feature, index: number) => {\n      const mapLabel = feature.properties[queryDataSource.mapLabel];\n\n      let exclude;\n      if (layer.options.sourceOptions?.type === 'wms') {\n        const sourceOptions = layer.options\n          .sourceOptions as WMSDataSourceOptions;\n        exclude = sourceOptions ? sourceOptions.excludeAttribute : undefined;\n      }\n\n      let title = this.getQueryTitle(feature, layer);\n      if (!title && features.length > 1) {\n        title = `${layer.title} (${index + 1})`;\n      } else if (!title) {\n        title = layer.title;\n      }\n\n      const meta = Object.assign({}, feature.meta || {}, {\n        id: uuid(),\n        title,\n        mapTitle: mapLabel,\n        sourceTitle: layer.title,\n        order: 1000 - layer.zIndex,\n        excludeAttribute: exclude\n      });\n\n      return Object.assign(feature, {\n        meta,\n        projection:\n          queryDataSource.options.type === 'carto'\n            ? 'EPSG:4326'\n            : options.projection\n      });\n    });\n  }\n\n  private createGeometryFromUrlClick(url) {\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const bboxRaw = searchParams.bbox;\n    const width = parseInt(searchParams.width, 10);\n    const height = parseInt(searchParams.height, 10);\n    const xPosition = parseInt(searchParams.i || searchParams.x, 10);\n    const yPosition = parseInt(searchParams.j || searchParams.y, 10);\n\n    const bbox = bboxRaw.split(',');\n    let threshold =\n      (Math.abs(parseFloat(bbox[0])) - Math.abs(parseFloat(bbox[2]))) * 0.05;\n\n    // for context in degree (EPSG:4326,4269...)\n    if (Math.abs(parseFloat(bbox[0])) < 180) {\n      threshold = 0.045;\n    }\n    const clickx =\n      parseFloat(bbox[0]) +\n      (Math.abs(parseFloat(bbox[0]) - parseFloat(bbox[2])) * xPosition) /\n        width -\n      threshold;\n    const clicky =\n      parseFloat(bbox[1]) +\n      (Math.abs(parseFloat(bbox[1]) - parseFloat(bbox[3])) * yPosition) /\n        height -\n      threshold;\n    const clickx1 = clickx + threshold * 2;\n    const clicky1 = clicky + threshold * 2;\n\n    const wktPoly =\n      'POLYGON((' +\n      clickx +\n      ' ' +\n      clicky +\n      ', ' +\n      clickx +\n      ' ' +\n      clicky1 +\n      ', ' +\n      clickx1 +\n      ' ' +\n      clicky1 +\n      ', ' +\n      clickx1 +\n      ' ' +\n      clicky +\n      ', ' +\n      clickx +\n      ' ' +\n      clicky +\n      '))';\n\n    const format = new olformat.WKT();\n    const tenPercentWidthGeom = format.readFeature(wktPoly);\n    const f = tenPercentWidthGeom.getGeometry() as any;\n\n    const newGeom = {\n      type: f.getType(),\n      coordinates: f.getCoordinates()\n    };\n\n    return newGeom;\n  }\n\n  private extractGML2Data(res, zIndex, allowedFieldsAndAlias?) {\n    const parser = new olFormatGML2();\n    let features = parser.readFeatures(res);\n    // Handle non standard GML output (MapServer)\n    if (features.length === 0) {\n      const wmsParser = new olformat.WMSGetFeatureInfo();\n      try {\n        features = wmsParser.readFeatures(res);\n      } catch (e) {\n        console.warn(\n          'query.service: Multipolygons are badly managed in mapserver in GML2. Use another format.'\n        );\n      }\n    }\n\n    return features.map(feature =>\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\n    );\n  }\n\n  private extractGML3Data(res, zIndex, allowedFieldsAndAlias?) {\n    const parser = new olFormatGML3();\n    let features = [];\n    try {\n      features = parser.readFeatures(res);\n    } catch (e) {\n      console.warn('query.service: GML3 is not well supported');\n    }\n    return features.map(feature =>\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\n    );\n  }\n\n  private extractGeoJSONData(res, zIndex, allowedFieldsAndAlias?) {\n    let features = [];\n    try {\n      features = JSON.parse(res.replace(/(\\r|\\n)/g, ' ')).features;\n    } catch (e) {\n      console.warn('query.service: Unable to parse geojson', '\\n', res);\n    }\n    features.map(feature => feature.meta = {\n      id: uuid(),\n      order: 1000 - zIndex,\n      alias: allowedFieldsAndAlias\n    });\n    return features;\n  }\n\n  private extractEsriJSONData(res, zIndex, allowedFieldsAndAlias) {\n    if (res) {\n      try {\n        if (JSON.parse(res).error) {\n          return [];\n        }\n      } catch (e) {}\n    }\n    const parser = new olFormatEsriJSON();\n    const features = parser.readFeatures(res);\n\n    return features.map(feature => this.featureToResult(feature, zIndex, allowedFieldsAndAlias));\n  }\n\n  private extractTextData(res) {\n    // TODO\n    return [];\n  }\n\n  private extractHtmlData(\n    res,\n    htmlTarget: QueryHtmlTarget,\n    url,\n    imposedGeometry?,\n    imposedProperties?: { [key: string]: any }\n  ) {\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const projection = searchParams.crs || searchParams.srs || 'EPSG:3857';\n    const geomToAdd = this.createGeometryFromUrlClick(url);\n\n    if (\n      htmlTarget !== QueryHtmlTarget.BLANK &&\n      htmlTarget !== QueryHtmlTarget.IFRAME\n    ) {\n      htmlTarget = QueryHtmlTarget.IFRAME;\n    }\n\n    const bodyTagStart = res.toLowerCase().indexOf('<body>');\n    const bodyTagEnd = res.toLowerCase().lastIndexOf('</body>') + 7;\n    // replace \\r \\n  and ' ' with '' to validate if the body is really empty. Clear all the html tags from body\n    const striptags = striptags_;\n    const body = striptags(res.slice(bodyTagStart, bodyTagEnd).replace(/(\\r|\\n|\\s)/g, ''));\n    if (body === '' || res === '') {\n      return [];\n    }\n\n    return [\n      {\n        type: FEATURE,\n        projection,\n        properties: Object.assign({ target: htmlTarget, body: res, url }, imposedProperties),\n        geometry: imposedGeometry || geomToAdd\n      }\n    ];\n  }\n\n  private getQueryParams(url) {\n    const queryString = url.split('?');\n    if (!queryString[1]) {\n      return;\n    }\n    const pairs = queryString[1].split('&');\n\n    const result = {};\n    pairs.forEach(pair => {\n      pair = pair.split('=');\n      result[pair[0]] = decodeURIComponent(pair[1] || '');\n    });\n    return result;\n  }\n\n  public featureToResult(\n    featureOL: olFeature<olgeom.Geometry>,\n    zIndex: number,\n    allowedFieldsAndAlias?\n  ): Feature {\n    const featureGeometry = featureOL.getGeometry() as any;\n    const properties: any = Object.assign({}, featureOL.getProperties());\n    delete properties.geometry;\n    delete properties.GEOMETRIE;\n    delete properties.boundedBy;\n    delete properties.shape;\n    delete properties.SHAPE;\n    delete properties.the_geom;\n    delete properties.geom;\n\n    let geometry;\n    if (featureGeometry) {\n      geometry = {\n        type: featureGeometry.getType(),\n        coordinates: featureGeometry.getCoordinates()\n      };\n    }\n\n    return {\n      type: FEATURE,\n      projection: undefined,\n      properties,\n      geometry,\n      meta: {\n        id: uuid(),\n        order: 1000 - zIndex,\n        alias: allowedFieldsAndAlias\n      }\n    };\n  }\n\n  private getQueryUrl(\n    datasource: QueryableDataSource,\n    options: QueryOptions,\n    forceGML2 = false,\n    mapExtent?: MapExtent\n  ): string {\n    let url;\n\n    if (datasource.options.queryUrl) {\n      return this.getCustomQueryUrl(datasource, options, mapExtent);\n    }\n\n    switch (datasource.constructor) {\n      case WMSDataSource:\n        const wmsDatasource = datasource as WMSDataSource;\n\n        const WMSGetFeatureInfoOptions = {\n          INFO_FORMAT:\n            wmsDatasource.params.INFO_FORMAT ||\n            this.getMimeInfoFormat(datasource.options.queryFormat),\n          QUERY_LAYERS: wmsDatasource.params.LAYERS,\n          FEATURE_COUNT: wmsDatasource.params.FEATURE_COUNT || '5'\n        };\n\n        if (forceGML2) {\n          WMSGetFeatureInfoOptions.INFO_FORMAT = this.getMimeInfoFormat(\n            QueryFormat.GML2\n          );\n        }\n\n        url = wmsDatasource.ol.getFeatureInfoUrl(\n          options.coordinates,\n          options.resolution,\n          options.projection,\n          WMSGetFeatureInfoOptions\n        );\n        // const wmsVersion =\n        //   wmsDatasource.params.VERSION ||\n        //   wmsDatasource.params.version ||\n        //   '1.3.0';\n        // if (wmsVersion !== '1.3.0') {\n        //   url = url.replace('&I=', '&X=');\n        //   url = url.replace('&J=', '&Y=');\n        // }\n        break;\n      case CartoDataSource:\n        const cartoDatasource = datasource as CartoDataSource;\n        const baseUrl =\n          'https://' +\n          cartoDatasource.options.account +\n          '.carto.com/api/v2/sql?';\n        const format = 'format=GeoJSON';\n        const sql =\n          '&q=' + cartoDatasource.options.config.layers[0].options.sql;\n        const clause =\n          ' WHERE ST_Intersects(the_geom_webmercator,ST_BUFFER(ST_SetSRID(ST_POINT(';\n        const meters = cartoDatasource.options.queryPrecision\n          ? cartoDatasource.options.queryPrecision\n          : '1000';\n        const coordinates =\n          options.coordinates[0] +\n          ',' +\n          options.coordinates[1] +\n          '),3857),' +\n          meters +\n          '))';\n\n        url = `${baseUrl}${format}${sql}${clause}${coordinates}`;\n        break;\n      case ImageArcGISRestDataSource:\n      case TileArcGISRestDataSource:\n        const tileArcGISRestDatasource = datasource as TileArcGISRestDataSource;\n        const deltaX = Math.abs(mapExtent[0] - mapExtent[2]);\n        const deltaY = Math.abs(mapExtent[1] - mapExtent[3]);\n        const maxDelta = deltaX > deltaY ? deltaX : deltaY;\n        const clickBuffer = maxDelta * 0.005;\n        const threshold = tileArcGISRestDatasource.options.queryPrecision ? tileArcGISRestDatasource.options.queryPrecision : clickBuffer;\n        const extent = olextent.buffer(\n          olextent.boundingExtent([options.coordinates]),\n          threshold\n        );\n        const serviceUrl =\n          tileArcGISRestDatasource.options.url +\n          '/' +\n          tileArcGISRestDatasource.options.layer +\n          '/query/';\n        const geometry = encodeURIComponent(\n          '{\"xmin\":' +\n            extent[0] +\n            ',\"ymin\":' +\n            extent[1] +\n            ',\"xmax\":' +\n            extent[2] +\n            ',\"ymax\":' +\n            extent[3] +\n            ',\"spatialReference\":{\"wkid\":102100}}'\n        );\n        const params = [\n          'f=json',\n          `geometry=${geometry}`,\n          'geometryType=esriGeometryEnvelope',\n          'inSR=102100',\n          'spatialRel=esriSpatialRelIntersects',\n          'outFields=*',\n          'returnGeometry=true',\n          'outSR=102100'\n        ];\n        url = `${serviceUrl}?${params.join('&')}`;\n        break;\n      default:\n        break;\n    }\n\n    return url;\n  }\n\n  private getMimeInfoFormat(queryFormat: string) {\n    let mime = 'application/vnd.ogc.gml';\n    const keyEnum = Object.keys(QueryFormat).find(\n      key => QueryFormat[key] === queryFormat\n    );\n    if (keyEnum) {\n      mime = QueryFormatMimeType[keyEnum];\n    }\n\n    return mime;\n  }\n\n  getAllowedFieldsAndAlias(layer: any) {\n    let allowedFieldsAndAlias;\n    if (\n      layer.options?.source?.options?.sourceFields &&\n      layer.options.source.options.sourceFields.length >= 1\n    ) {\n      allowedFieldsAndAlias = {};\n      layer.options.source.options.sourceFields.forEach(sourceField => {\n        const alias = sourceField.alias ? sourceField.alias : sourceField.name;\n        allowedFieldsAndAlias[sourceField.name] = alias;\n      });\n    }\n    return allowedFieldsAndAlias;\n  }\n\n  getQueryTitle(feature: Feature, layer: Layer): string {\n    let title;\n    if (layer.options?.source?.options) {\n      const dataSourceOptions = layer.options.source\n        .options as QueryableDataSourceOptions;\n      if (dataSourceOptions.queryTitle) {\n        title = this.getLabelMatch(feature, dataSourceOptions.queryTitle);\n      }\n    }\n\n    return title;\n  }\n\n  getLabelMatch(feature: Feature, labelMatch): string {\n    let label = labelMatch;\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\n\n    labelToGet.forEach(v => {\n      label = label.replace(v[0], feature.properties[v[1]]);\n    });\n\n    // Nothing done? check feature's attribute\n    if (labelToGet.length === 0 && label === labelMatch) {\n      label = feature.properties[labelMatch] || labelMatch;\n    }\n\n    return label;\n  }\n\n  /**\n   * @param datasource QueryableDataSource\n   * @param options QueryOptions\n   * @mapExtent extent of the map when click event\n   *\n   */\n\n  getCustomQueryUrl(\n    datasource: QueryableDataSource,\n    options: QueryOptions,\n    mapExtent?: MapExtent): string {\n\n      let url = datasource.options.queryUrl.replace(/\\{xmin\\}/g, mapExtent[0].toString())\n      .replace(/\\{ymin\\}/g, mapExtent[1].toString())\n      .replace(/\\{xmax\\}/g, mapExtent[2].toString())\n      .replace(/\\{ymax\\}/g, mapExtent[3].toString())\n      .replace(/\\{x\\}/g, options.coordinates[0].toString())\n      .replace(/\\{y\\}/g, options.coordinates[1].toString())\n      .replace(/\\{resolution\\}/g, options.resolution.toString())\n      .replace(/\\{srid\\}/g, options.projection.replace('EPSG:',''));\n\n      return url;\n    }\n}\n","import OlLayer from 'ol/layer/Layer';\nimport OlSource from 'ol/source/Source';\n\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\nimport { QueryableDataSource } from './query.interfaces';\n\n/**\n * Whether a layer is queryable\n * @param layer Layer\n * @returns True if the layer s squeryable\n */\nexport function layerIsQueryable(layer: AnyLayer): boolean {\n  const dataSource = layer.dataSource as QueryableDataSource;\n  return dataSource.options.queryable === true;\n}\n\n/**\n * Whether an OL layer is queryable\n * @param layer Layer\n * @returns True if the ol layer is queryable\n */\nexport function olLayerIsQueryable(olLayer: OlLayer<OlSource>): boolean {\n  const layer = olLayer.get('_layer');\n  return layer === undefined ? false : layerIsQueryable(layer);\n}\n\n/**\n * Whether a layer's feature is queryable\n * @param layer Layer\n * @returns True if the layer's feature is queryable\n */\nexport function layerFeatureIsQueryable(layer: AnyLayer): boolean {\n  const dataSource = layer.dataSource as QueryableDataSource;\n  return dataSource.options.queryLayerFeatures !== undefined ? (dataSource.options.queryLayerFeatures === true) : true;\n}\n\n/**\n * Whether an OL Vector layer is queryable\n * @param layer Layer\n * @returns True if the ol vector layer is queryable\n */\nexport function olLayerFeatureIsQueryable(olLayer: OlLayer<OlSource>): boolean {\n  const layer = olLayer.get('_layer');\n  return layer === undefined ? false : (layerIsQueryable(layer) && layerFeatureIsQueryable(layer));\n}\n","import {\n  Directive,\n  Input,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  AfterViewInit,\n  Self\n} from '@angular/core';\n\nimport { Subscription, Observable, of, zip } from 'rxjs';\nimport { unByKey } from 'ol/Observable';\n\nimport OlFeature from 'ol/Feature';\nimport OlRenderFeature from 'ol/render/Feature';\nimport OlLayer from 'ol/layer/Layer';\nimport OlSource from 'ol/source/Source';\nimport olVectorSource from 'ol/source/Vector';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { EventsKey } from 'ol/events';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { renderFeatureFromOl } from '../../feature/shared/feature.utils';\nimport { featureFromOl } from '../../feature/shared/feature.utils';\nimport { QueryService } from './query.service';\nimport { layerIsQueryable, olLayerFeatureIsQueryable } from './query.utils';\nimport { ctrlKeyDown } from '../../map/shared/map.utils';\nimport { OlDragSelectInteraction } from '../../feature/shared/strategies/selection';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { QueryableDataSourceOptions } from './query.interfaces';\n\n/**\n * This directive makes a map queryable with a click of with a drag box.\n * By default, all layers are queryable but this can ben controlled at\n * the layer level.\n */\n@Directive({\n  selector: '[igoQuery]'\n})\nexport class QueryDirective implements AfterViewInit, OnDestroy {\n  /**\n   * Subscriptions to ongoing queries\n   */\n  private queries$$: Subscription[] = [];\n\n  /**\n   * Listener to the map click event\n   */\n  private mapClickListener;\n\n  /**\n   * OL drag box interaction\n   */\n  private olDragSelectInteraction: OlDragSelectInteraction;\n\n  /**\n   * Ol drag box \"end\" event key\n   */\n  private olDragSelectInteractionEndKey: EventsKey | EventsKey[];\n\n  /**\n   * Whter to query features or not\n   */\n  @Input() queryFeatures: boolean = false;\n\n  /**\n   * Feature query hit tolerance\n   */\n  @Input() queryFeaturesHitTolerance: number = 0;\n\n  /**\n   * Feature query hit tolerance\n   */\n  @Input() queryFeaturesCondition: (olLayer: OlLayer<OlSource>) => boolean;\n\n  /**\n   * Whether all query should complete before emitting an event\n   */\n  @Input() waitForAllQueries: boolean = true;\n\n  /**\n   * Event emitted when a query (or all queries) complete\n   */\n  @Output() query = new EventEmitter<{\n    features: Feature[] | Feature[][];\n    event: MapBrowserPointerEvent<any>;\n  }>();\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return (this.component.map as any) as IgoMap;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private queryService: QueryService\n  ) {}\n\n  /**\n   * Start listening to click and drag box events\n   * @internal\n   */\n  ngAfterViewInit() {\n    this.listenToMapClick();\n    this.addDragBoxInteraction();\n  }\n\n  /**\n   * Stop listening to click and drag box events and cancel ongoind requests\n   * @internal\n   */\n  ngOnDestroy() {\n    this.cancelOngoingQueries();\n    this.unlistenToMapClick();\n    this.removeDragBoxInteraction();\n  }\n\n  /**\n   * On map click, issue queries\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Stop listening for map clicks\n   */\n  private unlistenToMapClick() {\n    unByKey(this.mapClickListener);\n    this.mapClickListener = undefined;\n  }\n\n  /**\n   * Issue queries from a map event and emit events with the results\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: MapBrowserPointerEvent<any>) {\n    this.cancelOngoingQueries();\n    if (!this.queryService.queryEnabled) {\n      return;\n    }\n\n    const queries$ = [];\n    if (this.queryFeatures) {\n      queries$.push(this.doQueryFeatures(event));\n    }\n\n    const resolution = this.map.ol.getView().getResolution();\n    const queryLayers = this.map.layers.filter(layerIsQueryable);\n    queries$.push(\n      ...this.queryService.query(queryLayers, {\n        coordinates: event.coordinate as [number, number],\n        projection: this.map.projection,\n        resolution\n      })\n    );\n\n    if (queries$.length === 0) {\n      return;\n    }\n\n    if (this.waitForAllQueries) {\n      this.queries$$.push(\n        zip(...queries$).subscribe((results: Feature[][]) => {\n          const features = [].concat(...results);\n          this.query.emit({ features, event });\n        })\n      );\n    } else {\n      this.queries$$ = queries$.map((query$: Observable<Feature[]>) => {\n        return query$.subscribe((features: Feature[]) => {\n          this.query.emit({ features, event });\n        });\n      });\n    }\n  }\n\n  /**\n   * Query features already present on the map\n   * @param event OL map browser pointer event\n   */\n  private doQueryFeatures(\n    event: MapBrowserPointerEvent<any>\n  ): Observable<Feature[]> {\n    const clickedFeatures = [];\n\n    if (event.type === 'singleclick') {\n      this.map.ol.forEachFeatureAtPixel(\n        event.pixel,\n        (featureOL: OlFeature<OlGeometry>, layerOL: any) => {\n          const layer = this.map.getLayerById(layerOL.values_._layer.id);\n          if ((layer.dataSource.options as QueryableDataSourceOptions).queryFormatAsWms) {\n            return;\n          }\n          if (featureOL) {\n            if (featureOL.get('features')) {\n              for (const feature of featureOL.get('features')) {\n                const newFeature = featureFromOl(feature, this.map.projection);\n                newFeature.meta = {\n                  title: feature.values_.nom,\n                  id: layerOL.values_._layer.id + '.' + feature.id_,\n                  icon: feature.values_._icon,\n                  sourceTitle: layerOL.values_.title,\n                  alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                  // title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n                };\n                clickedFeatures.push(newFeature);\n              }\n            } else if (featureOL instanceof OlRenderFeature) {\n              const newFeature = renderFeatureFromOl(\n                featureOL,\n                this.map.projection,\n                layerOL\n              );\n              newFeature.meta = {\n                id: layerOL.values_._layer.id + '.' + newFeature.meta.id,\n                sourceTitle: layerOL.values_.title,\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n              };\n              clickedFeatures.push(newFeature);\n            } else {\n              const newFeature = featureFromOl(\n                featureOL,\n                this.map.projection,\n                layerOL\n              );\n              newFeature.meta = {\n                id: layerOL.values_._layer.id + '.' + newFeature.meta.id,\n                sourceTitle: layerOL.values_.title,\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n              };\n              clickedFeatures.push(newFeature);\n            }\n          }\n        },\n        {\n          hitTolerance: this.queryFeaturesHitTolerance || 0,\n          layerFilter: this.queryFeaturesCondition\n            ? this.queryFeaturesCondition\n            : olLayerFeatureIsQueryable\n        }\n      );\n    } else if (event.type === 'boxend') {\n      const target = event.target as any;\n      const dragExtent = target.getGeometry().getExtent();\n      this.map.layers\n        .filter(layerIsQueryable)\n        .filter(layer => layer instanceof VectorLayer && layer.visible)\n        .map(layer => {\n          const featuresOL = layer.dataSource.ol as olVectorSource<OlGeometry>;\n          featuresOL.forEachFeatureIntersectingExtent(dragExtent, (olFeature: any) => {\n            const newFeature: Feature = featureFromOl(olFeature, this.map.projection, layer.ol);\n            newFeature.meta = {\n              id: layer.id + '.' + olFeature.getId(),\n              icon: olFeature.values_._icon,\n              sourceTitle: layer.title,\n              alias: this.queryService.getAllowedFieldsAndAlias(layer),\n              title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n            };\n            clickedFeatures.push(newFeature);\n          });\n        });\n    }\n\n\n    return of(clickedFeatures);\n  }\n\n  /**\n   * Cancel ongoing requests, if any\n   */\n  private cancelOngoingQueries() {\n    this.queries$$.forEach((sub: Subscription) => sub.unsubscribe());\n    this.queries$$ = [];\n  }\n\n  /**\n   * Add a drag box interaction and, on drag box end, select features\n   */\n  private addDragBoxInteraction() {\n    let olDragSelectInteractionOnQuery;\n    const olInteractions = this.map.ol.getInteractions().getArray();\n\n    // There can only be one dragbox interaction, so find the current one, if any\n    // Don't keep a reference to the current dragbox because we don't want\n    // to remove it when this startegy is deactivated\n    for (const olInteraction of olInteractions) {\n      if (olInteraction instanceof OlDragSelectInteraction) {\n        olDragSelectInteractionOnQuery = olInteraction;\n        break;\n      }\n    }\n    // If no drag box interaction is found, create a new one and add it to the map\n    if (olDragSelectInteractionOnQuery === undefined) {\n      olDragSelectInteractionOnQuery = new OlDragSelectInteraction({\n        condition: ctrlKeyDown\n      });\n      this.map.ol.addInteraction(olDragSelectInteractionOnQuery);\n      this.olDragSelectInteraction = olDragSelectInteractionOnQuery;\n    }\n\n    this.olDragSelectInteractionEndKey = olDragSelectInteractionOnQuery.on(\n      'boxend',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Remove drag box interaction\n   */\n  private removeDragBoxInteraction() {\n    if (this.olDragSelectInteractionEndKey !== undefined) {\n      unByKey(this.olDragSelectInteractionEndKey);\n    }\n    if (this.olDragSelectInteraction !== undefined) {\n      this.map.ol.removeInteraction(this.olDragSelectInteraction);\n    }\n    this.olDragSelectInteraction = undefined;\n  }\n}\n","import { Observable } from 'rxjs';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { StorageService } from '@igo2/core';\nimport { SearchResult } from '../search.interfaces';\nimport {\n  SearchSourceOptions,\n  TextSearchOptions,\n  ReverseSearchOptions,\n  SearchSourceSettings\n} from './source.interfaces';\n\n/**\n * Base search source class\n */\nexport class SearchSource {\n  /**\n   * Search source ID\n   * @internal\n   */\n  static id = '';\n\n  /**\n   * Search source type\n   * @internal\n   */\n  static type = '';\n\n  /**\n   * Search source options\n   * @internal\n   */\n  protected options: SearchSourceOptions;\n\n  /**\n   * Get search source's id\n   * @returns Search source's id\n   */\n  getId(): string {\n    throw new Error('You have to implement the method \"getId\".');\n  }\n  /**\n   * Get search source's type\n   * @returns Search source's type\n   */\n  getType(): string {\n    throw new Error('You have to implement the method \"getType\".');\n  }\n\n  /**\n   * Get search source's default options\n   * @returns Search source default options\n   */\n  protected getDefaultOptions(): SearchSourceOptions {\n    throw new Error('You have to implement the method \"getDefaultOptions\".');\n  }\n\n  /**\n   * Search source's title\n   */\n  get title(): string {\n    return this.options.title;\n  }\n\n  /**\n   * Whether the search source is available\n   */\n  get available(): boolean {\n    return this.options.available !== false;\n  }\n\n  /**\n   * Whether the search source is enabled\n   */\n  set enabled(value: boolean) {\n    this.options.enabled = value;\n  }\n  get enabled(): boolean {\n    return this.available && this.options.enabled !== false;\n  }\n\n  get showInPointerSummary(): boolean {\n    const showInPointerSummary = this.options.showInPointerSummary;\n    return showInPointerSummary ? showInPointerSummary : false;\n  }\n\n  get showInSettings(): boolean {\n    const showInSettings = this.options.showInSettings;\n    return showInSettings === undefined ? true : showInSettings;\n  }\n\n  /**\n   * Search url\n   */\n  get searchUrl(): string {\n    return this.options.searchUrl;\n  }\n\n  /**\n   * Search query params\n   */\n  get params(): { [key: string]: string } {\n    return this.options.params === undefined ? {} : this.options.params;\n  }\n\n  /**\n   * Search settings\n   */\n  get settings(): SearchSourceSettings[] {\n    return this.options.settings === undefined ? [] : this.options.settings;\n  }\n\n  /**\n   * Set params from selected settings\n   */\n  setParamFromSetting(setting: SearchSourceSettings, saveInStorage = true) {\n    switch (setting.type) {\n      case 'radiobutton':\n        setting.values.forEach(conf => {\n          if (conf.enabled) {\n            this.options.params = Object.assign(this.options.params || {}, {\n              [setting.name]: conf.value\n            });\n          }\n        });\n        break;\n      case 'checkbox':\n        let confValue = '';\n        setting.values\n          .filter(s => s.available !== false)\n          .forEach(conf => {\n            if (conf.enabled) {\n              confValue += conf.value + ',';\n            }\n          });\n        confValue = confValue.slice(0, -1);\n        this.options.params = Object.assign(this.options.params || {}, {\n          [setting.name]: confValue\n        });\n        break;\n    }\n\n    if (saveInStorage && this.storageService) {\n      this.storageService.set(\n        this.getId() + '.options',\n        {params: this.options.params}\n      );\n    }\n  }\n\n  /**\n   * Search results display order\n   */\n  get displayOrder(): number {\n    return this.options.order === undefined ? 99 : this.options.order;\n  }\n\n  constructor(options: SearchSourceOptions, private storageService?: StorageService) {\n    this.options = options;\n    if (this.storageService) {\n      const storageOptions = this.storageService.get(\n        this.getId() + '.options'\n      ) as object;\n      if (storageOptions) {\n        this.options = ObjectUtils.mergeDeep(this.options, storageOptions);\n      }\n    }\n\n    this.options = ObjectUtils.mergeDeep(this.getDefaultOptions(), this.options);\n\n\n    // Set Default Params from Settings\n    this.settings.forEach(setting => {\n      this.setParamFromSetting(setting, false);\n    });\n  }\n\n  /**\n   * Get hashtags valid\n   * @param hashtag hashtag from query\n   */\n  getHashtagsValid(term: string, settingsName: string): string[] {\n    const hashtags = term.match(/(#[A-Za-z]+)/g);\n    if (!hashtags) {\n      return undefined;\n    }\n\n    const searchSourceSetting = this.getSettingsValues(settingsName);\n    const hashtagsValid = [];\n    hashtags.forEach(hashtag => {\n      searchSourceSetting.values.forEach(conf => {\n        const hashtagKey = hashtag.substring(1);\n        if (typeof conf.value === 'string') {\n          const types = conf.value\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '')\n            .split(',');\n          const index = types.indexOf(\n            hashtagKey\n              .toLowerCase()\n              .normalize('NFD')\n              .replace(/[\\u0300-\\u036f]/g, '')\n          );\n          if (index !== -1) {\n            hashtagsValid.push(types[index]);\n          }\n        }\n        if (conf.hashtags && conf.hashtags.indexOf(hashtagKey.toLowerCase()) !== -1) {\n          hashtagsValid.push(conf.value);\n        }\n      });\n    });\n\n    return hashtagsValid.filter((a, b) => hashtagsValid.indexOf(a) === b);\n  }\n\n  getSettingsValues(search: string): SearchSourceSettings {\n    return this.getDefaultOptions().settings.find(\n      (value: SearchSourceSettings) => {\n        return value.name === search;\n      }\n    );\n  }\n}\n\n/**\n * Search sources that allow searching by text implement this class\n */\nexport interface TextSearch {\n  /**\n   * Search by text\n   * @param term Text\n   * @param options Optional: TextSearchOptions\n   * @returns Observable or search results\n   */\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult[]>;\n}\n\n/**\n * Search sources that allow searching by coordinates implement this class\n */\nexport interface ReverseSearch {\n  /**\n   * Search by text\n   * @param lonLat Coordinates\n   * @param options Optional: ReverseSearchOptions\n   * @returns Observable or search results\n   */\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): Observable<SearchResult[]>;\n}\n","import { Injectable, Inject } from '@angular/core';\n\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport { SearchSource } from '../../search/shared/sources/source';\nimport { SearchSourceOptions } from '../../search/shared/sources/source.interfaces';\n/**\n * Map search source. For now it has no search capability. All it does\n * is act as a placeholder for the map query results' \"search source\".\n */\n@Injectable()\nexport class QuerySearchSource extends SearchSource {\n  static id = 'map';\n  static type = FEATURE;\n\n  constructor(@Inject('options') options: SearchSourceOptions) {\n    super(options);\n  }\n\n  getId(): string {\n    return QuerySearchSource.id;\n  }\n\n  getType(): string {\n    return QuerySearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Carte'\n    };\n  }\n}\n","export class GoogleLinks {\n  static getGoogleMapsCoordLink(lon, lat) {\n    return 'https://www.google.com/maps?q=' + lat + ',' + lon;\n  }\n\n  static getGoogleStreetViewLink(lon, lat) {\n    return 'https://www.google.com/maps?q=&layer=c&cbll=' + lat + ',' + lon;\n  }\n\n  static getGoogleMapsNameLink(name) {\n    const encodedName = encodeURI(name);\n    return 'https://www.google.com/maps?q=' + encodedName;\n  }\n}\n","import type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olstyle from 'ol/style';\nimport olFeature from 'ol/Feature';\nimport { asArray as ColorAsArray } from 'ol/color';\n\nimport { createOverlayMarkerStyle } from '../overlay/shared/overlay-marker-style.utils';\nimport { createOverlayDefaultStyle } from '../overlay/shared/overlay.utils';\nimport { FeatureCommonVectorStyleOptions } from './commonVectorStyle.interface';\nimport { Feature } from '../feature';\n\n\n/**\n * Generate a style for selected features\n * @param feature The feature to generate the style\n * @returns A olStyle\n */\nexport function getCommonVectorSelectedStyle(\n  {\n    feature,\n    markerColor = [0, 161, 222],\n    markerOpacity = 1,\n    markerOutlineColor = [0, 255, 255],\n    fillColor,\n    fillOpacity = 0.15,\n    strokeColor = [0, 255, 255],\n    strokeOpacity = 0.5,\n    strokeWidth = 4\n  }: FeatureCommonVectorStyleOptions): olstyle.Style {\n\n  return getCommonVectorStyle({\n    feature,\n    markerColor,\n    markerOpacity,\n    markerOutlineColor,\n    fillColor,\n    fillOpacity,\n    strokeColor,\n    strokeOpacity,\n    strokeWidth\n  });\n}\n\n/**\n * Generate a basic style for features\n * @param feature The feature to generate the style\n * @returns A olStyle\n */\nexport function getCommonVectorStyle(\n  {\n    feature,\n    markerColor = [0, 161, 222],\n    markerOpacity = 0.5,\n    markerOutlineColor,\n    fillColor = [0, 161, 222],\n    fillOpacity = 0.15,\n    strokeColor = [0, 161, 222],\n    strokeOpacity = 0.5,\n    strokeWidth = 2\n  }: FeatureCommonVectorStyleOptions): olstyle.Style {\n\n  const isOlFeature = feature instanceof olFeature;\n  let geometry;\n  let text;\n  if (isOlFeature) {\n    feature = feature as olFeature<OlGeometry>;\n    geometry = feature.getGeometry();\n  } else {\n    feature = feature as Feature;\n    geometry = feature.geometry;\n    text = feature.meta.mapTitle;\n  }\n  const geometryType = isOlFeature ? geometry.getType() : geometry.type;\n\n  if (!geometry || geometryType === 'Point') {\n    const markerColorAsArray = ColorAsArray(markerColor).slice(0);\n    const markerColorRGB = markerColorAsArray.slice(0, 3);\n\n    if (markerColorAsArray.length === 4 &&\n        (typeof markerColor !== 'string' || /^#[0-9A-F]{8}$/i.test(markerColor as string))) {\n      markerOpacity = markerColorAsArray[3];\n    }\n\n    return createOverlayMarkerStyle({\n      text,\n      opacity: markerOpacity,\n      markerOutlineColor,\n      markerColor: markerColorRGB\n    });\n  } else {\n    const fillWithOpacity = ColorAsArray(fillColor).slice(0);\n    const strokeWithOpacity = ColorAsArray(strokeColor).slice(0);\n\n    if (!(fillWithOpacity.length === 4 &&\n        (typeof fillColor !== 'string' || /^#[0-9A-F]{8}$/i.test(fillColor as string)))) {\n      fillWithOpacity[3] = fillOpacity;\n    }\n\n    if (!(strokeWithOpacity.length === 4 &&\n        (typeof strokeColor !== 'string' || /^#[0-9A-F]{8}$/i.test(strokeColor as string)))) {\n      strokeWithOpacity[3] = strokeOpacity;\n    }\n\n    return createOverlayDefaultStyle({\n      text,\n      strokeWidth,\n      strokeColor: strokeWithOpacity,\n      fillColor: fillWithOpacity\n    });\n  }\n}\n","export class OsmLinks {\n  static getOpenStreetMapLink(lon, lat, zoom: number = 17) {\n    // return 'https://www.google.com/maps?q=' + lat + ',' + lon;\n    return `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}#map=${zoom}/${lat}/${lon}`;\n  }\n\n  static getOpenStreetCamLink(lon, lat, zoom: number = 17) {\n    return `https://openstreetcam.org/map/@${lat},${lon},${zoom}z`;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\nimport { EMPTY, Observable, of, zip } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\n\nimport { uuid, ObjectUtils } from '@igo2/utils';\nimport { LanguageService, MessageService, ConfigService } from '@igo2/core';\nimport {\n  CapabilitiesService,\n  WMSDataSourceOptions,\n  WMSDataSourceOptionsParams,\n  WMTSDataSourceOptions,\n  ArcGISRestDataSourceOptions\n} from '../../datasource';\nimport { LayerOptions, ImageLayerOptions } from '../../layer';\nimport { getResolutionFromScale } from '../../map';\n\nimport {\n  CatalogItem,\n  CatalogItemLayer,\n  CatalogItemGroup\n} from './catalog.interface';\nimport { Catalog, CatalogFactory, CompositeCatalog } from './catalog.abstract';\nimport { CatalogItemType, TypeCatalog } from './catalog.enum';\nimport { QueryFormat } from '../../query';\nimport { generateIdFromSourceOptions } from '../../utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CatalogService {\n  constructor(\n    private http: HttpClient,\n    private config: ConfigService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private capabilitiesService: CapabilitiesService\n  ) {}\n\n  loadCatalogs(): Observable<Catalog[]> {\n    const contextConfig = this.config.getConfig('context') || {};\n    const catalogConfig = this.config.getConfig('catalog') || {};\n    const apiUrl = catalogConfig.url || contextConfig.url;\n    const catalogsFromConfig = catalogConfig.sources || [];\n\n    const observables$ = [];\n\n    if (apiUrl) {\n      // Base layers catalog\n      if (catalogConfig.baseLayers) {\n        const translate = this.languageService.translate;\n        const title = translate.instant('igo.geo.catalog.baseLayers');\n        const baseLayersCatalog = [\n          {\n            id: 'catalog.baselayers',\n            title,\n            url: `${apiUrl}/baselayers`,\n            type: 'baselayers'\n          }\n        ];\n        observables$.push(of(baseLayersCatalog));\n      }\n\n      // Catalogs from API\n      const catalogsFromApi$ = this.http\n        .get<Catalog[]>(`${apiUrl}/catalogs`)\n        .pipe(\n          map((catalogs) =>\n            catalogs.map((c: any) => Object.assign(c, c.options))\n          ),\n          catchError((_response: HttpErrorResponse) => EMPTY)\n        );\n      observables$.push(catalogsFromApi$);\n    }\n\n    // Catalogs from config\n    if (catalogsFromConfig.length > 0) {\n      observables$.push(\n        of(catalogsFromConfig).pipe(\n          map((catalogs: Catalog[]) =>\n            catalogs.map((c) => {\n              if (!c.id) {\n                c.id = uuid();\n              }\n              return c;\n            })\n          )\n        )\n      );\n    }\n\n    return zip(...observables$).pipe(\n      map((catalogs: Catalog[][]) => [].concat.apply([], catalogs))\n    ) as Observable<Catalog[]>;\n  }\n\n  loadCatalogItems(catalog: Catalog): Observable<CatalogItem[]> {\n    let newCatalog: Catalog;\n    newCatalog = CatalogFactory.createInstanceCatalog(catalog, this);\n    return newCatalog.collectCatalogItems();\n  }\n\n  loadCatalogBaseLayerItems(catalog: Catalog): Observable<CatalogItemGroup[]> {\n    return this.getCatalogBaseLayersOptions(catalog).pipe(\n      map((layersOptions: LayerOptions[]) => {\n        const items = layersOptions.map((layerOptions: LayerOptions) => {\n          return {\n            id: generateIdFromSourceOptions(layerOptions.sourceOptions),\n            title: layerOptions.title,\n            type: CatalogItemType.Layer,\n            externalProvider: catalog.externalProvider,\n            options: layerOptions\n          } as CatalogItemLayer;\n        });\n        return [\n          {\n            id: 'catalog.group.baselayers',\n            type: CatalogItemType.Group,\n            externalProvider: catalog.externalProvider,\n            title: catalog.title,\n            items\n          }\n        ];\n      })\n    );\n  }\n\n  private getCatalogBaseLayersOptions(\n    catalog: Catalog\n  ): Observable<LayerOptions[]> {\n    return this.http.get<LayerOptions[]>(catalog.url);\n  }\n\n  loadCatalogWMSLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => {\n        const items = [];\n        if (!capabilities) {\n          return items;\n        }\n        if (capabilities.Service && capabilities.Service.Abstract && capabilities.Service.Abstract.length) {\n          catalog.abstract = capabilities.Service.Abstract;\n        }\n        const finalLayers = [];\n        this.flattenWmsCapabilities(capabilities.Capability.Layer, 0, finalLayers, catalog.groupSeparator);\n        const capabilitiesCapabilityLayer = Object.assign({}, capabilities.Capability.Layer);\n        capabilitiesCapabilityLayer.Layer = finalLayers.filter(f => f.Layer.length !== 0);\n        this.includeRecursiveItems(\n          catalog,\n          capabilitiesCapabilityLayer,\n          items\n        );\n        return items;\n      })\n    );\n  }\n\n  flattenWmsCapabilities(parent, level = 0, finalLayers, separator = ' / ') {\n    if (!finalLayers.includes(parent.Title)) {\n        const modifiedParent = Object.assign({}, parent);\n        modifiedParent.Layer = [];\n        finalLayers.push(modifiedParent);\n    }\n    for (const layer of parent.Layer) {\n        const modifiedLayer = Object.assign({}, layer);\n        if (level > 0) {\n          modifiedLayer.Title = parent.Title + separator + layer.Title;\n        }\n        if (layer.Layer) {\n            this.flattenWmsCapabilities(modifiedLayer, level + 1, finalLayers, separator);\n        } else {\n            finalLayers.find(ff => ff.Title === parent.Title).Layer.push(layer);\n         }\n    }\n}\n\n  loadCatalogWMTSLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => this.getWMTSItems(catalog, capabilities))\n    );\n  }\n\n  loadCatalogArcGISRestItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => {\n        return this.getArcGISRESTItems(catalog, capabilities);\n      })\n    );\n  }\n\n  loadCatalogCompositeLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    const compositeCatalog = (catalog as CompositeCatalog).composite;\n\n    const catalogsFromInstance = [] as Catalog[];\n    compositeCatalog.map((component: Catalog) => {\n      component.sortDirection = catalog.sortDirection; // propagate sortDirection with parent value\n      catalogsFromInstance.push(\n        CatalogFactory.createInstanceCatalog(component, this)\n    );\n  }\n    );\n\n    // get CatalogItems for each original Catalog-----------------------------------------------------\n    const request1$ = [];\n    catalogsFromInstance.map((component: Catalog) =>\n      request1$.push(component.collectCatalogItems())\n    );\n\n    // integrate imposed group -----------------------------------------------------\n    let request2$ = [];\n\n    function flatDeepLayer(arr) {\n      return arr.reduce(\n        (acc, val) =>\n          acc.concat(\n            val.type === CatalogItemType.Group ? flatDeepLayer(val.items) : val\n          ),\n        []\n      );\n    }\n\n    if (\n      Object.keys(compositeCatalog).find((k) => compositeCatalog[k].groupImpose)\n    ) {\n      const pushImposeGroup = (item, index) => {\n        const c = catalogsFromInstance[index];\n        const outGroupImpose = Object.assign({}, c.groupImpose);\n        outGroupImpose.address = c.id;\n        outGroupImpose.type = CatalogItemType.Group;\n        outGroupImpose.externalProvider = c.externalProvider;\n        if (outGroupImpose.sortDirection === undefined) {\n          outGroupImpose.sortDirection = c.sortDirection;\n        }\n        outGroupImpose.items = [];\n\n        const flatLayer = flatDeepLayer(item);\n        flatLayer.map(\n          (v) => (v.address = `${outGroupImpose.address}.${outGroupImpose.id}`)\n        );\n        outGroupImpose.items = flatLayer;\n\n        return outGroupImpose;\n      };\n\n      request2$ = request1$.map((obs, idx) =>\n        obs.pipe(\n          map((items) =>\n            compositeCatalog[idx].groupImpose\n              ? pushImposeGroup(items, idx)\n              : items\n          )\n        )\n      );\n    } else {\n      request2$ = request1$;\n    }\n\n    // concat Group -----------------------------------------------------\n    const request3$ = zip(...request2$).pipe(\n      map(\n        (output: CatalogItem[]) => [].concat(...output) // [].concat.apply([], result1\n      )\n    );\n\n    // merge Group (first level only) -----------------------------------------------------\n    const groupByGroupId = (data, keyFn) =>\n      data.reduce((acc, group) => {\n        const groupId = keyFn(group);\n        const ind = acc.find((x) => x.id === groupId);\n\n        if (!ind) {\n          acc[acc.length] = group;\n        } else {\n          const ix = acc.indexOf(ind);\n          if (acc[ix].address.split('|').indexOf(group.address) === -1) {\n            acc[ix].address = `${acc[ix].address}|${group.address}`;\n          }\n          acc[ix].items.push(...group.items);\n        }\n        return acc;\n      }, []);\n\n    // merge Layer for each Level (catalog, group(recursive))\n    const recursiveGroupByLayerAddress = (items, keyFn) =>\n      items.reduce((acc, item, idx, arr) => {\n        const layerTitle = keyFn(item);\n        const outItem = Object.assign({}, item);\n\n        if (item.type === CatalogItemType.Layer) {\n          // same title, same address => result: only one item is keep\n\n          // same title, address diff\n          const indicesMatchTitle = [];\n          const diffAddress = arr.filter((x, i) => {\n            let bInd = false;\n            if (x.title === layerTitle && x.type === CatalogItemType.Layer) {\n              if (i !== idx && x.address !== item.address) {\n                bInd = true;\n              }\n              indicesMatchTitle.push(i);\n            }\n            return bInd;\n          }); // $& i !== idx\n\n          if (diffAddress.length > 0) {\n            const nPosition = indicesMatchTitle.findIndex((x) => x === idx) + 1;\n            outItem.title = `${item.title} (${nPosition})`; // source: ${item.address.split('.')[0]}\n          }\n\n          const exist = acc.find(\n            (x) => x.title === outItem.title && x.type === CatalogItemType.Layer\n          );\n          if (!exist) {\n            acc[acc.length] = outItem;\n          }\n        } else if (item.type === CatalogItemType.Group) {\n          outItem.items = recursiveGroupByLayerAddress(\n            item.items,\n            (layer) => layer.title\n          );\n          acc[acc.length] = outItem;\n        }\n\n        return acc;\n      }, []);\n\n    const request4$ = request3$.pipe(\n      map((output) => groupByGroupId(output, (group) => group.id)),\n      map((output) => [].concat(...output)),\n      map((data) => recursiveGroupByLayerAddress(data, (layer) => layer.title))\n    );\n\n    return request4$;\n  }\n\n  private getCatalogCapabilities(catalog: Catalog): Observable<any> {\n    const sType: string = TypeCatalog[catalog.type as string];\n    return this.capabilitiesService\n      .getCapabilities(sType as any, catalog.url, catalog.version)\n      .pipe(\n        catchError((e) => {\n          const title = this.languageService.translate.instant(\n            'igo.geo.catalog.unavailableTitle'\n          );\n          const message =\n          catalog.title ? this.languageService.translate.instant(\n            'igo.geo.catalog.unavailable',\n            { value: catalog.title }\n          ) : this.languageService.translate.instant(\n            'igo.geo.catalog.someUnavailable'\n          );\n\n          this.messageService.error(message, title);\n          console.error(e);\n          return of(undefined);\n        })\n      );\n  }\n\n  private prepareCatalogItemLayer(layer, idParent, layersQueryFormat, catalog) {\n    const configuredQueryFormat = this.retrieveLayerInfoFormat(\n      layer.Name,\n      layersQueryFormat\n    );\n\n    const metadata = layer.DataURL ? layer.DataURL[0] : undefined;\n    const legendOptions =\n      catalog.showLegend && layer.Style\n        ? this.capabilitiesService.getStyle(layer.Style)\n        : undefined;\n\n    const params = Object.assign({}, catalog.queryParams, {\n      LAYERS: layer.Name,\n      VERSION: catalog.version\n    } as WMSDataSourceOptionsParams);\n\n    const baseSourceOptions = {\n      type: 'wms',\n      url: catalog.url,\n      crossOrigin: catalog.setCrossOriginAnonymous ? 'anonymous' : undefined,\n      queryFormat: configuredQueryFormat,\n      queryHtmlTarget:\n        configuredQueryFormat === QueryFormat.HTML ||\n        configuredQueryFormat === QueryFormat.HTMLGML2\n          ? 'iframe'\n          : undefined,\n      optionsFromCapabilities: true\n    };\n\n    const sourceOptions = Object.assign(\n      {},\n      baseSourceOptions,\n      catalog.sourceOptions,\n      { params }\n    ) as WMSDataSourceOptions;\n\n    let layerTitle;\n    if (catalog.forcedProperties) {\n      for (const property of catalog.forcedProperties) {\n        if (layer.Name === property.layerName && property.title) {\n          layerTitle = property.title;\n        }\n      }\n    }\n\n    let abstract;\n    if (layer.Abstract) {\n      abstract = layer.Abstract;\n    } else if (!layer.Abstract && catalog.abstract) {\n      abstract = catalog.abstract;\n    }\n\n    const layerPrepare = {\n      id: generateIdFromSourceOptions(sourceOptions),\n      type: CatalogItemType.Layer,\n      title: layerTitle !== undefined ? layerTitle : layer.Title,\n      address: idParent,\n      externalProvider: catalog.externalProvider || false,\n      options: {\n        maxResolution: getResolutionFromScale(layer.MaxScaleDenominator),\n        minResolution: getResolutionFromScale(layer.MinScaleDenominator),\n        metadata: {\n          url: metadata ? metadata.OnlineResource : undefined,\n          extern: metadata ? true : undefined,\n          abstract,\n          type: baseSourceOptions.type\n        },\n        legendOptions,\n        tooltip: { type: catalog.tooltipType },\n        sourceOptions\n      }\n    } as CatalogItem;\n\n    return ObjectUtils.removeUndefined(layerPrepare);\n  }\n\n  private prepareCatalogItemGroup(\n    itemListIn,\n    regexes,\n    idGroup,\n    layersQueryFormat,\n    catalog\n  ) {\n    const groupPrepare = {\n      id: idGroup,\n      type: CatalogItemType.Group,\n      title: itemListIn.Title,\n      address: catalog.id,\n      externalProvider: catalog.externalProvider || false,\n      sortDirection: catalog.sortDirection, // propagate sortDirection\n      items: itemListIn.Layer.reduce((items: CatalogItem[], layer: any) => {\n        if (layer.Layer !== undefined) {\n          // recursive, check next level\n          const idGroupItemNextLevel =\n            idGroup + `.group.${layer.Name || layer.Layer[0].Name}`;\n          const groupItem: CatalogItemGroup = this.prepareCatalogItemGroup(\n            layer,\n            regexes,\n            idGroupItemNextLevel,\n            layersQueryFormat,\n            catalog\n          );\n\n          items.push(groupItem);\n        } else {\n          if (this.testLayerRegexes(layer.Name, regexes) === false) {\n            return items;\n          }\n\n          const layerItem: CatalogItemLayer<ImageLayerOptions> = this.prepareCatalogItemLayer(\n            layer,\n            idGroup,\n            layersQueryFormat,\n            catalog\n          );\n\n          items.push(layerItem);\n        }\n        return items;\n      }, [])\n    };\n    return groupPrepare;\n  }\n\n  private includeRecursiveItems(\n    catalog: Catalog,\n    itemListIn: any,\n    itemsPrepare: CatalogItem[],\n    loopLevel: number = 0\n  ) {\n    // Dig all levels until last level (layer object are not defined on last level)\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n    if (!itemListIn.Layer) {\n      return;\n    }\n\n    for (const item of itemListIn.Layer) {\n      if (item.Layer !== undefined) {\n        // recursive, check next level\n        this.includeRecursiveItems(catalog, item, itemsPrepare, loopLevel + 1);\n        continue;\n      }\n\n      const layersQueryFormat = this.findCatalogInfoFormat(catalog);\n\n      // group(with layers) and layer(without group) level 1\n      if (loopLevel !== 0) {\n        // TODO: Slice that into multiple methods\n        // Define object of group layer\n        const idGroupItem = `catalog.group.${itemListIn.Name || item.Name}`;\n        const groupItem = this.prepareCatalogItemGroup(\n          itemListIn,\n          regexes,\n          idGroupItem,\n          layersQueryFormat,\n          catalog\n        );\n\n        if (groupItem.items.length !== 0) {\n          itemsPrepare.push(groupItem);\n        }\n\n        // Break the group (don't add a group of layer for each of their layer!)\n        break;\n      } else {\n        // layer without group\n        if (this.testLayerRegexes(item.Name, regexes) !== false) {\n          const layerItem = this.prepareCatalogItemLayer(\n            item,\n            catalog.id,\n            layersQueryFormat,\n            catalog\n          );\n          itemsPrepare.push(layerItem);\n        }\n      }\n    }\n  }\n\n  private getWMTSItems(\n    catalog,\n    capabilities: { [key: string]: any }\n  ): CatalogItemLayer[] {\n    if (!capabilities) {\n      return [];\n    }\n    const layers = capabilities.Contents.Layer;\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n\n    if (\n      capabilities.ServiceIdentification &&\n      capabilities.ServiceIdentification.Abstract &&\n      capabilities.ServiceIdentification.Abstract.length) {\n      catalog.abstract = capabilities.ServiceIdentification.Abstract;\n    }\n\n    return layers\n      .map((layer: any) => {\n        let forcedTitle;\n        if (catalog.forcedProperties) {\n          for (const property of catalog.forcedProperties) {\n            if (layer.Title === property.layerName && property.title) {\n              forcedTitle = property.title;\n            }\n          }\n        }\n        if (this.testLayerRegexes(layer.Identifier, regexes) === false) {\n          return undefined;\n        }\n        const params = Object.assign({}, catalog.queryParams, {\n          version: '1.0.0'\n        });\n        const baseSourceOptions = {\n          type: 'wmts',\n          url: catalog.url,\n          crossOrigin: catalog.setCrossOriginAnonymous\n            ? 'anonymous'\n            : undefined,\n          layer: layer.Identifier,\n          matrixSet: catalog.matrixSet,\n          optionsFromCapabilities: true,\n          requestEncoding: catalog.requestEncoding || 'KVP',\n          style: 'default'\n        } as WMTSDataSourceOptions;\n        const sourceOptions = Object.assign(\n          {},\n          baseSourceOptions,\n          catalog.sourceOptions,\n          { params }\n        ) as WMTSDataSourceOptions;\n\n        return ObjectUtils.removeUndefined({\n          id: generateIdFromSourceOptions(sourceOptions),\n          type: CatalogItemType.Layer,\n          title: forcedTitle !== undefined ? forcedTitle : layer.Title,\n          address: catalog.id,\n          externalProvider: catalog.externalProvider,\n          options: {\n            sourceOptions,\n            metadata: {\n              url: undefined,\n              extern: undefined,\n              abstract: catalog.abstract,\n              type: baseSourceOptions.type\n            }\n          }\n        } as CatalogItem);\n      })\n      .filter((item: CatalogItemLayer | undefined) => item !== undefined);\n  }\n\n  private getArcGISRESTItems(\n    catalog,\n    capabilities\n  ): CatalogItemLayer[] {\n    if (!capabilities) {\n      return [];\n    }\n    const layers =\n    !capabilities.layers ? [] : capabilities.layers.filter(layer => !layer.type || layer.type === 'Feature Layer');\n    if (!capabilities.layers) {\n      this.messageService.error(\n        this.languageService.translate.instant('igo.geo.catalog.someUnavailable'),\n        this.languageService.translate.instant('igo.geo.catalog.unavailableTitle')\n      );\n    }\n\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n\n    let abstract;\n    if (capabilities.serviceDescription && capabilities.serviceDescription.length) {\n      const regex = /(<([^>]+)>)/ig;\n      abstract = capabilities.serviceDescription.replace(regex, '');\n    }\n\n    return layers\n      .map((layer: any) => {\n        let forcedTitle;\n        if (catalog.forcedProperties) {\n          for (const property of catalog.forcedProperties) {\n            if (layer.name === property.layerName && property.title) {\n              forcedTitle = property.title;\n            }\n          }\n        }\n        if (this.testLayerRegexes(layer.id, regexes) === false) {\n          return undefined;\n        }\n        const baseSourceOptions = {\n          type: TypeCatalog[catalog.type],\n          url: catalog.url,\n          crossOrigin: catalog.setCrossOriginAnonymous\n            ? 'anonymous'\n            : undefined,\n          layer: layer.id as string,\n          queryable: true,\n          queryFormat: 'esrijson',\n          matrixSet: catalog.matrixSet,\n          optionsFromCapabilities: true,\n          style: 'default'\n        } as ArcGISRestDataSourceOptions;\n        const sourceOptions = Object.assign(\n          {},\n          baseSourceOptions,\n          catalog.sourceOptions\n        ) as ArcGISRestDataSourceOptions;\n        return ObjectUtils.removeUndefined({\n          id: generateIdFromSourceOptions(sourceOptions),\n          type: CatalogItemType.Layer,\n          title: forcedTitle !== undefined ? forcedTitle : layer.name,\n          externalProvider: catalog.externalProvider,\n          address: catalog.id,\n          options: {\n            sourceOptions,\n            minResolution: getResolutionFromScale(layer.maxScale),\n            maxResolution: getResolutionFromScale(layer.minScale),\n            metadata: {\n              url: undefined,\n              extern: undefined,\n              abstract,\n              type: baseSourceOptions.type\n            },\n            title: forcedTitle !== undefined ? forcedTitle : layer.name\n          }\n        } as CatalogItem);\n      })\n      .filter((item: CatalogItemLayer | undefined) => item !== undefined);\n  }\n\n  private testLayerRegexes(layerName: string, regexes: RegExp[]): boolean {\n    if (regexes.length === 0) {\n      return true;\n    }\n    return regexes.find((regex: RegExp) => regex.test(layerName)) !== undefined;\n  }\n\n  private retrieveLayerInfoFormat(\n    layerNameFromCatalog: string,\n    layersQueryFormat: { layer: string; queryFormat: QueryFormat }[]\n  ): QueryFormat {\n    const currentLayerInfoFormat = layersQueryFormat.find(\n      (f) => f.layer === layerNameFromCatalog\n    );\n    const baseInfoFormat = layersQueryFormat.find((f) => f.layer === '*');\n    let queryFormat: QueryFormat;\n    if (currentLayerInfoFormat) {\n      queryFormat = currentLayerInfoFormat.queryFormat;\n    } else if (baseInfoFormat) {\n      queryFormat = baseInfoFormat.queryFormat;\n    }\n    return queryFormat;\n  }\n\n  private findCatalogInfoFormat(\n    catalog: Catalog\n  ): { layer: string; queryFormat: QueryFormat }[] {\n    const layersQueryFormat: { layer: string; queryFormat: QueryFormat }[] = [];\n    if (!catalog.queryFormat) {\n      return layersQueryFormat;\n    }\n    Object.keys(catalog.queryFormat).forEach((configuredInfoFormat) => {\n      if (catalog.queryFormat[configuredInfoFormat] instanceof Array) {\n        catalog.queryFormat[configuredInfoFormat].forEach((layerName) => {\n          if (\n            !layersQueryFormat.find((specific) => specific.layer === layerName)\n          ) {\n            layersQueryFormat.push({\n              layer: layerName,\n              queryFormat: configuredInfoFormat as QueryFormat\n            });\n          }\n        });\n      } else {\n        if (\n          !layersQueryFormat.find(\n            (specific) =>\n              specific.layer === catalog.queryFormat[configuredInfoFormat]\n          )\n        ) {\n          layersQueryFormat.push({\n            layer: catalog.queryFormat[configuredInfoFormat],\n            queryFormat: configuredInfoFormat as QueryFormat\n          });\n        }\n      }\n    });\n    return layersQueryFormat;\n  }\n}\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-item [ngForOf]=\"store.view.all$() | async\">\n    <ng-container *ngIf=\"isGroup(item)\">\n      <igo-catalog-browser-group\n        [catalog]=\"catalog\"\n        [group]=\"item\"\n        [state]=\"store.state\"\n        [resolution]=\"resolution$ | async\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [collapsed]=\"(store.count === 1) ? false : true\"\n        [toggleCollapsed]=\"toggleCollapsedGroup\"\n        (addedChange)=\"onGroupAddedChange($event)\"\n        (layerAddedChange)=\"onLayerAddedChange($event)\">\n      </igo-catalog-browser-group>\n    </ng-container>\n\n    <ng-container *ngIf=\"isLayer(item)\">\n      <igo-catalog-browser-layer\n        igoListItem\n        [layer]=\"item\"\n        [resolution]=\"resolution$ | async\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [added]=\"store.state.get(item).added\"\n        (addedChange)=\"onLayerAddedChange($event)\">\n      </igo-catalog-browser-layer>\n    </ng-container>\n  </ng-template>\n</igo-list>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { zip, BehaviorSubject } from 'rxjs';\n\nimport { EntityStore, EntityStoreWatcher } from '@igo2/common';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { IgoMap } from '../../map';\n\nimport {\n  Catalog,\n  CatalogItem,\n  CatalogItemLayer,\n  CatalogItemGroup,\n  CatalogItemState,\n  CatalogItemType\n} from '../shared';\n\n/**\n * Component to browse a catalog's groups and layers and display them on a map.\n */\n@Component({\n  selector: 'igo-catalog-browser',\n  templateUrl: './catalog-browser.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogBrowserComponent implements OnInit, OnDestroy {\n  /**\n   * Catalog items store watcher\n   */\n  private watcher: EntityStoreWatcher<CatalogItem>;\n\n // private resolution$$: Subscription;\n\n  get resolution$(): BehaviorSubject<number> { return this.map.viewController.resolution$; }\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Store holding the catalog's items\n   */\n  @Input() store: EntityStore<CatalogItem, CatalogItemState>;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * Whether a group can be toggled when it's collapsed\n   */\n  @Input() toggleCollapsedGroup: boolean = true;\n\n  constructor(\n    private layerService: LayerService,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    const currentItems = this.map.layers.map((layer: Layer) => {\n      return {\n        id: layer.options.source.id,\n        title: layer.title,\n        type: CatalogItemType.Layer\n      };\n    });\n    this.store.state.updateMany(currentItems, { added: true }, true);\n    if (this.catalog && this.catalog.sortDirection !== undefined) {\n      this.store.view.sort({\n        direction: this.catalog.sortDirection,\n        valueAccessor: (item: CatalogItem) => item.title\n      });\n    }\n\n    const catalogShowLegend = this.catalog ? this.catalog.showLegend : false;\n    this.catalogAllowLegend = catalogShowLegend ? catalogShowLegend : this.catalogAllowLegend;\n\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n\n  }\n\n  ngOnDestroy() {\n    this.watcher.destroy();\n  }\n\n  /**\n   * @internal\n   */\n  isGroup(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Group;\n  }\n\n  /**\n   * @internal\n   */\n  isLayer(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Layer;\n  }\n\n  /**\n   * When a layer is added or removed, add or remove it from the map\n   * @internal\n   * @param event Layer added event\n   */\n  onLayerAddedChange(event: { added: boolean; layer: CatalogItemLayer }) {\n    const layer = event.layer;\n    this.store.state.update(layer, { added: event.added }, false);\n    event.added ? this.addLayerToMap(layer) : this.removeLayerFromMap(layer);\n  }\n\n  /**\n   * When a froup is added or removed, add or remove it from the map\n   * @internal\n   * @param event Group added event\n   */\n  onGroupAddedChange(event: { added: boolean; group: CatalogItemGroup }) {\n    const group = event.group;\n    this.store.state.update(group, { added: event.added }, false);\n    event.added ? this.addGroupToMap(group) : this.removeGroupFromMap(group);\n  }\n\n  /**\n   * Add layer to map\n   * @param layer Catalog layer\n   */\n  private addLayerToMap(layer: CatalogItemLayer) {\n    this.addLayersToMap([layer]);\n  }\n\n  /**\n   * Remove layer from map\n   * @param layer Catalog layer\n   */\n  private removeLayerFromMap(layer: CatalogItemLayer) {\n    this.removeLayersFromMap([layer]);\n  }\n\n  /**\n   * Add multiple layers to map\n   * @param layers Catalog layers\n   */\n  private addLayersToMap(layers: CatalogItemLayer[]) {\n    const layers$ = layers.map((layer: CatalogItemLayer) => {\n      if (!layer.options.sourceOptions.optionsFromApi) {\n        layer.options.sourceOptions.optionsFromApi = true;\n      }\n      return this.layerService.createAsyncLayer(layer.options);\n    });\n\n    zip(...layers$).subscribe((oLayers: Layer[]) => {\n      this.store.state.updateMany(layers, { added: true });\n      this.map.addLayers(oLayers);\n    });\n  }\n\n  /**\n   * Remove multiple layers from map\n   * @param layers Catalog layers\n   */\n  private removeLayersFromMap(layers: CatalogItemLayer[]) {\n    layers.forEach((layer: CatalogItemLayer) => {\n      this.store.state.update(layer, { added: false });\n      if (layer.options.baseLayer === true) {\n        const oLayer = this.map.getLayerById(layer.options.id);\n        if (oLayer !== undefined) {\n          this.map.removeLayer(oLayer);\n        }\n      } else {\n        const oLayer = this.map.getLayerById(layer.id);\n        if (oLayer !== undefined) {\n          this.map.removeLayer(oLayer);\n        }\n      }\n    });\n  }\n\n  /**\n   * Sort the layers by title. asc or desc.\n   * @internal\n   */\n  private sortCatalogItemsByTitle(items: CatalogItem[], direction) {\n    const returnItem = items.sort((a, b) => {\n      const titleA = a.title.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n      const titleB = b.title.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n\n      if (titleA < titleB) {\n        return -1;\n      }\n      if (titleA > titleB) {\n        return 1;\n      }\n      return 0;\n    });\n    switch (direction) {\n      case 'asc':\n        return returnItem;\n      case 'desc':\n        return returnItem.reverse();\n      default:\n        return items;\n    }\n  }\n\n  /**\n   * Add all the layers of a group to map\n   * @param group Catalog group\n   */\n  private addGroupToMap(group: CatalogItemGroup) {\n    let layers = group.items.filter((item: CatalogItem) => {\n      const added = this.store.state.get(item).added || false;\n      return this.isLayer(item) && added === false;\n    });\n    if (group.sortDirection !== undefined) {\n      layers = this.sortCatalogItemsByTitle(layers, group.sortDirection);\n    }\n    this.addLayersToMap(layers.reverse() as CatalogItemLayer[]);\n  }\n\n  /**\n   * Remove all the layers of a group from map\n   * @param group Catalog group\n   */\n  private removeGroupFromMap(group: CatalogItemGroup) {\n    const layers = group.items.filter((item: CatalogItem) => {\n      const added = this.store.state.get(item).added || false;\n      return this.isLayer(item) && added === true;\n    });\n    this.removeLayersFromMap(layers as CatalogItemLayer[]);\n  }\n}\n","<ng-container *ngIf=\"legendItems$ | async as items\">\n  <ng-container *ngIf=\"items.length; else noItems\">\n    <ng-container *ngFor=\"let item of items.slice().reverse()\" #renderedLegends>\n      <div *ngIf=\"getLegend; else noItems\">\n        <mat-list-item *ngIf=\"item.title\">\n          <mat-icon\n            id=\"legend-toggle\"\n            class=\"igo-chevron\"\n            mat-list-avatar\n            igoCollapse\n            [target]=\"legend\"\n            [collapsed]=\"(item.collapsed)\"\n            (toggle)=\"toggleLegendItem($event, item)\"\n            svgIcon=\"chevron-up\">\n          </mat-icon>\n          <h4 matLine>{{computeItemTitle(item) | async}} </h4>\n        </mat-list-item>\n        <div #legend class=\"igo-layer-legend\" [ngClass]=\"{'with-title': item.title}\">\n          <div *ngIf=\"currentStyle !== undefined\">\n              <mat-form-field>\n                <mat-select tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n                  [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" [(ngModel)]=\"currentStyle\"\n                  (selectionChange)=\"onChangeStyle()\">\n                  <mat-option *ngFor=\"let style of styles\" [value]=\"style.name\">{{style.title}}</mat-option>\n                </mat-select>\n            </mat-form-field>\n          </div>\n          <div *ngIf=\"!(item.collapsed)\">\n            <div *ngIf=\"item.url\">\n              <img #renderedLegend id=\"{{item.title}}\" (load)=\"onLoadImage(item.title)\"\n                src=\"{{[item.imgGraphValue]}}\"\n                alt=\"{{'igo.geo.layer.legend.loadingLegendText' | translate}}\">\n              <small *ngIf=\"imagesHeight[item.title]<16\">\n                  {{'igo.geo.layer.legend.noLegendScale' | translate}}\n              </small>\n            </div>\n            <div\n              [ngStyle]=\"item.style\"\n              [innerHTML]=\"item.html | sanitizeHtml\"\n              *ngIf=\"item.html\">\n            </div>\n          </div>\n        </div>\n      </div>\n    </ng-container>\n  </ng-container>\n\n  <ng-template #noItems>\n    <small>\n      {{'igo.geo.layer.legend.noLegendText' | translate}}\n    </small>\n  </ng-template>\n\n</ng-container>\n","import { HttpClient } from '@angular/common/http';\nimport { Component, Input, OnInit, OnDestroy, ChangeDetectionStrategy, ViewChildren, ElementRef, ChangeDetectorRef } from '@angular/core';\nimport type { QueryList } from '@angular/core';\n\nimport { Subscription, BehaviorSubject, of, Observable } from 'rxjs';\n\nimport { Legend } from '../../datasource/shared/datasources/datasource.interface';\nimport { Layer, ItemStyleOptions } from '../shared/layers';\nimport { LegendMapViewOptions } from '../shared/layers/layer.interface';\nimport { CapabilitiesService } from '../../datasource/shared/capabilities.service';\nimport { catchError, map } from 'rxjs/operators';\nimport { LanguageService } from '@igo2/core';\nimport { WMSDataSource, WMSDataSourceOptions } from '../../datasource';\nimport { SecureImagePipe } from '@igo2/common';\n\n@Component({\n  selector: 'igo-layer-legend',\n  templateUrl: './layer-legend.component.html',\n  styleUrls: ['./layer-legend.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerLegendComponent implements OnInit, OnDestroy {\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  /**\n   * Observable of the legend items\n   */\n  legendItems$: BehaviorSubject<Legend[]> = new BehaviorSubject([]);\n\n  /**\n   * Subscription to the map's resolution\n   */\n  private state$$: Subscription;\n\n  /**\n   * The available styles\n   */\n  public styles;\n\n  /**\n   * The style used to make the legend\n   */\n  public currentStyle;\n\n  /**\n   * The scale used to make the legend\n   */\n  private scale: number = undefined;\n\n  /**\n   * The extent used to make the legend\n   */\n  private view: LegendMapViewOptions = undefined;\n  /**\n   * Get list of images display\n   */\n  @ViewChildren('renderedLegend') renderedLegends: QueryList<ElementRef>;\n\n  /**\n   * List of size of images displayed\n   */\n  public imagesHeight: { [srcKey: string]: number } = {};\n\n  /**\n   * Layer\n   */\n  @Input() layer: Layer;\n\n  /**\n   * if getLegendGraphic is authorized\n   */\n  public getLegend = true;\n\n  /**\n   * activeLegend\n   */\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    private languageService: LanguageService,\n    private http: HttpClient,\n    private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * On init, subscribe to the map's resolution and update the legend accordingly\n   */\n  ngOnInit() {\n    let lastlLegend = this.layer.legend;\n    this.styles = this.listStyles();\n    const sourceOptions = this.layer.options.source.options as any;\n    if (sourceOptions && sourceOptions.params && sourceOptions.params.STYLES) {\n      // if a styles is provided into the layers wms params\n      this.currentStyle = this.styles.find(style => style.name === sourceOptions.params.STYLES).name;\n    } else if (!lastlLegend) {\n      // if no legend is manually provided\n      if (this.styles && this.styles.length > 1) {\n        this.currentStyle = this.styles[0].name;\n      }\n    } else if (this.styles && this.styles.length > 1) {\n      this.currentStyle = lastlLegend[0].currentStyle;\n    }\n    if (typeof this.layer.options.legendOptions !== 'undefined' && this.layer.options.legendOptions.display === false) {\n      lastlLegend = [];\n    } else {\n      lastlLegend = this.layer.dataSource.getLegend(this.currentStyle, this.view);\n    }\n\n    if (this.updateLegendOnResolutionChange || (sourceOptions as WMSDataSourceOptions).contentDependentLegend) {\n      const state$ = this.layer.map.viewController.state$;\n      this.state$$ = state$.subscribe(() => this.onViewControllerStateChange());\n    } else if (lastlLegend && lastlLegend.length !== 0) {\n      this.legendItems$.next(lastlLegend);\n      for (const legend of lastlLegend) {\n        this.getLegendGraphic(legend);\n      }\n    }\n  }\n\n  /**\n   * On destroy, unsubscribe to the map's view state\n   */\n  ngOnDestroy() {\n    if (this.state$$ !== undefined) {\n      this.state$$.unsubscribe();\n    }\n  }\n\n  getLegendGraphic(item: Legend) {\n    if (item.url) {\n      const secureIMG = new SecureImagePipe(this.http);\n      secureIMG.transform(item.url).pipe(\n        catchError((err) => {\n          if (err.error) {\n            err.error.caught = true;\n            this.getLegend = false;\n            this.cdRef.detectChanges();\n            return err;\n          }\n        })\n        ).subscribe(obsLegGraph => {\n          const idx = this.legendItems$.value.findIndex(leg => leg.title === item.title);\n          const legendGraph = obsLegGraph as string;\n          this.legendItems$.value[idx].imgGraphValue = legendGraph;\n          this.cdRef.detectChanges();\n        }\n      );\n    }\n  }\n\n  toggleLegendItem(collapsed: boolean, item: Legend) {\n    item.collapsed = collapsed;\n  }\n\n  private transfertToggleLegendItem(newLegends: Legend[]): Legend[] {\n    const outLegends: Legend[] = newLegends;\n    const lastLegends = this.layer.legend;\n    for (let i = 0; i < lastLegends.length; i++) {\n      outLegends[i].collapsed = lastLegends[i].collapsed;\n   }\n    return outLegends;\n  }\n\n  computeItemTitle(layerLegend): Observable<string> {\n    const layerOptions = this.layer.dataSource.options as any;\n    if (layerOptions.type !== 'wms') {\n      return of(layerLegend.title);\n    }\n\n    const layers = layerOptions.params.LAYERS.split(',');\n    const localLayerOptions = JSON.parse(JSON.stringify(layerOptions)); // to avoid to alter the original options.\n    localLayerOptions.params.LAYERS = layers.find(layer => layer === layerLegend.title);\n    return this.capabilitiesService\n      .getWMSOptions(localLayerOptions)\n      .pipe(map(wmsDataSourceOptions => {\n        return wmsDataSourceOptions._layerOptionsFromSource.title;\n      }));\n  }\n\n  /**\n   * On resolution change, compute the effective scale level and update the\n   * legend accordingly.\n   * @param resolution Map resolution\n   */\n  private onViewControllerStateChange() {\n    this.view = {\n      resolution: this.layer.map.viewController.getResolution(),\n      extent: this.layer.map.viewController.getExtent(),\n      projection: this.layer.map.viewController.getOlProjection().getCode(),\n      scale: this.layer.map.viewController.getScale(),\n      size: this.layer.map.ol.getSize()\n    } as LegendMapViewOptions;\n    this.updateLegend();\n  }\n\n  /**\n   * Update the legend with scale level and style define\n   */\n  private updateLegend() {\n    let legendItems = this.layer.dataSource.getLegend(this.currentStyle, this.view);\n    if (this.layer.legend && this.layer.legend.length > 1) { legendItems = this.transfertToggleLegendItem(legendItems); }\n    this.layer.legend = legendItems;\n\n    if (legendItems.length === 0 && this.legendItems$.value.length === 0) {\n      return;\n    }\n    this.legendItems$.next(legendItems);\n    for (const legend of this.legendItems$.value) {\n      this.getLegendGraphic(legend);\n    }\n  }\n\n  private listStyles() {\n    const layerOptions = this.layer.options;\n    if (layerOptions && layerOptions.legendOptions) {\n      const translate = this.languageService.translate;\n      const title = translate.instant('igo.geo.layer.legend.default');\n      let stylesAvailable = [{ name: '', title } as ItemStyleOptions];\n      if (layerOptions.legendOptions.stylesAvailable) {\n        stylesAvailable = stylesAvailable.concat(layerOptions.legendOptions.stylesAvailable.filter(sA => (\n          sA.name.normalize('NFD').replace(/[\\u0300-\\u036f]/gi, '') !== 'default' &&\n          sA.name.normalize('NFD').replace(/[\\u0300-\\u036f]/gi, '') !== 'defaut')));\n      }\n      stylesAvailable.filter(sa => !sa.title).map((sa) => sa.title = sa.name);\n      stylesAvailable.map(s => s.title = s.title.charAt(0).toUpperCase() + s.title.slice(1).replace(/_/g, ' '));\n      return stylesAvailable;\n    }\n    return ;\n  }\n\n  onChangeStyle() {\n    this.updateLegend();\n    let STYLES = '';\n    if (this.layer.dataSource instanceof WMSDataSource) {\n      this.layer.dataSource.ol.getParams().LAYERS.split(',').map(layer =>\n        STYLES += this.currentStyle + ','\n      );\n      STYLES = STYLES.slice(0, -1);\n      this.layer.dataSource.ol.updateParams({ STYLES });\n    }\n  }\n\n  onLoadImage(id: string) {\n    let elemRef: HTMLImageElement;\n    if (this.renderedLegends.length === 1) {\n      elemRef = this.renderedLegends.first.nativeElement as HTMLImageElement;\n    } else {\n      elemRef = this.renderedLegends.find(renderedLegend => renderedLegend.nativeElement.id === id).nativeElement as HTMLImageElement;\n    }\n    this.imagesHeight[id] = elemRef.height;\n  }\n}\n","<mat-list-item>\n  <mat-icon *ngIf=\"haveGroup()\" mat-list-avatar svgIcon=\"blank\"></mat-icon>\n  <h4 mat-line matTooltipShowDelay=\"500\" [ngClass]=\"(catalogAllowLegend)?'igo-cataloglayer-title':''\" (click)=\"askForLegend($event)\" [matTooltip]=\"computeTitleTooltip()\">{{title}}</h4>\n\n    <button *ngIf=\"layer.externalProvider\"\n      disabled=\"true\"\n      mat-icon-button>\n    <mat-icon\n      class=\"igo-cataloglayer-external-icon\"\n      *ngIf=\"layer.externalProvider\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.externalProvider.layer' | translate\"\n      color=\"primary\"\n      (click)=\"$event.stopPropagation()\"\n      svgIcon=\"earth-arrow-right\">\n    </mat-icon>\n  </button>\n  <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n\n  <button\n    (mouseenter)=\"onMouseEvent($event)\" (mouseleave)=\"onMouseEvent($event)\"\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"computeTooltip() | translate\"\n    [color]=\"(isPreview$ | async) ? '' : added ? 'warn' : ''\"\n    (click)=\"onToggleClick($event)\">\n    <mat-icon\n       matBadge=\"icon\"\n       igoMatBadgeIcon=\"eye-off\"\n       igoMatBadgeInverseColor=\"true\"\n       [matBadgeHidden]=\"isInResolutionsRange()\"\n       matBadgeDisabled=\"true\"\n       matBadgeSize=\"small\"\n       matBadgePosition=\"after\"\n       [svgIcon]=\"(isPreview$ | async) ? 'plus' : added ? 'delete' : 'plus'\">\n    </mat-icon>\n  </button>\n\n</mat-list-item>\n\n<div #legend class=\"igo-cataloglayer-legend-container\">\n  <igo-layer-legend\n    *ngIf=\"(layerLegendShown$ | async) && (igoLayer$ | async) && catalogAllowLegend\"\n    [layer]=\"igoLayer$ | async\">\n  </igo-layer-legend>\n</div>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { getEntityTitle, getEntityIcon } from '@igo2/common';\n\nimport { CatalogItemLayer } from '../shared';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { first } from 'rxjs/operators';\nimport { Layer, TooltipType } from '../../layer/shared/layers';\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\n\n/**\n * Catalog browser layer item\n */\n@Component({\n  selector: 'igo-catalog-browser-layer',\n  templateUrl: './catalog-browser-layer.component.html',\n  styleUrls: ['./catalog-browser-layer.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogBrowserLayerComponent implements OnInit, OnDestroy {\n  public inRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  public isPreview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private isPreview$$: Subscription;\n  private lastTimeoutRequest;\n\n  public layerLegendShown$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public igoLayer$ = new BehaviorSubject<Layer>(undefined);\n\n  private mouseInsideAdd: boolean = false;\n\n  @Input() resolution: number;\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Catalog layer\n   */\n  @Input() layer: CatalogItemLayer;\n\n  /**\n   * Whether the layer is already added to the map\n   */\n  @Input() added = false;\n\n  /**\n   * Event emitted when the add/remove button is clicked\n   */\n  @Output() addedChange = new EventEmitter<{\n    added: boolean;\n    layer: CatalogItemLayer;\n  }>();\n\n  @Output() addedLayerIsPreview = new EventEmitter<boolean>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return getEntityTitle(this.layer);\n  }\n\n  /**\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.layer) || 'layers';\n  }\n\n  constructor(private layerService: LayerService ) {}\n\n  ngOnInit(): void {\n    this.isInResolutionsRange();\n    this.isPreview$$ = this.isPreview$.subscribe(value => this.addedLayerIsPreview.emit(value));\n  }\n\n  ngOnDestroy() {\n    this.isPreview$$.unsubscribe();\n  }\n\n  computeTitleTooltip(): string {\n      const layerOptions = this.layer.options;\n      if (!layerOptions.tooltip) {\n        return getEntityTitle(this.layer);\n      }\n      const layerTooltip = layerOptions.tooltip;\n      const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n      switch (layerOptions.tooltip.type) {\n        case TooltipType.TITLE:\n          return this.layer.title;\n        case TooltipType.ABSTRACT:\n          if (layerMetadata && layerMetadata.abstract) {\n            return layerMetadata.abstract;\n          } else {\n            return this.layer.title;\n          }\n        case TooltipType.CUSTOM:\n          if (layerTooltip && layerTooltip.text) {\n            return layerTooltip.text;\n          } else {\n            return this.layer.title;\n          }\n        default:\n          return this.layer.title;\n      }\n  }\n\n  /**\n   * On mouse event, mouseenter /mouseleave\n   * @internal\n   */\n  onMouseEvent(event) {\n    this.onToggleClick(event);\n  }\n\n  askForLegend(event) {\n    this.layerLegendShown$.next(!this.layerLegendShown$.value);\n    this.layerService.createAsyncLayer(this.layer.options).pipe(first())\n    .subscribe(layer => this.igoLayer$.next(layer));\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick(event) {\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      clearTimeout(this.lastTimeoutRequest);\n    }\n    if (event.type === 'mouseenter' && this.mouseInsideAdd ) {\n      return;\n    }\n    switch (event.type) {\n      case 'click':\n        if (!this.isPreview$.value) {\n          if (this.added) {\n            this.remove();\n          } else {\n            this.add();\n          }\n        }\n        this.isPreview$.next(false);\n        break;\n      case 'mouseenter':\n        if (!this.isPreview$.value && !this.added) {\n          this.lastTimeoutRequest = setTimeout(() => {\n            this.add();\n            this.isPreview$.next(true);\n          }, 500);\n        }\n        this.mouseInsideAdd = true;\n        break;\n      case 'mouseleave':\n        if (this.isPreview$.value) {\n          this.remove();\n          this.isPreview$.next(false);\n        }\n        this.mouseInsideAdd = false;\n        break;\n      default:\n        break;\n    }\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private add() {\n    if (!this.added) {\n      this.added = true;\n      this.addedChange.emit({ added: true, layer: this.layer });\n    }\n  }\n\n  /**\n   * Emit added change event with added = false\n   */\n  private remove() {\n    if (this.added) {\n      this.added = false;\n      this.addedChange.emit({ added: false, layer: this.layer });\n    }\n  }\n\n  haveGroup(): boolean {\n    return !(!this.layer.address || this.layer.address.split('.').length === 1);\n  }\n\n  isInResolutionsRange(): boolean {\n    const minResolution = this.layer.options.minResolution || 0;\n    const maxResolution = this.layer.options.maxResolution || Infinity;\n    this.inRange$.next(\n      this.resolution >= minResolution && this.resolution <= maxResolution\n    );\n    return this.inRange$.value;\n  }\n\n  computeTooltip(): string {\n    if (this.added) {\n      return this.isPreview$.value\n        ? 'igo.geo.catalog.layer.addToMap'\n        : this.inRange$.value\n        ? 'igo.geo.catalog.layer.removeFromMap'\n        : 'igo.geo.catalog.layer.removeFromMapOutRange';\n    } else {\n      return this.inRange$.value\n        ? 'igo.geo.catalog.layer.addToMap'\n        : 'igo.geo.catalog.layer.addToMapOutRange';\n    }\n  }\n}\n","<mat-list-item>\n  <mat-icon\n    mat-list-avatar\n    svgIcon=\"chevron-up\"\n    igoCollapse\n    class=\"igo-chevron\"\n    [target]=\"items\"\n    [collapsed]=\"collapsed\"\n    (toggle)=\"onToggleCollapsed($event)\">\n  </mat-icon>\n\n  <h4 class=\"igo-catalog-group-title\" id=\"catalog-group-title\" mat-line matTooltipShowDelay=\"500\" [matTooltip]=\"title\" (click)=\"onTitleClick()\">{{title}}</h4>\n\n  <button *ngIf=\"group.externalProvider\"\n    disabled=\"true\"\n    mat-icon-button>\n    <mat-icon\n      class=\"igo-cataloggroup-external-icon\"\n      *ngIf=\"group.externalProvider\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.externalProvider.group' | translate\"\n      color=\"primary\"\n      (click)=\"$event.stopPropagation()\"\n      svgIcon=\"earth-arrow-right\">\n    </mat-icon>\n  </button>\n\n  <ng-container *ngIf=\"(added$ | async) && (preview$ | async) === false; else notadded\">\n    <button\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.group.removeFromMap' | translate\"\n      color=\"warn\"\n      [disabled]=\"disabled$ | async\"\n      (click)=\"onToggleClick()\">\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n  </ng-container>\n\n  <ng-template #notadded>\n    <button\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.group.addToMap' | translate\"\n      [disabled]=\"disabled$ | async\"\n      (click)=\"onToggleClick()\">\n      <mat-icon svgIcon=\"plus\"></mat-icon>\n    </button>\n  </ng-template>\n</mat-list-item>\n\n<div #items>\n  <ng-template ngFor let-item [ngForOf]=\"store.view.all$() | async\">\n    <ng-container *ngIf=\"isGroup(item)\">\n      <!-- todo: add display ans manage CatalogItemGroup -->\n    </ng-container>\n    <ng-container *ngIf=\"isLayer(item)\">\n      <igo-catalog-browser-layer\n        igoListItem\n        [layer]=\"item\"\n        [resolution]=\"resolution\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [added]=\"state.get(item).added\"\n        (addedLayerIsPreview)=\"onLayerPreview($event)\"\n        (addedChange)=\"onLayerAddedChange($event)\">\n      </igo-catalog-browser-layer>\n    </ng-container>\n  </ng-template>\n</div>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { EntityStore } from '@igo2/common';\nimport type { EntityStateManager } from '@igo2/common';\n\nimport {\n  Catalog,\n  CatalogItem,\n  CatalogItemGroup,\n  CatalogItemLayer,\n  CatalogItemState,\n  CatalogItemType\n} from '../shared';\n\n/**\n * Catalog browser group item\n */\n@Component({\n  selector: 'igo-catalog-browser-group',\n  templateUrl: './catalog-browser-group.component.html',\n  styleUrls: ['./catalog-browser-group.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogBrowserGroupComponent implements OnInit, OnDestroy {\n\n  /**\n   * Group's items store\n   * @internal\n   */\n  store = new EntityStore<CatalogItem, CatalogItemState>([]);\n\n  /**\n   * Whether all the layers of the group are added\n   * @internal\n   */\n  added$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  preview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  /**\n   * Whether the toggle button is disabled\n   * @internal\n   */\n  disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Catalog group\n   */\n  @Input() group: CatalogItemGroup;\n\n  /**\n   * Whether the group is collapsed\n   */\n  @Input() collapsed: boolean = true;\n\n  @Input() resolution: number;\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Whether the group can be toggled when it's collapsed\n   */\n  @Input() toggleCollapsed: boolean = true;\n\n  /**\n   * Parent catalog's items store state. Groups share a unique\n   * EntityState that tracks the group and it's layers state (whether they are added or not).\n   * Sharing a unique state would also allow us to expand this component to allow\n   * the selection of a layer while unselecting any layer already selected in another group.\n   * This could be useful to display some layer info before adding it, for example.\n   */\n  @Input() state: EntityStateManager<CatalogItem, CatalogItemState>;\n\n  /**\n   * Event emitted when the add/remove button of the group is clicked\n   */\n  @Output() addedChange = new EventEmitter<{\n    added: boolean;\n    group: CatalogItemGroup;\n  }>();\n\n  /**\n   * Event emitted when the add/remove button of a layer is clicked\n   */\n  @Output() layerAddedChange = new EventEmitter<{\n    added: boolean;\n    layer: CatalogItemLayer;\n  }>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return this.group.title;\n  }\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    this.store.load(this.group.items);\n    this.evaluateAdded();\n    this.evaluateDisabled(this.collapsed);\n    if (this.group.sortDirection !== undefined) {\n      this.store.view.sort({\n        direction: this.group.sortDirection,\n        valueAccessor: (item: CatalogItem) => item.title\n        });\n    }\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n\n  /**\n   * @internal\n   */\n  isGroup(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Group;\n  }\n\n  /**\n   * @internal\n   */\n  isLayer(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Layer;\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick() {\n    this.added$.value ? this.remove() : this.add();\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleCollapsed(collapsed: boolean) {\n    this.evaluateDisabled(collapsed);\n  }\n\n  /**\n   * When a layer is added or removed, evaluate if all the layers of the group\n   * are now added or removed. If so, consider that the group itself is added\n   * or removed.\n   * @internal\n   * @param event Layer added change event\n   */\n  onLayerAddedChange(event: { added: boolean; layer: CatalogItemLayer }) {\n    this.layerAddedChange.emit(event);\n    this.tryToggleGroup(event);\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private add() {\n    this.added$.next(true);\n    this.addedChange.emit({\n      added: true,\n      group: this.group\n    });\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private remove() {\n    this.added$.next(false);\n    this.addedChange.emit({\n      added: false,\n      group: this.group\n    });\n  }\n\n  onLayerPreview(event) {\n    this.preview$.next(event);\n  }\n\n  /**\n   * If all the layers of the group added or removed, add or remove the group itself.\n   * @param event The last layer added change event to occur\n   */\n  private tryToggleGroup(event: { added: boolean; layer: CatalogItemLayer }) {\n    const added = event.added;\n    const layer = event.layer;\n\n    const layersAdded = this.store.view\n      .all()\n      .filter((item: CatalogItem) => item.id !== layer.id)\n      .map((item: CatalogItem) => this.state.get(item).added || false);\n\n    if (layersAdded.every(value => value === added)) {\n      added ? this.add() : this.remove();\n    } else if (this.added$.value === true) {\n      this.added$.next(false);\n    }\n  }\n\n  private evaluateAdded() {\n    const added = this.store.all().every((item: CatalogItem) => {\n      return (this.state.get(item).added || false) === true;\n    });\n    this.added$.next(added);\n  }\n\n  private evaluateDisabled(collapsed: boolean) {\n    let disabled = false;\n    if (this.toggleCollapsed === false) {\n      disabled = collapsed;\n    }\n    this.disabled$.next(disabled);\n  }\n\n  onTitleClick() {\n    this.collapsed = !this.collapsed;\n  }\n}\n","import { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LayerListToolService {\n  public keyword: string;\n  public sortAlpha = false;\n  public onlyVisible = false;\n  public onlyInRange = false;\n  public keywordInitialized = false;\n  public sortedAlphaInitialized = false;\n  public onlyVisibleInitialized = false;\n  public onlyInRangeInitialized = false;\n\n  constructor() {}\n\n}\n","<mat-list-item class= \"igo-layer-list-item\">\n  <mat-checkbox *ngIf=\"selectionMode\"\n    class=\"layerCheck\"\n    mat-list-icon\n    (change)=\"check()\"\n    [checked]=\"layerCheck\">\n  </mat-checkbox>\n  <h4 (click)=\"toggleLegendOnClick()\" matLine class=\"igo-layer-title\" [matTooltip]=\"tooltipText\" matTooltipShowDelay=\"500\">{{layer.title}}</h4>\n\n  <button *ngIf=\"!selectionMode\"\n    mat-icon-button\n    [color]=\"layer.visible ? 'primary' : 'default'\"\n    collapsibleButton\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"layer.visible ?\n                  ('igo.geo.layer.hideLayer' | translate) :\n                  ('igo.geo.layer.showLayer' | translate)\"\n    (click)=\"toggleVisibility()\">\n    <mat-icon\n      matBadge=\"?\"\n      matBadgeColor=\"accent\"\n      matBadgeSize=\"small\"\n      matBadgePosition=\"after\"\n      [matBadgeHidden]=\"queryBadgeHidden$ | async\"\n      [ngClass]=\"{disabled: (inResolutionRange$ | async)===false}\"\n      [svgIcon]=\"(layer.visible$ | async) ? 'eye' : 'eye-off'\">\n    </mat-icon>\n  </button>\n\n  <button *ngIf=\"selectionMode\" class=\"selection-eye\"\n  mat-icon-button\n  [color]=\"layer.visible ? 'primary' : 'default'\"\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"layer.visible ?\n                ('igo.geo.layer.hideLayer' | translate) :\n                ('igo.geo.layer.showLayer' | translate)\"\n  (click)=\"toggleVisibility()\">\n  <mat-icon\n    matBadge=\"?\"\n    matBadgeColor=\"accent\"\n    matBadgeSize=\"small\"\n    matBadgePosition=\"after\"\n    [matBadgeHidden]=\"queryBadgeHidden$ | async\"\n    [ngClass]=\"{disabled: (inResolutionRange$ | async)===false}\"\n    [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\">\n  </mat-icon>\n</button>\n\n  <button *ngIf=\"!selectionMode\"\n    class=\"actions-button\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]= \"'igo.geo.layer.moreOptions' | translate\"\n    mat-icon-button\n    color=\"primary\"\n    (click)=\"toggleLayerTool()\">\n    <mat-icon svgIcon=\"dots-horizontal\"></mat-icon>\n  </button>\n</mat-list-item>\n\n<div #legend class=\"igo-layer-legend-container\">\n  <igo-layer-legend\n    *ngIf=\"showLegend$ | async\"\n    [layer]=\"layer\"\n    [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\">\n  </igo-layer-legend>\n</div>\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter,\n  Renderer2,\n  ElementRef,\n  ChangeDetectorRef\n} from '@angular/core';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\nimport { layerIsQueryable } from '../../query/shared/query.utils';\nimport { Layer, TooltipType } from '../shared/layers';\nimport { NetworkService, ConnectionState } from '@igo2/core';\n\n@Component({\n  selector: 'igo-layer-item',\n  templateUrl: './layer-item.component.html',\n  styleUrls: ['./layer-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerItemComponent implements OnInit, OnDestroy {\n  public focusedCls = 'igo-layer-item-focused';\n\n  @Input()\n  get activeLayer() {\n    return this._activeLayer;\n  }\n  set activeLayer(value) {\n    if (value && this.layer && value.id === this.layer.id && !this.selectionMode) {\n      this.layerTool$.next(true);\n      this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n    } else {\n      this.renderer.removeClass(this.elRef.nativeElement, this.focusedCls);\n    }\n  }\n  private _activeLayer;\n\n  layerTool$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  queryBadgeHidden$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  tooltipText: string;\n\n  state: ConnectionState;\n\n  @Input()\n  get selectAll() {\n    return this._selectAll;\n  }\n  set selectAll(value: boolean) {\n    this._selectAll = value;\n    if (value === true) {\n      this.layerCheck = true;\n    }\n  }\n  private _selectAll = false;\n\n  @Input() layerCheck;\n\n  private resolution$$: Subscription;\n  private network$$: Subscription;\n  private layers$$: Subscription;\n\n  layers$: BehaviorSubject<Layer> = new BehaviorSubject<Layer>(undefined);\n\n  @Input()\n  get layer() {\n    return this._layer;\n  }\n  set layer(value) {\n    this._layer = value;\n    this.layers$.next(value);\n  }\n  private _layer;\n\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendIfVisible: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() orderable: boolean = true;\n\n  @Input() lowerDisabled: boolean = false;\n\n  @Input() raiseDisabled: boolean = false;\n\n  @Input() queryBadge: boolean = false;\n\n  @Input() selectionMode;\n\n  @Input() changeDetection;\n\n  get opacity() {\n    return this.layer.opacity * 100;\n  }\n  set opacity(opacity: number) {\n    this.layer.opacity = opacity / 100;\n  }\n\n  @Output() action: EventEmitter<Layer> = new EventEmitter<Layer>(undefined);\n  @Output() checkbox = new EventEmitter<{\n    layer: Layer;\n    check: boolean;\n  }>();\n\n  constructor(\n    private networkService: NetworkService,\n    private renderer: Renderer2,\n    private elRef: ElementRef,\n    private cdRef: ChangeDetectorRef) {}\n\n  ngOnInit() {\n    if (\n      this.layer.visible &&\n      this.expandLegendIfVisible &&\n      this.layer.firstLoadComponent === true\n    ) {\n      this.layer.firstLoadComponent = false;\n      this.layer.legendCollapsed = false;\n    }\n    this.toggleLegend(this.layer.legendCollapsed);\n    this.updateQueryBadge();\n\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.onResolutionChange();\n    });\n    this.tooltipText = this.computeTooltip();\n\n    this.network$$ = this.networkService.currentState().subscribe((state: ConnectionState) => {\n      this.state = state;\n      this.onResolutionChange();\n    });\n\n    this.layers$$ = this.layers$.subscribe(() => {\n      if (this.layer && this.layer.options.active) {\n        this.layerTool$.next(true);\n        this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n      }\n    });\n\n    if (this.changeDetection) {\n      this.changeDetection.subscribe(() => this.cdRef.detectChanges());\n    }\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n    this.network$$.unsubscribe();\n    this.layers$$.unsubscribe();\n  }\n\n  toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    this.toggleLegend(this.showLegend$.value);\n  }\n\n  toggleVisibility() {\n    this.layer.visible = !this.layer.visible;\n    if (this.toggleLegendOnVisibilityChange) {\n      this.toggleLegend(!this.layer.visible);\n    }\n    this.updateQueryBadge();\n  }\n\n  computeTooltip(): string {\n    const layerOptions = this.layer.options;\n    if (!layerOptions.tooltip) {\n      return this.layer.title;\n    }\n    const layerTooltip = layerOptions.tooltip;\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n    switch (layerOptions.tooltip.type) {\n      case TooltipType.TITLE:\n        return this.layer.title;\n      case TooltipType.ABSTRACT:\n        if (layerMetadata && layerMetadata.abstract) {\n          return layerMetadata.abstract;\n        } else {\n          return this.layer.title;\n        }\n      case TooltipType.CUSTOM:\n        if (layerTooltip && layerTooltip.text) {\n          return layerTooltip.text;\n        } else {\n          return this.layer.title;\n        }\n      default:\n        return this.layer.title;\n    }\n  }\n\n  private onResolutionChange() {\n    const inResolutionRange = this.layer.isInResolutionsRange;\n    if (\n      inResolutionRange === false &&\n      this.updateLegendOnResolutionChange === true\n    ) {\n      this.toggleLegend(true);\n    }\n    this.inResolutionRange$.next(inResolutionRange);\n  }\n\n  private updateQueryBadge() {\n    const hidden =\n      this.queryBadge === false ||\n      this.layer.visible === false ||\n      !layerIsQueryable(this.layer);\n    this.queryBadgeHidden$.next(hidden);\n  }\n\n  toggleLayerTool() {\n    this.layerTool$.next(!this.layerTool$.getValue());\n    if (this.layerTool$.getValue() === true) {\n      this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n    } else {\n      this.renderer.removeClass(this.elRef.nativeElement, this.focusedCls);\n    }\n    this.action.emit(this.layer);\n  }\n\n  public check() {\n    this.layerCheck = !this.layerCheck;\n    this.checkbox.emit({layer: this.layer, check: this.layerCheck});\n  }\n}\n","export enum LayerListControlsEnum {\n  always = 'always',\n  never = 'never',\n  default = 'default'\n}\nexport enum LayerListSelectVisibleEnum {\n  ALL_VISIBLE = 'ALL_VISIBLE',\n  ALL_HIDDEN = 'ALL_HIDDEN',\n  MIXED = 'MIXED',\n  NULL = 'NULL'\n}\n\nexport enum LayerListDisplacement {\n  Raise = 'raise',\n  Lower = 'lower',\n}\n","<mat-list>\n  <igo-layer-list-tool *ngIf=\"showToolbar$ | async\"\n    floatLabel=\"auto\"\n    [layersAreAllVisible]=\"layersAreAllVisible\"\n    [term]=\"layerFilterAndSortOptions.keyword\"\n    [onlyVisible]=\"layerFilterAndSortOptions.onlyVisible\"\n    [sortAlpha]=\"layerFilterAndSortOptions.sortAlpha\"\n    (appliedFilterAndSort)=\"onAppliedFilterAndSortChange($event)\"\n    (selection)=\"toggleSelectionMode($event)\">\n  </igo-layer-list-tool>\n</mat-list>\n\n<mat-list-item *ngIf=\"selection\" class=\"select-all\">\n  <mat-checkbox\n    class=\"select-all-checkbox mat-subheading-2\"\n    [color]=\"!selectAllCheck && layersChecked.length > 0 ? 'accent' : 'primary'\"\n    (change)=\"selectAll()\"\n    [checked]=\"selectAllCheck\"\n    [indeterminate]=\"!selectAllCheck && layersChecked.length > 0\"> {{selectAllCheck ? ('igo.geo.layer.deselectAll' | translate) : ('igo.geo.layer.selectAll' | translate)}}\n  </mat-checkbox>\n</mat-list-item>\n<mat-divider></mat-divider>\n\n<igo-list #igoList [ngClass]=\"{'igo-list-tools-multi': selection, 'igo-list-tools-single': (layerTool && !selection), 'igo-list-no-tools': (!layerTool && !selection)}\" [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-layer let-i=\"index\" [ngForOf]=\"layers$ | async\">\n    <igo-layer-item *ngIf=\"!(excludeBaseLayers && layer.baseLayer)\"\n      igoListItem\n      [layer]=\"layer\"\n      [activeLayer]=\"activeLayer\"\n      [orderable]=\"orderable && !layer.baseLayer\"\n      [lowerDisabled]=\"getLowerLayer().id === layer.id\"\n      [raiseDisabled]=\"getUpperLayer().id === layer.id\"\n      [queryBadge]=\"queryBadge\"\n      [expandLegendIfVisible]=\"expandLegendOfVisibleLayers\"\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n      [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\n      [selectionMode]=\"selection\"\n      [selectAll]=\"selectAllCheck\"\n      [layerCheck]=\"layer.options.check\"\n      [changeDetection]=\"layerItemChangeDetection$\"\n      (action)=\"toggleLayerTool($event)\"\n      (checkbox)=\"layersCheck($event)\">\n    </igo-layer-item>\n  </ng-template>\n</igo-list>\n\n<igo-panel *ngIf=\"!selection && layerTool && activeLayer\" class=\"igo-layer-actions-container\" [title]=\"activeLayer.title\">\n  <div class=\"igo-layer-button-group\">\n    <button\n      *ngIf=\"isLayerRemovable(activeLayer)\"\n      class=\"delete-button\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.removeLayer' | translate\"\n      (click)=\"removeLayers()\">\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <button\n      class=\"down-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterLowerLayer' | translate) : ('igo.geo.layer.lowerLayer' | translate)\"\n      [disabled]=\"lowerDisabled\"\n      (click)=\"moveActiveLayer(activeLayer,layerListDisplacement.Lower)\">\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"lowerDisabled\"\n                svgIcon=\"arrow-down\"></mat-icon>\n    </button>\n\n    <button\n      class=\"up-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterRaiseLayer' | translate) : ('igo.geo.layer.raiseLayer' | translate)\"\n      [disabled]=\"raiseDisabled\"\n      (click)=\"moveActiveLayer(activeLayer,layerListDisplacement.Raise)\">\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"raiseDisabled\"\n                svgIcon=\"arrow-up\"></mat-icon>\n    </button>\n\n    <!-- <label>{{ 'igo.geo.layer.opacity' | translate }} </label> -->\n    <button\n      class=\"opacity-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matMenuTriggerFor]=\"opacityMenu\"\n      [matTooltip]=\"'igo.geo.layer.opacity' | translate\">\n      <mat-icon [matBadge]=\"badgeOpacity\" matBadgeColor=\"primary\" matBadgeSize=\"medium\" svgIcon=\"opacity\"></mat-icon>\n    </button>\n\n    <mat-menu #opacityMenu=\"matMenu\" class=\"mat-menu-opacity-slider\">\n      <div id=\"opacity-menu\">\n        <mat-slider\n          id=\"opacity-slider\"\n          color=\"primary\"\n          thumbLabel\n          tickInterval=\"5\"\n          step=\"5\"\n          [min]=\"0\"\n          [max]=\"100\"\n          [value]=\"opacity\"\n          (input)=\"changeOpacity($event)\"\n          [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n          (click) = \"$event.stopPropagation()\"\n          matTooltipShowDelay=\"500\"\n          tooltip-position=\"below\">\n        </mat-slider>\n      </div>\n    </mat-menu>\n\n    <button\n      *ngIf=\"activeLayerIsValid(activeLayer)\"\n      class=\"zoomLayer-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.zoomLayer' | translate\"\n      (click)=\"zoomLayerExtents(activeLayer)\">\n      <mat-icon matBadgeColor=\"primary\" matBadgeSize=\"medium\" svgIcon=\"magnify-scan\"></mat-icon>\n    </button>\n\n    <ng-container igoLayerItemToolbar\n      [ngTemplateOutlet]=\"templateLayerToolbar\"\n      [ngTemplateOutletContext]=\"{layer: activeLayer}\">\n    </ng-container>\n\n    <ng-content select=\"[igoLayerItemToolbar]\"></ng-content>\n  </div>\n</igo-panel>\n\n<igo-panel *ngIf=\"selection && layers.length > 0\" class=\"igo-layer-actions-container\" [title]=\"'igo.geo.layer.tools' | translate\">\n  <div class=\"actions-buttons-multi\">\n    <button\n      class=\"delete-button\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matTooltip]=\"isAllLayersRemovable(layersChecked) ? ('igo.geo.layer.removeSelectedLayers' | translate) : 'igo.geo.layer.removeSelectedLayersRestriction' | translate\"\n      (click)=\"removeLayers(layersChecked)\">\n      <mat-icon [matBadge]=\"'!'\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"isAllLayersRemovable(layersChecked)\"\n                svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <button\n      class=\"eye-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matTooltip]=\"statusSelectedLayersCheck === 'ALL_HIDDEN' ? ('igo.geo.layer.showSelectedLayers' | translate) : ('igo.geo.layer.hideSelectedLayers' | translate)\"\n      (click)=\"toggleVisibility(layersChecked)\">\n      <mat-icon\t[svgIcon]=\"(statusSelectedLayersCheck === 'ALL_HIDDEN') ? 'eye-off' : 'eye'\"></mat-icon>\n    </button>\n\n    <button\n      class=\"down-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterLowerLayer' | translate) : ('igo.geo.layer.lowerLayer' | translate)\"\n      [disabled]=\"lowerDisabledSelection\"\n      (click)=\"lowerLayers(layersChecked)\">\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"lowerDisabledSelection\"\n                svgIcon=\"arrow-down\"></mat-icon>\n    </button>\n\n    <button\n      class=\"up-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterRaiseLayer' | translate) : ('igo.geo.layer.raiseLayer' | translate)\"\n      [disabled]=\"raiseDisabledSelection\"\n      (click)=\"raiseLayers(layersChecked)\">\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"raiseDisabledSelection\"\n                svgIcon=\"arrow-up\"></mat-icon>\n    </button>\n\n    <button\n      class=\"opacity-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matMenuTriggerFor]=\"opacityMenu\"\n      [matTooltip]=\"'igo.geo.layer.opacity' | translate\">\n      <mat-icon svgIcon=\"opacity\"></mat-icon>\n    </button>\n\n    <mat-menu #opacityMenu=\"matMenu\"  class=\"mat-menu-opacity-slider\">\n      <div id=\"opacity-menu\">\n        <mat-slider *ngIf=\"layersChecked.length\"\n          id=\"opacity-slider\"\n          color=\"primary\"\n          thumbLabel\n          tickInterval=\"5\"\n          step=\"5\"\n          [min]=\"0\"\n          [max]=\"100\"\n          [(ngModel)]=\"checkOpacity\"\n          [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n          matTooltipShowDelay=\"500\"\n          tooltip-position=\"below\"\n          (click) = \"$event.stopPropagation()\">\n        </mat-slider>\n      </div>\n    </mat-menu>\n\n    <button\n      *ngIf=\"layersChecked.length !== 0 && activeLayersAreValid(layersChecked)\"\n      class=\"zoomLayer-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.zoomLayers' | translate\"\n      (click)=\"zoomLayersExtents(layersChecked)\">\n      <mat-icon svgIcon=\"magnify-scan\"></mat-icon>\n    </button>\n  </div>\n</igo-panel>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ContentChild,\n  OnInit,\n  OnDestroy,\n  Output,\n  EventEmitter,\n  ElementRef\n} from '@angular/core';\nimport type { TemplateRef } from '@angular/core';\n\nimport { FloatLabelType } from '@angular/material/form-field';\nimport { LayerListControlsEnum, LayerListDisplacement } from './layer-list.enum';\nimport { LayerListSelectVisibleEnum } from './layer-list.enum';\nimport {\n  BehaviorSubject,\n  ReplaySubject,\n  Subscription,\n  EMPTY,\n  timer\n} from 'rxjs';\nimport { debounce } from 'rxjs/operators';\nimport {\n  MetadataOptions,\n  MetadataLayerOptions\n} from '../../metadata/shared/metadata.interface';\nimport { LayerListControlsOptions } from '../layer-list-tool/layer-list-tool.interface';\nimport { IgoMap } from '../../map/shared/map';\nimport { Layer } from '../shared/layers/layer';\nimport { LinkedProperties, LayersLink } from '../shared/layers/layer.interface';\nimport { MatSliderChange } from '@angular/material/slider';\nimport * as olextent from 'ol/extent';\n\n// TODO: This class could use a clean up. Also, some methods could be moved ealsewhere\n@Component({\n  selector: 'igo-layer-list',\n  templateUrl: './layer-list.component.html',\n  styleUrls: ['./layer-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerListComponent implements OnInit, OnDestroy {\n  orderable = true;\n  thresholdToFilterAndSort = 5;\n\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n\n  change$ = new ReplaySubject<void>(1);\n\n  showToolbar$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public layerTool: boolean;\n\n  public hideSelectedLayers: boolean = true;\n  activeLayer$: BehaviorSubject<Layer> = new BehaviorSubject(undefined);\n\n  layersChecked: Layer[] = [];\n  public selection: boolean;\n\n  private change$$: Subscription;\n  private layers$$: Subscription;\n  public layerItemChangeDetection$ = new BehaviorSubject(undefined);\n\n  @ContentChild('igoLayerItemToolbar', /* TODO: add static flag */ {})\n  templateLayerToolbar: TemplateRef<any>;\n\n  @Input() layersAreAllVisible: boolean = true;\n\n  @Input() ogcButton: boolean = true;\n\n  @Input() timeButton: boolean = true;\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  set layers(value: Layer[]) {\n    this._layers = this.removeProblemLayerInList(value);\n    this.next();\n  }\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  private _layers: Layer[];\n\n  set activeLayer(value: Layer) {\n    this._activeLayer = value;\n    this.activeLayer$.next(value);\n  }\n  get activeLayer(): Layer {\n    return this._activeLayer;\n  }\n  private _activeLayer: Layer;\n\n  @Input() floatLabel: FloatLabelType = 'auto';\n\n  @Input() layerFilterAndSortOptions: LayerListControlsOptions = {};\n\n  @Input() excludeBaseLayers: boolean = false;\n\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendOfVisibleLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() queryBadge: boolean = false;\n\n  @Output() appliedFilterAndSort = new EventEmitter<LayerListControlsOptions>();\n\n  get keyword(): string {\n    return this._keyword;\n  }\n  set keyword(value: string) {\n    this._keyword = value;\n    this.next();\n  }\n  private _keyword = undefined;\n\n  get onlyVisible(): boolean {\n    return this._onlyVisible;\n  }\n  set onlyVisible(value: boolean) {\n    this._onlyVisible = value;\n    this.next();\n  }\n  private _onlyVisible = false;\n\n  get sortAlpha(): boolean {\n    return this._sortedAlpha;\n  }\n  set sortAlpha(value: boolean) {\n    this._sortedAlpha = value;\n    this.next();\n  }\n  private _sortedAlpha = false;\n\n  get opacity() {\n    return Math.round(this.activeLayer$.getValue().opacity * 100);\n  }\n  set opacity(opacity: number) {\n    this.activeLayer$.getValue().opacity = opacity / 100;\n  }\n\n  get badgeOpacity() {\n    if (this.opacity === 100) {\n      return;\n    }\n    return this.opacity;\n  }\n\n  get raiseDisabled(): boolean {\n    if (\n      !this.orderable ||\n      this.activeLayer.baseLayer ||\n      this.getUpperLayer().id === this.activeLayer.id ||\n      this.isUpperBaselayer(this.activeLayer)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get lowerDisabled(): boolean {\n    if (\n      !this.orderable ||\n      this.activeLayer.baseLayer ||\n      this.getLowerLayer().id === this.activeLayer.id ||\n      this.isLowerBaselayer(this.activeLayer)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get raiseDisabledSelection(): boolean {\n    if (\n      this.layersChecked.length === 0 ||\n      !this.orderable ||\n      !this.raisableLayers(this.layersChecked) ||\n      this.selectAllCheck === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get lowerDisabledSelection(): boolean {\n    if (\n      this.layersChecked.length === 0 ||\n      !this.orderable ||\n      !this.lowerableLayers(this.layersChecked) ||\n      this.selectAllCheck === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get checkOpacity() {\n    return this.layersCheckedOpacity() * 100;\n  }\n  set checkOpacity(opacity: number) {\n    for (const layer of this.layersChecked) {\n      layer.opacity = opacity / 100;\n    }\n  }\n\n  get layerListDisplacement(): typeof LayerListDisplacement {\n    return LayerListDisplacement;\n  }\n\n  public toggleOpacity = false;\n\n  public selectAllCheck: boolean;\n  public selectAllCheck$ = new BehaviorSubject<boolean>(undefined);\n  private selectAllCheck$$: Subscription;\n\n  constructor(private elRef: ElementRef) { }\n\n  /**\n   * Subscribe to the search term stream and trigger researches\n   * @internal\n   */\n  ngOnInit(): void {\n    this.change$$ = this.change$\n      .pipe(\n        debounce(() => {\n          return this.layers.length === 0 ? EMPTY : timer(50);\n        })\n      )\n      .subscribe(() => {\n        this.showToolbar$.next(this.computeShowToolbar());\n        this.layers$.next(this.computeLayers(this.layers.slice(0)));\n        this.appliedFilterAndSort.emit({\n          keyword: this.keyword,\n          sortAlpha: this.sortAlpha,\n          onlyVisible: this.onlyVisible\n        });\n      });\n\n    this.selectAllCheck$$ = this.selectAllCheck$.subscribe((value) => {\n      this.selectAllCheck = value;\n    });\n\n    this.layers$$ = this.layers$.subscribe(() => {\n      if (this.layers) {\n        let checks = 0;\n        for (const layer of this.layers) {\n          layer.status$.subscribe(valStatus => {\n            if (valStatus === 0) {\n              this.map.removeLayer(layer);\n            }\n          });\n          if (layer.options.active) {\n            this.activeLayer = layer;\n            this.layerTool = true;\n          }\n          if (layer.options.check) {\n            checks += 1;\n          }\n        }\n        if (this.excludeBaseLayers) {\n          this.selectAllCheck =\n            checks ===\n              this.layers.filter(\n                (lay) => lay.baseLayer !== true && lay.showInLayerList\n              ).length\n              ? true\n              : false;\n        } else {\n          this.selectAllCheck =\n            checks === this.layers.filter((lay) => lay.showInLayerList).length\n              ? true\n              : false;\n        }\n      }\n    });\n  }\n\n  ngOnDestroy() {\n    this.change$$.unsubscribe();\n    this.selectAllCheck$$.unsubscribe();\n    this.layers$$.unsubscribe();\n  }\n\n  activeLayerIsValid(layer: Layer): boolean {\n    let valid = false;\n    const layerExtent = layer.options.extent;\n    const maxLayerZoomExtent = this.map.viewController.maxLayerZoomExtent;\n\n    if (layerExtent) {\n      if (maxLayerZoomExtent) {\n        valid = olextent.containsExtent(maxLayerZoomExtent, layerExtent);\n      } else {\n        valid = true;\n      }\n    }\n    return valid;\n  }\n\n  activeLayersAreValid(layers: Layer[]): boolean {\n    let valid = false;\n    const layersExtent = olextent.createEmpty();\n    const maxLayerZoomExtent = this.map.viewController.maxLayerZoomExtent;\n\n    for (const layer of layers) {\n      const layerExtent = layer.options.extent;\n\n      if (layerExtent && !layerExtent.includes(Infinity)) {\n        olextent.extend(layersExtent, layerExtent);\n      }\n    }\n\n    if (!olextent.isEmpty(layersExtent)) {\n      if (maxLayerZoomExtent) {\n        valid = (olextent.containsExtent(maxLayerZoomExtent, layersExtent));\n      } else {\n        valid = true;\n      }\n    }\n    return valid;\n  }\n\n  zoomLayerExtents(layer: Layer) {\n    this.map.viewController.zoomToExtent(layer.options.extent);\n  }\n\n  zoomLayersExtents(layers: Layer[]) {\n    const layersExtent = olextent.createEmpty() as [number, number, number, number];\n\n    for (const layer of layers) {\n      const layerExtent = layer.options.extent;\n\n      if (layerExtent) {\n        olextent.extend(layersExtent, layerExtent);\n      }\n    }\n    this.map.viewController.zoomToExtent(layersExtent);\n  }\n\n  changeOpacity(event: MatSliderChange){\n    this.opacity = event.value;\n  }\n\n  clearKeyword() {\n    this.keyword = undefined;\n  }\n\n  getLowerLayer() {\n    return this.layers\n      .filter((l) => !l.baseLayer)\n      .reduce(\n        (prev, current) => {\n          return prev.zIndex < current.zIndex ? prev : current;\n        },\n        { zIndex: undefined, id: undefined }\n      );\n  }\n\n  isLowerBaselayer(layer) {\n    const index = this.layers.findIndex((lay) => layer.id === lay.id);\n    if (\n      this.layers &&\n      this.layers[index + 1] &&\n      this.layers[index + 1].baseLayer === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  getUpperLayer() {\n    return this.layers\n      .filter((l) => !l.baseLayer)\n      .reduce(\n        (prev, current) => {\n          return prev.zIndex > current.zIndex ? prev : current;\n        },\n        { zIndex: undefined, id: undefined }\n      );\n  }\n\n  isUpperBaselayer(layer) {\n    const index = this.layers.findIndex((lay) => layer.id === lay.id);\n    if (\n      this.layers &&\n      this.layers[index - 1] &&\n      this.layers[index - 1].baseLayer === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  moveActiveLayer(activeLayer: Layer, actiontype: LayerListDisplacement) {\n    const layersToMove = [activeLayer];\n    const sortedLayersToMove = [];\n    this.getLinkedLayers(activeLayer, layersToMove);\n    this.layers.map(layer => {\n      if (layersToMove.indexOf(layer) !== -1) {\n        sortedLayersToMove.push(layer);\n      }\n    });\n\n    if (actiontype === LayerListDisplacement.Raise) {\n      this.raiseLayers(sortedLayersToMove, false);\n    } else if (actiontype === LayerListDisplacement.Lower) {\n      this.lowerLayers(sortedLayersToMove, false);\n    }\n  }\n\n  private getLinkedLayers(activeLayer: Layer, layersList: Layer[]) {\n    const linkedLayers = activeLayer.options.linkedLayers as LayersLink;\n    if (!linkedLayers) {\n      return;\n    }\n    const currentLinkedId = linkedLayers.linkId;\n    const currentLinks = linkedLayers.links;\n    const isParentLayer = currentLinks ? true : false;\n\n    if (isParentLayer) {\n      // search for child layers\n      currentLinks.map(link => {\n        if (!link.properties || link.properties.indexOf(LinkedProperties.ZINDEX) === -1) {\n          return;\n        }\n        link.linkedIds.map(linkedId => {\n          const childLayer = this.layers.find(layer => layer.options.linkedLayers?.linkId === linkedId);\n          if (childLayer) {\n            if (!layersList.includes(childLayer)) {\n              layersList.push(childLayer);\n            }\n          }\n        });\n      });\n    } else {\n      // search for parent layer\n      this.layers.map(parentLayer => {\n        if (parentLayer.options.linkedLayers?.links) {\n          parentLayer.options.linkedLayers.links.map(l => {\n            if (\n              l.properties?.indexOf(LinkedProperties.ZINDEX) !== -1 &&\n              l.bidirectionnal !== false &&\n              l.linkedIds.indexOf(currentLinkedId) !== -1) {\n              layersList.push(parentLayer);\n              this.getLinkedLayers(parentLayer, layersList);\n            }\n          });\n        }\n      });\n    }\n  }\n\n  /*\n   * For selection mode disabled attribute\n   */\n  raisableLayers(layers: Layer[]) {\n    let response = false;\n    let base = 0;\n    for (const layer of layers) {\n      const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n      const currentLayer = this.layers[mapIndex];\n      if (currentLayer.baseLayer) {\n        base += 1;\n      }\n\n      const previousLayer = this.layers[mapIndex - 1];\n      if (\n        previousLayer &&\n        previousLayer.baseLayer !== true &&\n        !layers.find((lay) => previousLayer.id === lay.id) &&\n        currentLayer.baseLayer !== true\n      ) {\n        response = true;\n      }\n    }\n\n    if (\n      (this.layersChecked.length === 1 && this.layersChecked[0].baseLayer) ||\n      base === this.layersChecked.length\n    ) {\n      response = false;\n    }\n    return response;\n  }\n\n  /*\n   * When multiple layers is selected but some may be allow to move\n   */\n  raisableLayer(index: number) {\n    if (index < 1) {\n      return false;\n    }\n\n    if (this.layers[index - 1].options.check) {\n      return this.raisableLayer(index - 1);\n    }\n    return true;\n  }\n\n  raiseLayers(layers: Layer[], fromUi: boolean = true) {\n    const layersToRaise = [];\n    for (const layer of layers) {\n      const index = this.layers.findIndex((lay) => lay.id === layer.id);\n      if (this.raisableLayer(index)) {\n        layersToRaise.push(layer);\n      }\n    }\n    this.map.raiseLayers(layersToRaise);\n    if (fromUi) {\n      setTimeout(() => {\n        const elements = this.computeElementRef();\n        if (!this.isScrolledIntoView(elements[0], elements[1].offsetParent)) {\n          elements[0].scrollTop = elements[1].offsetParent.offsetTop;\n        }\n      }, 100);\n    }\n  }\n  /*\n   * For selection mode disabled attribute\n   */\n  lowerableLayers(layers: Layer[]) {\n    let response = false;\n    let base = 0;\n    for (const layer of layers) {\n      const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n      const currentLayer = this.layers[mapIndex];\n      if (currentLayer.baseLayer) {\n        base += 1;\n      }\n\n      const nextLayer = this.layers[mapIndex + 1];\n      if (\n        nextLayer &&\n        nextLayer.baseLayer !== true &&\n        !layers.find((lay) => nextLayer.id === lay.id)\n      ) {\n        response = true;\n      }\n    }\n\n    if (\n      (this.layersChecked.length === 1 && this.layersChecked[0].baseLayer) ||\n      base === this.layersChecked.length\n    ) {\n      response = false;\n    }\n    return response;\n  }\n\n  /*\n   * When multiple layers is selected but some may be allow to move\n   */\n  lowerableLayer(index: number) {\n    if (\n      index >\n      this.layers.filter((lay) => lay.baseLayer !== true).length - 2\n    ) {\n      return false;\n    }\n\n    if (this.layers[index + 1].options.check) {\n      return this.lowerableLayer(index + 1);\n    }\n    return true;\n  }\n\n  lowerLayers(layers: Layer[], fromUi: boolean = true) {\n    const layersToLower = [];\n    for (const layer of layers) {\n      const index = this.layers.findIndex((lay) => lay.id === layer.id);\n      if (this.lowerableLayer(index)) {\n        layersToLower.push(layer);\n      }\n    }\n    this.map.lowerLayers(layersToLower);\n    if (fromUi) {\n      setTimeout(() => {\n        const elements = this.computeElementRef('lower');\n        if (!this.isScrolledIntoView(elements[0], elements[1].offsetParent)) {\n          elements[0].scrollTop =\n            elements[1].offsetParent.offsetTop +\n            elements[1].offsetParent.offsetHeight -\n            elements[0].clientHeight;\n        }\n      }, 100);\n    }\n  }\n  private next() {\n    this.change$.next();\n  }\n\n  private computeLayers(layers: Layer[]): Layer[] {\n    let layersOut = this.filterLayers(layers);\n    if (this.sortAlpha) {\n      layersOut = this.sortLayersByTitle(layersOut);\n    } else {\n      layersOut = this.sortLayersByZindex(layersOut);\n    }\n    return layersOut;\n  }\n\n  onKeywordChange(term) {\n    this.keyword = term;\n  }\n\n  onAppliedFilterAndSortChange(appliedFilter: LayerListControlsOptions) {\n    this.keyword = appliedFilter.keyword;\n    this.onlyVisible = appliedFilter.onlyVisible;\n    this.sortAlpha = appliedFilter.sortAlpha;\n  }\n\n  private filterLayers(layers: Layer[]): Layer[] {\n    if (\n      this.layerFilterAndSortOptions.showToolbar === LayerListControlsEnum.never\n    ) {\n      return layers;\n    }\n    if (!this.keyword && !this.onlyVisible) {\n      return layers;\n    }\n\n    const keepLayerIds = layers.map((layer: Layer) => layer.id);\n\n    layers.forEach((layer: Layer) => {\n      const layerOptions = (layer.options as MetadataLayerOptions) || {};\n      const dataSourceOptions = layer.dataSource.options || {};\n      const metadata = layerOptions.metadata || ({} as MetadataOptions);\n      const keywords = metadata.keywordList || [];\n      const layerKeywords = keywords.map((kw: string) => {\n        return kw.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n      });\n\n      if (this.keyword && layer.title) {\n        const localKeyword = this.keyword\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        const layerTitle = layer.title\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        const dataSourceType = dataSourceOptions.type || '';\n        const keywordRegex = new RegExp(localKeyword, 'gi');\n        const keywordInList =\n          layerKeywords.find((kw: string) => keywordRegex.test(kw)) !==\n          undefined;\n        if (\n          !keywordRegex.test(layerTitle) &&\n          !(this.keyword.toLowerCase() === dataSourceType.toLowerCase()) &&\n          !keywordInList\n        ) {\n          const index = keepLayerIds.indexOf(layer.id);\n          if (index > -1) {\n            keepLayerIds.splice(index, 1);\n          }\n        }\n      }\n\n      if (this.onlyVisible && layer.visible === false) {\n        const index = keepLayerIds.indexOf(layer.id);\n        if (index > -1) {\n          keepLayerIds.splice(index, 1);\n        }\n      }\n    });\n\n    return layers.filter(\n      (layer: Layer) => keepLayerIds.indexOf(layer.id) !== -1\n    );\n  }\n\n  private sortLayersByZindex(layers: Layer[]) {\n    return layers.sort((layer1, layer2) => layer2.zIndex - layer1.zIndex);\n  }\n\n  private sortLayersByTitle(layers: Layer[]) {\n    return layers.sort((a, b) => {\n      if (this.normalize(a.title) < this.normalize(b.title)) {\n        return -1;\n      }\n      if (this.normalize(a.title) > this.normalize(b.title)) {\n        return 1;\n      }\n      return 0;\n    });\n  }\n\n  private normalize(str: string) {\n    return str\n      .normalize('NFD')\n      .replace(/[\\u0300-\\u036f]/g, '')\n      .toLowerCase();\n  }\n\n  private computeShowToolbar(): boolean {\n    switch (this.layerFilterAndSortOptions.showToolbar) {\n      case LayerListControlsEnum.always:\n        return true;\n      case LayerListControlsEnum.never:\n        return false;\n      default:\n        if (\n          this.layers.length >= this.thresholdToFilterAndSort ||\n          this.keyword ||\n          this.onlyVisible\n        ) {\n          return true;\n        }\n        return false;\n    }\n  }\n\n  toggleLayerTool(layer) {\n    this.toggleOpacity = false;\n    if (this.layerTool && layer === this.activeLayer) {\n      this.layerTool = false;\n    } else {\n      this.layerTool = true;\n    }\n\n    for (const lay of this.layers) {\n      lay.options.active = false;\n    }\n    layer.options.active = true;\n    this.activeLayer = layer;\n  }\n\n  removeLayers(layers?: Layer[]) {\n    if (layers && layers.length > 0) {\n      this.layersChecked = [];\n      for (const layer of layers) {\n        if (layer.options.removable !== false) {\n          layer.map.removeLayer(layer);\n        } else {\n          this.layersChecked.push(layer);\n        }\n      }\n    } else if (!layers && this.activeLayer.options.removable !== false) {\n      this.activeLayer.map.removeLayer(this.activeLayer);\n      this.layerTool = false;\n    }\n  }\n\n  toggleVisibility(layers?: Layer[]) {\n    if (layers && layers.length > 0) {\n      for (const layer of layers) {\n        layer.visible = this.hideSelectedLayers;\n      }\n    }\n    this.layerItemChangeDetection$.next(true);\n  }\n\n  isLayerRemovable(layer: Layer): boolean {\n    return layer.options.removable !== false;\n  }\n\n  isAllLayersRemovable(layers: Layer[]): boolean {\n    return layers.every(l => this.isLayerRemovable(l));\n  }\n\n  get statusSelectedLayersCheck(): LayerListSelectVisibleEnum {\n    let statusSelectedLayers: LayerListSelectVisibleEnum =\n      LayerListSelectVisibleEnum.NULL;\n    let findTrue: boolean = false;\n    let findFalse: boolean = false;\n\n    if (this.layersChecked.length === 0) {\n      statusSelectedLayers = LayerListSelectVisibleEnum.NULL;\n    } else {\n      statusSelectedLayers = LayerListSelectVisibleEnum.MIXED;\n      this.hideSelectedLayers = false;\n\n      for (const layer2 of this.layersChecked) {\n        if (layer2.visible === true) {\n          findTrue = true;\n        }\n        if (layer2.visible === false) {\n          findFalse = true;\n        }\n      }\n\n      if (findTrue === true && findFalse === false) {\n        statusSelectedLayers = LayerListSelectVisibleEnum.ALL_VISIBLE;\n      }\n      if (findTrue === false && findFalse === true) {\n        statusSelectedLayers = LayerListSelectVisibleEnum.ALL_HIDDEN;\n        this.hideSelectedLayers = true;\n      }\n    }\n\n    return statusSelectedLayers;\n  }\n\n  layersCheck(event: { layer: Layer; check: boolean }) {\n    event.layer.options.check = event.check;\n    if (event.check === true) {\n      const eventMapIndex = this.layers.findIndex(\n        (layer) => event.layer.id === layer.id\n      );\n      for (const layer of this.layersChecked) {\n        const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n        if (eventMapIndex < mapIndex) {\n          this.layersChecked.splice(\n            this.layersChecked.findIndex((lay) => layer.id === lay.id),\n            0,\n            event.layer\n          );\n\n          if (this.excludeBaseLayers) {\n            if (\n              this.layersChecked.length ===\n              this.layers.filter(\n                (lay) => lay.baseLayer !== true && lay.showInLayerList\n              ).length\n            ) {\n              this.selectAllCheck = true;\n            } else {\n              this.selectAllCheck = false;\n            }\n          } else if (!this.excludeBaseLayers) {\n            if (\n              this.layersChecked.length ===\n              this.layers.filter((lay) => lay.showInLayerList).length\n            ) {\n              this.selectAllCheck = true;\n            } else {\n              this.selectAllCheck = false;\n            }\n          }\n          return;\n        }\n      }\n      this.layersChecked.push(event.layer);\n    } else {\n      const index = this.layersChecked.findIndex(\n        (layer) => event.layer.id === layer.id\n      );\n      this.layersChecked.splice(index, 1);\n    }\n\n    if (this.excludeBaseLayers) {\n      if (\n        this.layersChecked.length ===\n        this.layers.filter(\n          (lay) => lay.baseLayer !== true && lay.showInLayerList\n        ).length\n      ) {\n        this.selectAllCheck = true;\n      } else {\n        this.selectAllCheck = false;\n      }\n    } else if (!this.excludeBaseLayers) {\n      if (\n        this.layersChecked.length ===\n        this.layers.filter((lay) => lay.showInLayerList).length\n      ) {\n        this.selectAllCheck = true;\n      } else {\n        this.selectAllCheck = false;\n      }\n    }\n  }\n\n  toggleSelectionMode(value: boolean) {\n    this.selection = value;\n    this.activeLayer = undefined;\n    if (value === true) {\n      this.layerTool = false;\n      for (const layer of this.layers) {\n        if (layer.options.check) {\n          this.layersChecked.push(layer);\n        }\n      }\n    }\n  }\n\n  layersCheckedOpacity(): any {\n    if (this.layersChecked.length > 1) {\n      return 1;\n    } else {\n      const opacity = [];\n      for (const layer of this.layersChecked) {\n        opacity.push(layer.opacity);\n      }\n      return opacity;\n    }\n  }\n\n  selectAll() {\n    if (!this.selectAllCheck) {\n      for (const layer of this.layers) {\n        if (\n          this.excludeBaseLayers &&\n          layer.baseLayer !== true &&\n          layer.showInLayerList\n        ) {\n          layer.options.check = true;\n          this.layersChecked.push(layer);\n        } else if (!this.excludeBaseLayers && layer.showInLayerList) {\n          layer.options.check = true;\n          this.layersChecked.push(layer);\n        }\n      }\n      this.selectAllCheck$.next(true);\n    } else {\n      for (const layer of this.layers) {\n        layer.options.check = false;\n      }\n      this.layersChecked = [];\n      this.selectAllCheck$.next(false);\n    }\n  }\n\n  isScrolledIntoView(elemSource, elem) {\n    const docViewTop = elemSource.scrollTop;\n    const docViewBottom = docViewTop + elemSource.clientHeight;\n\n    const elemTop = elem.offsetTop;\n    const elemBottom = elemTop + elem.clientHeight;\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\n  }\n\n  computeElementRef(type?: string) {\n    const checkItems = this.elRef.nativeElement.getElementsByClassName(\n      'mat-checkbox-checked'\n    );\n    const checkItem =\n      type === 'lower'\n        ? this.elRef.nativeElement.getElementsByClassName(\n          'mat-checkbox-checked'\n        )[checkItems.length - 1]\n        : this.elRef.nativeElement.getElementsByClassName(\n          'mat-checkbox-checked'\n        )[0];\n    const igoList = this.elRef.nativeElement.getElementsByTagName(\n      'igo-list'\n    )[0];\n\n    return [igoList, checkItem];\n  }\n\n  removeProblemLayerInList(layersList: Layer[]): Layer[] {\n    for (const layer of layersList) {\n      if (layer.olLoadingProblem === true) {\n        this.map.removeLayer(layer);\n      }\n    }\n    return layersList;\n  }\n}\n","  <mat-list-item>\n      <mat-form-field class=\"inputFilter\" [floatLabel]=\"floatLabel\">\n        <input\n          matInput\n          [placeholder]=\"'igo.geo.layer.filterPlaceholder' | translate\"\n          [matTooltip]=\"'igo.geo.layer.subsetLayersListKeyword' | translate\"\n          matTooltipShowDelay=\"500\"\n          type=\"text\" [(ngModel)]=\"term\">\n        <button\n          mat-button\n          *ngIf=\"term\"\n          matSuffix\n          mat-icon-button\n          aria-label=\"Clear\"\n          color=\"warn\"\n          (click)=\"clearTerm()\">\n          <mat-icon svgIcon=\"close\"></mat-icon>\n        </button>\n      </mat-form-field>\n\n      <div [matTooltip]=\"sortAlpha ?\n      ('igo.geo.layer.sortMapOrder' | translate) :\n      ('igo.geo.layer.sortAlphabetically' | translate)\" matTooltipShowDelay=\"500\">\n        <button class=\"sort-alpha\" [color]=\"sortAlpha ? 'warn' : 'primary'\" mat-icon-button (click)=\"toggleSortAlpha()\">\n          <mat-icon [svgIcon]=\"sortAlpha ? 'sort-ascending' : 'sort-alphabetical-ascending'\"></mat-icon>\n        </button>\n      </div>\n\n       <div [matTooltip]=\"onlyVisible ?\n        ('igo.geo.layer.resetLayersList' | translate) :\n        ('igo.geo.layer.subsetLayersListOnlyVisible' | translate)\" matTooltipShowDelay=\"500\">\n         <button class=\"only-visible\" mat-icon-button [disabled]=\"layersAreAllVisible && !onlyVisible\"\n           [color]=\"onlyVisible ? 'warn' : 'primary'\" (click)=\"toggleOnlyVisible()\">\n           <mat-icon\n             matBadge=\"icon\"\n             igoMatBadgeIcon=\"eye\"\n             igoMatBadgeInverseColor=\"true\"\n             igoMatBadgeInheritColor=\"true\"\n             [svgIcon]=\"onlyVisible ? 'filter-remove' : 'filter'\">\n           </mat-icon>\n         </button>\n       </div>\n\n       <div [matTooltip]=\"selectionMode ?\n        ('igo.geo.layer.deactivateSelectionMode' | translate) :\n        ('igo.geo.layer.activateSelectionMode' | translate)\" matTooltipShowDelay=\"500\">\n         <button class=\"selection-mode\" mat-icon-button\n           color=\"primary\" (click)=\"toggleSelectionMode()\">\n           <mat-icon [svgIcon]=\"selectionMode ? 'checkbox-multiple-marked-outline' : 'checkbox-multiple-blank-outline'\"></mat-icon>\n         </button>\n       </div>\n\n</mat-list-item>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  OnInit,\n  EventEmitter,\n  Output,\n  OnDestroy\n} from '@angular/core';\nimport { FloatLabelType } from '@angular/material/form-field';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { LayerListControlsOptions } from './layer-list-tool.interface';\n\n@Component({\n  selector: 'igo-layer-list-tool',\n  templateUrl: './layer-list-tool.component.html',\n  styleUrls: ['./layer-list-tool.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerListToolComponent implements OnInit, OnDestroy {\n  public onlyVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public sortAlpha$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public term$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n  onlyVisible$$: Subscription;\n  sortAlpha$$: Subscription;\n  term$$: Subscription;\n\n  @Input() layersAreAllVisible: boolean = true;\n\n  @Input() floatLabel: FloatLabelType = 'auto';\n\n  @Input()\n  set onlyVisible(value: boolean) {\n    this.onlyVisible$.next(value);\n  }\n  get onlyVisible(): boolean {\n    return this.onlyVisible$.value;\n  }\n\n  @Input()\n  set sortAlpha(value: boolean) {\n    this.sortAlpha$.next(value);\n  }\n  get sortAlpha(): boolean {\n    return this.sortAlpha$.value;\n  }\n\n  @Input()\n  set term(value: string) {\n    this.term$.next(value);\n  }\n  get term(): string {\n    return this.term$.value;\n  }\n\n  public selectionMode = false;\n\n  @Output() appliedFilterAndSort = new EventEmitter<LayerListControlsOptions>();\n  @Output() selection = new EventEmitter<boolean>();\n\n  ngOnInit(): void {\n    this.term$$ = this.term$.subscribe(keyword => {\n      this.appliedFilterAndSort.emit({\n        keyword,\n        onlyVisible: this.onlyVisible,\n        sortAlpha: this.sortAlpha\n      });\n    });\n\n    this.onlyVisible$$ = this.onlyVisible$.subscribe(onlyVisible => {\n      this.appliedFilterAndSort.emit({\n        keyword: this.term,\n        onlyVisible,\n        sortAlpha: this.sortAlpha\n      });\n    });\n    this.sortAlpha$$ = this.sortAlpha$.subscribe(sortAlpha => {\n      this.appliedFilterAndSort.emit({\n        keyword: this.term,\n        onlyVisible: this.onlyVisible,\n        sortAlpha\n      });\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.onlyVisible$$.unsubscribe();\n    this.sortAlpha$$.unsubscribe();\n    this.term$$.unsubscribe();\n  }\n\n  clearTerm() {\n    this.term = undefined;\n  }\n  toggleSortAlpha() {\n    this.sortAlpha = !this.sortAlpha;\n  }\n\n  toggleOnlyVisible() {\n    this.onlyVisible = !this.onlyVisible;\n  }\n\n  toggleSelectionMode() {\n    this.selectionMode = !this.selectionMode;\n    this.selection.emit(this.selectionMode);\n  }\n}\n","import { Directive, Self, OnInit, OnDestroy, Optional } from '@angular/core';\nimport { Subscription, combineLatest } from 'rxjs';\n\nimport { RouteService } from '@igo2/core';\nimport { MapService } from '../../map/shared/map.service';\nimport { LayerListComponent } from './layer-list.component';\nimport { Layer } from '../shared/layers/layer';\nimport { map, debounceTime } from 'rxjs/operators';\n\n@Directive({\n  selector: '[igoLayerListBinding]'\n})\nexport class LayerListBindingDirective implements OnInit, OnDestroy {\n  private component: LayerListComponent;\n  private layersOrResolutionChange$$: Subscription;\n  layersVisibility$$: Subscription;\n\n  constructor(\n    @Self() component: LayerListComponent,\n    private mapService: MapService,\n    @Optional() private route: RouteService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input layers\n    // this.component.layers = [];\n    this.layersOrResolutionChange$$ = combineLatest([\n      this.mapService.getMap().layers$,\n      this.mapService.getMap().viewController.resolution$]\n    ).pipe(\n      debounceTime(10)\n    ).subscribe((bunch: [Layer[], number]) => {\n      const shownLayers = bunch[0].filter((layer: Layer) => {\n        return layer.showInLayerList === true;\n      });\n      this.component.layers = shownLayers;\n      this.setLayersVisibilityStatus(shownLayers, this.component.excludeBaseLayers);\n    });\n  }\n\n  private setLayersVisibilityStatus(layers: Layer[], excludeBaseLayers: boolean) {\n    if (this.layersVisibility$$ !== undefined) {\n      this.layersVisibility$$.unsubscribe();\n      this.layersVisibility$$ = undefined;\n    }\n    this.layersVisibility$$ = combineLatest(layers\n      .filter(layer => layer.baseLayer !== excludeBaseLayers )\n      .map((layer: Layer) => layer.visible$))\n      .pipe(map((visibles: boolean[]) => visibles.every(Boolean)))\n      .subscribe((allLayersAreVisible: boolean) =>\n        this.component.layersAreAllVisible = allLayersAreVisible);\n  }\n\n  ngOnDestroy() {\n    this.layersOrResolutionChange$$.unsubscribe();\n    if (this.layersVisibility$$ !== undefined) {\n      this.layersVisibility$$.unsubscribe();\n      this.layersVisibility$$ = undefined;\n    }\n  }\n\n}\n","\n<div class=\"layer-legend-list-container\">\n  <mat-slide-toggle \n  tooltip-position=\"above\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.layer.legend.showAll' | translate\"\n  [checked]=\"showAllLegendsValue\" class=\"mat-typography\" \n  *ngIf=\"(layersInUi$ | async).length && allowShowAllLegends\" [labelPosition]=\"'before'\" (change)=\"toggleShowAllLegends($event.checked)\">\n    {{'igo.geo.layer.legend.showAll' | translate}}\n  </mat-slide-toggle>\n  <mat-divider *ngIf=\"(layersInUi$ | async).length && allowShowAllLegends\"></mat-divider>\n  <igo-list [navigation]=\"false\" [selection]=\"false\">\n    <ng-template ngFor let-layer let-i=\"index\" [ngForOf]=\"layers$ | async\">\n      <igo-layer-legend-item *ngIf=\"!(excludeBaseLayers && layer.baseLayer)\"\n          igoListItem [layer]=\"layer\"\n          [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\">\n      </igo-layer-legend-item>\n    </ng-template>\n  </igo-list>\n  <p class=\"layers-empty mat-typography\" \n    *ngIf=\"!showAllLegendsValue && (layersInUi$ | async).length && (hasVisibleOrInRangeLayers$ | async)===false && (hasVisibleAndNotInRangeLayers$ | async)===false && allowShowAllLegends\">\n    {{'igo.geo.layer.legend.noLayersVisibleWithShowAllButton' | translate}} \n  </p>\n  <p class=\"layers-empty mat-typography\" \n    *ngIf=\"!showAllLegendsValue && (layersInUi$ | async).length && (hasVisibleOrInRangeLayers$ | async)===false && (hasVisibleAndNotInRangeLayers$ | async) && allowShowAllLegends\">\n    {{'igo.geo.layer.legend.noLayersVisibleWithShowAllButtonButZoom' | translate}} \n  </p>\n  <p class=\"layers-empty mat-typography\"\n    *ngIf=\"(layersInUi$ | async).length && (hasVisibleOrInRangeLayers$ | async)===false && (hasVisibleAndNotInRangeLayers$ | async)===false && !allowShowAllLegends\">\n    {{'igo.geo.layer.legend.noLayersVisible' | translate}} \n  </p>\n  <p class=\"layers-empty mat-typography\"\n    *ngIf=\"(layersInUi$ | async).length && (hasVisibleOrInRangeLayers$ | async)===false && (hasVisibleAndNotInRangeLayers$ | async) && !allowShowAllLegends\">\n    {{'igo.geo.layer.legend.noLayersVisibleButZoom' | translate}} \n  </p>\n\n</div>","import { Component, Input, ChangeDetectionStrategy, OnInit, OnDestroy, EventEmitter, Output } from '@angular/core';\nimport { Layer } from '../shared';\nimport { BehaviorSubject, ReplaySubject, Subscription, EMPTY, timer } from 'rxjs';\nimport { debounce } from 'rxjs/operators';\n\n@Component({\n  selector: 'igo-layer-legend-list',\n  templateUrl: './layer-legend-list.component.html',\n  styleUrls: ['./layer-legend-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerLegendListComponent implements OnInit, OnDestroy {\n  orderable = true;\n\n  hasVisibleOrInRangeLayers$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  hasVisibleAndNotInRangeLayers$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  layersInUi$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n  showAllLegend: boolean = false;\n  public change$ = new ReplaySubject<void>(1);\n  private change$$: Subscription;\n  @Input()\n  set layers(value: Layer[]) {\n    this._layers = value;\n    this.next();\n  }\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  private _layers: Layer[];\n  @Input() excludeBaseLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() allowShowAllLegends: boolean = false;\n\n  @Input() showAllLegendsValue: boolean = false;\n\n  @Output() allLegendsShown = new EventEmitter<boolean>(false);\n\n  constructor() { }\n  ngOnInit(): void {\n    this.change$$ = this.change$\n      .pipe(debounce(() => {\n        return this.layers.length === 0 ? EMPTY : timer(50);\n      }))\n      .subscribe(() => {\n        const layers = this.computeShownLayers(this.layers.slice(0));\n        this.layers$.next(layers);\n        this.hasVisibleOrInRangeLayers$.next(\n          this.layers.slice(0)\n            .filter(layer => layer.baseLayer !== true)\n            .filter(layer => layer.visible$.value && layer.isInResolutionsRange$.value).length > 0\n        );\n        this.hasVisibleAndNotInRangeLayers$.next(\n          this.layers.slice(0)\n            .filter(layer => layer.baseLayer !== true)\n            .filter(layer => layer.visible$.value && !layer.isInResolutionsRange$.value).length > 0\n        );\n\n        this.layersInUi$.next(\n          this.layers.slice(0).filter(layer => layer.showInLayerList !== false && (!this.excludeBaseLayers || !layer.baseLayer))\n        );\n      });\n  }\n\n  ngOnDestroy() {\n    this.change$$.unsubscribe();\n  }\n  private next() {\n    this.change$.next();\n  }\n  private computeShownLayers(layers: Layer[]) {\n    let shownLayers = layers.filter((layer: Layer) => layer.visible && layer.isInResolutionsRange);\n    if (this.showAllLegendsValue) {\n      shownLayers = layers;\n    }\n    return this.sortLayersByZindex(shownLayers);\n  }\n  private sortLayersByZindex(layers: Layer[]) {\n    return layers.sort((layer1, layer2) => layer2.zIndex - layer1.zIndex);\n  }\n\n  toggleShowAllLegends(toggle: boolean) {\n      this.showAllLegendsValue = toggle;\n      this.next();\n      this.allLegendsShown.emit(toggle);\n  }\n}\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\nimport { Subscription, combineLatest } from 'rxjs';\n\nimport { MapService } from '../../map/shared/map.service';\nimport { Layer } from '../shared/layers/layer';\nimport { debounceTime } from 'rxjs/operators';\nimport { LayerLegendListComponent } from './layer-legend-list.component';\n\n@Directive({\n  selector: '[igoLayerLegendListBinding]'\n})\nexport class LayerLegendListBindingDirective implements OnInit, OnDestroy {\n  private component: LayerLegendListComponent;\n  private layersOrResolutionChange$$: Subscription;\n  layersVisibility$$: Subscription;\n\n  constructor(\n    @Self() component: LayerLegendListComponent,\n    private mapService: MapService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input layers\n    this.component.layers = [];\n    this.layersOrResolutionChange$$ = combineLatest([\n      this.mapService.getMap().layers$,\n      this.mapService.getMap().viewController.resolution$]\n    ).pipe(\n      debounceTime(10)\n    ).subscribe((bunch: [Layer[], number]) => {\n      const shownLayers = bunch[0].filter((layer: Layer) => {\n        return layer.showInLayerList === true;\n      });\n      this.component.layers = shownLayers;\n\n      this.layersVisibility$$ = combineLatest(shownLayers\n        .map((layer: Layer) => layer.visible$))\n        .subscribe((r) => {\n          this.component.change$.next();\n        }\n        );\n    });\n  }\n\n  ngOnDestroy() {\n    this.layersOrResolutionChange$$.unsubscribe();\n    if (this.layersVisibility$$ !== undefined) {\n      this.layersVisibility$$.unsubscribe();\n      this.layersVisibility$$ = undefined;\n    }\n  }\n\n}\n","<button *ngIf=\"options.trackFeature\"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.layer.trackFeature' | translate\"\n  [color]=\"color\"\n  (click)=\"toggleTrackFeature()\">\n  <mat-icon svgIcon=\"crosshairs-gps\"></mat-icon>\n</button>\n","import { Component, Input, ChangeDetectionStrategy, OnInit } from '@angular/core';\n\nimport { VectorLayer } from '../shared/layers';\nimport { VectorLayerOptions } from '../shared/layers/vector-layer.interface';\n\n@Component({\n  selector: 'igo-track-feature-button',\n  templateUrl: './track-feature-button.component.html',\n  styleUrls: ['./track-feature-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class TrackFeatureButtonComponent implements OnInit {\n\n  @Input() layer: VectorLayer;\n\n  @Input() trackFeature = false;\n\n  get options(): VectorLayerOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.options;\n  }\n\n  public color: string = 'primary';\n\n  constructor() {}\n\n  ngOnInit() {\n    this.color = this.trackFeature ? 'primary' : 'basic';\n  }\n\n  toggleTrackFeature() {\n    if (this.trackFeature) {\n      this.layer.disableTrackFeature(this.layer.options.trackFeature);\n      this.color = 'basic';\n    } else {\n      this.layer.enableTrackFeature(this.layer.options.trackFeature);\n      this.color = 'primary';\n    }\n    this.trackFeature = !this.trackFeature;\n  }\n}\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy\n} from '@angular/core';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\nimport { Layer, TooltipType } from '../shared/layers';\nimport { NetworkService, ConnectionState } from '@igo2/core';\n\n@Component({\n  selector: 'igo-layer-legend-item',\n  templateUrl: './layer-legend-item.component.html',\n  styleUrls: ['./layer-legend-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerLegendItemComponent implements OnInit, OnDestroy {\n\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  tooltipText: string;\n\n  state: ConnectionState;\n\n  private resolution$$: Subscription;\n  private network$$: Subscription;\n\n  @Input() layer: Layer;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  constructor(private networkService: NetworkService) {}\n\n  ngOnInit() {\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.onResolutionChange();\n    });\n    this.tooltipText = this.computeTooltip();\n\n    this.network$$ = this.networkService.currentState().subscribe((state: ConnectionState) => {\n      this.state = state;\n      this.onResolutionChange();\n    });\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n    this.network$$.unsubscribe();\n  }\n\n  computeTooltip(): string {\n    const layerOptions = this.layer.options;\n    if (!layerOptions.tooltip) {\n      return this.layer.title;\n    }\n    const layerTooltip = layerOptions.tooltip;\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n    switch (layerOptions.tooltip.type) {\n      case TooltipType.TITLE:\n        return this.layer.title;\n      case TooltipType.ABSTRACT:\n        if (layerMetadata && layerMetadata.abstract) {\n          return layerMetadata.abstract;\n        } else {\n          return this.layer.title;\n        }\n      case TooltipType.CUSTOM:\n        if (layerTooltip && layerTooltip.text) {\n          return layerTooltip.text;\n        } else {\n          return this.layer.title;\n        }\n      default:\n        return this.layer.title;\n    }\n  }\n\n  private onResolutionChange() {\n    const inResolutionRange = this.layer.isInResolutionsRange;\n    this.inResolutionRange$.next(inResolutionRange);\n  }\n}\n","<mat-list-item class= \"igo-layer-list-item\">\n  <h4 matLine class=\"igo-layer-title\" [matTooltip]=\"tooltipText\" matTooltipShowDelay=\"500\">{{layer.title}}</h4>\n</mat-list-item>\n\n<div #legend class=\"igo-layer-legend-container\">\n  <igo-layer-legend\n    [layer]=\"layer\"\n    [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\">\n  </igo-layer-legend>\n</div>\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatSliderModule } from '@angular/material/slider';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoListModule,\n  IgoCollapsibleModule,\n  IgoImageModule,\n  IgoPanelModule,\n  IgoMatBadgeIconModule,\n  IgoCustomHtmlModule\n} from '@igo2/common';\n\nimport { LayerService } from './shared/layer.service';\nimport { StyleService } from './shared/style.service';\nimport { LayerListToolService } from './layer-list-tool/layer-list-tool.service';\nimport { LayerItemComponent } from './layer-item/layer-item.component';\nimport { LayerLegendComponent } from './layer-legend/layer-legend.component';\nimport { LayerListComponent } from './layer-list/layer-list.component';\nimport { LayerListToolComponent } from './layer-list-tool/layer-list-tool.component';\nimport { LayerListBindingDirective } from './layer-list/layer-list-binding.directive';\nimport { LayerLegendListBindingDirective } from './layer-legend-list/layer-legend-list-binding.directive';\nimport { TrackFeatureButtonComponent } from './track-feature-button/track-feature-button.component';\nimport { LayerLegendListComponent } from './layer-legend-list/layer-legend-list.component';\nimport { LayerLegendItemComponent } from './layer-legend-item/layer-legend-item.component';\n\n@NgModule({\n  imports: [\n    MatInputModule,\n    MatFormFieldModule,\n    CommonModule,\n    FormsModule,\n    MatDividerModule,\n    MatMenuModule,\n    MatIconModule,\n    MatButtonModule,\n    MatSlideToggleModule,\n    MatSelectModule,\n    MatTooltipModule,\n    MatListModule,\n    MatSliderModule,\n    MatBadgeModule,\n    MatCheckboxModule,\n    IgoLanguageModule,\n    IgoListModule,\n    IgoCollapsibleModule,\n    IgoImageModule,\n    IgoPanelModule,\n    IgoMatBadgeIconModule,\n    IgoCustomHtmlModule\n  ],\n  exports: [\n    LayerItemComponent,\n    LayerLegendItemComponent,\n    LayerLegendComponent,\n    LayerListComponent,\n    LayerListToolComponent,\n    LayerLegendListComponent,\n    LayerListBindingDirective,\n    LayerLegendListBindingDirective,\n    TrackFeatureButtonComponent\n  ],\n  declarations: [\n    LayerItemComponent,\n    LayerLegendItemComponent,\n    LayerLegendComponent,\n    LayerListComponent,\n    LayerListToolComponent,\n    LayerLegendListComponent,\n    LayerListBindingDirective,\n    LayerLegendListBindingDirective,\n    TrackFeatureButtonComponent\n  ]\n})\nexport class IgoLayerModule {\n  static forRoot(): ModuleWithProviders<IgoLayerModule> {\n    return {\n      ngModule: IgoLayerModule,\n      providers: [LayerService, StyleService, LayerListToolService]\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoMatBadgeIconModule,\n  IgoCollapsibleModule,\n  IgoListModule\n} from '@igo2/common';\n\nimport { IgoMetadataModule } from './../../metadata/metadata.module';\nimport { CatalogBrowserComponent } from './catalog-browser.component';\nimport { CatalogBrowserLayerComponent } from './catalog-browser-layer.component';\nimport { CatalogBrowserGroupComponent } from './catalog-browser-group.component';\nimport { IgoLayerModule } from '../../layer/layer.module';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatBadgeModule,\n    MatButtonModule,\n    MatIconModule,\n    MatListModule,\n    MatTooltipModule,\n    IgoMatBadgeIconModule,\n    IgoLanguageModule,\n    IgoListModule,\n    IgoCollapsibleModule,\n    IgoMetadataModule,\n    IgoLayerModule\n  ],\n  exports: [\n    CatalogBrowserComponent\n  ],\n  declarations: [\n    CatalogBrowserComponent,\n    CatalogBrowserGroupComponent,\n    CatalogBrowserLayerComponent\n  ]\n})\nexport class IgoCatalogBrowserModule {}\n","<h1 mat-dialog-title class=\"mat-typography\">{{'igo.geo.catalog.library.addTitle' | translate}}</h1>\n<div mat-dialog-content class=\"mat-typography\">\n  <form class=\"igo-form\" [formGroup]=\"form\">\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <input type=\"text\" formControlName=\"title\" placeholder=\"{{'igo.geo.printForm.title' | translate}}\" matInput [matAutocomplete]=\"auto2\">\n        <mat-autocomplete #auto2=\"matAutocomplete\" (optionSelected)='changeUrlOrTitle($event.option.value)'>\n          <mat-option *ngFor=\"let predefinedCatalog of (predefinedCatalogsList$ | async)\" matTooltipShowDelay=\"500\"\n            [matTooltip]=\"predefinedCatalog.title\" [value]=\"predefinedCatalog\">\n            {{predefinedCatalog.title}}\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <input type=\"text\" formControlName=\"url\" placeholder=\"URL\" matInput [matAutocomplete]=\"auto\">\n        <mat-autocomplete #auto=\"matAutocomplete\" (optionSelected)='changeUrlOrTitle($event.option.value)'>\n          <mat-option *ngFor=\"let predefinedCatalog of (predefinedCatalogsList$ | async)\" matTooltipShowDelay=\"500\"\n            [matTooltip]=\"predefinedCatalog.url\" [value]=\"predefinedCatalog\">\n            {{predefinedCatalog.url}}\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <mat-select\n          formControlName=\"type\"\n          placeholder=\"Type\">\n          <mat-option\n            *ngFor=\"let type of typeCapabilities\"\n            [value]=\"type\"\n            (click)=\"$event.stopPropagation()\">\n              <p mat-line>{{type}}</p>\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </form>\n  <span *ngIf=\"error && addedCatalog && emailAddress\">\n    <p class=\"error\">{{languageService.translate.instant('igo.geo.catalog.externalProvider.unavailableWithEmail', { value: addedCatalog.url, email: emailAddress })}}</p>\n  </span>\n  <span *ngIf=\"error && addedCatalog && !emailAddress\">\n    <p class=\"error\">{{languageService.translate.instant('igo.geo.catalog.unavailable', { value: addedCatalog.url })}}</p>\n  </span>\n</div>\n<div mat-dialog-actions style=\"justify-content: center\">\n  <div class=\"igo-form-button-group add-catalog-button-top-padding\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      (click)=\"cancel()\">\n      {{'igo.geo.catalog.library.cancel' | translate}}\n    </button>\n    <button\n      id=\"addCatalogBtnDialog\"\n      mat-raised-button\n      type=\"button\"\n      color=\"primary\"\n      [disabled]=\"!form.valid\"\n      (click)=\"addCatalog(form.value)\">\n      {{'igo.geo.catalog.library.add' | translate}}\n    </button>\n  </div>\n</div>","import { LanguageService, ConfigService } from '@igo2/core';\nimport { Component, OnInit, OnDestroy, Optional, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport { EntityStore } from '@igo2/common';\nimport { TypeCapabilities } from '../../datasource';\nimport { Catalog } from '../shared/catalog.abstract';\n\n@Component({\n  selector: 'igo-add-catalog-dialog',\n  templateUrl: './add-catalog-dialog.component.html',\n  styleUrls: ['./add-catalog-dialog.component.scss']\n})\nexport class AddCatalogDialogComponent implements OnInit, OnDestroy {\n  public form: FormGroup;\n  private defaultAddedCatalogType = 'wms';\n  private addedCatalogType$$: Subscription;\n  public predefinedCatalogsList$ = new BehaviorSubject<Catalog[]>([]);\n  typeCapabilities: string[];\n  predefinedCatalogs: Catalog[] = [];\n  store: EntityStore<Catalog>;\n  error = false;\n  addedCatalog: Catalog;\n  emailAddress: string;\n  private storeViewAll$$: Subscription;\n\n  constructor(\n    private formBuilder: FormBuilder,\n    public languageService: LanguageService,\n    private configService: ConfigService,\n    public dialogRef: MatDialogRef<AddCatalogDialogComponent>,\n    @Optional()\n    @Inject(MAT_DIALOG_DATA)\n    public data: { predefinedCatalogs: Catalog[]; store: EntityStore<Catalog>; error: boolean; addedCatalog: Catalog }\n  ) {\n    this.store = data.store;\n    this.predefinedCatalogs = data.predefinedCatalogs;\n    this.error = data.error;\n    this.addedCatalog = data.addedCatalog;\n    this.form = this.formBuilder.group({\n      id: ['', []],\n      title: ['', []],\n      url: ['', [Validators.required]],\n      type: [this.defaultAddedCatalogType, [Validators.required]]\n    });\n  }\n\n  ngOnInit() {\n    this.store.state.clear();\n    this.typeCapabilities = Object.keys(TypeCapabilities);\n\n    this.addedCatalogType$$ = this.form\n      .get('type')\n      .valueChanges.subscribe((value) => {\n        if (value === 'wmts') {\n          this.form.get('title').setValidators(Validators.required);\n        } else {\n          this.form.get('title').setValidators([]);\n        }\n        this.form.get('title').updateValueAndValidity();\n      });\n\n    this.computePredefinedCatalogList();\n    this.storeViewAll$$ = this.store.view\n      .all$()\n      .subscribe(() => this.computePredefinedCatalogList());\n\n    this.emailAddress = this.configService.getConfig('emailAddress');\n  }\n\n  ngOnDestroy() {\n    this.addedCatalogType$$.unsubscribe();\n    this.storeViewAll$$.unsubscribe();\n  }\n\n  changeUrlOrTitle(catalog: Catalog) {\n    this.form.patchValue(catalog);\n    this.error = false;\n    this.computePredefinedCatalogList();\n  }\n\n  computePredefinedCatalogList() {\n    this.predefinedCatalogsList$.next(\n      this.predefinedCatalogs.filter((c) => !this.store.get(c.id))\n    );\n  }\n\n  addCatalog(addedCatalog: Catalog) {\n    this.error = false;\n    this.dialogRef.close(addedCatalog);\n  }\n\n  cancel() {\n    this.error = false;\n    this.dialogRef.close();\n  }\n}\n","<igo-list [navigation]=\"false\">\n  <ng-template ngFor let-catalog [ngForOf]=\"getCatalogs() | async\">\n    <igo-catalog-library-item\n      igoListItem\n      color=\"accent\"\n      [map]=\"map\"\n      [catalog]=\"catalog\"\n      (catalogRemove)=\"onCatalogRemove(catalog)\"\n      (select)=\"onCatalogSelect(catalog)\">\n    </igo-catalog-library-item>\n  </ng-template>\n</igo-list>\n\n<div *ngIf=\"addCatalogAllowed\" class=btnAddCatalog>\n  <button\n    mat-raised-button\n    [matTooltip]=\"'igo.geo.catalog.library.addBtn' | translate\"\n    matTooltipPosition=\"above\"\n    color=\"primary\"\n    (click)=\"addCatalogDialog()\">\n    {{'igo.geo.catalog.library.addBtn' | translate}}\n    <mat-icon svgIcon=\"earth-plus\"></mat-icon>\n  </button>\n</div>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { EntityStore } from '@igo2/common';\nimport { LanguageService, MessageService, StorageService } from '@igo2/core';\nimport { ObjectUtils } from '@igo2/utils';\nimport { Observable, Subscription } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\nimport { Md5 } from 'ts-md5';\nimport { CapabilitiesService } from '../../datasource';\nimport { IgoMap } from '../../map';\nimport { standardizeUrl } from '../../utils/id-generator';\nimport { Catalog } from '../shared/catalog.abstract';\nimport { AddCatalogDialogComponent } from './add-catalog-dialog.component';\n\n/**\n * Component to browse a list of available catalogs\n */\n@Component({\n  selector: 'igo-catalog-library',\n  templateUrl: './catalog-library.component.html',\n  styleUrls: ['./catalog-library.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogLibaryComponent implements OnInit, OnDestroy {\n  /**\n   * Store holding the catalogs\n   */\n  @Input() store: EntityStore<Catalog>;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * Determine if the form to add a catalog is allowed\n   */\n  @Input() addCatalogAllowed: boolean = false;\n\n  /**\n   * Determine if the form to add a catalog is allowed\n   */\n  @Input() predefinedCatalogs: Catalog[] = [];\n\n  /**\n   * Event emitted a catalog is selected or unselected\n   */\n  @Output() catalogSelectChange = new EventEmitter<{\n    selected: boolean;\n    catalog: Catalog;\n  }>();\n\n  submitDisabled = true;\n  private addingCatalog$$: Subscription;\n\n  get addedCatalogs(): Catalog[] {\n    return (this.storageService.get('addedCatalogs') || []) as Catalog[];\n  }\n  set addedCatalogs(catalogs: Catalog[]) {\n    this.storageService.set('addedCatalogs', catalogs);\n  }\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    private messageService: MessageService,\n    private languageService: LanguageService,\n    private storageService: StorageService,\n    private dialog: MatDialog\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    this.store.state.clear();\n\n    this.predefinedCatalogs = this.predefinedCatalogs.map(c => {\n      c.id = Md5.hashStr(\n        (c.type || 'wms') + standardizeUrl(c.url)\n      ) as string;\n      c.title = c.title === '' || !c.title ? c.url : c.title;\n      return c;\n    });\n  }\n\n  getCatalogs(): Observable<Catalog[]> {\n    return this.store.view.all$();\n  }\n\n  /**\n   * When a catalog is selected, update it's state in the store\n   * and emit the catalog select change event\n   * @internal\n   */\n  onCatalogSelect(catalog: Catalog) {\n    this.store.state.update(\n      catalog,\n      {\n        selected: true,\n        focused: true\n      },\n      true\n    );\n    this.catalogSelectChange.emit({ selected: true, catalog });\n  }\n\n  private unsubscribeAddingCatalog() {\n    if (this.addingCatalog$$) {\n      this.addingCatalog$$.unsubscribe();\n    }\n  }\n\n  addCatalog(addedCatalog: Catalog) {\n    if (!addedCatalog) {\n      return;\n    }\n    let id = Md5.hashStr(\n      addedCatalog.type + standardizeUrl(addedCatalog.url)\n    ) as string;\n    const predefinedCatalog = this.predefinedCatalogs.find(\n      (c) => c.id === addedCatalog.id\n    );\n\n    if (predefinedCatalog) {\n      addedCatalog.version = predefinedCatalog.version;\n      addedCatalog.externalProvider = predefinedCatalog.externalProvider;\n      id = predefinedCatalog.id;\n    }\n\n    if (this.store.get(id)) {\n      const title = this.languageService.translate.instant(\n        'igo.geo.catalog.library.inlist.title'\n      );\n      const message = this.languageService.translate.instant(\n        'igo.geo.catalog.library.inlist.message'\n      );\n      this.messageService.alert(message, title);\n      return;\n    }\n    this.unsubscribeAddingCatalog();\n\n    this.addingCatalog$$ = this.capabilitiesService\n    .getCapabilities(addedCatalog.type as any, addedCatalog.url, addedCatalog.version)\n      .pipe(\n        catchError((e) => {\n          const title = this.languageService.translate.instant('igo.geo.catalog.unavailableTitle');\n          if (e.error) {\n            this.addCatalogDialog(true, addedCatalog);\n            e.error.caught = true;\n            return e;\n          }\n          const message = this.languageService.translate.instant('igo.geo.catalog.unavailable', { value: addedCatalog.url });\n          this.messageService.error(message, title);\n          throw e;\n        })\n      )\n      .subscribe((capabilities) => {\n        let title;\n        let version;\n        switch (addedCatalog.type) {\n          case 'wms':\n            title = addedCatalog.title || capabilities.Service.Title;\n            version = addedCatalog.version || capabilities.version;\n            break;\n          case 'arcgisrest':\n          case 'imagearcgisrest':\n          case 'tilearcgisrest':\n            title = addedCatalog.title || capabilities.mapName;\n            break;\n          case 'wmts':\n            title =\n              addedCatalog.title ||\n              capabilities.ServiceIdentification.ServiceType;\n            break;\n          default:\n            title = addedCatalog.title;\n        }\n\n        const catalogToAdd = ObjectUtils.removeUndefined(\n          Object.assign({},\n            predefinedCatalog,\n            ObjectUtils.removeUndefined({\n              id,\n              title,\n              url: addedCatalog.url,\n              type: addedCatalog.type || 'wms',\n              externalProvider: addedCatalog.externalProvider || false,\n              removable: true,\n              version\n            })) as Catalog);\n        this.store.insert(catalogToAdd);\n        const newCatalogs = this.addedCatalogs.slice(0);\n        newCatalogs.push(catalogToAdd);\n        this.addedCatalogs = newCatalogs;\n        this.unsubscribeAddingCatalog();\n      });\n  }\n\n  ngOnDestroy() {\n    this.unsubscribeAddingCatalog();\n  }\n\n  onCatalogRemove(catalog) {\n    this.store.delete(catalog);\n    this.addedCatalogs = this.addedCatalogs\n      .slice(0)\n      .filter((c) => c.id !== catalog.id);\n  }\n\n  addCatalogDialog(error?, addedCatalog?: Catalog) {\n    const dialogRef = this.dialog.open(AddCatalogDialogComponent, {\n      width: '700px',\n      data: {\n        predefinedCatalogs: this.predefinedCatalogs,\n        store: this.store,\n        error,\n        addedCatalog\n      }\n    });\n\n    dialogRef.afterClosed().subscribe((catalog) => {\n      this.addCatalog(catalog);\n    });\n  }\n}\n","<mat-list-item>\n  <h4 mat-line>\n    {{title}}\n  </h4>\n  <mat-icon\n    class=\"igo-external-provider\"\n    *ngIf=\"catalog.externalProvider\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.catalog.externalProvider.catalog' | translate\"\n    color=\"primary\"\n    (click)=\"$event.stopPropagation()\"\n    svgIcon=\"earth-arrow-right\">\n  </mat-icon>\n\n  <button\n  *ngIf=\"catalog.removable\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.catalog.library.remove' | translate\"\n  color=\"warn\"\n  (click)=\"removeCatalogFromLibrary($event)\">\n  <mat-icon svgIcon=\"delete\"></mat-icon>\n</button>\n\n<button\n  class=\"igo-blank\"\n  *ngIf=\"!catalog.removable\"\n  disabled=\"true\"\n  mat-icon-button>\n  <mat-icon svgIcon=\"blank\"></mat-icon>\n</button>\n</mat-list-item>\n","import { Component, Input, ChangeDetectionStrategy, Output, EventEmitter } from '@angular/core';\n\nimport { getEntityTitle } from '@igo2/common';\nimport { IgoMap } from '../../map';\nimport { Catalog } from '../shared/catalog.abstract';\n\n/**\n * Catalog library item\n */\n@Component({\n  selector: 'igo-catalog-library-item',\n  templateUrl: './catalog-library-item.component.html',\n  styleUrls: ['./catalog-library-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogLibaryItemComponent {\n\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  @Output() catalogRemove = new EventEmitter();\n\n  /**\n   * @internal\n   */\n  get title(): string { return getEntityTitle(this.catalog); }\n\n  removeCatalogFromLibrary(event) {\n    event.stopPropagation();\n    this.catalogRemove.emit();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoListModule } from '@igo2/common';\n\nimport { CatalogLibaryComponent, } from './catalog-library.component';\nimport { CatalogLibaryItemComponent } from './catalog-library-item.component';\nimport { AddCatalogDialogComponent } from './add-catalog-dialog.component';\n\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { IgoLanguageModule } from '@igo2/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { ReactiveFormsModule } from '@angular/forms';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatDialogModule } from '@angular/material/dialog';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatBadgeModule,\n    MatListModule,\n    MatTooltipModule,\n    IgoListModule,\n    IgoLanguageModule,\n    MatButtonModule,\n    MatFormFieldModule,\n    ReactiveFormsModule,\n    MatInputModule,\n    MatSelectModule,\n    MatAutocompleteModule,\n    MatDialogModule\n  ],\n  exports: [\n    CatalogLibaryComponent,\n    AddCatalogDialogComponent\n  ],\n  declarations: [\n    CatalogLibaryComponent,\n    CatalogLibaryItemComponent,\n    AddCatalogDialogComponent\n  ]\n})\nexport class IgoCatalogLibraryModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoListModule, IgoCollapsibleModule, IgoMatBadgeIconModule } from '@igo2/common';\n\nimport { IgoCatalogBrowserModule } from './catalog-browser/catalog-browser.module';\nimport { IgoCatalogLibraryModule } from './catalog-library/catalog-library.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatBadgeModule,\n    MatIconModule,\n    MatListModule,\n    MatTooltipModule,\n    IgoMatBadgeIconModule,\n    IgoListModule,\n    IgoCollapsibleModule\n  ],\n  exports: [\n    IgoCatalogBrowserModule,\n    IgoCatalogLibraryModule\n  ],\n  declarations: []\n})\nexport class IgoCatalogModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\n\n@NgModule({\n  imports: [],\n  exports: [],\n  declarations: []\n})\nexport class IgoDataSourceModule {\n  static forRoot(): ModuleWithProviders<IgoDataSourceModule> {\n    return {\n      ngModule: IgoDataSourceModule,\n      providers: []\n    };\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\nimport { TimeFilterableDataSource } from './time-filter.interface';\n\n@Pipe({\n  name: 'filterableDataSource'\n})\nexport class FilterableDataSourcePipe implements PipeTransform {\n  transform(value: Layer[], arg: string): Layer[] {\n    let layers;\n\n    if (arg === 'time') {\n      layers = value.filter((layer: Layer) => {\n        const datasource = layer.dataSource as TimeFilterableDataSource;\n        return (\n          this.isTimeFilterable(datasource) &&\n          datasource.options.timeFilter !== undefined &&\n          Object.keys(datasource.options.timeFilter).length\n        );\n      });\n    }\n    if (arg === 'ogc') {\n      layers = value.filter((layer: Layer) => {\n        const datasource = layer.dataSource as OgcFilterableDataSource;\n        return this.isOgcFilterable(datasource);\n      });\n    }\n    return layers;\n  }\n\n  private isTimeFilterable(dataSource: TimeFilterableDataSource) {\n    if (dataSource.options.type !== 'wms') {\n      return false;\n    }\n    return dataSource.options.timeFilterable;\n  }\n\n  private isOgcFilterable(dataSource: OgcFilterableDataSource): boolean {\n    let isOgcFilterable = false;\n    if (\n      dataSource.options.ogcFilters &&\n      dataSource.options.ogcFilters.enabled &&\n      dataSource.options.ogcFilters.editable\n    ) {\n      isOgcFilterable = true;\n    }\n    if (\n      dataSource.options.ogcFilters &&\n      dataSource.options.ogcFilters.enabled &&\n      (\n        dataSource.options.ogcFilters.pushButtons ||\n        dataSource.options.ogcFilters.checkboxes ||\n        dataSource.options.ogcFilters.radioButtons ||\n        dataSource.options.ogcFilters.select)) {\n        isOgcFilterable = true;\n    }\n    return isOgcFilterable;\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { TileArcGISRestDataSource } from '../../datasource/shared/datasources/tilearcgisrest-datasource';\n\n@Injectable()\nexport class TimeFilterService {\n  constructor() {}\n\n  filterByDate(\n    datasource: WMSDataSource | TileArcGISRestDataSource,\n    date: Date | [Date, Date]\n  ) {\n    let time;\n    let newdateform;\n    let newdateformStart;\n    let newdateformEnd;\n\n    if (Array.isArray(date)) {\n      const dates = [];\n      if (date[0]) {\n        newdateformStart = this.reformatDateTime(date[0]);\n        dates.push(date[0]);\n      }\n      if (date[1]) {\n        newdateformEnd = this.reformatDateTime(date[1]);\n        dates.push(date[1]);\n      }\n      if (dates.length === 2 && newdateformStart !== newdateformEnd) {\n        if (datasource instanceof TileArcGISRestDataSource) {\n          time = newdateformStart + ',' + newdateformEnd;\n        } else {\n          time = newdateformStart + '/' + newdateformEnd;\n        }\n      }\n      if (newdateformStart === newdateformEnd) {\n        time = newdateformStart;\n      }\n    } else if (date) {\n      newdateform = this.reformatDateTime(date);\n      time = newdateform;\n    }\n\n    const params = { TIME: time };\n    datasource.ol.updateParams(params);\n    if (datasource instanceof WMSDataSource) {\n      const wmsDataSource = datasource as WMSDataSource;\n      wmsDataSource.setTimeFilter(wmsDataSource.timeFilter, true);\n    }\n  }\n\n  filterByYear(\n    datasource: WMSDataSource | TileArcGISRestDataSource,\n    year: string | [string, string]\n  ) {\n    let time;\n    let newdateformStart;\n    let newdateformEnd;\n\n    if (Array.isArray(year)) {\n      const years = [];\n      if (year[0]) {\n        newdateformStart = year[0];\n        years.push(year[0]);\n      }\n      if (year[1]) {\n        newdateformEnd = year[1];\n        years.push(year[1]);\n      }\n      if (years.length === 2 && newdateformStart !== newdateformEnd) {\n        if (datasource instanceof TileArcGISRestDataSource) {\n          time = newdateformStart + ',' + newdateformEnd;\n        } else {\n          time = newdateformStart + '/' + newdateformEnd;\n        }\n      }\n      if (newdateformStart === newdateformEnd) {\n        time = newdateformStart;\n      }\n    } else { // to reset filter.\n      time = year;\n    }\n\n    const params = { TIME: time };\n    datasource.ol.updateParams(params);\n    if (datasource instanceof WMSDataSource) {\n      const wmsDataSource = datasource as WMSDataSource;\n      wmsDataSource.setTimeFilter(wmsDataSource.timeFilter, true);\n    }\n  }\n\n  private reformatDateTime(value) {\n    const year = value.getFullYear();\n    let month = value.getMonth() + 1;\n    let day = value.getUTCDate();\n    let hour = value.getUTCHours();\n    let minute = value.getUTCMinutes();\n\n    if (Number(month) < 10) {\n      month = '0' + month;\n    }\n\n    if (Number(day) < 10) {\n      day = '0' + day;\n    }\n\n    if (Number(hour) < 10) {\n      hour = '0' + hour;\n    }\n\n    if (Number(minute) < 10) {\n      minute = '0' + minute;\n    }\n\n    return year + '-' + month + '-' + day + 'T' + hour + ':' + minute + ':00Z';\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport olProjection from 'ol/proj/Projection';\n\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { OgcFilterWriter } from './ogc-filter';\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\n\n@Injectable()\nexport class OGCFilterService {\n  constructor() {}\n\n  public filterByOgc(wmsDatasource: WMSDataSource, filterString: string) {\n    const appliedFilter = new OgcFilterWriter().formatProcessedOgcFilter(filterString, wmsDatasource.options.params.LAYERS);\n    wmsDatasource.ol.updateParams({ FILTER: appliedFilter });\n  }\n\n  public setOgcWFSFiltersOptions(wfsDatasource: OgcFilterableDataSource) {\n    const options: any = wfsDatasource.options;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (options.ogcFilters.enabled && options.ogcFilters.filters) {\n      options.ogcFilters.filters = ogcFilterWriter.checkIgoFiltersProperties(\n        options.ogcFilters.filters,\n        options.paramsWFS.fieldNameGeometry,\n        new olProjection({ code: options.paramsWFS.srsName }),\n        true\n      );\n      if (!options.ogcFilters.interfaceOgcFilters) {\n        options.ogcFilters.interfaceOgcFilters = ogcFilterWriter.defineInterfaceFilterSequence(\n          options.ogcFilters.filters,\n          options.paramsWFS.fieldNameGeometry\n        );\n      }\n    }\n  }\n\n  public setOgcWMSFiltersOptions(wmsDatasource: OgcFilterableDataSource) {\n    const options: any = wmsDatasource.options;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (options.ogcFilters.enabled && options.ogcFilters.filters) {\n      options.ogcFilters.filters = ogcFilterWriter.checkIgoFiltersProperties(\n        options.ogcFilters.filters,\n        options.fieldNameGeometry,\n        undefined,\n        true\n      );\n      if (!options.ogcFilters.interfaceOgcFilters) {\n        options.ogcFilters.interfaceOgcFilters = ogcFilterWriter.defineInterfaceFilterSequence(\n          // With some wms server, this param must be set to make spatials call.\n          options.ogcFilters.filters,\n          options.fieldNameGeometry\n        );\n      }\n      this.filterByOgc(\n        wmsDatasource as WMSDataSource,\n        ogcFilterWriter.buildFilter(options.ogcFilters.filters,\n        undefined,\n        undefined,\n        undefined,\n        wmsDatasource.options\n        )\n      );\n      options.filtered = true;\n    } else {\n      options.ogcFilters.filters = undefined;\n      options.ogcFilters.interfaceOgcFilters = [];\n      options.filtered = false;\n    }\n  }\n}\n","export enum SpatialFilterQueryType {\n    AdmRegion = 'AdmRegion',\n    Mun = 'Mun',\n    Arrond = 'Arrond',\n    CircFed = 'CircFed',\n    CircProv = 'CircProv',\n    DirReg = 'DirReg',\n    MRC = 'MRC',\n    RegTour = 'RegTour'\n}\n\nexport enum SpatialFilterType {\n    Predefined = 'Predefined',\n    Polygon = 'Polygon',\n    Point = 'Point'\n}\n\nexport enum SpatialFilterItemType {\n    Address = 'Address',\n    Thematics = 'Thematics'\n}\n","import { Injectable } from '@angular/core';\n\nimport { HttpClient } from '@angular/common/http';\nimport { ConfigService, LanguageService } from '@igo2/core';\nimport { map } from 'rxjs/operators';\nimport { Observable } from 'rxjs';\nimport { Feature } from '../../feature/shared';\nimport {\n  SpatialFilterQueryType,\n  SpatialFilterItemType,\n  SpatialFilterType\n} from './spatial-filter.enum';\nimport { SpatialFilterThematic } from './spatial-filter.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class SpatialFilterService {\n  public baseUrl: string = 'https://geoegl.msp.gouv.qc.ca/apis/terrapi/';\n\n  /*\n   * Type association with URL\n   */\n  public urlFilterList = {\n    AdmRegion: 'regadmin',\n    Arrond: 'arrondissements',\n    CircFed: 'circ-fed',\n    CircProv: 'circ-prov',\n    DirReg: 'dir-reg',\n    MRC: 'mrc',\n    Mun: 'municipalites',\n    RegTour: 'tourisme',\n    bornes: 'bornes-sumi',\n    hydro: 'hydro',\n    routes: 'routes'\n  };\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    private configService: ConfigService\n  ) {\n    this.baseUrl =\n      this.configService.getConfig('spatialFilter.url') || this.baseUrl;\n  }\n\n  getKeyByValue(object, value) {\n    return Object.keys(object).find(key => object[key] === value);\n  }\n\n  /*\n   * Loading data for spatial filter list component (NO GEOMETRY)\n   */\n  loadFilterList(type: SpatialFilterQueryType): Observable<Feature[]> {\n    const urlPath = type as string;\n    if (urlPath) {\n      return this.http\n        .get<{ features: Feature[] }>(\n          this.baseUrl + this.urlFilterList[urlPath]\n        )\n        .pipe(\n          map(featureCollection =>\n            featureCollection.features.map(f => {\n              f.meta = {\n                id: f.properties.code\n              };\n              return f;\n            })\n          )\n        );\n    }\n  }\n\n  /*\n   * Loading item list (STRING)\n   */\n  loadThematicsList() {\n    const url = 'types';\n    const items: SpatialFilterThematic[] = [];\n    return this.http.get(this.baseUrl + url).pipe(\n      map((types: string[]) => {\n        types.forEach(type => {\n          if (type.startsWith('lieux')) {\n            const item: SpatialFilterThematic = {\n              name: undefined,\n              source: type\n            };\n            let substr = type.substring(6, type.length);\n            let name = substr;\n            if (substr.includes('.')) {\n              const index = substr.indexOf('.');\n              name = substr.substring(index + 1, substr.length);\n              substr = substr.substring(0, index);\n            }\n            try {\n              item.name = this.languageService.translate.instant(\n                'igo.geo.terrapi.' + name\n              );\n            } catch (e) {\n              item.name = name.substring(0, 1).toUpperCase() + name.substring(1, name.length - 1);\n            }\n\n            try {\n              item.group = this.languageService.translate.instant(\n                'igo.geo.spatialFilter.group.' + substr\n              );\n            } catch (e) {\n              item.group = substr.substring(0, 1).toUpperCase() + substr.substring(1, name.length - 1);\n            }\n\n            items.push(item);\n          } else {\n            if (this.getKeyByValue(this.urlFilterList, type)) {\n              const item: SpatialFilterThematic = {\n                name: undefined,\n                source: type\n              };\n              const name = this.getKeyByValue(this.urlFilterList, type);\n              try {\n                item.name = this.languageService.translate.instant(\n                  'igo.geo.terrapi.' + name\n                );\n              } catch (e) {\n                item.name = name.substring(0, 1).toUpperCase() + name.substring(1, name.length - 1);\n              }\n              item.source = type;\n\n              items.push(item);\n            }\n          }\n        });\n        return items;\n      })\n    );\n  }\n\n  /*\n   * Loading data for spatial filter item component (Address or Thematics) depends on predefined zone or draw zone (feature)\n   */\n  loadFilterItem(\n    feature,\n    itemType: SpatialFilterItemType,\n    type?: SpatialFilterQueryType,\n    thematic?: SpatialFilterThematic,\n    buffer?: number\n  ) {\n    if (type) {\n      // Predefined type\n      const urlType = type as string;\n      const url = this.baseUrl + this.urlFilterList[urlType];\n      let urlItem = '';\n      if (itemType === SpatialFilterItemType.Address) {\n        urlItem = 'adresses';\n        return this.http\n          .get<{ features: Feature[] }>(\n            url + '/' + feature.properties.code + '/' + urlItem,\n            {\n              params: {\n                geometry: 'true',\n                icon: 'true',\n                bufferInput: buffer.toString(),\n                simplified: '100'\n              }\n            }\n          )\n          .pipe(\n            map(featureCollection =>\n              featureCollection.features.map(f => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: this.languageService.translate.instant(\n                    'igo.geo.spatialFilter.Address'\n                  ),\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      } else {\n        // If thematics search\n        urlItem = thematic.source;\n        return this.http\n          .get<{ features: Feature[] }>(\n            url + '/' + feature.properties.code + '/' + urlItem,\n            {\n              params: {\n                geometry: 'true',\n                icon: 'true',\n                bufferInput: buffer.toString(),\n                simplified: '100'\n              }\n            }\n          )\n          .pipe(\n            map(featureCollection =>\n              featureCollection.features.map(f => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: thematic.name,\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      }\n    } else {\n      // Draw type\n      const url = this.baseUrl + 'locate';\n      if (itemType === SpatialFilterItemType.Address) {\n        const urlItem = '?type=adresses';\n        return this.http\n          .post<{ features: Feature[] }>(url + urlItem, {\n            geometry: 'true',\n            icon: 'true',\n            loc: JSON.stringify(feature),\n            bufferInput: buffer.toString(),\n            simplified: '100'\n          })\n          .pipe(\n            map(featureCollection =>\n              featureCollection.features.map(f => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: this.languageService.translate.instant(\n                    'igo.geo.spatialFilter.Address'\n                  ),\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      } else {\n        // If thematics search\n        const urlItem = '?type=' + thematic.source;\n        return this.http\n          .post<{ features: Feature[] }>(url + urlItem, {\n            geometry: 'true',\n            icon: 'true',\n            loc: JSON.stringify(feature),\n            bufferInput: buffer.toString(),\n            simplified: '100'\n          })\n          .pipe(\n            map(featureCollection =>\n              featureCollection.features.map(f => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: thematic.name,\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      }\n    }\n  }\n\n  /*\n   * Get one territory by id (WITH GEOMETRY)\n   */\n  loadItemById(\n    feature: Feature,\n    type: SpatialFilterQueryType\n  ): Observable<Feature> {\n    const featureType = this.urlFilterList[type];\n    const featureCode = '/' + feature.properties.code;\n    if (featureType && featureCode) {\n      return this.http\n        .get<Feature>(this.baseUrl + featureType + featureCode, {\n          params: {\n            geometry: 'true'\n          }\n        })\n        .pipe(\n          map(f => {\n            f.meta = {\n              id: f.properties.code,\n              alias: f.properties.nom,\n              title: f.properties.nom\n            };\n            return f;\n          })\n        );\n    }\n  }\n\n  /*\n   * Get buffer geometry\n   */\n  loadBufferGeometry(\n    feature: Feature,\n    filterType: SpatialFilterType,\n    buffer?: number,\n    type?: SpatialFilterQueryType,\n  ): Observable<Feature> {\n    if (filterType === SpatialFilterType.Predefined) {\n      const featureType = this.urlFilterList[type];\n      const featureCode = '/' + feature.properties.code;\n      if (featureType && featureCode) {\n        return this.http\n          .get<Feature>(this.baseUrl + featureType + featureCode,\n            {\n              params: {\n                geometry: '100',\n                bufferOutput: buffer.toString()\n              }\n            }\n          )\n          .pipe(\n            map(f => {\n              f.meta = {\n                id: f.properties.code,\n                alias: f.properties.nom,\n                title: f.properties.nom\n              };\n              return f;\n            })\n          );\n      }\n    } else {\n      return this.http\n        .post<Feature>(this.baseUrl + 'geospatial/buffer?', {\n          buffer,\n          loc: JSON.stringify(feature)\n        })\n        .pipe(\n          map(f => {\n            return f;\n          })\n        );\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport olProjection from 'ol/proj/Projection';\nimport * as olproj from 'ol/proj';\n\nimport { MessageService, LanguageService } from '@igo2/core';\n\nimport { Layer } from '../../layer/shared';\nimport { OgcFilterWriter, OgcFilterableDataSourceOptions } from '../../filter/shared';\n\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DownloadService {\n\n  constructor(\n    private messageService: MessageService,\n    private languageService: LanguageService\n  ) {}\n\n  open(layer: Layer) {\n    const translate = this.languageService.translate;\n    const title = translate.instant('igo.geo.download.title');\n    this.messageService.success(\n      translate.instant('igo.geo.download.start'),\n      title\n    );\n\n    const DSOptions: DataSourceOptions = layer.dataSource.options;\n    if (Object.keys(DSOptions.download).length > 0) {\n      if (\n        DSOptions.download.dynamicUrl &&\n        DSOptions.download.url === undefined\n      ) {\n        let wfsOptions;\n        let currentProj = new olProjection({ code: layer.map.projection });\n        const paramsWFS = (layer.dataSource.options as any).paramsWFS;\n        if (paramsWFS && Object.keys(paramsWFS).length > 0\n        ) {\n          currentProj = paramsWFS.srsName ? new olProjection({ code: paramsWFS.srsName }) : currentProj;\n          wfsOptions = (layer.dataSource.options as any).paramsWFS;\n        } else {\n          wfsOptions = (layer.dataSource.options as any).params;\n        }\n\n        const currentExtent = olproj.transformExtent(\n          layer.map.viewController.getExtent(),\n          new olProjection({ code: layer.map.projection }),\n          currentProj\n        );\n        const outputFormatDownload =\n          wfsOptions.outputFormatDownload === undefined\n            ? wfsOptions.outputFormat === undefined ? '' : 'outputformat=' + wfsOptions.outputFormat\n            : 'outputformat=' + wfsOptions.outputFormatDownload;\n\n        const baseurl = DSOptions.download.dynamicUrl\n          .replace(/&?outputformat=[^&]*/gi, '')\n          .replace(/&?filter=[^&]*/gi, '')\n          .replace(/&?bbox=[^&]*/gi, '');\n\n        const ogcFilters = (layer.dataSource.options as OgcFilterableDataSourceOptions).ogcFilters;\n\n        let filterQueryString;\n        filterQueryString = new OgcFilterWriter()\n        .handleOgcFiltersAppliedValue(\n          layer.dataSource.options,\n          ogcFilters.geometryName,\n          currentExtent as [number, number, number, number],\n          currentProj);\n        if (!filterQueryString) {\n          // Prevent getting all the features for empty filter\n            filterQueryString = new OgcFilterWriter().buildFilter(\n            undefined,\n            currentExtent as [number, number, number, number],\n            currentProj,\n            ogcFilters.geometryName\n          );\n        } else {\n          filterQueryString = 'filter=' + encodeURIComponent(filterQueryString);\n        }\n        window.open(\n          `${baseurl}&${filterQueryString}&${outputFormatDownload}`,\n          '_blank'\n        );\n      } else if (DSOptions.download) {\n        window.open(DSOptions.download.url, '_blank');\n      }\n    }\n  }\n}\n","<button\n  *ngIf=\"options && options.download && (options.download['dynamicUrl'] || options.download['url']) \"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.download.action' | translate\"\n  [color]=\"color\"\n  (click)=\"openDownload(layer)\">\n  <mat-icon svgIcon=\"download\"></mat-icon>\n</button>\n","import { Component, Input, ChangeDetectionStrategy } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\nimport { DownloadDataSourceOptions } from '../shared/download.interface';\nimport { DownloadService } from '../shared/download.service';\n\n@Component({\n  selector: 'igo-download-button',\n  templateUrl: './download-button.component.html',\n  styleUrls: ['./download-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class DownloadButtonComponent {\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n  }\n  private _layer: Layer;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor(private downloadService: DownloadService) {}\n\n  openDownload(layer: Layer) {\n    this.downloadService.open(layer);\n  }\n\n  get options(): DownloadDataSourceOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.dataSource.options;\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { DownloadButtonComponent } from './download-button/download-button.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule,\n    IgoLanguageModule\n  ],\n  exports: [DownloadButtonComponent],\n  declarations: [DownloadButtonComponent]\n})\nexport class IgoDownloadModule {\n  static forRoot(): ModuleWithProviders<IgoDownloadModule> {\n    return {\n      ngModule: IgoDownloadModule\n    };\n  }\n}\n","<table class=\"igo-striped mat-typography\" *ngIf=\"ready && feature && isObject(feature.properties) && feature.properties.target !== 'iframe'\">\n  <tbody>\n    <tr *ngFor=\"let property of filterFeatureProperties(feature) | keyvalue\">\n\n      <td *ngIf=\"feature.properties.target === '_blank' && property.key === 'url'\">\n        <mat-icon mat-list-avatar svgIcon=\"{{icon}}\"></mat-icon>\n      </td>\n\n      <td *ngIf=\"feature.properties.target === '_blank' && property.key === 'url'\">\n        <a href=\"{{property.value}}\" target='_blank' rel=\"noopener noreferrer\"> {{ 'igo.geo.targetHtmlUrl' | translate }} {{title}}</a>\n      </td>\n\n      <td id=\"keyValue\" *ngIf=\"feature.properties.target === undefined\">\n        {{property.key }}\n      </td>\n\n      <td *ngIf=\"feature.properties.target === undefined && !isObject(property.value) && !isUrl(property.value)\" [innerHTML]=\"property.value\">\n      </td>\n\n      <td *ngIf=\"feature.properties.target === undefined && !isObject(property.value) && isUrl(property.value)\">\n        <a href=\"{{property.value}}\" target='_blank' rel=\"noopener noreferrer\">\n          <img *ngIf=\"isImg(property.value);else notImg\" src=\"{{(property.value | secureImage) |async}}\" width=\"225\" heigth=\"auto\">\n          <ng-template #notImg><span>{{ 'igo.geo.targetHtmlUrl' | translate }} </span></ng-template>\n        </a>\n      </td>\n\n      <td *ngIf=\"feature.properties.target === undefined && isObject(property.value)\" [innerHTML]=\"property.value | json\">\n      </td>\n\n    </tr>\n  </tbody>\n</table>\n\n<iframe *ngIf=\"isHtmlDisplay()\" [srcdoc]=\"htmlSanitizer(feature.properties)\" [src]=\"urlSanitizer(feature.properties.url)\"></iframe>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Output,\n  EventEmitter,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\nimport { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\n\nimport { userAgent } from '@igo2/utils';\nimport { NetworkService, ConnectionState } from '@igo2/core';\nimport { getEntityTitle, getEntityIcon } from '@igo2/common';\nimport type { Toolbox } from '@igo2/common';\n\nimport { Feature } from '../shared';\nimport { SearchSource } from '../../search/shared/sources/source';\nimport { IgoMap } from '../../map/shared/map';\n\n@Component({\n  selector: 'igo-feature-details',\n  templateUrl: './feature-details.component.html',\n  styleUrls: ['./feature-details.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\n\nexport class FeatureDetailsComponent implements OnInit, OnDestroy {\n  private state: ConnectionState;\n  private unsubscribe$ = new Subject<void>();\n  ready = false;\n\n  @Input()\n  get source(): SearchSource {\n    return this._source;\n  }\n  set source(value: SearchSource) {\n    this._source = value;\n    this.cdRef.detectChanges();\n  }\n\n  @Input() map: IgoMap;\n\n  @Input() toolbox: Toolbox;\n\n  @Input()\n  get feature(): Feature {\n    return this._feature;\n  }\n  set feature(value: Feature) {\n    this._feature = value;\n    this.cdRef.detectChanges();\n    this.selectFeature.emit();\n  }\n\n  private _feature: Feature;\n  private _source: SearchSource;\n\n  @Output() routeEvent = new EventEmitter<boolean>();\n  @Output() selectFeature = new EventEmitter<boolean>();\n  @Output() htmlDisplayEvent = new EventEmitter<boolean>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return getEntityTitle(this.feature);\n  }\n\n  /**\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.feature) || 'link';\n  }\n\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private sanitizer: DomSanitizer,\n    private networkService: NetworkService\n  ) {\n    this.networkService.currentState().pipe(takeUntil(this.unsubscribe$)).subscribe((state: ConnectionState) => {\n      this.state = state;\n    });\n  }\n\n  ngOnInit() {\n    this.ready = true;\n  }\n\n  ngOnDestroy() {\n    this.unsubscribe$.next();\n    this.unsubscribe$.complete();\n  }\n\n  urlSanitizer(value): SafeResourceUrl {\n    return this.sanitizer.bypassSecurityTrustResourceUrl(value);\n  }\n\n\n  isHtmlDisplay(): boolean {\n    if (this.feature && this.isObject(this.feature.properties) && this.feature.properties.target === 'iframe') {\n      this.htmlDisplayEvent.emit(true);\n      return true;\n    } else {\n      this.htmlDisplayEvent.emit(false);\n      return false;\n    }\n  }\n\n  htmlSanitizer(value): SafeResourceUrl {\n    if (!value.body || userAgent.getBrowserName() === 'Internet Explorer') {\n      return;\n    }\n    const regexBase = /<base href=\"[\\w:\\/\\.]+\">/;\n    if (!regexBase.test(value.body)) {\n      const url = new URL(value.url, window.location.origin);\n      value.body = value.body.replace('<head>', `<head><base href=\"${url.origin}\">`);\n    }\n\n    return this.sanitizer.bypassSecurityTrustHtml(value.body);\n  }\n\n  isObject(value) {\n    return typeof value === 'object';\n  }\n\n  isUrl(value) {\n    if (typeof value === 'string') {\n      return (\n        value.slice(0, 8) === 'https://' || value.slice(0, 7) === 'http://'\n      );\n    } else {\n      return false;\n    }\n  }\n\n  isImg(value) {\n    if (this.isUrl(value)) {\n      return (\n        ['jpg', 'png', 'gif'].includes(value.split('.').pop().toLowerCase())\n      );\n    } else {\n      return false;\n    }\n  }\n\n  filterFeatureProperties(feature) {\n    const allowedFieldsAndAlias = feature.meta ? feature.meta.alias : undefined;\n    const properties = {};\n    let offlineButtonState;\n\n    if (this.map) {\n      this.map.offlineButtonToggle$.pipe(takeUntil(this.unsubscribe$)).subscribe(state => {\n        offlineButtonState = state;\n      });\n    }\n\n    if (feature.properties && feature.properties.Route && this.toolbox && !this.toolbox.getTool('directions')) {\n      delete feature.properties.Route;\n    }\n\n    if (allowedFieldsAndAlias) {\n      Object.keys(allowedFieldsAndAlias).forEach(field => {\n        properties[allowedFieldsAndAlias[field]] = feature.properties[field];\n      });\n      return properties;\n    } else if (offlineButtonState !== undefined) {\n      if (!offlineButtonState) {\n        if (this.state.connection && feature.meta && feature.meta.excludeAttribute) {\n          const excludeAttribute = feature.meta.excludeAttribute;\n          excludeAttribute.forEach(attribute => {\n            delete feature.properties[attribute];\n          });\n        } else if (!this.state.connection && feature.meta && feature.meta.excludeAttributeOffline) {\n          const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n          excludeAttributeOffline.forEach(attribute => {\n            delete feature.properties[attribute];\n          });\n        }\n      } else {\n        if (feature.meta && feature.meta.excludeAttributeOffline) {\n          const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n          excludeAttributeOffline.forEach(attribute => {\n            delete feature.properties[attribute];\n          });\n        }\n      }\n    } else {\n      if (this.state.connection && feature.meta && feature.meta.excludeAttribute) {\n        const excludeAttribute = feature.meta.excludeAttribute;\n        excludeAttribute.forEach(attribute => {\n          delete feature.properties[attribute];\n        });\n      } else if (!this.state.connection && feature.meta && feature.meta.excludeAttributeOffline) {\n        const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n        excludeAttributeOffline.forEach(attribute => {\n          delete feature.properties[attribute];\n        });\n      }\n    }\n    return feature.properties;\n  }\n}\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  ViewChild\n} from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Form, getEntityRevision } from '@igo2/common';\nimport type { FormComponent } from '@igo2/common';\nimport { uuid } from '@igo2/utils';\n\nimport { FEATURE } from '../shared/feature.enums';\nimport { Feature, FeatureMeta } from '../shared/feature.interfaces';\n\n/**\n * A configurable form, optionnally bound to a feature.\n * This component creates an entity form and, on submit,\n * returns a feature made out of the submitted data. It also\n * does things like managing the feature visibility while it's being updated\n * as well as disabling the selection of another feature.\n */\n@Component({\n  selector: 'igo-feature-form',\n  templateUrl: './feature-form.component.html',\n  styleUrls: ['./feature-form.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class FeatureFormComponent {\n\n  /**\n   * Form\n   */\n  @Input() form: Form;\n\n  /**\n   * Feature to update\n   */\n  @Input()\n  set feature(value: Feature | undefined) { this.feature$.next(value); }\n  get feature(): Feature | undefined { return this.feature$.value; }\n  readonly feature$: BehaviorSubject<Feature> = new BehaviorSubject(undefined);\n\n  /**\n   * Event emitted when the form is submitted\n   */\n  @Output() submitForm = new EventEmitter<Feature>();\n\n  @ViewChild('igoForm', { static: true }) igoForm: FormComponent;\n\n  constructor() {}\n\n  /**\n   * Transform the form data to a feature and emit an event\n   * @param event Form submit event\n   * @internal\n   */\n  onSubmit(data: { [key: string]: any }) {\n    const feature = this.formDataToFeature(data);\n    this.submitForm.emit(feature);\n  }\n\n  getData(): Feature {\n    return this.formDataToFeature(this.igoForm.getData());\n  }\n\n  /**\n   * Transform the form data to a feature\n   * @param data Form data\n   * @returns A feature\n   */\n  private formDataToFeature(data: { [key: string]: any }): Feature {\n    const properties = {};\n    const meta = {};\n    if (this.feature === undefined) {\n      (meta as any).id = uuid();\n    } else {\n      Object.assign(properties, this.feature.properties);\n      Object.assign(meta, this.feature.meta, {\n        revision: getEntityRevision(this.feature) + 1\n      });\n    }\n\n    const propertyPrefix = 'properties.';\n    Object.entries(data).forEach((entry: [string, any]) => {\n      const [key, value] = entry;\n      if (key.startsWith(propertyPrefix)) {\n        const property = key.substr(propertyPrefix.length);\n        properties[property] = value;\n      }\n    });\n\n    let geometry = data.geometry;\n    if (geometry === undefined && this.feature !== undefined) {\n      geometry = this.feature.geometry;\n    }\n\n    return {\n      meta: meta as FeatureMeta,\n      type: FEATURE,\n      geometry,\n      projection: 'EPSG:4326',\n      properties\n    };\n  }\n}\n","\n<igo-form\n  #igoForm\n  [form]=\"form\"\n  [formData]=\"feature$ | async\"\n  (submitForm)=\"onSubmit($event)\">\n\n  <ng-content></ng-content>\n  \n  <ng-content select=\"[formButtons]\" formButtons></ng-content>\n  \n</igo-form>\n","export enum GeometryType {\n    Point = 'Point',\n    LineString = 'LineString',\n    Polygon = 'Polygon',\n    Circle = 'Circle'\n}\n","/* eslint-disable */\n// See this issue: https://github.com/Microsoft/TypeScript/issues/13965\n// And the solution: https://github.com/Microsoft/TypeScript/wiki/Breaking-Changes#extending-built-ins-like-error-array-and-map-may-no-longer-work\n// for an explanation as to why the prototype is set manually\n/* eslint-enable */\n\nexport class GeometrySliceError extends Error {}\n\nexport class GeometrySliceMultiPolygonError extends GeometrySliceError {\n  constructor() {\n    super('Can\\'t slice a MultiPolygon.');\n    Object.setPrototypeOf(this, GeometrySliceMultiPolygonError.prototype);\n  }\n}\n\nexport class GeometrySliceLineStringError extends GeometrySliceError {\n  constructor() {\n    super('Can\\'t slice with a line that has more than 2 points.');\n    Object.setPrototypeOf(this, GeometrySliceLineStringError.prototype);\n  }\n}\n\nexport class GeometrySliceTooManyIntersectionError extends GeometrySliceError {\n  constructor() {\n    super('More than 2 intersections found between the target polygon and the slicing line.');\n    Object.setPrototypeOf(this, GeometrySliceTooManyIntersectionError.prototype);\n  }\n}\n","import OlCircle from 'ol/geom/Circle';\nimport OlPoint from 'ol/geom/Point';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olstyle from 'ol/style';\nimport OlLineString from 'ol/geom/LineString';\nimport OlLinearRing from 'ol/geom/LinearRing';\nimport OlPolygon from 'ol/geom/Polygon';\nimport BasicEvent from 'ol/events/Event';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport lineIntersect from '@turf/line-intersect';\nimport { lineString } from '@turf/helpers';\n\nimport {\n  GeometrySliceMultiPolygonError,\n  GeometrySliceLineStringError,\n  GeometrySliceTooManyIntersectionError\n } from './geometry.errors';\n\n/**\n * Create a default style for draw and modify interactions\n * @param color Style color (R, G, B)\n * @returns OL style\n */\nexport function createDrawInteractionStyle(color?: [number, number, number]): olstyle.Circle {\n  color = color || [0, 153, 255];\n  return new olstyle.Circle({\n    stroke: new olstyle.Stroke({\n      color: color.concat([1]),\n      width: 2\n    }),\n    fill:  new olstyle.Fill({\n      color: color.concat([0.2])\n    }),\n    radius: 8\n  });\n}\n\n/**\n * Create a default style for drawing a hole\n * @returns OL style\n */\nexport function createDrawHoleInteractionStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color:  [0, 153, 255, 1],\n      width: 2\n    })\n  });\n}\n\n/**\n * Slice geometry into two parts\n * @param olGeometry OL geometry\n * @param olSlicer Slicing line\n * @returns New OL geometries\n */\nexport function sliceOlGeometry(\n  olGeometry: OlLineString | OlPolygon,\n  olSlicer: OlLineString\n): Array<OlLineString | OlPolygon> {\n  if (olGeometry instanceof OlPolygon) {\n    return sliceOlPolygon(olGeometry, olSlicer);\n  } else if (olGeometry instanceof OlLineString) {\n    return sliceOlLineString(olGeometry, olSlicer);\n  }\n  return [];\n}\n\n/**\n * Slice OL LineString into one or more lines\n * @param olLineString OL line string\n * @param olSlicer Slicing line\n * @returns New OL line strings\n */\nexport function sliceOlLineString(olLineString: OlLineString, olSlicer: OlLineString): OlLineString[] {\n  return [];\n}\n\n/**\n * Slice OL Polygon into one or more polygons\n * @param olPolygon OL polygon\n * @param olSlicer Slicing line\n * @returns New OL polygons\n */\nexport function sliceOlPolygon(olPolygon: OlPolygon, olSlicer: OlLineString): OlPolygon[] {\n  if (olPolygon.getLinearRingCount() > 1) {\n    throw new GeometrySliceMultiPolygonError();\n  }\n\n  if (olSlicer.getCoordinates().length > 2) {\n    throw new GeometrySliceLineStringError();\n  }\n\n  const olGeoJSON = new OlGeoJSON();\n  const slicer = olGeoJSON.writeGeometryObject(olSlicer) as any;\n  const outerCoordinates = olPolygon.getLinearRing(0).getCoordinates();\n\n  const parts = [[], []];\n  let totalIntersectionCount = 0;\n  for (let i = 0, ii = outerCoordinates.length - 1; i < ii; i++) {\n    const segmentCoordinates = [outerCoordinates[i], outerCoordinates[i + 1]];\n    const segment = lineString(segmentCoordinates);\n    const intersections = lineIntersect(segment, slicer).features;\n\n    const intersectionCount = intersections.length;\n    totalIntersectionCount += intersectionCount;\n    if (intersectionCount > 1 || totalIntersectionCount > 2) {\n      throw new GeometrySliceTooManyIntersectionError();\n    }\n\n    parts[0].push(segmentCoordinates[0]);\n    if (intersectionCount === 1) {\n      const intersection = intersections[0].geometry.coordinates;\n      parts[0].push(intersection);\n      parts[1].push(intersection);\n      parts.reverse();\n    }\n  }\n\n  if (totalIntersectionCount <= 1) {\n    return [];\n  }\n\n  parts[0].push(parts[0][0]);\n  parts[1].push(parts[1][0]);\n\n  return [new OlPolygon([parts[0]]), new OlPolygon([parts[1]])];\n}\n\n/**\n * Splice geometry into two parts\n * @param olGeometry OL geometry\n * @param olSlicer Slicing line\n * @returns New OL geometries\n */\nexport function addLinearRingToOlPolygon(olPolygon: OlPolygon, olLinearRing: OlLinearRing ) {\n  // TODO: make some validation and support updating an existing linear ring\n  olPolygon.appendLinearRing(olLinearRing);\n}\n\nexport function getMousePositionFromOlGeometryEvent(\n  olEvent: BasicEvent\n) {\n  const olGeometry = olEvent.target as OlGeometry;\n  if (olGeometry instanceof OlPolygon) {\n    return olGeometry.getFlatCoordinates().slice(-4, -2) as [number, number];\n  }\n  const olGeometryCast = olGeometry as OlPoint | OlLineString | OlCircle;\n  return olGeometryCast.getFlatCoordinates().slice(-2) as [number, number];\n}\n","import { EventsKey } from 'ol/events';\nimport OlMap from 'ol/Map';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\nimport type { default as OlGeometryType } from 'ol/geom/GeometryType';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport OlDraw from 'ol/interaction/Draw';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlModify from 'ol/interaction/Modify';\nimport OlSelect from 'ol/interaction/Select';\nimport BasicEvent from 'ol/events/Event';\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\nimport { SelectEvent as OlSelectEvent } from 'ol/interaction/Select';\nimport { unByKey } from 'ol/Observable';\nimport { doubleClick } from 'ol/events/condition';\n\nimport { Subject, Subscription, fromEvent, BehaviorSubject } from 'rxjs';\n\nimport { getMousePositionFromOlGeometryEvent } from '../geometry.utils';\n\nexport interface DrawControlOptions {\n  geometryType: typeof OlGeometryType | string;\n  drawingLayerSource?: OlVectorSource<OlGeometry>;\n  drawingLayer?: OlVectorLayer<OlVectorSource<OlGeometry>>;\n  drawingLayerStyle?: OlStyleLike;\n  interactionStyle?: OlStyleLike;\n  maxPoints?: number;\n}\n\n/**\n * Control to draw entities\n */\nexport class DrawControl {\n  /**\n   * Draw start observable\n   */\n  public start$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw end observable\n   */\n  public end$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw changes observable (while drawing)\n   */\n  public changes$: Subject<any> = new Subject();\n\n  /**\n   * Draw modify observable (modify drawn features)\n   */\n  public modify$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw select observable (modify drawn features)\n   */\n  public select$: Subject<any> = new Subject();\n\n  /**\n   * Draw abort observable (abort drawn features)\n   */\n     public abort$: Subject<any> = new Subject();\n\n  /**\n   * Freehand mode observable (defaults to false)\n   */\n  freehand$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  private keyDown$$: Subscription;\n\n  private olGeometryType: typeof OlGeometryType | undefined | string;\n  private olMap: OlMap;\n  private olDrawingLayer: OlVectorLayer<OlVectorSource<OlGeometry>>;\n  private olDrawInteraction: OlDraw;\n  private olSelectInteraction: OlSelect;\n  private olModifyInteraction: OlModify;\n  private onDrawStartKey: EventsKey;\n  private onDrawEndKey: EventsKey;\n  private onDrawAbortKey: EventsKey;\n  private onDrawKey: EventsKey;\n\n  private mousePosition: [number, number];\n\n  /**\n   * Wheter the control is active\n   */\n  get active(): boolean {\n    return this.olMap !== undefined;\n  }\n\n  /**\n   * OL overlay source\n   * @internal\n   */\n  get olDrawingLayerSource(): OlVectorSource<OlGeometry> {\n    return this.olDrawingLayer.getSource();\n  }\n\n  constructor(private options: DrawControlOptions) {\n    this.olDrawingLayer = options.drawingLayer ? options.drawingLayer : this.createOlInnerOverlayLayer();\n    this.olGeometryType = this.options.geometryType;\n  }\n\n  /**\n   * Add or remove this control to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined, activateModifyAndSelect?: boolean) {\n    if (!olMap) {\n      this.clearOlInnerOverlaySource();\n      this.removeOlInnerOverlayLayer();\n      this.removeOlInteractions();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n    this.addOlInnerOverlayLayer();\n    this.addOlInteractions(activateModifyAndSelect);\n  }\n\n  /**\n   * Return the drawing layer source\n   */\n  getSource(): OlVectorSource<OlGeometry> {\n    return this.olDrawingLayerSource;\n  }\n\n  /**\n   * Set the current geometry type\n   * @param geometryType the geometry type\n   */\n  setGeometryType(geometryType: typeof OlGeometryType) {\n    this.olGeometryType = geometryType;\n  }\n\n  /**\n   * Create a drawing source if none is defined in the options\n   */\n  private createOlInnerOverlayLayer(): OlVectorLayer<OlVectorSource<OlGeometry>> {\n    return new OlVectorLayer({\n      source: this.options.drawingLayerSource ? this.options.drawingLayerSource : new OlVectorSource(),\n      style: this.options.drawingLayerStyle,\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Clear the drawing layer if it wasn't defined in the options\n   */\n  private removeOlInnerOverlayLayer() {\n    if (!this.options.drawingLayer && this.olMap) {\n      this.olMap.removeLayer(this.olDrawingLayer);\n    }\n  }\n\n  /**\n   * Add the drawing layer if it wasn't defined in the options\n   */\n  private addOlInnerOverlayLayer() {\n    if (!this.options.drawingLayer) {\n      this.olMap.addLayer(this.olDrawingLayer);\n    }\n  }\n\n  /**\n   * Clear the drawing layer source if it wasn't defined in the options\n   */\n  private clearOlInnerOverlaySource() {\n    if (!this.options.drawingLayer && !this.options.drawingLayerSource) {\n      this.olDrawingLayerSource.clear(true);\n    }\n  }\n\n  /**\n   * Add interactions to the map an set up some listeners\n   */\n  addOlInteractions(activateModifyAndSelect?: boolean) {\n    // Create Draw interaction\n    let olDrawInteraction;\n    if (!this.freehand$.getValue()) {\n      olDrawInteraction = new OlDraw({\n        type: this.olGeometryType,\n        source: this.getSource(),\n        stopClick: true,\n        style: this.options.interactionStyle,\n        maxPoints: this.options.maxPoints,\n        freehand: false,\n        freehandCondition: () => false\n      });\n\n    } else {\n      if (this.olGeometryType === 'Point') {\n        olDrawInteraction = new OlDraw({\n          type: 'Circle',\n          source: this.getSource(),\n          maxPoints: this.options.maxPoints,\n          freehand: true\n        });\n\n      } else {\n        olDrawInteraction = new OlDraw({\n          type: this.olGeometryType,\n          source: this.getSource(),\n          maxPoints: this.options.maxPoints,\n          freehand: true\n        });\n      }\n    }\n\n    // Add Draw interaction to map and create listeners\n    this.olMap.addInteraction(olDrawInteraction);\n    this.olDrawInteraction = olDrawInteraction;\n\n    this.onDrawStartKey = olDrawInteraction.on('drawstart', (event: OlDrawEvent) => this.onDrawStart(event));\n    this.onDrawEndKey = olDrawInteraction.on('drawend', (event: OlDrawEvent) => this.onDrawEnd(event));\n    this.onDrawAbortKey = olDrawInteraction.on('drawabort', (event: OlDrawEvent) => this.abort$.next(event.feature.getGeometry()));\n\n    if (activateModifyAndSelect) {\n      // Create a Modify interaction, add it to map and create a listener\n      const olModifyInteraction = new OlModify({\n        source: this.getSource()\n      });\n\n      this.olMap.addInteraction(olModifyInteraction);\n      this.olModifyInteraction = olModifyInteraction;\n\n      // Create a select interaction and add it to map\n      if (!this.olSelectInteraction) {\n        const olSelectInteraction = new OlSelect({\n          condition: doubleClick,\n          style: undefined\n        });\n        this.olMap.addInteraction(olSelectInteraction);\n        this.olSelectInteraction = olSelectInteraction;\n\n        this.olSelectInteraction.on('select', (event: OlSelectEvent) => this.onSelect(event));\n      }\n    }\n  }\n\n  /**\n   * Remove interactions\n   */\n  private removeOlInteractions() {\n    this.unsubscribeKeyDown();\n    unByKey([this.onDrawStartKey, this.onDrawEndKey, this.onDrawKey, this.onDrawAbortKey]);\n\n    if (this.olMap) {\n      this.olMap.removeInteraction(this.olDrawInteraction);\n      this.olMap.removeInteraction(this.olModifyInteraction);\n    }\n\n    this.olDrawInteraction = undefined;\n    this.olModifyInteraction = undefined;\n  }\n\n  /**\n   * When drawing starts, clear the overlay and start watching for changes\n   * @param event Draw start event\n   */\n  private onDrawStart(event: OlDrawEvent) {\n    const olGeometry = event.feature.getGeometry();\n    this.start$.next(olGeometry);\n    this.clearOlInnerOverlaySource();\n    this.onDrawKey = olGeometry.on('change', (olGeometryEvent: BasicEvent) => {\n      this.mousePosition = getMousePositionFromOlGeometryEvent(olGeometryEvent);\n      this.changes$.next(olGeometryEvent.target);\n    });\n    this.subscribeKeyDown();\n  }\n\n  /**\n   * When drawing ends, update the drawing (feature) geometry observable and add\n   * @param event Draw event (drawend)\n   */\n  private onDrawEnd(event: OlDrawEvent) {\n    this.unsubscribeKeyDown();\n    unByKey(this.onDrawKey);\n    const olGeometry = event.feature.getGeometry();\n    olGeometry.on('change', () => {\n      this.modify$.next(olGeometry);\n    });\n    this.end$.next(olGeometry);\n  }\n\n  /**\n   * When a feature is selected, update the selected feature observable\n   * @param event Modify event (modifyend)\n   */\n  private onSelect(event: OlSelectEvent) {\n    if (event.selected.length === 1) {\n      this.select$.next(event.selected[0]);\n    }\n  }\n\n  /**\n   * Subscribe to key downs used as drawing interaction shorcuts\n   */\n  private subscribeKeyDown() {\n    this.unsubscribeKeyDown();\n    this.keyDown$$ = fromEvent(document, 'keydown').subscribe((event: KeyboardEvent) => {\n      // On Escape or 'c' keydowns, abort the current drawing\n      if (event.key === 'Escape') {\n        this.olDrawInteraction.abortDrawing();\n        return;\n      }\n\n      // On Backspace or 'u' keydowns, remove last vertex of current drawing\n      if (event.key === 'Backspace') {\n        this.olDrawInteraction.removeLastPoint();\n      }\n\n      // On Enter or 'f' keydowns, finish current drawing\n      if (event.key === 'Enter') {\n        this.olDrawInteraction.finishDrawing();\n      }\n\n      // On space bar key down, pan to the current mouse position\n      if (event.key === ' ') {\n        this.olMap.getView().animate({\n          center: this.mousePosition,\n          duration: 100\n        });\n        return;\n      }\n    });\n  }\n\n  /**\n   * Unsubscribe to key down\n   */\n  private unsubscribeKeyDown() {\n    if (this.keyDown$$) {\n      this.keyDown$$.unsubscribe();\n      this.keyDown$$ = undefined;\n    }\n  }\n}\n","import { Component, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nexport interface DialogData {\n  label: string;\n}\n\n@Component({\n    selector: 'igo-draw-popup-component',\n    templateUrl: './draw-popup.component.html',\n    styleUrls: ['./draw-popup.component.scss'],\n  })\n  export class DrawPopupComponent {\n\n    constructor(\n      public dialogRef: MatDialogRef<DrawPopupComponent>,\n      @Inject(MAT_DIALOG_DATA) public data: {currentLabel: string}) {}\n\n    noLabel() {\n      this.dialogRef.close();\n    }\n  }\n","<div mat-dialog-content>\n  <p class=\"mat-typography\">{{'igo.geo.draw.dialogInstruction' | translate}}</p>\n  <mat-form-field class=\"example-full-width\">\n    <input\n      #input\n      matInput\n      placeholder=\"{{'igo.geo.draw.dialogTitle' | translate}}\"\n      value=\"{{data.currentLabel}}\">\n  </mat-form-field>\n</div>\n<div mat-dialog-actions>\n  <button\n    mat-raised-button\n    (click)=\"noLabel()\">{{'igo.geo.draw.noLabel' | translate}}\n  </button>\n  <button\n    mat-raised-button\n    color=\"primary\"\n    [mat-dialog-close]=\"input.value\">OK\n  </button>\n</div>","import { Component } from '@angular/core';\n\n@Component({\n  selector: 'igo-draw-shorcuts',\n  templateUrl: './draw-shorcuts.component.html',\n  styleUrls: ['./draw-shorcuts.component.scss']\n})\n\nexport class DrawShorcutsComponent {}\n","<mat-dialog-content>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-return\"></mat-icon>{{'igo.geo.draw.finish' | translate}}</span>\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"backspace-outline\"></mat-icon>{{'igo.geo.draw.undo' | translate}}</span>\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-esc\"></mat-icon>{{'igo.geo.draw.abort' | translate}}</span>\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-space\"></mat-icon>{{'igo.geo.draw.move' | translate}}</span>\n  </div>\n</mat-dialog-content>\n<mat-dialog-actions class=\"shortcuts-close\">\n  <button mat-raised-button mat-dialog-close color=\"primary\">OK</button>\n</mat-dialog-actions>","\nexport const MEASURE_UNIT_AUTO = 'auto';\n\nexport enum MeasureType {\n  Length = 'length',\n  Area = 'area'\n}\n\nexport enum MeasureLengthUnit {\n  Meters = 'meters',\n  Kilometers = 'kilometers',\n  Miles = 'miles',\n  Feet = 'feet'\n}\n\nexport const MeasureLengthUnitAbbreviation = {\n  [MeasureLengthUnit.Meters]: 'm',\n  [MeasureLengthUnit.Kilometers]: 'km',\n  [MeasureLengthUnit.Miles]: 'mi',\n  [MeasureLengthUnit.Feet]: 'ft'\n};\n\nexport enum MeasureAreaUnit {\n  SquareMeters = 'squareMeters',\n  SquareKilometers = 'squareKilometers',\n  SquareMiles = 'squareMiles',\n  SquareFeet = 'squareFeet',\n  Hectares = 'hectares',\n  Acres = 'acres'\n}\n\nexport const MeasureAreaUnitAbbreviation = {\n  [MeasureAreaUnit.SquareMeters]: 'm',\n  [MeasureAreaUnit.SquareKilometers]: 'km',\n  [MeasureAreaUnit.SquareMiles]: 'mi',\n  [MeasureAreaUnit.SquareFeet]: 'ft',\n  [MeasureAreaUnit.Hectares]: 'ha',\n  [MeasureAreaUnit.Acres]: 'ac'\n};\n","import { LanguageService } from '@igo2/core';\nimport * as olstyle from 'ol/style';\nimport OlPoint from 'ol/geom/Point';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlCircle from 'ol/geom/Circle';\nimport OlOverlay from 'ol/Overlay';\nimport { getCenter as olGetCenter } from 'ol/extent';\nimport {\n  getLength as olGetLength,\n  getArea as olGetArea\n} from 'ol/sphere';\n\nimport { Measure } from './measure.interfaces';\nimport {\n  MeasureAreaUnit,\n  MeasureAreaUnitAbbreviation,\n  MeasureLengthUnit,\n  MeasureLengthUnitAbbreviation\n} from './measure.enum';\n\n/**\n * Convert value from meters to kilometers\n * @param value Value in meters\n * @returns Value in kilometers\n */\nexport function metersToKilometers(value: number): number {\n  return value * 0.001;\n}\n\n/**\n * Convert value from meters to feet\n * @param value Value in meters\n * @returns Value in feet\n */\nexport function metersToFeet(value: number): number {\n  return value * 3.2808;\n}\n\n/**\n * Convert value from meters to miles\n * @param value Value in meters\n * @returns Value in miles\n */\nexport function metersToMiles(value: number): number {\n  return value * 0.000621;\n}\n\n/**\n * Convert value from square meters to square kilometers\n * @param value Value in square meters\n * @returns Value in square kilometers\n */\nexport function squareMetersToSquareKilometers(value: number): number {\n  return value * 0.000001;\n}\n\n/**\n * Convert value from square meters to square miles\n * @param value Value in square meters\n * @returns Value in square miles\n */\nexport function squareMetersToSquareMiles(value: number): number {\n  return value * 0.0000003861;\n}\n\n/**\n * Convert value from square meters to square feet\n * @param value Value in square meters\n * @returns Value in square feet\n */\nexport function squareMetersToSquareFeet(value: number): number {\n  return value * 10.764;\n}\n\n/**\n * Convert value from square meters to hectares\n * @param value Value in square meters\n * @returns Value in hectares\n */\nexport function squareMetersToHectares(value: number): number {\n  return value * 0.0001;\n}\n\n/**\n * Convert value from square meters to acres\n * @param value Value in square meters\n * @returns Value in acres\n */\nexport function squareMetersToAcres(value: number): number {\n  return value * 0.00024711;\n}\n\n/**\n * Convert value from meters to the specified length unit\n * @param value Value in meters\n * @param unit Length unit\n * @returns Value in unit\n */\nexport function metersToUnit(value: number, unit: MeasureLengthUnit): number | undefined {\n  const conversionMapper = new Map([\n    [MeasureLengthUnit.Meters, (val: number) => val],\n    [MeasureLengthUnit.Kilometers, metersToKilometers],\n    [MeasureLengthUnit.Miles, metersToMiles],\n    [MeasureLengthUnit.Feet, metersToFeet],\n  ]);\n  const conversion = conversionMapper.get(unit);\n\n  return conversion ? conversion(value) : undefined;\n}\n\n/**\n * Convert value from square meters to the specified area unit\n * @param value Value in meters\n * @param unit Area unit\n * @returns Value in unit\n */\nexport function squareMetersToUnit(value: number, unit: MeasureAreaUnit): number | undefined {\n  const conversionMapper = new Map([\n    [MeasureAreaUnit.SquareMeters, (val: number) => val],\n    [MeasureAreaUnit.SquareKilometers, squareMetersToSquareKilometers],\n    [MeasureAreaUnit.SquareMiles, squareMetersToSquareMiles],\n    [MeasureAreaUnit.SquareFeet, squareMetersToSquareFeet],\n    [MeasureAreaUnit.Hectares, squareMetersToHectares],\n    [MeasureAreaUnit.Acres, squareMetersToAcres],\n  ]);\n  const conversion = conversionMapper.get(unit);\n\n  return conversion ? conversion(value) : undefined;\n}\n\n/**\n * This method format a measure to a readable format\n * @param measure Measure\n * @param options Formatting options\n * @returns Formatted measure\n */\nexport function formatMeasure(\n  measure: number,\n  options?: {\n    decimal?: number;\n    unit?: MeasureAreaUnit | MeasureLengthUnit;\n    unitAbbr?: boolean;\n    locale?: string;\n  },\n  languageService?: LanguageService) {\n  let decimal = options.decimal;\n  if (decimal === undefined || decimal < 0) {\n    decimal = 1;\n  }\n\n  const parts = [];\n  if (options.locale !== undefined) {\n    parts.push(measure.toLocaleString(options.locale, {\n      minimumFractionDigits: decimal,\n      maximumFractionDigits: decimal\n    }));\n  } else {\n    parts.push(measure.toFixed(decimal).toString());\n  }\n\n  if (options.unit !== undefined && options.unitAbbr === true) {\n    if (languageService) {\n      parts.push(\n        MeasureLengthUnitAbbreviation[options.unit] ?\n          languageService.translate.instant('igo.geo.measure.' + MeasureLengthUnitAbbreviation[options.unit]) :\n          languageService.translate.instant('igo.geo.measure.' + MeasureAreaUnitAbbreviation[options.unit])\n      );\n    } else {\n      parts.push(\n        MeasureLengthUnitAbbreviation[options.unit] || MeasureAreaUnitAbbreviation[options.unit]\n      );\n    }\n  }\n\n  return parts.filter(p => p !== undefined).join(' ');\n}\n\n/**\n * Compute best length measure unit for a given measure in meters\n * @param value Value in meters\n * @returns Measure unit\n */\nexport function computeBestLengthUnit(value: number): MeasureLengthUnit {\n  let unit = MeasureLengthUnit.Meters;\n  let converted = value;\n  const possibleUnits = [MeasureLengthUnit.Kilometers];\n  while (converted > 1000 && possibleUnits.length > 0) {\n    unit = possibleUnits.pop();\n    converted = metersToUnit(value, unit);\n  }\n  return unit;\n}\n\n/**\n * Compute best length measure unit for a given measure in square meters\n * @param value Value in meters\n * @returns Measure unit\n */\nexport function computeBestAreaUnit(value: number): MeasureAreaUnit {\n  let unit = MeasureAreaUnit.SquareMeters;\n  let converted = value;\n  const possibleUnits = [MeasureAreaUnit.SquareKilometers];\n  while (converted > 1000000 && possibleUnits.length > 0) {\n    unit = possibleUnits.pop();\n    converted = squareMetersToUnit(value, unit);\n  }\n  return unit;\n}\n\n/**\n * Create a default style for a measure interaction\n * @returns OL style\n */\nexport function createMeasureInteractionStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color: '#ffcc33',\n      lineDash: [10, 10],\n      width: 2\n    }),\n    fill:  new olstyle.Fill({\n      color: 'rgba(255, 255, 255, 0.2)'\n    }),\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke: new olstyle.Stroke({\n        color: '#ffcc33',\n      }),\n      fill: new olstyle.Fill({\n        color: 'rgba(255, 255, 255, 0.2)'\n      })\n    })\n  });\n}\n\n/**\n * Create a default style for a measure layer\n * @returns OL style\n */\nexport function createMeasureLayerStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color: '#ffcc33',\n      width: 2\n    }),\n    fill:  new olstyle.Fill({\n      color: 'rgba(255, 255, 255, 0.2)'\n    })\n  });\n}\n\n/**\n * Compute the length in meters of an OL geometry with a given projection\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Length in meters\n */\nexport function measureOlGeometryLength(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle, projection: string): number | undefined {\n  if (olGeometry instanceof OlPoint) {\n    return undefined;\n  }\n  if (olGeometry.getFlatCoordinates().length === 0) {\n    return undefined;\n  }\n  return olGetLength(olGeometry, {projection});\n}\n\n/**\n * Compute the area in square meters of an OL geometry with a given projection\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Area in square meters\n */\nexport function measureOlGeometryArea(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle, projection: string): number | undefined {\n  if (olGeometry instanceof OlPoint || olGeometry instanceof OlLineString) {\n    return undefined;\n  }\n  if (olGeometry.getFlatCoordinates().length === 0) {\n    return undefined;\n  }\n  return olGetArea(olGeometry, {projection});\n}\n\n/**\n * Compute the area (square meters), length (meters) and last length (meters)\n * of an OL geometry with a given projection.\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Computed measure\n */\nexport function measureOlGeometry(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle, projection: string): Measure {\n  const length = measureOlGeometryLength(olGeometry, projection);\n  const area = measureOlGeometryArea(olGeometry, projection);\n\n  const lengths = [];\n  const coordinates = olGeometry.getFlatCoordinates();\n  const coordinatesLength = coordinates.length;\n  for (let i = 0; i <= coordinatesLength - 4; i += 2) {\n    const olSegment = new OlLineString([\n      [coordinates[i], coordinates[i + 1]],\n      [coordinates[i + 2], coordinates[i + 3]]\n    ]);\n\n    lengths.push(measureOlGeometryLength(olSegment, projection));\n  }\n\n  return {\n    area,\n    length,\n    lengths\n  };\n}\n\n/**\n * Update an OL geometry midpoints and return an array of those points\n * @param olGeometry OL Geometry\n * @returns OL points\n */\nexport function updateOlGeometryMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlPoint[] {\n  let olMidpoints;\n  if (olGeometry instanceof OlPoint) {\n    const olMidpointPoint = new OlPoint(olGeometry.getFlatCoordinates());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n  } else {\n    olMidpoints = getOlGeometryMidpoints(olGeometry);\n    // TODO: handle multi geometries\n    const coordinates = olGeometry.getFlatCoordinates();\n    const midpointsLength = olMidpoints.length;\n    for (let i = 0; i < midpointsLength; i++) {\n      const j = i * 2;\n      const olSegment = new OlLineString([\n        [coordinates[j], coordinates[j + 1]],\n        [coordinates[j + 2], coordinates[j + 3]]\n      ]);\n\n      const midpointCoordinate = olSegment.getCoordinateAt(0.5);\n      const olMidpoint = olMidpoints[i];\n      if (olMidpoint !== undefined) {\n        olMidpoint.setCoordinates(midpointCoordinate);\n      } else {\n        olMidpoints[i] = new OlPoint(midpointCoordinate);\n      }\n    }\n  }\n  return olMidpoints;\n}\n\n/**\n * Clear an OL geometry midpoints and return an array of those points\n * @param olGeometry OL Geometry\n */\nexport function clearOlGeometryMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle) {\n  const olMidpoints = olGeometry.get('_midpoints') || [];\n  const midpointsLength = olMidpoints.length;\n  for (let i = 0; i < midpointsLength; i++) {\n    const olMidpoint = olMidpoints[i];\n    if (olMidpoint !== undefined) {\n      if (olMidpoint !== undefined) {\n        clearOlMidpointTooltip(olMidpoint);\n      }\n    }\n  }\n\n  olGeometry.set('_midpoints', undefined, true);\n\n  return olMidpoints;\n}\n\n/**\n * Return an array of  OL geometry midpoints, if any\n * @param olGeometry OL Geometry\n * @returns OL points\n */\nfunction getOlGeometryMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlPoint[] {\n  let expectedNumber;\n  if (olGeometry instanceof OlCircle) {\n    expectedNumber = 0;\n  } else {\n    expectedNumber = Math.max((olGeometry.getFlatCoordinates().length / 2) - 1, 0);\n  }\n  // TODO: This works but it's quite messy. If time permits,\n  // clean this. Maybe a Tooltip class could handle that\n  let olMidpoints = olGeometry.get('_midpoints');\n\n  if (olMidpoints === undefined) {\n    if (olGeometry instanceof OlPoint) {\n      olMidpoints = new Array(1);\n    } else {\n      olMidpoints = new Array(expectedNumber);\n    }\n    olGeometry.set('_midpoints', olMidpoints, true);\n    return olMidpoints;\n  }\n\n  if (expectedNumber === 0) {\n    return olMidpoints;\n  }\n\n  if (expectedNumber === olMidpoints.length) {\n    return olMidpoints;\n  }\n\n  if (expectedNumber > olMidpoints.length) {\n    olMidpoints.push(...new Array(expectedNumber - olMidpoints.length));\n    return olMidpoints;\n  }\n\n  for (let i = expectedNumber; i < olMidpoints.length; i++) {\n    const olMidpoint = olMidpoints[expectedNumber];\n    if (olMidpoint !== undefined) {\n      clearOlMidpointTooltip(olMidpoint);\n    }\n  }\n  olMidpoints.splice(expectedNumber);\n\n  return olMidpoints;\n}\n\n/**\n * Remove an OL midpoint's tooltip from the map\n * @param olMidpoint OL Point\n */\nfunction clearOlMidpointTooltip(olMidpoint: OlPoint) {\n  const olTooltip = olMidpoint.get('_tooltip');\n  if (olTooltip !== undefined) {\n    const olMap = olTooltip.getMap();\n    if (olMap !== undefined) {\n      olMap.removeOverlay(olTooltip);\n    }\n  }\n}\n\n/**\n * Add an OL overlay at each midpoint and return an array of those overlays\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function updateOlTooltipsAtMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\n  const olMidpoints = updateOlGeometryMidpoints(olGeometry);\n  let typeGeom = '';\n  if (olGeometry instanceof OlLineString) {\n  typeGeom = 'line-';\n  } else if (olGeometry instanceof OlPolygon) {\n    typeGeom = 'polygone-';\n    }\n  const olTooltips = olMidpoints.map((olMidpoint: OlPoint) => {\n    let olTooltip = olMidpoint.get('_tooltip');\n    if (olTooltip === undefined) {\n      olTooltip = createOlTooltipAtPoint(olMidpoint, false, typeGeom);\n    } else {\n      olTooltip.setPosition(olMidpoint.getFlatCoordinates());\n    }\n    return olTooltip;\n  });\n  return olTooltips;\n}\n\n/**\n * Return an array of OL overlay at midspoints, if any\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getOlTooltipsAtMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\n  const olMidpoints = getOlGeometryMidpoints(olGeometry);\n  return olMidpoints.map((olMidpoint: OlPoint) => {\n    return olMidpoint ? olMidpoint.get('_tooltip') : undefined;\n  });\n}\n\n/**\n * Update an OL geometry center and return it\n * @param olGeometry OL Geometry\n * @returns OL point\n */\nexport function updateOlGeometryCenter(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlPoint {\n  let olCenter = olGeometry.get('_center');\n  const centerCoordinate = olGetCenter(olGeometry.getExtent());\n  if (olCenter !== undefined) {\n    olCenter.setCoordinates(centerCoordinate);\n  } else {\n    olCenter = new OlPoint(centerCoordinate);\n    olGeometry.set('_center', olCenter);\n  }\n\n  return olCenter;\n}\n\n/**\n * Add an OL overlay at the center of a geometry and return that overlay\n * @param olGeometry OL Geometry\n * @returns OL overlay\n */\nexport function updateOlTooltipAtCenter(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay {\n  const olCenter = updateOlGeometryCenter(olGeometry);\n  let olTooltip = olCenter.get('_tooltip');\n  if (olTooltip === undefined) {\n    olTooltip = createOlTooltipAtPoint(olCenter, true);\n  } else {\n    olTooltip.setPosition(olCenter.getFlatCoordinates());\n  }\n  return olTooltip;\n}\n\n/**\n * Return an array of OL overlay at midspoints, if any\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getOlTooltipAtCenter(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay {\n  const olCenter = olGeometry.get('_center');\n  return olCenter ? olCenter.get('_tooltip') : undefined;\n}\n\n/**\n * Get all the tooltips of an OL geometry\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getTooltipsOfOlGeometry(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\n  const olTooltips = [].concat(getOlTooltipsAtMidpoints(olGeometry) || []);\n  const olCenterTooltip = getOlTooltipAtCenter(olGeometry);\n  if (olCenterTooltip !== undefined) {\n    olTooltips.push(olCenterTooltip);\n  }\n  return olTooltips;\n}\n\n/**\n * Create an OL overlay at a point and bind the overlay to the point\n * @param olPoint OL Point\n * @returns OL overlay\n */\nexport function createOlTooltipAtPoint(olPoint: OlPoint, center: boolean = false, srcGeomType: string= ''): OlOverlay {\n  const olTooltip = new OlOverlay({\n    element: document.createElement('div'),\n    offset: [-30, -10],\n    className: (center ?\n    [ 'igo-map-tooltip',\n      'igo-map-tooltip-measure', 'igo-map-tooltip-measure-area'] : ['igo-map-tooltip', 'igo-map-tooltip-measure',\n      `igo-map-tooltip-measure-${srcGeomType}segments`]).join(' '),\n    stopEvent: false\n  });\n  olTooltip.setPosition(olPoint.getFlatCoordinates());\n  olPoint.set('_tooltip', olTooltip);\n\n  return olTooltip;\n}\n","import * as Olstyle from 'ol/style';\nimport OlPoint from 'ol/geom/Point';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlCircle from 'ol/geom/Circle';\nimport OlOverlay from 'ol/Overlay';\nimport {\n  updateOlGeometryMidpoints,\n  updateOlGeometryCenter\n} from '../../measure/shared/measure.utils';\n\n\n/**\n * Create a default style\n * @param fillColor the fill color\n * @param strokeColor the stroke color\n * @param strokeWidth the stroke width\n * @param label a label\n * @returns OL style\n */\nexport function createInteractionStyle(fillColor?: string, strokeColor?: string, strokeWidth?: number, label?: string): Olstyle.Style {\n  return new Olstyle.Style({\n    stroke: new Olstyle.Stroke({\n      color: strokeColor ? strokeColor : 'rgba(143,7,7,1)',\n      width: strokeWidth ? strokeWidth : 1\n    }),\n    fill: new Olstyle.Fill({\n      color: fillColor ? fillColor : 'rgba(255,255,255,0.4)'\n    }),\n    image: new Olstyle.Circle({\n      radius: 5,\n      stroke: new Olstyle.Stroke({\n        color: strokeColor ? strokeColor : 'rgba(143,7,7,1)',\n        width: strokeWidth ? strokeWidth : 1\n      }),\n      fill: new Olstyle.Fill({\n        color: fillColor ? fillColor : 'rgba(255,255,255,0.4)'\n      })\n    })\n  });\n}\n\n/**\n * Add an OL overlay at each midpoint and return an array of those overlays\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function updateOlTooltipsDrawAtMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\n  let olMidpoints;\n  if (olGeometry instanceof OlPoint) {\n    const olMidpointPoint = new OlPoint(olGeometry.getFlatCoordinates());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n    olGeometry.setProperties({_midpoints: olMidpoints}, true);\n  } else if (olGeometry instanceof OlCircle) {\n    const olMidpointPoint = new OlPoint(olGeometry.getCenter());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n    olGeometry.setProperties({_midpoints: olMidpoints}, true);\n  } else {\n    olMidpoints = updateOlGeometryMidpoints(olGeometry);\n  }\n  const olTooltips = olMidpoints.map((olMidpoint: OlPoint) => {\n    let olTooltip = olMidpoint.get('_tooltip');\n    if (olTooltip === undefined) {\n      olTooltip = createOlTooltipDrawAtPoint(olMidpoint);\n    } else {\n      olTooltip.setPosition(olMidpoint.getFlatCoordinates());\n    }\n    return olTooltip;\n  });\n  return olTooltips;\n}\n\n/**\n * Add an OL overlay at the center of a geometry and return that overlay\n * @param olGeometry OL Geometry\n * @returns OL overlay\n */\nexport function updateOlTooltipDrawAtCenter(olGeometry: OlLineString | OlPolygon): OlOverlay {\n  const olCenter = updateOlGeometryCenter(olGeometry);\n  let olTooltip = olCenter.get('_tooltip');\n  if (olTooltip === undefined) {\n    olTooltip = createOlTooltipDrawAtPoint(olCenter);\n  } else {\n    olTooltip.setPosition(olCenter.getFlatCoordinates());\n  }\n  return olTooltip;\n}\n\n/**\n * Create an OL overlay at a point and bind the overlay to the point\n * @param olPoint OL Point\n * @returns OL overlay\n */\nexport function createOlTooltipDrawAtPoint(olPoint: OlPoint): OlOverlay {\n  const olTooltip = new OlOverlay({\n    element: document.createElement('div'),\n    offset: [-30, -10],\n    className: [\n      'igo-map-tooltip',\n      'igo-map-tooltip-draw'\n    ].join(' '),\n    stopEvent: false\n  });\n  olTooltip.setPosition(olPoint.getFlatCoordinates());\n  olPoint.set('_tooltip', olTooltip);\n\n  return olTooltip;\n}\n","import { Injectable } from '@angular/core';\n\nimport * as OlStyle from 'ol/style';\nimport OlPoint from 'ol/geom/Point';\nimport { transform } from 'ol/proj';\nimport { MapService } from '../../map/shared/map.service';\n\n@Injectable({\n    providedIn: 'root'\n  })\nexport class DrawStyleService {\n\n  private fillColor = 'rgba(255,255,255,0.4)';\n  private strokeColor = 'rgba(143,7,7,1)';\n  private strokeWidth: number = 1;\n  private labelsAreShown = true;\n  private icon: string;\n\n  constructor(\n    private mapService: MapService\n  ) {}\n\n  getFillColor(): string {\n    return this.fillColor;\n  }\n\n  setFillColor(fillColor: string) {\n    this.fillColor = fillColor;\n  }\n\n  getStrokeColor(): string {\n    return this.strokeColor;\n  }\n\n  setStrokeColor(strokeColor: string) {\n    this.strokeColor = strokeColor;\n  }\n\n  getStrokeWidth(): number {\n    return this.strokeWidth;\n  }\n\n  getLabelsAreShown() {\n    return this.labelsAreShown;\n  }\n\n  toggleLabelsAreShown() {\n    this.labelsAreShown = !this.labelsAreShown;\n  }\n\n  setIcon(icon: string) {\n    this.icon = icon;\n  }\n\n  getIcon() {\n    return this.icon;\n  }\n\n  createDrawingLayerStyle(feature, resolution, labelsAreShown?: boolean, icon?: string): OlStyle.Style {\n    let style;\n    let labelsAreOffset: boolean = false;\n    const proj = this.mapService.getMap().projection;\n    const geom = feature.getGeometry();\n\n    if (geom instanceof OlPoint) {\n      labelsAreOffset = !labelsAreOffset;\n    }\n\n    // if feature is a circle\n    if (feature.get('rad')) {\n      const coordinates = transform(feature.getGeometry().flatCoordinates, proj, 'EPSG:4326');\n\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: labelsAreShown ? feature.get('draw') : '',\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n          font: '20px sans-serif',\n          overflow: true\n        }),\n\n        image: new OlStyle.Circle({\n          radius: feature.get('rad') / Math.cos((Math.PI / 180) * coordinates[1]) / resolution,\n          stroke: new OlStyle.Stroke({\n            color: this.strokeColor,\n            width: this.strokeWidth\n          }),\n          fill: new OlStyle.Fill({\n            color: this.fillColor\n          })\n        })\n      });\n      return style;\n\n    // if feature is an icon\n    } else if (icon) {\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: labelsAreShown ? feature.get('draw') : '',\n          offsetY: -26,\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n          font: '20px sans-serif',\n          overflow: true\n        }),\n\n        stroke: new OlStyle.Stroke({\n          color: this.strokeColor,\n          width: this.strokeWidth\n        }),\n\n        fill:  new OlStyle.Fill({\n          color: this.fillColor\n        }),\n\n        image: new OlStyle.Icon({\n          src: icon\n        })\n      });\n      return style;\n\n    // if feature is a point, a linestring or a polygon\n    } else {\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: labelsAreShown ? feature.get('draw') : '',\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n          font: '20px sans-serif',\n          overflow: true,\n          offsetY: labelsAreOffset ? -15 : 0\n        }),\n\n        stroke: new OlStyle.Stroke({\n          color: this.strokeColor,\n          width: this.strokeWidth\n        }),\n\n        fill: new OlStyle.Fill({\n          color: this.fillColor\n        }),\n\n        image: new OlStyle.Circle({\n          radius: 5,\n          stroke: new OlStyle.Stroke({\n            color: this.strokeColor,\n            width: this.strokeWidth\n          }),\n          fill: new OlStyle.Fill({\n            color: this.fillColor\n          })\n        })\n      });\n      return style;\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\n\n@Injectable({\n    providedIn: 'root'\n  })\nexport class DrawIconService {\n\n    protected icons: Array<string>;\n\n    constructor(\n      protected config: ConfigService\n    ) {\n        this.getIconsList();\n    }\n\n    getIcons() {\n        return this.icons;\n    }\n\n    getPath(): any {\n      return this.config.getConfig('drawingTool.icons') || [];\n    }\n\n    getIconsList() {\n      this.icons = this.getPath();\n    }\n}\n","<div>\n  <div class=\"geometry-type-toggle mat-typography\">\n    <mat-button-toggle-group\n      (change)=\"onGeometryTypeChange($event.value)\" [value]=\"geometryType.Point\">\n      <mat-button-toggle [value]=\"geometryType.Point\">\n        {{('igo.geo.draw.' + geometryType.Point) | translate}}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.LineString\">\n        {{('igo.geo.draw.' + geometryType.LineString) | translate}}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.Polygon\">\n        {{('igo.geo.draw.' + geometryType.Polygon) | translate}}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.Circle\">\n        {{('igo.geo.draw.' + geometryType.Circle) | translate}}\n      </mat-button-toggle>\n    </mat-button-toggle-group>\n  </div>\n\n  <div class=\"draw-options mat-typography\">\n    <mat-slide-toggle\n      [disabled]=\"drawControlIsDisabled\"\n      [checked]=\"drawControlIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDrawControl($event.checked)\">\n      {{'igo.geo.spatialFilter.drawControl' | translate}}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle\n      [checked]=\"labelsAreShown\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleLabels()\">\n      {{'igo.geo.draw.toggleMapTooltips' | translate}}\n    </mat-slide-toggle>\n  </div>\n\n  <form class=\"igo-form\" [formGroup]=\"form\" >\n    <div class=\"fill-color-picker mat-typography\">\n      <span>\n        <mat-icon class=\"stroke-palette-icon\" svgIcon=\"square\"></mat-icon>\n        {{'igo.geo.draw.fill' | translate}}\n      </span>\n\n      <mat-form-field\n        class=\"fill-field\"\n        appearance=\"outline\"\n        floatLabel=\"always\"\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.draw.colorPicker' | translate\">\n        <mat-label>{{fillColor}}</mat-label>\n\n        <input\n          formControlName=\"fill\"\n          matInput\n          type=\"text\"\n          [(colorPicker)]=\"fillColor\"\n          [style.background]=\"fillColor\"\n          [readonly]=\"true\"\n          [colorPicker]=\"fillColor\"\n          [cpWidth]=\"('200px')\"\n          [cpOutputFormat]=\"'rgba'\"\n          [cpPosition]=\"'bottom'\"\n          [cpPositionOffset]=\"'-75%'\"\n          [cpCancelButton]=\"true\"\n          [cpCancelButtonText]=\"'igo.geo.draw.cancelColorPicker' | translate\"\n          [cpOKButton]=\"true\"\n          (colorPickerChange)=\"onColorChange(labelsAreShown, false)\">\n      </mat-form-field>\n    </div>\n\n    <div class=\"stroke-color-picker mat-typography\">\n      <span>\n        <mat-icon class=\"stroke-palette-icon\" svgIcon=\"square-outline\"></mat-icon>\n        {{'igo.geo.draw.stroke' | translate}}\n      </span>\n\n      <mat-form-field\n        class=\"stroke-field\"\n        appearance=\"outline\"\n        floatLabel=\"always\"\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.draw.colorPicker' | translate\">\n        <mat-label>{{strokeColor}}</mat-label>\n\n        <input\n          formControlName=\"stroke\"\n          matInput\n          type=\"text\"\n          [(colorPicker)]=\"strokeColor\"\n          [style.background]=\"strokeColor\"\n          [readonly]=\"true\"\n          [colorPicker]=\"strokeColor\"\n          [cpWidth]=\"('200px')\"\n          [cpPosition]=\"'bottom'\"\n          [cpPositionOffset]=\"'-75%'\"\n          [cpOutputFormat]=\"'rgba'\"\n          [cpCancelButton]=\"true\"\n          [cpCancelButtonText]=\"'igo.geo.draw.cancelColorPicker' | translate\"\n          [cpOKButton]=\"true\"\n          (colorPickerChange)=\"onColorChange(labelsAreShown, false)\">\n      </mat-form-field>\n    </div>\n\n    <div>\n      <mat-form-field *ngIf=\"icons.length >= 1\">\n        <mat-label>{{'igo.geo.draw.icon' | translate}}</mat-label>\n        <mat-select>\n          <mat-select-trigger>\n            <div *ngIf=\"icon\" class=\"box\">\n              <img src={{icon}}>\n            </div>\n          </mat-select-trigger>\n          <mat-option value=\"\" (click)=\"onIconChange()\">{{'igo.geo.draw.noIcon' | translate}}</mat-option>\n          <mat-option\n            *ngFor=\"let icon_html of icons\"\n            [value]=\"icon_html\"\n            (click)=\"onIconChange(icon_html)\">\n            <div class=\"box\">\n              <img src={{icon_html}}>\n            </div>\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </form>\n\n  <mat-divider></mat-divider>\n\n  <div>\n    <button *ngIf=\"store.count$.getValue() > 0\"\n      class=\"deleteBtn\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.draw.delete' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      (click)=\"deleteDrawings()\">\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <igo-entity-table\n      #table\n      class=\"table-compact\"\n      [store]=\"store\"\n      [template]=\"tableTemplate\">\n    </igo-entity-table>\n  </div>\n\n  <button\n    mat-icon-button\n    color=\"accent\"\n    disableRipple=\"true\"\n    (click)=\"openShorcutsDialog()\">\n    <mat-icon\n      class=\"shortcuts-icon\"\n      svgIcon=\"keyboard-outline\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.draw.shortcuts' | translate\">\n    </mat-icon>\n  </button>\n</div>\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Output\n} from '@angular/core';\n\nimport {\n    FEATURE,\n    FeatureStore,\n    FeatureStoreSelectionStrategy,\n    tryBindStoreLayer,\n    tryAddLoadingStrategy,\n    tryAddSelectionStrategy,\n    FeatureMotion,\n    FeatureStoreLoadingStrategy\n  } from '../../feature';\n\nimport { LanguageService } from '@igo2/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { GeometryType } from '../shared/draw.enum';\nimport { IgoMap } from '../../map/shared/map';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { Draw, FeatureWithDraw } from '../shared/draw.interface';\nimport { FormGroup, FormBuilder } from '@angular/forms';\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { DrawControl } from '../../geometry/shared/controls/draw';\nimport { EntityRecord, EntityTableTemplate } from '@igo2/common';\n\nimport * as OlStyle from 'ol/style';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlCircle from 'ol/geom/Circle';\nimport OlPoint from 'ol/geom/Point';\nimport OlFeature from 'ol/Feature';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlOverlay from 'ol/Overlay';\nimport type { default as OlGeometryType } from 'ol/geom/GeometryType';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { getDistance } from 'ol/sphere';\nimport { DrawStyleService } from '../shared/draw-style.service';\nimport { skip } from 'rxjs/operators';\nimport { DrawPopupComponent } from './draw-popup.component';\nimport { DrawShorcutsComponent } from './draw-shorcuts.component';\nimport { getTooltipsOfOlGeometry } from '../../measure/shared/measure.utils';\nimport { createInteractionStyle } from '../shared/draw.utils';\nimport { transform } from 'ol/proj';\nimport { DrawIconService } from '../shared/draw-icon.service';\n\n@Component ({\n  selector: 'igo-draw',\n  templateUrl: './draw.component.html',\n  styleUrls: ['./draw.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\n\nexport class DrawComponent implements OnInit, OnDestroy {\n  /**\n   * Table template\n   * @internal\n   */\n  public tableTemplate: EntityTableTemplate = {\n    selection: true,\n    selectMany: true,\n    selectionCheckbox: true,\n    sort: true,\n    columns: [{\n      name: 'Drawing',\n      title: this.languageService.translate.instant('igo.geo.draw.labels'),\n      valueAccessor: (feature: FeatureWithDraw) => {\n        return feature.properties.draw;\n      }\n    }]\n  };\n\n  public geometryType = GeometryType; // Reference to the GeometryType enum\n\n  @Output() fillColor: string;\n  @Output() strokeColor: string;\n  @Output() strokeWidth: number;\n\n  @Input() map: IgoMap; // Map to draw on\n\n  @Input() store: FeatureStore<FeatureWithDraw>; // Drawing store\n\n  public draw$: BehaviorSubject<Draw> = new BehaviorSubject({}); // Observable of draw\n\n  private olDrawingLayerSource = new OlVectorSource();\n  private drawControl: DrawControl;\n  private drawEnd$$: Subscription;\n  private drawSelect$$: Subscription;\n  private olDrawingLayer: VectorLayer;\n  public selectedFeatures$: BehaviorSubject<FeatureWithDraw[]> = new BehaviorSubject([]);\n  public fillForm: string;\n  public strokeForm: string;\n  public drawControlIsDisabled: boolean = true;\n  public drawControlIsActive: boolean = false;\n  public labelsAreShown: boolean;\n  private subscriptions$$: Subscription[] = [];\n\n  public position: string = 'bottom';\n  public form: FormGroup;\n  public icons: Array<string>;\n  public icon: string;\n\n  constructor(\n    private languageService: LanguageService,\n    private formBuilder: FormBuilder,\n    private drawStyleService: DrawStyleService,\n    private dialog: MatDialog,\n    private drawIconService: DrawIconService\n  ) {\n    this.buildForm();\n    this.fillColor = this.drawStyleService.getFillColor();\n    this.strokeColor = this.drawStyleService.getStrokeColor();\n    this.strokeWidth = this.drawStyleService.getStrokeWidth();\n    this.labelsAreShown = this.drawStyleService.getLabelsAreShown();\n    this.icons = this.drawIconService.getIcons();\n    this.icon = this.drawStyleService.getIcon();\n  }\n\n  // Initialize the store that will contain the entities and create the Draw control\n  ngOnInit() {\n    this.initStore();\n    this.drawControl = this.createDrawControl(this.fillColor, this.strokeColor, this.strokeWidth);\n    this.drawControl.setGeometryType(this.geometryType.Point as any);\n    this.toggleDrawControl();\n  }\n\n  /**\n   * Remove the drawing layer and the interactions\n   * @internal\n   */\n  ngOnDestroy() {\n    this.drawControl.setOlMap(undefined);\n    this.subscriptions$$.map(s => s.unsubscribe());\n  }\n\n  /**\n   * Create a Draw Control\n   * @param fillColor the fill color\n   * @param strokeColor the stroke color\n   * @param strokeWidth the stroke width\n   * @returns a Draw Control\n   */\n  createDrawControl(fillColor?: string, strokeColor?: string, strokeWidth?: number) {\n    const drawControl = new DrawControl({\n      geometryType: undefined,\n      drawingLayerSource: this.olDrawingLayerSource,\n      drawingLayerStyle: new OlStyle.Style({}),\n      interactionStyle: createInteractionStyle(fillColor, strokeColor, strokeWidth),\n    });\n\n    return drawControl;\n  }\n\n  /**\n   * Called when the user selects a new geometry type\n   * @param geometryType the geometry type selected by the user\n   */\n  onGeometryTypeChange(geometryType: typeof OlGeometryType) {\n    this.drawControl.setGeometryType(geometryType);\n    this.toggleDrawControl();\n  }\n\n  /**\n   * Store initialization, including drawing layer creation\n   */\n  private initStore() {\n    this.map.removeLayer(this.olDrawingLayer);\n\n    this.olDrawingLayer = new VectorLayer({\n      isIgoInternalLayer: true,\n      id: 'igo-draw-layer',\n      title: this.languageService.translate.instant('igo.geo.draw.drawing'),\n      zIndex: 200,\n      source: new FeatureDataSource(),\n      style: (feature, resolution) => {\n        return this.drawStyleService.createDrawingLayerStyle(feature, resolution, this.labelsAreShown, this.icon);\n      },\n      showInLayerList: true,\n      exportable: true,\n      browsable: false,\n      workspace: {\n        enabled: false\n      },\n    });\n    tryBindStoreLayer(this.store, this.olDrawingLayer);\n\n    tryAddLoadingStrategy(this.store, new FeatureStoreLoadingStrategy({\n      motion: FeatureMotion.None\n    }));\n\n    tryAddSelectionStrategy(this.store, new FeatureStoreSelectionStrategy({\n      map: this.map,\n      motion: FeatureMotion.None,\n      many: true\n    }));\n    this.store.layer.visible = true;\n    this.store.source.ol.on('removefeature', (event: OlVectorSourceEvent<OlGeometry>) => {\n      const olGeometry = event.feature.getGeometry();\n      this.clearLabelsOfOlGeometry(olGeometry);\n    });\n\n    this.subscriptions$$.push(this.store.stateView.manyBy$((record: EntityRecord<FeatureWithDraw>) => {\n      return record.state.selected === true;\n    }).pipe(\n      skip(1) // Skip initial emission\n    ).subscribe((records: EntityRecord<FeatureWithDraw>[]) => {\n      this.selectedFeatures$.next(records.map(record => record.entity));\n    }));\n\n    this.subscriptions$$.push(this.store.count$.subscribe(cnt => {\n      cnt >= 1 ? this.store.layer.options.showInLayerList = true : this.store.layer.options.showInLayerList = false;\n    }));\n  }\n\n  /**\n   * Called when the user changes the color in a color picker\n   * @param labelsAreShown wheter the labels are shown or not\n   * @param isAnIcon wheter the feature is an icon or not\n   */\n  onColorChange(labelsAreShown: boolean, isAnIcon: boolean) {\n    this.fillForm = this.fillColor;\n    this.strokeForm = this.strokeColor;\n    this.drawStyleService.setFillColor(this.fillColor);\n    this.drawStyleService.setStrokeColor(this.strokeColor);\n\n    if (isAnIcon) {\n      this.store.layer.ol.setStyle((feature, resolution) => {\n        return this.drawStyleService.createDrawingLayerStyle(feature, resolution, labelsAreShown, this.icon);\n      });\n      this.icon = undefined;\n\n    } else {\n      this.store.layer.ol.setStyle((feature, resolution) => {\n        return this.drawStyleService.createDrawingLayerStyle(feature, resolution, labelsAreShown);\n      });\n    }\n    this.createDrawControl();\n  }\n\n  /**\n   * Called when the user toggles the Draw control is toggled\n   * @internal\n   */\n  onToggleDrawControl(toggleIsChecked: boolean) {\n    toggleIsChecked ? this.toggleDrawControl() : this.deactivateDrawControl();\n  }\n\n  /**\n   * Activate the correct control\n   */\n  private toggleDrawControl() {\n    this.deactivateDrawControl();\n    this.activateDrawControl();\n  }\n\n  /**\n   * Open a dialog box to enter label and do something\n   * @param olGeometry geometry at draw end or selected geometry\n   * @param drawEnd event fired at drawEnd?\n   */\n  private openDialog(olGeometryFeature, isDrawEnd: boolean) {\n    setTimeout(() => {\n      // open the dialog box used to enter label\n      const dialogRef = this.dialog.open(DrawPopupComponent, {\n        disableClose: false,\n        data: {currentLabel: olGeometryFeature.get('draw')}\n      });\n\n      // when dialog box is closed, get label and set it to geometry\n      dialogRef.afterClosed().subscribe((label: string) => {\n        this.updateLabelOfOlGeometry(olGeometryFeature, label);\n\n        // if event was fired at draw end\n        if (isDrawEnd) {\n          this.onDrawEnd(olGeometryFeature);\n\n        // if event was fired at select\n        } else {\n          this.onSelectDraw(olGeometryFeature, label);\n        }\n      });\n    }, 250);\n  }\n\n  /**\n   * Activate a given control\n   */\n  private activateDrawControl() {\n    this.drawControlIsDisabled = false;\n    this.drawControlIsActive = true;\n    this.drawEnd$$ = this.drawControl.end$.subscribe((olGeometry: OlGeometry) => {\n      this.openDialog(olGeometry, true);\n    });\n\n    this.drawControl.modify$.subscribe((olGeometry: OlGeometry) => {\n      this.onModifyDraw(olGeometry);\n    });\n\n    if (!this.drawSelect$$) {\n      this.drawSelect$$ = this.drawControl.select$.subscribe((olFeature: OlFeature<OlGeometry>) => {\n        this.openDialog(olFeature, false);\n      });\n    }\n\n    this.drawControl.setOlMap(this.map.ol, true);\n  }\n\n  /**\n   * Deactivate the active draw control\n   */\n  private deactivateDrawControl() {\n    if (!this.drawControl) {\n      return;\n    }\n\n    if (this.drawEnd$$) {\n      this.drawEnd$$.unsubscribe();\n    }\n\n    this.drawControl.setOlMap(undefined);\n    this.drawControlIsActive = false;\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawEnd(olGeometry: OlGeometry, radius?: number) {\n    this.addFeatureToStore(olGeometry, radius);\n    this.clearLabelsOfOlGeometry(olGeometry);\n    this.store.layer.ol.getSource().refresh();\n  }\n\n  private onModifyDraw(olGeometry) {\n    const entities = this.store.all();\n\n    entities.forEach(entity => {\n      const entityId = entity.properties.id;\n\n      const olGeometryId = olGeometry.ol_uid;\n\n      if (entityId === olGeometryId) {\n        this.updateLabelOfOlGeometry(olGeometry, entity.properties.draw);\n        this.replaceFeatureInStore(entity, olGeometry);\n      }\n    });\n  }\n\n  private onSelectDraw(olFeature: OlFeature<OlGeometry>, label: string) {\n    const entities = this.store.all();\n\n    const olGeometry = olFeature.getGeometry() as any;\n    olGeometry.ol_uid = olFeature.get('id');\n\n    const olGeometryCoordinates = JSON.stringify(olGeometry.getCoordinates()[0]);\n\n    entities.forEach(entity => {\n      const entityCoordinates = JSON.stringify(entity.geometry.coordinates[0]);\n\n      if (olGeometryCoordinates === entityCoordinates) {\n        const rad: number = entity.properties.rad ? entity.properties.rad : undefined;\n\n        this.updateLabelOfOlGeometry(olGeometry, label);\n        this.replaceFeatureInStore(entity, olGeometry, rad);\n      }\n    });\n  }\n\n  /**\n   * Add a feature with draw label to the store. The loading stragegy of the store\n   * will trigger and add the feature to the map.\n   * @internal\n   */\n  private addFeatureToStore(olGeometry, radius?: number, feature?: FeatureWithDraw) {\n    let rad: number;\n    let center4326: Array<number>;\n    let point4326: Array<number>;\n    let lon4326: number;\n    let lat4326: number;\n    const featureId = feature ? feature.properties.id : olGeometry.ol_uid;\n    const projection = this.map.ol.getView().getProjection();\n\n    const geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\n      featureProjection: projection,\n      dataProjection: projection\n    }) as any;\n\n    if (olGeometry instanceof OlCircle || radius) {\n      if (radius) {\n        rad = radius;\n      } else {\n        geometry.type = 'Point';\n        geometry.coordinates = olGeometry.getCenter();\n        const extent4326 = transform([olGeometry.getFlatCoordinates()[2], olGeometry.getFlatCoordinates()[3]], projection, 'EPSG:4326');\n        center4326 = transform([olGeometry.getFlatCoordinates()[0], olGeometry.getFlatCoordinates()[1]], projection, 'EPSG:4326');\n        lon4326 = center4326[0];\n        lat4326 = center4326[1];\n        rad = getDistance(center4326, extent4326);\n      }\n    }\n\n    if (olGeometry instanceof OlPoint) {\n      point4326 = transform(olGeometry.getFlatCoordinates(), projection, 'EPSG:4326');\n      lon4326 = point4326[0];\n      lat4326 = point4326[1];\n    }\n\n    this.store.update({\n      type: FEATURE,\n      geometry,\n      projection: projection.getCode(),\n      properties: {\n        id: featureId,\n        draw: olGeometry.get('_label'),\n        longitude: lon4326 ? lon4326 : null,\n        latitude: lat4326 ? lat4326 : null,\n        rad: rad ? rad : null\n      },\n      meta: {\n       id: featureId\n      }\n    });\n  }\n\n  /**\n   * Replace the feature in the store\n   * @param entity the entity to replace\n   * @param olGeometry the new geometry to insert in the store\n   */\n  private replaceFeatureInStore(entity, olGeometry: OlGeometry, radius?: number) {\n    this.store.delete(entity);\n    this.onDrawEnd(olGeometry, radius);\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      fill: [''],\n      stroke: ['']\n    });\n  }\n\n  deleteDrawings() {\n    this.store.deleteMany(this.selectedFeatures$.value);\n    this.selectedFeatures$.value.forEach(selectedFeature => {\n      this.olDrawingLayerSource.getFeatures().forEach(drawingLayerFeature => {\n        const geometry = drawingLayerFeature.getGeometry() as any;\n        if (selectedFeature.properties.id === geometry.ol_uid) {\n          this.olDrawingLayerSource.removeFeature(drawingLayerFeature);\n        }\n      });\n    });\n  }\n\n  /**\n   * Clear the tooltips of an OL geometry\n   * @param olGeometry OL geometry with tooltips\n   */\n  private clearLabelsOfOlGeometry(olGeometry) {\n    getTooltipsOfOlGeometry(olGeometry).forEach((olTooltip: OlOverlay | undefined) => {\n      if (olTooltip && olTooltip.getMap()) {\n        this.map.ol.removeOverlay(olTooltip);\n      }\n    });\n  }\n\n  /**\n   * Called when the user toggles the labels toggle\n   */\n  onToggleLabels() {\n    this.drawStyleService.toggleLabelsAreShown();\n    this.labelsAreShown = !this.labelsAreShown;\n    this.icon ? this.onColorChange(this.labelsAreShown, true) : this.onColorChange(this.labelsAreShown, false);\n    }\n\n  /**\n   * Update the label of a geometry when a label is entered in a dialog box\n   * @param olGeometry the geometry\n   * @param label the label\n   */\n  private updateLabelOfOlGeometry(olGeometry: OlGeometry, label: string) {\n    olGeometry.setProperties({\n      _label: label\n    }, true);\n  }\n\n  onIconChange(event?) {\n    this.icon = event;\n    this.drawStyleService.setIcon(this.icon);\n    this.store.layer.ol.setStyle((feature, resolution) => {\n      return this.drawStyleService.createDrawingLayerStyle(feature, resolution, true, this.icon);\n    });\n  }\n\n  openShorcutsDialog() {\n    this.dialog.open(DrawShorcutsComponent);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { ColorPickerModule } from 'ngx-color-picker';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoEntityTableModule } from '@igo2/common';\nimport { DrawComponent } from './draw.component';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { DrawPopupComponent } from './draw-popup.component';\nimport { DrawShorcutsComponent } from './draw-shorcuts.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    FormsModule,\n    ReactiveFormsModule,\n    CommonModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    MatDividerModule,\n    MatFormFieldModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatListModule,\n    MatSelectModule,\n    MatSlideToggleModule,\n    MatDialogModule,\n    IgoLanguageModule,\n    IgoEntityTableModule,\n    ColorPickerModule\n  ],\n  declarations: [\n    DrawComponent,\n    DrawPopupComponent,\n    DrawShorcutsComponent\n  ],\n  exports: [\n    DrawComponent\n  ]\n})\nexport class IgoDrawModule {}\n","import { NgModule } from '@angular/core';\nimport { IgoDrawModule } from './draw/draw.module';\n\n@NgModule({\n    imports: [\n\n    ],\n    declarations: [\n    ],\n    exports: [\n        IgoDrawModule\n    ]\n})\n\nexport class IgoDrawingToolModule {}\n","import { OnInit, Directive, Self, HostListener, ElementRef, Output, EventEmitter } from '@angular/core';\nimport { FeatureDetailsComponent } from './feature-details.component';\n\nimport olGeolocation from 'ol/Geolocation';\nimport * as olProj from 'ol/proj';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport pointOnFeature from '@turf/point-on-feature';\nimport { Feature, FEATURE } from '../shared';\n\n@Directive({\n  // This directive allow to view the route between the user coordinates and the feature\n  selector: '[igoFeatureDetailsDirective]'\n})\n\nexport class FeatureDetailsDirective implements OnInit {\n  private component: FeatureDetailsComponent;\n  public geolocation$ = new BehaviorSubject<olGeolocation>(undefined);\n\n  public start: Feature = {\n    meta: { id: 1 },\n    type: FEATURE,\n    geometry: {\n      type: 'Point',\n      coordinates: undefined\n    },\n    projection: 'EPSG:4326',\n    properties: {\n      id: 1,\n      name: 'User coordinates',\n    }\n  };\n\n  public end: Feature;\n\n  get map() {\n    return this.component.map;\n  }\n\n  get feature() {\n    return this.component.feature;\n  }\n  feature$ = new BehaviorSubject(undefined);\n\n  get geolocation() {\n    return this.component.map.geolocation$.getValue();\n  }\n  set geolocation(value) {\n    if (value) {\n      this.geolocation = value;\n      this.geolocation.on('change', evt => {\n        this.geolocation$.next(this.geolocation);\n      });\n    }\n  }\n\n  @Output() routingEvent = new EventEmitter<Feature[]>();\n\n  @HostListener('selectFeature')\n  setFeature() {\n    this.feature$.next(this.feature);\n  }\n\n  constructor(\n    @Self() component: FeatureDetailsComponent,\n    private el: ElementRef\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    this.map.geolocation$.subscribe(geolocation => {\n      if (!geolocation) {\n        return;\n      }\n      geolocation.setProjection(this.map.projection);\n\n      if (geolocation && geolocation.getTracking() === false) {\n        geolocation.setTracking(false);\n      }\n\n      if (geolocation.getTracking() === true) {\n        let userCoord = geolocation.getPosition();\n        userCoord = olProj.transform(userCoord, this.map.projection, 'EPSG:4326');\n        this.start.geometry.coordinates = userCoord;\n      }\n    });\n\n    this.feature$.subscribe(() => {\n      if (this.feature.geometry) {\n        if (this.feature.geometry.type === 'Point') {\n          this.end = this.feature;\n        } else {\n          this.end = pointOnFeature(this.feature.geometry);\n        }\n        this.geolocation$.next(this.geolocation);\n        this.bindClicking();\n      }\n    });\n  }\n\n  bindClicking() {\n    setTimeout(() => {\n      const routeElement = this.el.nativeElement.querySelector('span.routing');\n      if (routeElement) {\n        routeElement.addEventListener('click', () => {\n          this.activateRouting();\n        });\n      }\n    }, 1);\n  }\n\n  activateRouting() {\n    this.start.geometry.coordinates ? this.routingEvent.emit([this.start, this.end]) : this.routingEvent.emit([this.end]);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoKeyValueModule, IgoImageModule } from '@igo2/common';\n\nimport { FeatureDetailsComponent } from './feature-details.component';\nimport { FeatureDetailsDirective } from './feature-details.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    IgoLanguageModule,\n    IgoKeyValueModule,\n    IgoImageModule\n  ],\n  exports: [\n    FeatureDetailsComponent,\n    FeatureDetailsDirective],\n  declarations: [\n    FeatureDetailsComponent,\n    FeatureDetailsDirective]\n})\nexport class IgoFeatureDetailsModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoFormModule } from '@igo2/common';\n\nimport { FeatureFormComponent } from './feature-form.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoFormModule\n  ],\n  exports: [\n    IgoFormModule,\n    FeatureFormComponent\n  ],\n  declarations: [\n    FeatureFormComponent\n  ]\n})\nexport class IgoFeatureFormModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoFeatureDetailsModule } from './feature-details/feature-details.module';\nimport { IgoFeatureFormModule } from './feature-form/feature-form.module';\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    IgoFeatureDetailsModule,\n    IgoFeatureFormModule\n  ],\n  declarations: [],\n  providers: []\n})\nexport class IgoFeatureModule {}\n","import OlMap from 'ol/Map';\nimport OlFeature from 'ol/Feature';\nimport * as OlStyle from 'ol/style';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport OlModify from 'ol/interaction/Modify';\nimport OlTranslate from 'ol/interaction/Translate';\nimport OlDraw from 'ol/interaction/Draw';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlLineString from 'ol/geom/LineString';\nimport OlCircle from 'ol/geom/Circle';\nimport OlLinearRing from 'ol/geom/LinearRing';\nimport OlInteraction from 'ol/interaction/Interaction';\nimport OlDragBoxInteraction from 'ol/interaction/DragBox';\nimport MapBrowserEvent from 'ol/MapBrowserEvent';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport BasicEvent from 'ol/events/Event';\nimport { ModifyEvent as OlModifyEvent } from 'ol/interaction/Modify';\nimport { TranslateEvent as OlTranslateEvent } from 'ol/interaction/Translate';\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\nimport { unByKey } from 'ol/Observable';\n\nimport { Subject, Subscription, fromEvent } from 'rxjs';\n\nimport {\n  addLinearRingToOlPolygon,\n  createDrawHoleInteractionStyle,\n  getMousePositionFromOlGeometryEvent\n} from '../geometry.utils';\n\nexport interface ModifyControlOptions {\n  source?: OlVectorSource<any>;\n  layer?: OlVectorLayer<any>;\n  layerStyle?: OlStyleLike;\n  drawStyle?: OlStyleLike;\n  modify?: boolean;\n  translate?: boolean;\n}\n\n/**\n * Control to modify geometries\n */\nexport class ModifyControl {\n  /**\n   * Modify start observable\n   */\n  public start$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Modify end observable\n   */\n  public end$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Geometry changes observable\n   */\n  public changes$: Subject<OlGeometry> = new Subject();\n\n  private olMap: OlMap;\n  private olOverlayLayer: OlVectorLayer<any>;\n  public olModifyInteraction: OlModify;\n  private onModifyStartKey: any;\n  private onModifyEndKey: any;\n  private onModifyKey: any;\n  private olModifyInteractionIsActive: boolean = false;\n  private olTranslateInteraction: OlTranslate;\n  private onTranslateStartKey: any;\n  private onTranslateEndKey: any;\n  private onTranslateKey: any;\n  private olTranslateInteractionIsActive: boolean = false;\n  private olDrawInteraction: OlDraw;\n  private onDrawStartKey: any;\n  private onDrawEndKey: any;\n  private onDrawKey: any;\n  private olDrawInteractionIsActive: boolean = false;\n\n  private mousePosition: [number, number];\n\n  private keyDown$$: Subscription;\n  private drawKeyUp$$: Subscription;\n  private drawKeyDown$$: Subscription;\n\n  private removedOlInteractions: OlInteraction[] = [];\n  private olLinearRingsLayer: OlVectorLayer<any>;\n\n  // This is the geometry to test against when drawing holes\n  private olOuterGeometry: OlGeometry;\n\n  /**\n   * Wheter the control is active\n   */\n  get active(): boolean {\n    return this.olMap !== undefined;\n  }\n\n  /**\n   * OL overlay source\n   * @internal\n   */\n  get olOverlaySource(): OlVectorSource<any> {\n    return this.olOverlayLayer.getSource();\n  }\n\n  /**\n   * OL linear rings source\n   * @internal\n   */\n  get olLinearRingsSource(): OlVectorSource<any> {\n    return this.olLinearRingsLayer.getSource();\n  }\n\n  /**\n   * Whether a modify control should be available\n   */\n  private modify: boolean = true;\n\n  /**\n   * Whether a translate control should be available\n   */\n  private translate: boolean = true;\n\n  constructor(private options: ModifyControlOptions) {\n    if (options.modify !== undefined) {\n      this.modify = options.modify;\n    }\n    if (options.translate !== undefined) {\n      this.translate = options.translate;\n    }\n\n    if (options.layer !== undefined) {\n      this.olOverlayLayer = options.layer;\n    } else {\n      this.olOverlayLayer = this.createOlInnerOverlayLayer();\n    }\n    this.olLinearRingsLayer = this.createOlLinearRingsLayer();\n  }\n\n  /**\n   * Add or remove this control to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    if (olMap === undefined) {\n      this.clearOlInnerOverlaySource();\n      this.removeOlInnerOverlayLayer();\n      this.removeOlModifyInteraction();\n      this.removeOlTranslateInteraction();\n      this.removeOlDrawInteraction();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n    this.addOlInnerOverlayLayer();\n\n    // The order in which these interactions\n    // are added is important\n    if (this.modify === true) {\n      this.addOlDrawInteraction();\n    }\n\n    if (this.translate === true) {\n      this.addOlTranslateInteraction();\n      this.activateTranslateInteraction();\n    }\n\n    if (this.modify === true) {\n      this.addOlModifyInteraction();\n      this.activateModifyInteraction();\n    }\n  }\n\n  /**\n   * Return the overlay source\n   */\n  getSource(): OlVectorSource<any> {\n    return this.olOverlaySource;\n  }\n\n  /**\n   * Add an OL geometry to the overlay and start modifying it\n   * @param olGeometry Ol Geometry\n   */\n  setOlGeometry(olGeometry: OlGeometry) {\n    const olFeature = new OlFeature({ geometry: olGeometry });\n    this.olOverlaySource.clear();\n    this.olOverlaySource.addFeature(olFeature);\n  }\n\n  /**\n   * Create an overlay source if none is defined in the options\n   */\n  private createOlInnerOverlayLayer(): OlVectorLayer<any> {\n    return new OlVectorLayer({\n      source: this.options.source ? this.options.source : new OlVectorSource(),\n      style: this.options.layerStyle,\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Add the overlay layer if it wasn't defined in the options\n   */\n  private addOlInnerOverlayLayer() {\n    if (this.options.layer === undefined) {\n      this.olMap.addLayer(this.olOverlayLayer);\n    }\n  }\n\n  /**\n   * Clear the overlay layer if it wasn't defined in the options\n   */\n  private removeOlInnerOverlayLayer() {\n    if (this.options.layer === undefined && this.olMap !== undefined) {\n      this.olMap.removeLayer(this.olOverlayLayer);\n    }\n  }\n\n  /**\n   * Clear the overlay source if it wasn't defined in the options\n   */\n  private clearOlInnerOverlaySource() {\n    if (this.options.layer === undefined && this.options.source === undefined) {\n      this.olOverlaySource.clear(true);\n    }\n  }\n\n  private createOlLinearRingsLayer(): OlVectorLayer<any> {\n    return new OlVectorLayer({\n      source: new OlVectorSource(),\n      style: createDrawHoleInteractionStyle(),\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Add the linear rings layer\n   */\n  private addOlLinearRingsLayer() {\n    this.olMap.addLayer(this.olLinearRingsLayer);\n  }\n\n  /**\n   * Clear the linear rings layer\n   */\n  private removeOlLinearRingsLayer() {\n    this.olMap.removeLayer(this.olLinearRingsLayer);\n  }\n\n  /**\n   * Clear the linear rings source\n   */\n  private clearOlLinearRingsSource() {\n    this.olLinearRingsSource.clear(true);\n  }\n\n  /**\n   * Add a modify interaction to the map an set up some listeners\n   */\n  private addOlModifyInteraction() {\n    const olModifyInteraction = new OlModify({\n      source: this.olOverlaySource,\n      style: this.options.drawStyle as OlStyle.Style\n    });\n    this.olModifyInteraction = olModifyInteraction;\n  }\n\n  /**\n   * Remove the modify interaction\n   */\n  private removeOlModifyInteraction() {\n    if (this.olModifyInteraction === undefined) {\n      return;\n    }\n\n    this.deactivateModifyInteraction();\n    this.olModifyInteraction = undefined;\n  }\n\n  private activateModifyInteraction() {\n    if (this.olModifyInteractionIsActive === true) {\n      return;\n    }\n\n    this.olModifyInteractionIsActive = true;\n    this.onModifyStartKey = this.olModifyInteraction.on(\n      'modifystart',\n      (event: OlModifyEvent) => this.onModifyStart(event)\n    );\n    this.onModifyEndKey = this.olModifyInteraction.on(\n      'modifyend',\n      (event: OlModifyEvent) => this.onModifyEnd(event)\n    );\n    this.olMap.addInteraction(this.olModifyInteraction);\n  }\n\n  private deactivateModifyInteraction() {\n    if (this.olModifyInteractionIsActive === false) {\n      return;\n    }\n\n    this.olModifyInteractionIsActive = false;\n\n    unByKey([this.onModifyStartKey, this.onModifyEndKey, this.onModifyKey]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olModifyInteraction);\n    }\n  }\n\n  /**\n   * When modifying starts, clear the overlay and start watching for changes\n   * @param event Modify start event\n   */\n  private onModifyStart(event: OlModifyEvent) {\n    const olGeometry = event.features.item(0).getGeometry() as OlGeometry;\n    this.start$.next(olGeometry);\n    this.onModifyKey = olGeometry.on(\n      'change',\n      (olGeometryEvent: BasicEvent) => {\n        this.mousePosition = getMousePositionFromOlGeometryEvent(\n          olGeometryEvent\n        );\n        this.changes$.next(olGeometryEvent.target as OlLineString | OlCircle | OlPolygon);\n      }\n    );\n    this.subscribeToKeyDown();\n  }\n\n  /**\n   * When modifying ends, update the geometry observable and stop watching for changes\n   * @param event Modify end event\n   */\n  private onModifyEnd(event: OlModifyEvent) {\n    unByKey(this.onModifyKey);\n    this.end$.next(event.features.item(0).getGeometry() as OlGeometry);\n    this.unsubscribeToKeyDown();\n  }\n\n  /**\n   * Subscribe to space key down to pan the map\n   */\n  private subscribeToKeyDown() {\n    this.keyDown$$ = fromEvent(document, 'keydown').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key === ' ') {\n          // On space bar, pan to the current mouse position\n          this.olMap.getView().animate({\n            center: this.mousePosition,\n            duration: 0\n          });\n          return;\n        }\n      }\n    );\n  }\n\n  /**\n   * Unsubscribe to key down\n   */\n  private unsubscribeToKeyDown() {\n    if (this.keyDown$$ !== undefined) {\n      this.keyDown$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Add a translate interaction to the map an set up some listeners\n   */\n  private addOlTranslateInteraction() {\n    const olTranslateInteraction = new OlTranslate({\n      layers: [this.olOverlayLayer]\n    });\n    this.olTranslateInteraction = olTranslateInteraction;\n  }\n\n  /**\n   * Remove the translate interaction\n   */\n  private removeOlTranslateInteraction() {\n    if (this.olTranslateInteraction === undefined) {\n      return;\n    }\n\n    this.deactivateTranslateInteraction();\n    this.olTranslateInteraction = undefined;\n  }\n\n  private activateTranslateInteraction() {\n    if (this.olTranslateInteractionIsActive === true) {\n      return;\n    }\n\n    this.olTranslateInteractionIsActive = true;\n    this.onTranslateStartKey = this.olTranslateInteraction.on(\n      'translatestart',\n      (event: OlTranslateEvent) => this.onTranslateStart(event)\n    );\n    this.onTranslateEndKey = this.olTranslateInteraction.on(\n      'translateend',\n      (event: OlTranslateEvent) => this.onTranslateEnd(event)\n    );\n    this.olMap.addInteraction(this.olTranslateInteraction);\n  }\n\n  private deactivateTranslateInteraction() {\n    if (this.olTranslateInteractionIsActive === false) {\n      return;\n    }\n\n    this.olTranslateInteractionIsActive = false;\n    unByKey([\n      this.onTranslateStartKey,\n      this.onTranslateEndKey,\n      this.onTranslateKey\n    ]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olTranslateInteraction);\n    }\n  }\n\n  /**\n   * When translation starts, clear the overlay and start watching for changes\n   * @param event Translate start event\n   */\n  private onTranslateStart(event: OlTranslateEvent) {\n    const olGeometry = event.features.item(0).getGeometry() as OlGeometry;\n    this.start$.next(olGeometry);\n    this.onTranslateKey = olGeometry.on(\n      'change',\n      (olGeometryEvent: BasicEvent) => {\n        // this.changes$.next(olGeometryEvent.target);\n      }\n    );\n  }\n\n  /**\n   * When translation ends, update the geometry observable and stop watchign for changes\n   * @param event Translate end event\n   */\n  private onTranslateEnd(event: OlTranslateEvent) {\n    unByKey(this.onTranslateKey);\n    this.end$.next(event.features.item(0).getGeometry() as OlGeometry);\n  }\n\n  /**\n   * Add a draw interaction to the map an set up some listeners\n   */\n  private addOlDrawInteraction() {\n    const olDrawInteraction = new OlDraw({\n      type: 'Polygon',\n      source: this.olLinearRingsSource,\n      stopClick: true,\n      style: createDrawHoleInteractionStyle(),\n      condition: (event: MapBrowserEvent<any>) => {\n        const olOuterGeometry = this.olOuterGeometry || this.getOlGeometry();\n        const intersects = olOuterGeometry.intersectsCoordinate(\n          event.coordinate\n        );\n        return intersects;\n      }\n    });\n\n    this.olDrawInteraction = olDrawInteraction;\n    this.subscribeToDrawKeyDown();\n  }\n\n  /**\n   * Subscribe to CTRL key down to activate the draw control\n   */\n  private subscribeToDrawKeyDown() {\n    this.drawKeyDown$$ = fromEvent(document, 'keydown').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key !== 'Control') {\n          return;\n        }\n\n        this.unsubscribeToDrawKeyDown();\n\n        const olGeometry = this.getOlGeometry();\n        if (!olGeometry || !(olGeometry instanceof OlPolygon)) {\n          return;\n        }\n\n        this.subscribeToDrawKeyUp();\n\n        this.deactivateModifyInteraction();\n        this.deactivateTranslateInteraction();\n        this.activateDrawInteraction();\n      }\n    );\n  }\n\n  /**\n   * Subscribe to CTRL key up to deactivate the draw control\n   */\n  private subscribeToDrawKeyUp() {\n    this.drawKeyUp$$ = fromEvent(document, 'keyup').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key !== 'Control') {\n          return;\n        }\n\n        this.unsubscribeToDrawKeyUp();\n        this.unsubscribeToKeyDown();\n        this.deactivateDrawInteraction();\n\n        this.activateModifyInteraction();\n        if (this.translate === true) {\n          this.activateTranslateInteraction();\n        }\n        this.subscribeToDrawKeyDown();\n\n        this.olOuterGeometry = undefined;\n        this.clearOlLinearRingsSource();\n        this.end$.next(this.getOlGeometry());\n      }\n    );\n  }\n\n  /**\n   * Unsubscribe to draw key down\n   */\n  private unsubscribeToDrawKeyDown() {\n    if (this.drawKeyDown$$ !== undefined) {\n      this.drawKeyDown$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Unsubscribe to key up\n   */\n  private unsubscribeToDrawKeyUp() {\n    if (this.drawKeyUp$$ !== undefined) {\n      this.drawKeyUp$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Remove the draw interaction\n   */\n  private removeOlDrawInteraction() {\n    if (this.olDrawInteraction === undefined) {\n      return;\n    }\n\n    this.unsubscribeToKeyDown();\n    this.unsubscribeToDrawKeyUp();\n    this.unsubscribeToDrawKeyDown();\n    this.deactivateDrawInteraction();\n    this.clearOlLinearRingsSource();\n    this.olDrawInteraction = undefined;\n  }\n\n  /**\n   * Activate the draw interaction\n   */\n  private activateDrawInteraction() {\n    if (this.olDrawInteractionIsActive === true) {\n      return;\n    }\n\n    this.clearOlLinearRingsSource();\n    this.addOlLinearRingsLayer();\n\n    this.olMap.getInteractions().forEach((olInteraction: OlInteraction) => {\n      if (olInteraction instanceof OlDragBoxInteraction) {\n        this.olMap.removeInteraction(olInteraction);\n        this.removedOlInteractions.push(olInteraction);\n      }\n    });\n\n    this.olDrawInteractionIsActive = true;\n    this.onDrawStartKey = this.olDrawInteraction.on(\n      'drawstart',\n      (event: OlDrawEvent) => this.onDrawStart(event)\n    );\n    this.onDrawEndKey = this.olDrawInteraction.on(\n      'drawend',\n      (event: OlDrawEvent) => this.onDrawEnd(event)\n    );\n    this.olMap.addInteraction(this.olDrawInteraction);\n  }\n\n  /**\n   * Deactivate the draw interaction\n   */\n  private deactivateDrawInteraction() {\n    if (this.olDrawInteractionIsActive === false) {\n      return;\n    }\n\n    this.removeOlLinearRingsLayer();\n\n    this.removedOlInteractions.forEach((olInteraction: OlInteraction) => {\n      this.olMap.addInteraction(olInteraction);\n    });\n    this.removedOlInteractions = [];\n\n    this.olDrawInteractionIsActive = false;\n    unByKey([this.onDrawStartKey, this.onDrawEndKey, this.onDrawKey]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olDrawInteraction);\n    }\n  }\n\n  /**\n   * When draw start, add a new linerar ring to the geometry and start watching for changes\n   * @param event Draw start event\n   */\n  private onDrawStart(event: OlDrawEvent) {\n    const olGeometry = event.feature.getGeometry();\n    this.olOuterGeometry = this.getOlGeometry().clone();\n\n    const linearRingCoordinates = olGeometry.getLinearRing().getCoordinates();\n    this.addLinearRingToOlGeometry(linearRingCoordinates);\n    this.start$.next(this.getOlGeometry());\n\n    this.onDrawKey = olGeometry.on(\n      'change',\n      (olGeometryEvent: BasicEvent) => {\n        this.mousePosition = getMousePositionFromOlGeometryEvent(\n          olGeometryEvent\n        );\n        const olGeometryTarget = olGeometryEvent.target as OlPolygon;\n        const _linearRingCoordinates = olGeometryTarget\n          .getLinearRing(0)\n          .getCoordinates();\n        this.updateLinearRingOfOlGeometry(_linearRingCoordinates);\n        this.changes$.next(this.getOlGeometry());\n      }\n    );\n    this.subscribeToKeyDown();\n  }\n\n  /**\n   * When translation ends, update the geometry observable and stop watchign for changes\n   * @param event Draw end event\n   */\n  private onDrawEnd(event: OlDrawEvent) {\n    unByKey(this.onDrawKey);\n    this.olOuterGeometry = undefined;\n\n    const linearRingCoordinates = event.feature\n      .getGeometry()\n      .getLinearRing()\n      .getCoordinates();\n    this.updateLinearRingOfOlGeometry(linearRingCoordinates);\n    this.clearOlLinearRingsSource();\n    this.end$.next(this.getOlGeometry());\n    this.unsubscribeToKeyDown();\n  }\n\n  /**\n   * Add a linear ring to the geometry being modified\n   * @param coordinates Linear ring coordinates\n   */\n  private addLinearRingToOlGeometry(coordinates: number[]) {\n    const olGeometry = this.getOlGeometry() as OlPolygon;\n    const olLinearRing = new OlLinearRing(coordinates);\n    addLinearRingToOlPolygon(olGeometry, olLinearRing);\n  }\n\n  /**\n   * Update the last linear ring of the geometry being modified\n   * @param coordinates Linear ring coordinates\n   */\n  private updateLinearRingOfOlGeometry(coordinates: number[][]) {\n    const olGeometry = this.getOlGeometry() as OlPolygon;\n    // Remove the last linear ring (the one we are updating)\n    const olLinearRings = olGeometry.getLinearRings().slice(0, -1);\n    const newCoordinates = olLinearRings.map((olLinearRing: OlLinearRing) => {\n      return olLinearRing.getCoordinates();\n    });\n    newCoordinates.push(coordinates);\n    olGeometry.setCoordinates(newCoordinates);\n  }\n\n  /**\n   * Get the geometry being modified\n   * @returns OL Geometry\n   */\n  private getOlGeometry(): OlGeometry {\n    const olFeatures = this.olOverlaySource.getFeatures();\n    return olFeatures.length > 0 ? olFeatures[0].getGeometry() : undefined;\n  }\n}\n","import OlMap from 'ol/Map';\nimport OlFeature from 'ol/Feature';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlLineString from 'ol/geom/LineString';\n\nimport { Subject, Subscription } from 'rxjs';\n\nimport { GeometrySliceError } from '../geometry.errors';\nimport { sliceOlGeometry } from '../geometry.utils';\nimport { DrawControl } from './draw';\n\nexport interface SliceControlOptions {\n  source?: OlVectorSource<OlGeometry>;\n  layer?: OlVectorLayer<OlVectorSource<OlGeometry>>;\n  layerStyle?: OlStyleLike;\n  drawStyle?: OlStyleLike;\n}\n\n/**\n * Control to modify geometries\n */\nexport class SliceControl {\n\n  /**\n   * Slice end observable\n   */\n  public end$: Subject<OlGeometry[]> = new Subject();\n\n  /**\n   * Slice error, if any\n   */\n  public error$: Subject<GeometrySliceError> = new Subject();\n\n  private olMap: OlMap;\n  private olOverlayLayer: OlVectorLayer<OlVectorSource<OlGeometry>>;\n\n  /**\n   * Draw line control\n   */\n  private drawLineControl: DrawControl;\n\n  /**\n   * Subscription to draw start\n   */\n  private drawLineStart$$: Subscription;\n\n  /**\n   * Subscription to draw end\n   */\n  private drawLineEnd$$: Subscription;\n\n  /**\n   * Wheter the control is active\n   */\n  get active(): boolean {\n    return this.olMap !== undefined;\n  }\n\n  /**\n   * OL overlay source\n   * @internal\n   */\n  get olOverlaySource(): OlVectorSource<OlGeometry> {\n    return this.olOverlayLayer.getSource();\n  }\n\n  constructor(private options: SliceControlOptions) {\n    if (options.layer !== undefined) {\n      this.olOverlayLayer = options.layer;\n    } else {\n      this.olOverlayLayer = this.createOlInnerOverlayLayer();\n    }\n  }\n\n  /**\n   * Add or remove this control to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    if (olMap === undefined) {\n      this.clearOlInnerOverlaySource();\n      this.removeOlInnerOverlayLayer();\n      this.removeDrawLineControl();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n    this.addOlInnerOverlayLayer();\n    this.addDrawLineControl();\n  }\n\n  /**\n   * Return the overlay source\n   */\n  getSource(): OlVectorSource<OlGeometry> {\n    return this.olOverlaySource;\n  }\n\n  /**\n   * Add an OL geometry to the overlay for slicing\n   * @param olGeometry Ol Geometry\n   */\n  setOlGeometry(olGeometry: OlGeometry) {\n    const olFeature = new OlFeature({geometry: olGeometry});\n    this.olOverlaySource.clear(true);\n    this.olOverlaySource.addFeature(olFeature);\n  }\n\n  /**\n   * Create an overlay source if none is defined in the options\n   */\n  private createOlInnerOverlayLayer(): OlVectorLayer<OlVectorSource<OlGeometry>> {\n    return new OlVectorLayer({\n      source: this.options.source ? this.options.source : new OlVectorSource(),\n      style: this.options.layerStyle,\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Clear the overlay layer if it wasn't defined in the options\n   */\n  private removeOlInnerOverlayLayer() {\n    if (this.options.layer === undefined && this.olMap !== undefined) {\n      this.olMap.removeLayer(this.olOverlayLayer);\n    }\n  }\n\n  /**\n   * Add the overlay layer if it wasn't defined in the options\n   */\n  private addOlInnerOverlayLayer() {\n    if (this.options.layer === undefined) {\n      this.olMap.addLayer(this.olOverlayLayer);\n    }\n  }\n\n  /**\n   * Clear the overlay source if it wasn't defined in the options\n   */\n  private clearOlInnerOverlaySource() {\n    if (this.options.layer === undefined && this.options.source === undefined) {\n      this.olOverlaySource.clear(true);\n    }\n  }\n\n  /**\n   * Create a draw line control and add it to the map\n   */\n  private addDrawLineControl() {\n    this.drawLineControl = new DrawControl({\n      geometryType: 'LineString',\n      interactionStyle: this.options.drawStyle,\n      maxPoints: 2\n    });\n    this.drawLineStart$$ = this.drawLineControl.start$\n      .subscribe((olLine: OlLineString) => this.onDrawLineStart(olLine));\n    this.drawLineEnd$$ = this.drawLineControl.end$\n      .subscribe((olLine: OlLineString) => this.onDrawLineEnd(olLine));\n    this.drawLineControl.setOlMap(this.olMap);\n  }\n\n  /**\n   * Remove draw line control\n   */\n  private removeDrawLineControl() {\n    if (this.drawLineControl === undefined) {\n      return;\n    }\n\n    this.drawLineStart$$.unsubscribe();\n    this.drawLineEnd$$.unsubscribe();\n    this.drawLineControl.getSource().clear(true);\n    this.drawLineControl.setOlMap(undefined);\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olLine Ol linestring or polygon\n   */\n  private onDrawLineStart(olLine: OlLineString) {\n    this.drawLineControl.getSource().clear(true);\n  }\n\n  /**\n   * Slice the first geometry encountered with the drawn line\n   * @param olLine Ol linestring\n   */\n  private onDrawLineEnd(olLine: OlLineString) {\n    const olSlicedGeometries = [];\n    const lineExtent = olLine.getExtent();\n\n    const olFeaturesToRemove = [];\n    try {\n      this.olOverlaySource.forEachFeatureInExtent(lineExtent, (olFeature: OlFeature<OlGeometry>) => {\n        const olGeometry = olFeature.getGeometry() as any;\n        const olParts = sliceOlGeometry(olGeometry, olLine);\n        if (olParts.length > 0) {\n          olSlicedGeometries.push(...olParts);\n          olFeaturesToRemove.push(olFeature);\n        }\n      });\n    } catch (e) {\n      if (e instanceof GeometrySliceError) {\n        this.error$.next(e);\n        return;\n      } else {\n        throw e;\n      }\n    }\n\n    this.drawLineControl.getSource().clear(true);\n\n    this.olOverlaySource.addFeatures(\n      olSlicedGeometries.map((olGeometry: OlGeometry) => new OlFeature(olGeometry))\n    );\n    olFeaturesToRemove.forEach((olFeature: OlFeature<OlGeometry>) => {\n      this.olOverlaySource.removeFeature(olFeature);\n    });\n\n    this.error$.next(undefined);\n    this.end$.next(olSlicedGeometries);\n  }\n}\n","export const LAYER = 'Layer';\n","export enum LayerListToolControlsEnum {\n  always = 'always',\n  never = 'never',\n  default = 'default'\n}\n","<h3 mat-dialog-title>{{'igo.geo.measure.dialog.title' | translate}}</h3>\n\n<table *ngIf=\"data.length > 0\"\n  class=\"mat-typography\">\n  <thead>\n    <tr>\n      <th colspan=\"2\">{{'igo.geo.measure.dialog.length.title' | translate}}</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>{{data.length | measureFormat: measureLengthUnit.Meters}}</td>\n      <td>{{'igo.geo.measure.dialog.lengthInMeters' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.length | measureFormat: measureLengthUnit.Kilometers}}</td>\n      <td>{{'igo.geo.measure.dialog.lengthInKilometers' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.length | measureFormat: measureLengthUnit.Miles}}</td>\n      <td>{{'igo.geo.measure.dialog.lengthInMiles' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.length | measureFormat: measureLengthUnit.Feet}}</td>\n      <td>{{'igo.geo.measure.dialog.lengthInFeet' | translate}}</td>\n    </tr>\n  </tbody>\n</table>\n\n<table *ngIf=\"data.area > 0\"\n  class=\"mat-typography\">\n  <thead>\n    <tr>\n      <th colspan=\"2\">{{'igo.geo.measure.dialog.area.title' | translate}}</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>{{data.area | measureFormat: measureAreaUnit.SquareMeters}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInSquareMeters' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.area | measureFormat:measureAreaUnit.SquareKilometers}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInSquareKilometers' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.area | measureFormat: measureAreaUnit.SquareMiles}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInSquareMiles' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.area | measureFormat: measureAreaUnit.Acres}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInAcres' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.area | measureFormat: measureAreaUnit.Hectares}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInHectares' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{'igo.geo.measure.dialog.perimeterInMeters' | translate}}</td>\n      <td>{{data.perimeter | measureFormat: measureLengthUnit.Meters}}</td>\n    </tr>\n  </tbody>\n</table>\n","import { Component, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { MeasurerDialogData } from '../shared/measure.interfaces';\n\nimport { MeasureAreaUnit, MeasureLengthUnit} from '../shared/measure.enum';\n\n@Component({\n  selector: 'igo-measurer-dialog',\n  templateUrl: 'measurer-dialog.component.html',\n  styleUrls: ['./measurer-dialog.component.scss']\n})\nexport class MeasurerDialogComponent {\n\n  measureAreaUnit = MeasureAreaUnit;\n\n  measureLengthUnit = MeasureLengthUnit;\n\n  constructor(\n    public dialogRef: MatDialogRef<MeasurerDialogComponent>,\n    @Inject(MAT_DIALOG_DATA) public data: MeasurerDialogData\n  ) {}\n\n  onNoClick(): void {\n    this.dialogRef.close();\n  }\n\n}\n","<div>\n  <div class=\"measure-type-toggle mat-typography\">\n    <mat-button-toggle-group\n      [value]=\"activeMeasureType\"\n      (change)=\"onMeasureTypeChange($event.value)\">\n      <mat-button-toggle [value]=\"measureType.Length\">\n        {{('igo.geo.measure.' + measureType.Length) | translate}}\n      </mat-button-toggle>\n      <mat-button-toggle [value]=\"measureType.Area\">\n        {{('igo.geo.measure.' + measureType.Area) | translate}}\n      </mat-button-toggle>\n    </mat-button-toggle-group>\n  </div>\n\n  <div class=\"measure-options mat-typography\">\n    <mat-slide-toggle\n      [disabled]=\"drawControlIsDisabled\"\n      [checked]=\"drawControlIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDrawControl($event.checked)\">\n      {{'igo.geo.measure.toggleActive' | translate}}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"(hasLine$ | async)\"></mat-divider>\n\n    <mat-slide-toggle *ngIf=\"(hasLine$ | async)\"\n      [checked]=\"displayLines\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayLines($event.checked)\">\n      {{'igo.geo.measure.toggleDisplayLines' | translate}}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"></mat-divider>\n\n    <mat-slide-toggle *ngIf=\"(hasArea$ | async)\"\n      [checked]=\"displayDistance\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayDistance($event.checked)\">\n      {{'igo.geo.measure.toggleDisplayDistance' | translate}}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle *ngIf=\"(hasArea$ | async)\"\n      [checked]=\"displayAreas\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayAreas($event.checked)\">\n      {{'igo.geo.measure.toggleDisplayAreas' | translate}}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"(hasArea$ | async)\"></mat-divider>\n\n    <mat-slide-toggle\n      [checked]=\"measureUnitsAuto\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleMeasureUnitsAuto($event.checked)\">\n      {{'igo.geo.measure.toggleAutoUnits' | translate}}\n    </mat-slide-toggle>\n  </div>\n\n  <ng-container *ngIf=\"measure$ | async as measure\">\n    <igo-measurer-item *ngIf=\"activeMeasureType === measureType.Length || activeMeasureType === measureType.Area\"\n      [measureType]=\"measureType.Length\"\n      [measureUnit]=\"measureLengthUnit.Meters\"\n      [measure]=\"measure.length\"\n      [auto]=\"measureUnitsAuto\"\n      [placeholder]=\"(activeMeasureType === measureType.Area ? 'igo.geo.measure.perimeter' : 'igo.geo.measure.length') | translate\"\n      (measureUnitChange)=\"onLengthUnitChange($event)\">\n    </igo-measurer-item>\n\n    <igo-measurer-item *ngIf=\"activeMeasureType === measureType.Area\"\n      [measureType]=\"measureType.Area\"\n      [measureUnit]=\"measureAreaUnit.SquareMeters\"\n      [measure]=\"measure.area\"\n      [auto]=\"measureUnitsAuto\"\n      [placeholder]=\"'igo.geo.measure.area' | translate\"\n      (measureUnitChange)=\"onAreaUnitChange($event)\">\n    </igo-measurer-item>\n  </ng-container>\n\n  <mat-divider *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"></mat-divider>\n\n  <div class=\"measure-store-buttons\">\n    <button *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.measure.actionbar.calculate.tooltip' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      color=\"accent\"\n      (click)=\"onCalculateClick()\">\n      <mat-icon svgIcon=\"calculator\"></mat-icon>\n    </button>\n\n    <button *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.measure.actionbar.delete.tooltip' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      color=\"warn\"\n      (click)=\"onDeleteClick()\">\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <!--button\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.measure.actionbar.modify.tooltip' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length !== 1\"\n      (click)=\"onModifyClick()\">\n      <mat-icon svgIcon=\"edit\"></mat-icon>\n    </button-->\n  </div>\n\n  <igo-entity-table\n    #table\n    class=\"table-compact\"\n    [store]=\"store\"\n    [template]=\"tableTemplate\">\n  </igo-entity-table>\n</div>\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  ViewChild\n} from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { skip } from 'rxjs/operators';\n\nimport OlStyle from 'ol/style/Style';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlVectorSource from 'ol/source/Vector';\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlOverlay from 'ol/Overlay';\nimport { unByKey } from 'ol/Observable';\n\nimport { LanguageService, StorageScope, StorageService } from '@igo2/core';\nimport { EntityRecord, EntityTableTemplate } from '@igo2/common';\nimport type { EntityTableComponent } from '@igo2/common';\nimport { uuid } from '@igo2/utils';\n\nimport { FeatureDataSource } from '../../datasource';\nimport {\n  FEATURE,\n  FeatureStore,\n  FeatureStoreLoadingStrategy,\n  FeatureStoreSelectionStrategy,\n  tryBindStoreLayer,\n  tryAddLoadingStrategy,\n  tryAddSelectionStrategy\n} from '../../feature';\nimport { DrawControl, ModifyControl } from '../../geometry/shared';\nimport { VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\n\nimport { Measure, MeasurerDialogData, FeatureWithMeasure } from '../shared/measure.interfaces';\nimport {\n  MeasureType,\n  MeasureAreaUnit,\n  MeasureLengthUnit,\n} from '../shared/measure.enum';\nimport {\n  measureOlGeometry,\n  createMeasureInteractionStyle,\n  createMeasureLayerStyle,\n  updateOlTooltipsAtMidpoints,\n  updateOlTooltipAtCenter,\n  getTooltipsOfOlGeometry,\n  squareMetersToUnit,\n  metersToUnit,\n  formatMeasure\n} from '../shared/measure.utils';\nimport { MeasurerDialogComponent } from './measurer-dialog.component';\n\n/**\n * Tool to measure lengths and areas\n */\n@Component({\n  selector: 'igo-measurer',\n  templateUrl: './measurer.component.html',\n  styleUrls: ['./measurer.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MeasurerComponent implements OnInit, OnDestroy {\n\n  /**\n   * Table template\n   * @internal\n   */\n  public tableTemplate: EntityTableTemplate = {\n    selection: true,\n    selectMany: true,\n    selectionCheckbox: true,\n    sort: true,\n    columns: [\n      {\n        name: 'length',\n        title: this.languageService.translate.instant('igo.geo.measure.lengthHeader'),\n        valueAccessor: (localFeature: FeatureWithMeasure) => {\n          const unit = this.activeLengthUnit;\n          const measure = metersToUnit(localFeature.properties.measure.length, unit);\n          return formatMeasure(measure, {\n            decimal: 1,\n            unit,\n            unitAbbr: false,\n            locale: 'fr'\n          });\n        }\n      },\n      {\n        name: 'area',\n        title: this.languageService.translate.instant('igo.geo.measure.areaHeader'),\n        valueAccessor: (localFeature: FeatureWithMeasure) => {\n          const unit = this.activeAreaUnit;\n          const measure = squareMetersToUnit(localFeature.properties.measure.area, unit);\n          return measure ? formatMeasure(measure, {\n            decimal: 1,\n            unit,\n            unitAbbr: false,\n            locale: 'fr'\n          }) : '';\n        }\n      }\n    ]\n  };\n\n  private subscriptions$$: Subscription[] = [];\n\n  /**\n   * Reference to the MeasureType enum\n   * @internal\n   */\n  public measureType = MeasureType;\n\n  /**\n   * Reference to the AreaMeasureUnit enum\n   * @internal\n   */\n  public measureAreaUnit = MeasureAreaUnit;\n\n  /**\n   * Reference to the LengthMeasureUnit enum\n   * @internal\n   */\n  public measureLengthUnit = MeasureLengthUnit;\n\n  /**\n   * Whether measure units should be automatically determined\n   * @internal\n   */\n  public measureUnitsAuto: boolean = false;\n\n  /**\n   * Whether display of distances of areas\n   * @internal\n   */\n  public displayDistance: boolean = true;\n\n  /**\n   * Whether display of distances of lines\n   * @internal\n   */\n  public displayLines: boolean = true;\n\n  /**\n   * Whether display of areas\n   * @internal\n   */\n  public displayAreas: boolean = true;\n\n  /**\n   * Observable of line boolean\n   * @internal\n   */\n   public hasLine$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Observable of area boolean\n   * @internal\n   */\n  public hasArea$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Observable of area\n   * @internal\n   */\n  public measure$: BehaviorSubject<Measure> = new BehaviorSubject({});\n\n  /**\n   * Observable of selected features\n   * @internal\n   */\n  public selectedFeatures$: BehaviorSubject<FeatureWithMeasure[]> = new BehaviorSubject([]);\n\n  /**\n   * OL draw source\n   * @internal\n   */\n  public showTooltips: boolean = true;\n\n  /**\n   * Whether draw control toggle is disabled or not\n   * @internal\n   */\n  public drawControlIsDisabled: boolean = true;\n\n  /**\n   * Draw line control\n   */\n  private drawLineControl: DrawControl;\n\n  /**\n   * Draw polygon control\n   */\n  private drawPolygonControl: DrawControl;\n\n  /**\n   * Modify control\n   */\n  private modifyControl: ModifyControl;\n\n  /**\n   * Active OL geometry\n   */\n  private activeOlGeometry: OlLineString | OlPolygon;\n\n  /**\n   * Active mlength unit\n   */\n  private activeLengthUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n\n  /**\n   * Active area unit\n   */\n  private activeAreaUnit: MeasureAreaUnit = MeasureAreaUnit.SquareMeters;\n\n  /**\n   * Feature added listener key\n   */\n  private onFeatureAddedKey;\n\n  /**\n   * Feature removed listener key\n   */\n  private onFeatureRemovedKey;\n\n  /**\n   * Active draw control\n   * @internal\n   */\n  private activeDrawControl: DrawControl;\n\n  /**\n   * Subscription to draw start\n   */\n  private drawStart$$: Subscription;\n\n  /**\n   * Subscription to draw end\n   */\n  private drawEnd$$: Subscription;\n\n  /**\n   * Subscription to controls changes\n   */\n  private drawChanges$$: Subscription;\n\n  /**\n   * Subscription to modify start\n   */\n  private modifyStart$$: Subscription;\n\n  /**\n   * Subscription to modify end\n   */\n  private modifyEnd$$: Subscription;\n\n  /**\n   * Subscription to controls changes\n   */\n  private modifyChanges$$: Subscription;\n\n  /**\n   * Subscription to measures selection\n   */\n  private selectedFeatures$$: Subscription;\n\n  /**\n   * OL draw source\n   */\n  private olDrawSource = new OlVectorSource();\n\n  /**\n   * The map to measure on\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * The measures store\n   */\n  @Input() store: FeatureStore<FeatureWithMeasure>;\n\n  /**\n   * Measure type\n   * @internal\n   */\n  @Input()\n  set activeMeasureType(value: MeasureType) { this.setActiveMeasureType(value); }\n  get activeMeasureType(): MeasureType { return this._activeMeasureType; }\n  private _activeMeasureType: MeasureType;\n\n  /**\n   * The minimum length a segment must have to display a tooltip.\n   * It also applies to area tooltips.\n   */\n  @Input() minSegmentLength: number = 10;\n\n  @ViewChild('table', { static: true }) table: EntityTableComponent;\n\n  /**\n   * Wheter one of the draw control is active\n   * @internal\n   */\n  get drawControlIsActive(): boolean {\n    return this.activeDrawControl !== undefined;\n  }\n\n  get projection(): string {\n    return this.map.ol.getView().getProjection().getCode();\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    private dialog: MatDialog,\n    private storageService: StorageService\n  ) {}\n\n  /**\n   * Add draw controls and activate one\n   * @internal\n   */\n  ngOnInit() {\n    this.initStore();\n    this.createDrawLineControl();\n    this.createDrawPolygonControl();\n    this.createModifyControl();\n    this.toggleDrawControl();\n    this.updateTooltipsOfOlSource(this.store.source.ol);\n    this.checkDistanceAreaToggle();\n    this.setActiveMeasureType(MeasureType.Length);\n  }\n\n  /**\n   * Clear the overlay layer and any interaction added by this component.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.setActiveMeasureType(undefined);\n    this.deactivateModifyControl();\n    this.freezeStore();\n    this.subscriptions$$.map(s => s.unsubscribe());\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onMeasureTypeChange(measureType: MeasureType) {\n    this.activeMeasureType = measureType;\n  }\n\n  /**\n   * Activate or deactivate the current draw control\n   * @internal\n   */\n  onToggleDrawControl(toggle: boolean) {\n    if (toggle === true) {\n      this.toggleDrawControl();\n    } else {\n      this.deactivateDrawControl();\n    }\n  }\n\n\n  /**\n   * Activate or deactivate the current draw control\n   * @internal\n   */\n   onToggleMeasureUnitsAuto(toggle: boolean) {\n    this.measureUnitsAuto = toggle;\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of the areas\n   * @internal\n   */\n  onToggleDisplayDistance(toggle: boolean) {\n    this.displayDistance = toggle;\n    this.onDisplayDistance();\n    toggle ? (this.storageService.set('distanceToggle', true, StorageScope.SESSION)) :\n     (this.storageService.set('distanceToggle', false, StorageScope.SESSION));\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of the lines\n   * @internal\n   */\n  onToggleDisplayLines(toggle: boolean) {\n    this.displayLines = toggle;\n    this.onDisplayLines();\n    toggle ? (this.storageService.set('linesToggle', true, StorageScope.SESSION)) :\n     (this.storageService.set('linesToggle', false, StorageScope.SESSION));\n  }\n\n  /**\n   * Activate or deactivate the current display of areas\n   * @internal\n   */\n  onToggleDisplayAreas(toggle: boolean) {\n    this.displayAreas = toggle;\n    this.onDisplayAreas();\n    toggle ? (this.storageService.set('areasToggle', true, StorageScope.SESSION)) :\n     (this.storageService.set('areasToggle', false, StorageScope.SESSION));\n  }\n\n  /**\n   * Set display parametres in current values\n   * @internal\n   */\n  checkDistanceAreaToggle(){\n    if (this.storageService.get('distanceToggle') === false){\n      this.displayDistance = false;\n    }\n    if (this.storageService.get('linesToggle') === false){\n      this.displayLines = false;\n    }\n    if (this.storageService.get('areasToggle') === false){\n      this.displayAreas = false;\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of areas\n   * @internal\n   */\n  onDisplayDistance() {\n    if (this.displayDistance) {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-polygone-segments')).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-hidden'));\n    } else {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-polygone-segments')).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-hidden'));\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of lines\n   * @internal\n   */\n  onDisplayLines() {\n    if (this.displayLines) {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-line-segments')).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-hidden'));\n    } else {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-line-segments')).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-hidden'));\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of areas\n   * @internal\n   */\n  onDisplayAreas() {\n    if (this.displayAreas) {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-area')).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-hidden'));\n    } else {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-area')).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-hidden'));\n    }\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onLengthUnitChange(unit: MeasureLengthUnit) {\n    this.activeLengthUnit = unit;\n    this.table.refresh();\n    this.updateTooltipsOfOlSource(this.store.source.ol);\n    if (this.activeOlGeometry !== undefined) {\n      this.updateTooltipsOfOlGeometry(this.activeOlGeometry);\n    }\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onAreaUnitChange(unit: MeasureAreaUnit) {\n    this.activeAreaUnit = unit;\n    this.table.refresh();\n    this.updateTooltipsOfOlSource(this.store.source.ol);\n    if (this.activeOlGeometry !== undefined) {\n      this.updateTooltipsOfOlGeometry(this.activeOlGeometry);\n    }\n  }\n\n  onCalculateClick() {\n    const features = this.selectedFeatures$.value;\n    const area = features.reduce((sum: number, localFeature: FeatureWithMeasure) => {\n      return sum + localFeature.properties.measure.area || 0;\n    }, 0);\n    const length = features.reduce((sum: number, localFeature: FeatureWithMeasure) => {\n      if (localFeature.geometry.type === 'Polygon') {\n        return sum;\n      }\n      return sum + localFeature.properties.measure.length || 0;\n    }, 0);\n    const perimeter = features.reduce((sum: number, localFeature: FeatureWithMeasure) => {\n      if (localFeature.geometry.type === 'LineString') {\n        return sum;\n      }\n      return sum + localFeature.properties.measure.length || 0;\n    }, 0);\n\n    this.openDialog({\n      area,\n      length,\n      perimeter\n    });\n  }\n\n  onDeleteClick() {\n    this.store.deleteMany(this.selectedFeatures$.value);\n    this.selectedFeatures$.value.forEach(selectedFeature => {\n      this.olDrawSource.getFeatures().forEach(drawingLayerFeature => {\n        const geometry = drawingLayerFeature.getGeometry() as any;\n        if (selectedFeature.properties.id === geometry.ol_uid) {\n          this.olDrawSource.removeFeature(drawingLayerFeature);\n        }\n      });\n    });\n  }\n\n  onModifyClick() {\n    if (this.selectedFeatures$.value.length !== 1) { return; }\n\n    if (this.modifyControl.active === true) {\n      this.deactivateModifyControl();\n      this.toggleDrawControl();\n    } else {\n      const localFeature = this.selectedFeatures$.value[0];\n      const olFeatures = this.store.layer.ol.getSource().getFeatures();\n      const olFeature = olFeatures.find((_olFeature: OlFeature<OlGeometry>) => {\n        return _olFeature.get('id') === localFeature.properties.id;\n      });\n\n      if (olFeature !== undefined) {\n        this.deactivateDrawControl();\n        this.activateModifyControl();\n\n        const olGeometry = olFeature.getGeometry();\n        this.clearTooltipsOfOlGeometry(olGeometry as (OlLineString | OlPolygon));\n        this.modifyControl.setOlGeometry(olGeometry);\n      }\n    }\n  }\n\n  private openDialog(data: MeasurerDialogData): void {\n    this.dialog.open(MeasurerDialogComponent, {data});\n  }\n\n  /**\n   * Initialize the measure store and set up some listeners\n   * @internal\n   */\n  private initStore() {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      title: this.languageService.translate.instant('igo.geo.measure.layerTitle'),\n      isIgoInternalLayer: true,\n      id: `igo-measures-${uuid()}`,\n      zIndex: 200,\n      source: new FeatureDataSource(),\n      style: createMeasureLayerStyle(),\n      showInLayerList: true,\n      exportable: true,\n      browsable: false,\n      workspace: { enabled: false }\n    });\n    tryBindStoreLayer(store, layer);\n    store.layer.visible = true;\n    layer.visible$.subscribe(visible => {\n      if (visible) {\n        Array.from(document.getElementsByClassName('igo-map-tooltip-measure')).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-measure-by-display'));\n      }\n      else {\n        Array.from(document.getElementsByClassName('igo-map-tooltip-measure')).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-measure-by-display'));\n      }\n    });\n\n    tryAddLoadingStrategy(store);\n\n    tryAddSelectionStrategy(store, new FeatureStoreSelectionStrategy({\n      map: this.map,\n      many: true\n    }));\n\n    this.onFeatureAddedKey = store.source.ol.on('addfeature', (event: OlVectorSourceEvent<OlGeometry>) => {\n      const localFeature = event.feature;\n      const olGeometry = localFeature.getGeometry() as any;\n      this.updateMeasureOfOlGeometry(olGeometry, localFeature.get('measure'));\n      this.onDisplayDistance();\n    });\n\n    this.onFeatureRemovedKey = store.source.ol.on('removefeature', (event: OlVectorSourceEvent<OlGeometry>) => {\n      const olGeometry = event.feature.getGeometry() as any;\n      this.clearTooltipsOfOlGeometry(olGeometry);\n    });\n\n    this.selectedFeatures$$ = store.stateView.manyBy$((record: EntityRecord<FeatureWithMeasure>) => {\n      return record.state.selected === true;\n    }).pipe(\n      skip(1) // Skip initial emission\n    )\n    .subscribe((records: EntityRecord<FeatureWithMeasure>[]) => {\n      if (this.modifyControl.active === true) {\n        this.deactivateModifyControl();\n      }\n      this.selectedFeatures$.next(records.map(record => record.entity));\n    });\n\n    this.subscriptions$$.push(this.store.entities$.subscribe(objectsExists => {\n      if (objectsExists.find(objectExist => objectExist.geometry.type === 'Polygon')){\n        this.hasArea$.next(true);\n      } else {\n        this.hasArea$.next(false);\n      }\n\n      if (objectsExists.find(objectExist => objectExist.geometry.type === 'LineString')){\n        this.hasLine$.next(true);\n      } else {\n        this.hasLine$.next(false);\n      }\n    }));\n\n    this.subscriptions$$.push(this.store.count$.subscribe(cnt => {\n      cnt >= 1 ?\n        this.store.layer.options.showInLayerList = true :\n        this.store.layer.options.showInLayerList = false;\n    }));\n  }\n\n  /**\n   * Freeze any store, meaning the layer is removed, strategies are deactivated\n   * and some listener removed\n   * @internal\n   */\n  private freezeStore() {\n    const store = this.store;\n    this.selectedFeatures$$.unsubscribe();\n    unByKey(this.onFeatureAddedKey);\n    unByKey(this.onFeatureRemovedKey);\n    store.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n    store.deactivateStrategyOfType(FeatureStoreSelectionStrategy);\n  }\n\n  /**\n   * Create a draw line control\n   */\n  private createDrawLineControl() {\n    this.drawLineControl = new DrawControl({\n      geometryType: 'LineString',\n      drawingLayerSource: this.olDrawSource,\n      interactionStyle: createMeasureInteractionStyle(),\n      drawingLayerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Create a draw polygon control\n   */\n  private createDrawPolygonControl() {\n    this.drawPolygonControl = new DrawControl({\n      geometryType: 'Polygon',\n      drawingLayerSource: this.olDrawSource,\n      interactionStyle: createMeasureInteractionStyle(),\n      drawingLayerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Create a draw polygon control\n   */\n  private createModifyControl() {\n    this.modifyControl = new ModifyControl({\n      source: this.olDrawSource,\n      drawStyle: createMeasureInteractionStyle(),\n      layerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Activate the right control\n   */\n  private toggleDrawControl() {\n    this.deactivateDrawControl();\n    // this.deactivateModifyControl();\n    if (this.activeMeasureType === MeasureType.Length) {\n      this.activateDrawControl(this.drawLineControl);\n    } else if (this.activeMeasureType === MeasureType.Area) {\n      this.activateDrawControl(this.drawPolygonControl);\n    }\n  }\n\n  /**\n   * Activate a given control\n   * @param drawControl Draw control\n   */\n  private activateDrawControl(drawControl: DrawControl) {\n    this.drawControlIsDisabled = false;\n    this.activeDrawControl = drawControl;\n    this.drawStart$$ = drawControl.start$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onDrawStart(olGeometry));\n    this.drawEnd$$ = drawControl.end$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onDrawEnd(olGeometry));\n    this.drawChanges$$ = drawControl.changes$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onDrawChanges(olGeometry));\n    this.drawChanges$$ = drawControl.abort$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => {\n        this.clearTooltipsOfOlGeometry(olGeometry);\n        this.clearMeasures();\n      });\n    drawControl.setOlMap(this.map.ol, false);\n  }\n\n  /**\n   * Deactivate the active draw control\n   */\n  private deactivateDrawControl() {\n    if (this.activeDrawControl === undefined) {\n      return;\n    }\n\n    this.olDrawSource.clear();\n    if (this.drawStart$$ !== undefined ) { this.drawStart$$.unsubscribe(); }\n    if (this.drawEnd$$ !== undefined ) { this.drawEnd$$.unsubscribe(); }\n    if (this.drawChanges$$ !== undefined ) { this.drawChanges$$.unsubscribe(); }\n\n    this.clearTooltipsOfOlSource(this.olDrawSource);\n    if (this.activeOlGeometry !== undefined) {\n      this.clearTooltipsOfOlGeometry(this.activeOlGeometry);\n    }\n    this.activeDrawControl.setOlMap(undefined);\n    this.activeDrawControl = undefined;\n    this.activeOlGeometry = undefined;\n  }\n\n  private setActiveMeasureType(measureType: MeasureType) {\n    this._activeMeasureType = measureType;\n    this.clearMeasures();\n    this.toggleDrawControl();\n  }\n\n  /**\n   * Clear the draw source and track the geometry being drawn\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawStart(olGeometry: OlLineString | OlPolygon) {\n    this.activeOlGeometry = olGeometry;\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawEnd(olGeometry: OlLineString | OlPolygon) {\n    this.activeOlGeometry = undefined;\n    this.finalizeMeasureOfOlGeometry(olGeometry);\n    this.addFeatureToStore(olGeometry);\n    this.clearTooltipsOfOlGeometry(olGeometry);\n    this.olDrawSource.clear(true);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawChanges(olGeometry: OlLineString | OlPolygon) {\n    const measure = measureOlGeometry(olGeometry, this.projection);\n    this.updateMeasureOfOlGeometry(olGeometry, Object.assign({}, measure, {\n      area: undefined // We don't want to display an area tooltip while drawing.\n    }));\n    this.measure$.next(measure);\n  }\n\n  /**\n   * Activate a given control\n   * @param modifyControl Modify control\n   */\n  private activateModifyControl() {\n    const selection = this.store.getStrategyOfType(FeatureStoreSelectionStrategy) as FeatureStoreSelectionStrategy;\n    selection.deactivate();\n    selection.clear();\n\n    this.modifyStart$$ = this.modifyControl.start$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onModifyStart(olGeometry));\n    this.modifyEnd$$ = this.modifyControl.end$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onModifyEnd(olGeometry));\n    this.modifyChanges$$ = this.modifyControl.changes$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onModifyChanges(olGeometry));\n    this.modifyControl.setOlMap(this.map.ol);\n  }\n\n  /**\n   * Deactivate the active modify control\n   */\n  private deactivateModifyControl() {\n    if (this.modifyStart$$ !== undefined ) { this.modifyStart$$.unsubscribe(); }\n    if (this.modifyEnd$$ !== undefined ) { this.modifyEnd$$.unsubscribe(); }\n    if (this.modifyChanges$$ !== undefined ) { this.modifyChanges$$.unsubscribe(); }\n\n    if (this.activeOlGeometry !== undefined) {\n      if (this.selectedFeatures$.value.length === 1) {\n        const localFeature = this.selectedFeatures$.value[0];\n        this.addFeatureToStore(this.activeOlGeometry, localFeature);\n      }\n      this.finalizeMeasureOfOlGeometry(this.activeOlGeometry);\n    }\n\n    this.olDrawSource.clear();\n\n    this.store.activateStrategyOfType(FeatureStoreSelectionStrategy);\n\n    this.activeOlGeometry = undefined;\n    this.modifyControl.setOlMap(undefined);\n  }\n\n  /**\n   * Clear the draw source and track the geometry being drawn\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyStart(olGeometry: OlLineString | OlPolygon) {\n    this.onDrawStart(olGeometry);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyChanges(olGeometry: OlLineString | OlPolygon) {\n    this.onDrawChanges(olGeometry);\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyEnd(olGeometry: OlLineString | OlPolygon) {\n    this.finalizeMeasureOfOlGeometry(olGeometry);\n  }\n\n  private finalizeMeasureOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    const measure = measureOlGeometry(olGeometry, this.projection);\n    this.updateMeasureOfOlGeometry(olGeometry, measure);\n  }\n\n  /**\n   * Update measures observables\n   * @param olGeometry Ol linestring or polygon\n   * @param measure Measure\n   */\n  private updateMeasureOfOlGeometry(olGeometry: OlLineString | OlPolygon, measure: Measure) {\n    olGeometry.setProperties({_measure: measure}, true);\n    this.updateTooltipsOfOlGeometry(olGeometry);\n  }\n\n  /**\n   * Clear the measures observables\n   */\n  private clearMeasures() {\n    this.measure$.next({});\n  }\n\n  /**\n   * Add a feature with measures to the store. The loading stragegy of the store\n   * will trigger and add the feature to the map.\n   * @internal\n   */\n  private addFeatureToStore(olGeometry, localFeature?: FeatureWithMeasure) {\n    const featureId = localFeature ? localFeature.properties.id : olGeometry.ol_uid;\n    const projection = this.map.ol.getView().getProjection();\n    const geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\n      featureProjection: projection,\n      dataProjection: projection\n    }) as any;\n    this.store.update({\n      type: FEATURE,\n      geometry,\n      projection: projection.getCode(),\n      properties: {\n        id: featureId,\n        measure: olGeometry.get('_measure')\n      },\n      meta: {\n        id: featureId\n      }\n    });\n  }\n\n  /**\n   * Update all the tooltips of an OL geometry\n   * @param olGeometry OL Geometry\n   * @param lengths Lengths of the OL geometry's segments\n   * @param measureUnit Display tooltip measure in those units\n   */\n  private updateTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    const measure = olGeometry.get('_measure');\n    const lengths = measure.lengths;\n    const area = measure.area;\n\n    const olMidpointsTooltips = updateOlTooltipsAtMidpoints(olGeometry);\n    if (lengths.length === olMidpointsTooltips.length) {\n      for (let i = 0; i < olMidpointsTooltips.length; i++) {\n        const length = lengths[i];\n        if (length !== undefined) {\n          this.updateOlTooltip(\n            olMidpointsTooltips[i],\n            metersToUnit(length, this.activeLengthUnit),\n            this.activeLengthUnit,\n            MeasureType.Length\n          );\n        }\n      }\n    }\n\n    if (area !== undefined) {\n      this.updateOlTooltip(\n        updateOlTooltipAtCenter(olGeometry),\n        squareMetersToUnit(area, this.activeAreaUnit),\n        this.activeAreaUnit,\n        MeasureType.Area\n      );\n    }\n  }\n\n  /**\n   * Show the map tooltips of a geoemtry\n   */\n  private showTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    getTooltipsOfOlGeometry(olGeometry).forEach((olTooltip: OlOverlay | undefined) => {\n      if (this.shouldShowTooltip(olTooltip)) {\n        this.map.ol.addOverlay(olTooltip);\n      }\n    });\n  }\n\n  /**\n   * Clear the tooltips of an OL geometrys\n   * @param olGeometry OL geometry with tooltips\n   */\n  private clearTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    getTooltipsOfOlGeometry(olGeometry).forEach((olTooltip: OlOverlay | undefined) => {\n      if (olTooltip !== undefined && olTooltip.getMap() !== undefined) {\n        this.map.ol.removeOverlay(olTooltip);\n      }\n    });\n  }\n\n  /**\n   * Show the map tooltips of all the geometries of a source\n   */\n  private updateTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\n      this.updateTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n    });\n  }\n\n  /**\n   * Show the map tooltips of all the geometries of a source\n   */\n  private showTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\n      this.showTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n    });\n  }\n\n  /**\n   * Clear the map tooltips\n   * @param olDrawSource OL vector source\n   */\n  private clearTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\n      const olGeometry = olFeature.getGeometry();\n      if (olGeometry !== undefined) {\n        this.clearTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n      }\n    });\n  }\n\n  /**\n   * Update an OL tooltip properties and inner HTML and add it to the map if possible\n   * @param olTooltip OL tooltip\n   * @param measure The measure valeu ti display\n   * @param measureUnit Display tooltip measure in those units\n   */\n  private updateOlTooltip(\n    olTooltip: OlOverlay,\n    measure: number,\n    unit: MeasureAreaUnit | MeasureLengthUnit,\n    type: MeasureType\n  ) {\n    olTooltip.setProperties({_measure: measure, _unit: unit, _type: type}, true);\n    olTooltip.getElement().innerHTML = this.computeTooltipInnerHTML(olTooltip);\n    if (this.shouldShowTooltip(olTooltip)) {\n      this.map.ol.addOverlay(olTooltip);\n    }\n  }\n\n  /**\n   * Compute a tooltip's content\n   * @param olTooltip OL overlay\n   * @returns Inner HTML\n   */\n  private computeTooltipInnerHTML(olTooltip: OlOverlay): string {\n    const properties = olTooltip.getProperties() as any;\n    return formatMeasure(properties._measure, {\n      decimal: 1,\n      unit: properties._unit,\n      unitAbbr: true,\n      locale: 'fr'\n    }, this.languageService);\n  }\n\n  /**\n   * Whether a tooltip should be showned based on the length\n   * of the segment it is bound to.\n   * @param olTooltip OL overlay\n   * @returns True if the tooltip should be shown\n   */\n  private shouldShowTooltip(olTooltip: OlOverlay): boolean {\n    if (this.showTooltips === false) {\n      return false;\n    }\n\n    const properties = olTooltip.getProperties() as any;\n    const measure = properties._measure;\n    if (measure === undefined) {\n      return false;\n    }\n\n    if (properties._unit === MeasureType.Length) {\n      const minSegmentLength = metersToUnit(this.minSegmentLength, properties._unit) || 0;\n      return measure > Math.max(minSegmentLength, 0);\n    }\n\n    return true;\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\n\nimport { MeasureAreaUnit, MeasureLengthUnit } from '../shared/measure.enum';\nimport { metersToUnit, squareMetersToUnit, formatMeasure } from '../shared/measure.utils';\n\n/**\n * This pipe returns a measure converted from meters (or square meters)\n * to the specified unit. It also keeps a certain number of decimals.\n */\n@Pipe({\n  name: 'measureFormat'\n})\nexport class MeasureFormatPipe implements PipeTransform {\n\n  /**\n   * @ignore\n   */\n  transform(\n    value: number, unit: MeasureAreaUnit | MeasureLengthUnit,\n    unitAbbr: boolean = false,\n    decimal: number = 1\n  ): number {\n    let out;\n    if (Object.values(MeasureAreaUnit).indexOf(unit as MeasureAreaUnit) >= 0) {\n      out = squareMetersToUnit(value, unit as MeasureAreaUnit);\n    } else if (Object.values(MeasureLengthUnit).indexOf(unit as MeasureLengthUnit) >= 0) {\n      out = metersToUnit(value, unit as MeasureLengthUnit);\n    }\n\n    return out ? formatMeasure(out, {\n      decimal: 1,\n      unit,\n      unitAbbr,\n      locale: 'fr'\n    }) : out;\n  }\n}\n","import { DrawControlOptions } from './../shared/controls/draw';\nimport {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  Optional,\n  Self,\n  ChangeDetectorRef,\n  ChangeDetectionStrategy\n} from '@angular/core';\nimport { NgControl, ControlValueAccessor } from '@angular/forms';\n\nimport { Subscription } from 'rxjs';\n\nimport * as OlStyle from 'ol/style';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlGeometry from 'ol/geom/Geometry';\nimport type { default as OlGeometryType } from 'ol/geom/GeometryType';\nimport OlFeature from 'ol/Feature';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport OlOverlay from 'ol/Overlay';\nimport * as olproj from 'ol/proj';\nimport Point from 'ol/geom/Point';\n\nimport { IgoMap } from '../../map';\nimport {\n  MeasureLengthUnit,\n  updateOlGeometryMidpoints,\n  formatMeasure,\n  measureOlGeometry\n} from '../../measure';\nimport { DrawControl, ModifyControl, ModifyControlOptions } from '../shared/controls';\nimport { createDrawInteractionStyle } from '../shared/geometry.utils';\nimport { GeoJSONGeometry } from '../shared/geometry.interfaces';\nimport OlCircle from 'ol/geom/Circle';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPoint from 'ol/geom/Point';\nimport OlPolygon from 'ol/geom/Polygon';\n\n/**\n * This input allows a user to draw a new geometry or to edit\n * an existing one on a map. A text input is also displayed in the\n * form with some instructions.\n * This is still WIP.\n */\n@Component({\n  selector: 'igo-geometry-form-field-input',\n  templateUrl: './geometry-form-field-input.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class GeometryFormFieldInputComponent implements OnInit, OnDestroy, ControlValueAccessor {\n\n  private olOverlayLayer: OlVectorLayer<OlVectorSource<OlGeometry>>;\n  private olGeoJSON = new OlGeoJSON();\n  private ready = false;\n\n  private drawControl: DrawControl;\n  private modifyControl: ModifyControl;\n  private defaultDrawStyleRadius: number;\n  private olGeometryEnds$$: Subscription;\n  private olGeometryChanges$$: Subscription;\n  private olTooltip = this.createMeasureTooltip();\n\n  /**\n   * Active control\n   * @internal\n   */\n  public activeControl: DrawControl | ModifyControl;\n\n  /**\n   * The map to draw the geometry on\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * The geometry type\n   */\n  @Input()\n  set geometryType(value: typeof OlGeometryType) {\n    this._geometryType = value;\n    if (this.ready === false) {\n      return;\n    }\n\n    this.deactivateControl();\n    this.createDrawControl();\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n    this.toggleControl();\n  }\n  get geometryType(): typeof OlGeometryType { return this._geometryType; }\n  private _geometryType: typeof OlGeometryType;\n\n  /**\n   * The drawGuide around the mouse pointer to help drawing\n   */\n  @Input() drawGuide: number = null;\n\n  /**\n   * Whether a measure tooltip should be displayed\n   */\n  @Input() measure: boolean = false;\n\n  /**\n   * Whether draw control should be active or not\n   */\n  @Input()\n  get drawControlIsActive(): boolean { return this._drawControlIsActive; }\n  set drawControlIsActive(value: boolean) {\n    this._drawControlIsActive = value;\n    if (this.ready === false) {\n      return;\n    }\n    this.deactivateControl();\n    if (!this._drawControlIsActive) {\n      return;\n    } else {\n      this.toggleControl();\n    }\n  }\n  private _drawControlIsActive: boolean = true;\n\n  /**\n   * Whether freehand draw control should be active or not\n   */\n  @Input()\n  get freehandDrawIsActive(): boolean { return this._freehandDrawIsActive; }\n  set freehandDrawIsActive(value: boolean) {\n    this._freehandDrawIsActive = value;\n    this.deactivateControl();\n\n    this.createDrawControl();\n    this.createModifyControl();\n\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n\n    if (this.ready === false) {\n      return;\n    }\n\n    if (!this.drawControlIsActive) {\n      return;\n    }\n    this.toggleControl();\n  }\n  private _freehandDrawIsActive: boolean;\n\n  /**\n   * Control options\n   */\n  @Input() controlOptions: {[key: string]: any} = {};\n\n  /**\n   * Style for the draw control (applies while the geometry is being drawn)\n   */\n  @Input()\n  set drawStyle(value: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle) {\n    if (value === undefined) {\n      value = createDrawInteractionStyle();\n    }\n    this._drawStyle = value;\n\n    const olGuideStyle = this.getGuideStyleFromDrawStyle(value) as OlStyle.Circle;\n    if (olGuideStyle !== undefined) {\n      this.defaultDrawStyleRadius = olGuideStyle.getRadius();\n    } else {\n      this.defaultDrawStyleRadius = null;\n    }\n\n    if (this.ready === false) {\n      return;\n    }\n\n    this.deactivateControl();\n    this.createDrawControl();\n    this.createModifyControl();\n\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n    this.toggleControl();\n  }\n  get drawStyle(): OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle { return this._drawStyle; }\n  private _drawStyle: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle;\n\n  /**\n   * Style for the overlay layer (applies once the geometry is added to the map)\n   * If not specified, drawStyle applies\n   */\n  @Input()\n  set overlayStyle(value: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle) { this._overlayStyle = value; }\n  get overlayStyle(): OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle { return this._overlayStyle; }\n  private _overlayStyle: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle;\n\n  /**\n   * The geometry value (GeoJSON)\n   * Implemented as part of ControlValueAccessor.\n   */\n  @Input()\n  set value(value: GeoJSONGeometry) {\n    this._value = value;\n    if (this.ready === false) {\n      return;\n    }\n\n    if (value) {\n      this.addGeoJSONToOverlay(value);\n    } else {\n      this.olOverlaySource.clear(true);\n    }\n    this.onChange(value);\n    this.toggleControl();\n    this.cdRef.detectChanges();\n  }\n  get value(): GeoJSONGeometry { return this._value; }\n  private _value: GeoJSONGeometry;\n\n  /**\n   * The vector source to add the geometry to\n   * @internal\n   */\n  get olOverlaySource(): OlVectorSource<OlGeometry> {\n    return this.olOverlayLayer.getSource();\n  }\n\n  @Input()\n  set radius(value: any) {\n    if (this.ready === false) {\n      return;\n    }\n    if (this.modifyControl.getSource()) {\n      this.modifyControl.getSource().refresh();\n    }\n    if (this.freehandDrawIsActive) {\n      let olModify;\n      setTimeout(() => {\n        olModify = this.modifyControl.olModifyInteraction;\n        if (olModify) {\n          if (olModify.features_) {\n            olModify.features_.clear();\n            this.addGeoJSONToOverlay(this.value);\n          }\n        }\n      }, 0);\n    }\n  }\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    @Optional() @Self() public ngControl: NgControl\n  ) {\n    if (this.ngControl !== undefined) {\n      // Setting the value accessor directly (instead of using\n      // the providers) to avoid running into a circular import.\n      this.ngControl.valueAccessor = this;\n    }\n  }\n\n  /**\n   * Create an overlay layer, add the initial geometry to it (if any)\n   * and toggle the right interaction.\n   * @internal\n   */\n  ngOnInit() {\n    if (this.drawStyle === undefined) {\n      this.drawStyle = createDrawInteractionStyle();\n    }\n\n    if (this.overlayStyle === undefined) {\n      this.overlayStyle = this.drawStyle;\n    }\n\n    this.addOlOverlayLayer();\n    this.createDrawControl();\n    this.createModifyControl();\n\n    if (this.value) {\n      this.addGeoJSONToOverlay(this.value);\n    }\n    this.toggleControl();\n\n    this.ready = true;\n  }\n\n  /**\n   * Clear the overlay layer and any interaction added by this component.\n   * @internal\n   */\n  ngOnDestroy() {\n    // This is mandatory when the form control is reused after\n    // this component has been destroyed. It seems like the control\n    // keeps a reference to this component even after it's destroyed\n    // and it attempts to set it's value\n    this.ready = false;\n\n    this.deactivateControl();\n    this.olOverlaySource.clear();\n    this.map.ol.removeLayer(this.olOverlayLayer);\n  }\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  registerOnChange(fn: Function) {\n    this.onChange = fn;\n  }\n  private onChange: any = () => {};\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  registerOnTouched(fn: Function) {\n    this.onTouched = fn;\n  }\n  private onTouched: any = () => {};\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  writeValue(value: GeoJSONGeometry) {\n    this.value = value;\n  }\n\n  /**\n   * Add an overlay layer to the map\n   */\n  private addOlOverlayLayer() {\n    this.olOverlayLayer = new OlVectorLayer({\n      source: new OlVectorSource(),\n      zIndex: 500,\n      style: null\n    });\n    this.map.ol.addLayer(this.olOverlayLayer);\n  }\n\n  /**\n   * Create a draw control and subscribe to it's geometry\n   */\n  private createDrawControl() {\n    const controlOptions = Object.assign({}, this.controlOptions, {\n      geometryType: this.geometryType || 'Point',\n      drawingLayer: this.olOverlayLayer,\n      interactionStyle: typeof this.drawStyle === 'function' ? this.drawStyle : (olFeature: OlFeature<OlGeometry>, resolution: number) => {\n        const style = this.drawStyle;\n        this.updateDrawStyleWithDrawGuide(style, resolution);\n        return style;\n      }\n    }) as DrawControlOptions;\n    this.drawControl = new DrawControl(controlOptions);\n  }\n\n  /**\n   * Create a modify control and subscribe to it's geometry\n   */\n  private createModifyControl() {\n    const controlOptions = Object.assign({}, this.controlOptions, {\n      layer: this.olOverlayLayer,\n      drawStyle: typeof this.drawStyle === 'function' ? this.drawStyle : (olFeature: OlFeature<OlGeometry>, resolution: number) => {\n        const style = this.drawStyle;\n        this.updateDrawStyleWithDrawGuide(style, resolution);\n        return style;\n      }\n    }) as ModifyControlOptions;\n    this.modifyControl = new ModifyControl(controlOptions);\n  }\n\n  /**\n   * Toggle the proper control (draw or modify)\n   */\n  private toggleControl() {\n    let activate;\n    if (!this.value && this.geometryType) {\n      activate = this.drawControl;\n    } else {\n      activate = this.modifyControl;\n    }\n\n    // If the control that should be activated\n    // is not the same as the current active control,\n    // deactivate the current control and activate the new one\n    // Otherwise, do nothing and keep the current control active\n    if (activate !== this.activeControl) {\n      this.deactivateControl();\n      this.activateControl(activate);\n    }\n  }\n\n  /**\n   * Activate a given control\n   * @param control Control\n   */\n  private activateControl(control: DrawControl | ModifyControl) {\n    this.activeControl = control;\n    this.olGeometryEnds$$ = control.end$\n      .subscribe((olGeometry: OlGeometry) => this.onOlGeometryEnds(olGeometry));\n    if (this.measure === true && control === this.drawControl) {\n      this.olGeometryChanges$$ = control.changes$\n        .subscribe((olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle) => this.onOlGeometryChanges(olGeometry));\n    }\n    control.setOlMap(this.map.ol, false);\n  }\n\n  /**\n   * Deactivate the active control\n   */\n  private deactivateControl() {\n    this.removeMeasureTooltip();\n    if (this.activeControl !== undefined) {\n      this.activeControl.setOlMap(undefined);\n    }\n    if (this.olGeometryEnds$$ !== undefined) {\n      this.olGeometryEnds$$.unsubscribe();\n    }\n    if (this.olGeometryChanges$$ !== undefined) {\n      this.olGeometryChanges$$.unsubscribe();\n    }\n    this.activeControl = undefined;\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onOlGeometryEnds(olGeometry: OlGeometry | undefined) {\n    this.removeMeasureTooltip();\n    this.setOlGeometry(olGeometry);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onOlGeometryChanges(olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle) {\n    if (olGeometry.getType() !== 'Point') {\n      this.updateMeasureTooltip(olGeometry);\n    }\n  }\n\n  /**\n   * When drawing ends, convert the output value to GeoJSON and keep it.\n   * Restore the double click interaction.\n   * @param olGeometry OL geometry\n   */\n  private setOlGeometry(olGeometry: OlGeometry | undefined) {\n    let value;\n    if (olGeometry === undefined) {\n      return;\n    }\n\n    if (olGeometry.getType() === 'Circle') { // Because Circle doesn't exist as a GeoJSON object\n      olGeometry = this.circleToPoint(olGeometry);\n    }\n\n    value = this.olGeoJSON.writeGeometryObject(olGeometry, {\n      featureProjection: this.map.projection,\n      dataProjection: 'EPSG:4326'\n    });\n    if (olGeometry.get('radius')) {\n      value.radius = olGeometry.get('radius');\n      olGeometry.set('radius', value.radius);\n    }\n    this.writeValue(value);\n  }\n\n  private circleToPoint(olGeometry) {\n    const center = olGeometry.getCenter();\n    const coordinates = olproj.transform(center, this.map.projection, 'EPSG:4326');\n    const radius = Math.round(olGeometry.getRadius() * (Math.cos((Math.PI / 180) * coordinates[1])));\n\n    // Convert it to a point object\n    olGeometry = new Point(center);\n    olGeometry.set('radius', radius, true);\n    return olGeometry;\n  }\n\n  /**\n   * Add a GeoJSON geometry to the overlay\n   * @param geometry GeoJSON geometry\n   */\n  private addGeoJSONToOverlay(geometry: GeoJSONGeometry) {\n    const olGeometry = this.olGeoJSON.readGeometry(geometry, {\n      dataProjection: 'EPSG:4326',\n      featureProjection: this.map.projection\n    });\n    const olFeature = new OlFeature({\n      geometry: olGeometry\n    });\n    olFeature.setStyle(this.overlayStyle as OlStyle.Style);\n    this.olOverlaySource.clear();\n    this.olOverlaySource.addFeature(olFeature);\n  }\n\n  /**\n   * Create the measure tooltip\n   */\n  private createMeasureTooltip() {\n    return new OlOverlay({\n      element: document.createElement('div'),\n      offset: [-30, -10],\n      className: [\n        'igo-map-tooltip',\n        'igo-map-tooltip-measure'\n      ].join(' '),\n      stopEvent: false\n    });\n  }\n\n  /**\n   * Update the measure tooltip of an OL geometry\n   * @param olGeometry OL Geometry\n   */\n  private updateMeasureTooltip(olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle) {\n    const measure = measureOlGeometry(olGeometry, this.map.projection);\n    const lengths = measure.lengths;\n    const lastIndex = olGeometry.getType() === 'Polygon' ? lengths.length - 2 : lengths.length - 1;\n    const lastLength = lengths[lastIndex];\n\n    const olMidpoints = updateOlGeometryMidpoints(olGeometry);\n    const olLastMidpoint = olMidpoints[lastIndex];\n    if (olMidpoints.length === 0 || olLastMidpoint === undefined) {\n      this.removeMeasureTooltip();\n      return;\n    }\n\n    this.olTooltip.setPosition(olLastMidpoint.getFlatCoordinates());\n\n    const innerHtml = formatMeasure(lastLength, {\n      decimal: 1,\n      unit: MeasureLengthUnit.Meters,\n      unitAbbr: true,\n      locale: 'fr'\n    });\n    this.olTooltip.getElement().innerHTML = innerHtml;\n    if (this.olTooltip.getMap() === undefined) {\n      this.map.ol.addOverlay(this.olTooltip);\n    }\n  }\n\n  /**\n   * Remove the measure tooltip from the map\n   */\n  private removeMeasureTooltip() {\n    if (this.olTooltip.getMap && this.olTooltip.getMap() !== undefined) {\n      this.map.ol.removeOverlay(this.olTooltip);\n      this.olTooltip.setMap(undefined);\n    }\n  }\n\n  /**\n   * Adjust the draw style with the specified draw guide distance, if possible\n   * @param olStyle Draw style to update\n   * @param resolution Resolution (to make the screen size of symbol fit the drawGuide value)\n   */\n  private updateDrawStyleWithDrawGuide(\n    olStyle: OlStyle.Style |\n    ((feature, resolution) => OlStyle.Style) |\n    OlStyle.Circle,\n    resolution: number) {\n    const olGuideStyle = this.getGuideStyleFromDrawStyle(olStyle) as OlStyle.Circle;\n    if (olGuideStyle === undefined) {\n      return;\n    }\n\n    const drawGuide = this.drawGuide;\n    let radius;\n    if (!drawGuide || drawGuide < 0) {\n      radius = this.defaultDrawStyleRadius;\n    } else {\n      radius = drawGuide > 0 ? drawGuide / resolution : drawGuide;\n    }\n    olGuideStyle.setRadius(radius);\n  }\n\n  /**\n   * Returns wether a given Open Layers style has a radius property that can be set (used to set draw guide)\n   * @param olStyle The style on which to perform the check\n   */\n  private isStyleWithRadius(olStyle) {\n    return typeof olStyle !== 'function' && olStyle.setRadius;\n  }\n\n  /**\n   * Returns wether a given Open Layers style has a radius property that can be set (used to set draw guide)\n   * @param olStyle The style on which to perform the check\n   */\n  private getGuideStyleFromDrawStyle(\n    olStyle: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle |\n    OlStyle.Style[] | ((feature, resolution) => OlStyle.Style)[] | OlStyle.Circle[]\n  ) {\n    if (Array.isArray(olStyle)) {\n      olStyle = olStyle[0];\n    }\n    if (this.isStyleWithRadius(olStyle)) {\n      return olStyle;\n    }\n    return undefined;\n  }\n}\n","<ng-template></ng-template>","<igo-geometry-form-field-input\n  [formControl]=\"formControl\"\n  [map]=\"map\"\n  [geometryType]=\"geometryType$ | async\"\n  [drawGuide]=\"drawGuide$ | async\"\n  [measure]=\"measure\"\n  [drawControlIsActive]=\"drawControlIsActive\"\n  [freehandDrawIsActive]=\"freehandDrawIsActive\"\n  [controlOptions]=\"controlOptions\"\n  [drawStyle]=\"drawStyle\"\n  [overlayStyle]=\"overlayStyle\">\n</igo-geometry-form-field-input>\n\n<div *ngIf=\"geometryTypeField\" class=\"geometry-type-toggle\">\n  <mat-button-toggle-group\n    [disabled]=\"(value$ | async) !== undefined\"\n    [(ngModel)]=\"geometryType\">\n    <mat-button-toggle\n      value=\"Point\"\n      [disabled]=\"geometryTypes.indexOf('Point') < 0\">\n      {{'igo.geo.geometry.point' | translate}}\n    </mat-button-toggle>\n    <mat-button-toggle\n      value=\"LineString\"\n      [disabled]=\"geometryTypes.indexOf('LineString') < 0\">\n      {{'igo.geo.geometry.line' | translate}}\n    </mat-button-toggle>\n    <mat-button-toggle\n      value=\"Polygon\"\n      [disabled]=\"geometryTypes.indexOf('Polygon') < 0\">\n      {{'igo.geo.geometry.polygon' | translate}}\n    </mat-button-toggle>\n  </mat-button-toggle-group>\n</div>\n\n<mat-form-field *ngIf=\"drawGuideField\" class=\"draw-guide-field\">\n  <input\n    matInput\n    type=\"number\"\n    [placeholder]=\"drawGuidePlaceholder\"\n    [(ngModel)]=\"drawGuide\">\n  <mat-icon\n    matPrefix\n    [color]=\"'primary'\"\n    svgIcon=\"adjust\">    \n  </mat-icon>\n  <span matSuffix class=\"draw-guide-units\">{{'igo.geo.measure.meters' | translate}}</span>\n</mat-form-field>","import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef, Component,\n  Input, OnDestroy, OnInit\n} from '@angular/core';\nimport { FormControl } from '@angular/forms';\nimport { IgoFormFieldComponent } from '@igo2/common';\nimport type { default as OlGeometryType } from 'ol/geom/GeometryType';\nimport * as OlStyle from 'ol/style';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { IgoMap } from '../../map';\nimport { GeoJSONGeometry } from '../shared/geometry.interfaces';\n\n/**\n * This input allows a user to draw a new geometry or to edit\n * an existing one on a map.\n */\n@IgoFormFieldComponent('geometry')\n@Component({\n  selector: 'igo-geometry-form-field',\n  templateUrl: './geometry-form-field.component.html',\n  styleUrls: ['./geometry-form-field.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class GeometryFormFieldComponent implements OnInit, OnDestroy {\n\n  readonly value$: BehaviorSubject<GeoJSONGeometry> = new BehaviorSubject(undefined);\n\n  private value$$: Subscription;\n\n  set drawControlIsActive(value: boolean) {\n    this._drawControlIsActive = value;\n    this.cdRef.detectChanges();\n  }\n\n  get drawControlIsActive(): boolean {\n    return this._drawControlIsActive;\n  }\n  private _drawControlIsActive = true;\n\n  set freehandDrawIsActive(value: boolean) {\n    this._freehandDrawIsActive = value;\n    this.cdRef.detectChanges();\n  }\n\n  get freehandDrawIsActive(): boolean {\n    return this._freehandDrawIsActive;\n  }\n  private _freehandDrawIsActive = false;\n\n  /**\n   * The field's form control\n   */\n  @Input() formControl: FormControl;\n\n  /**\n   * The map to draw the geometry on\n   */\n  @Input() map: IgoMap;\n\n  @Input()\n  set geometryType(value: typeof OlGeometryType) { this.geometryType$.next(value); }\n  get geometryType(): typeof OlGeometryType { return this.geometryType$.value; }\n  readonly geometryType$: BehaviorSubject<typeof OlGeometryType> = new BehaviorSubject(undefined);\n\n  /**\n   * Whether a geometry type toggle should be displayed\n   */\n  @Input() geometryTypeField: boolean = false;\n\n  /**\n   * Available geometry types\n   */\n  @Input() geometryTypes: string[] = ['Point', 'LineString', 'Polygon'];\n\n  /**\n   * Whether a draw guide field should be displayed\n   */\n  @Input() drawGuideField: boolean = false;\n\n  /**\n   * The drawGuide around the mouse pointer to help drawing\n   */\n  @Input()\n  set drawGuide(value: number) { this.drawGuide$.next(value); }\n  get drawGuide(): number { return this.drawGuide$.value; }\n  readonly drawGuide$: BehaviorSubject<number> = new BehaviorSubject(0);\n\n  /**\n   * Draw guide placeholder\n   */\n  @Input() drawGuidePlaceholder: string = '';\n\n  /**\n   * Whether a measure tooltip should be displayed\n   */\n  @Input() measure: boolean = false;\n\n  /**\n   * Control options\n   */\n  @Input() controlOptions: {[key: string]: any} = {};\n\n  /**\n   * Style for the draw control (applies while the geometry is being drawn)\n   */\n  @Input() drawStyle: OlStyle.Style;\n\n  /**\n   * Style for the overlay layer (applies once the geometry is added to the map)\n   * If not specified, drawStyle applies\n   */\n  @Input() overlayStyle: OlStyle.Style;\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * Set up a value stream\n   * @internal\n   */\n  ngOnInit() {\n    this.value$.next(this.formControl.value ? this.formControl.value : undefined);\n    this.value$$ = this.formControl.valueChanges.subscribe((value: GeoJSONGeometry) => {\n      this.value$.next(value ? value : undefined);\n    });\n  }\n\n  /**\n   * Unsubscribe to the value stream\n   * @internal\n   */\n  ngOnDestroy() {\n    this.value$$.unsubscribe();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { GeometryFormFieldComponent } from './geometry-form-field.component';\nimport { GeometryFormFieldInputComponent } from './geometry-form-field-input.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    IgoLanguageModule\n  ],\n  exports: [\n    GeometryFormFieldComponent,\n    GeometryFormFieldInputComponent\n  ],\n  declarations: [\n    GeometryFormFieldComponent,\n    GeometryFormFieldInputComponent\n  ]\n})\nexport class IgoGeometryFormFieldModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoGeometryFormFieldModule } from './geometry-form-field/geometry-form-field.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoGeometryFormFieldModule\n  ],\n  exports: [\n    IgoGeometryFormFieldModule\n  ],\n  declarations: [],\n  providers: []\n})\nexport class IgoGeometryModule {}\n","<button *ngIf=\"header && options.timeFilterable && options.timeFilter\"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.filter.filterBy' | translate\"\n  [color]=\"color\">\n  <mat-icon [matBadge]=\"badge\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" svgIcon=\"history\"></mat-icon>\n</button>\n\n<div #ogcFilter class=\"igo-layer-actions-container\"\n*ngIf=\"header && options.timeFilterable && options.timeFilter\">\n  <igo-time-filter-item\n    *ngIf=\"timeFilterCollapse && options.timeFilter\"\n    igoListItem\n    [header]=\"false\"\n    [layer]=\"layer\">\n  </igo-time-filter-item>\n</div>\n","import { Component, Input, ChangeDetectionStrategy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { IgoMap } from '../../map';\nimport { TimeFilterableDataSourceOptions } from '../shared/time-filter.interface';\nimport { WMSDataSourceOptions } from '../../datasource/shared/datasources/wms-datasource.interface';\n\n@Component({\n  selector: 'igo-time-filter-button',\n  templateUrl: './time-filter-button.component.html',\n  styleUrls: ['./time-filter-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class TimeFilterButtonComponent implements OnInit {\n\n  public options: TimeFilterableDataSourceOptions;\n\n  get badge() {\n    const filter = this.options.timeFilter as any;\n    if (filter && filter.enabled) {\n      return 1;\n    } else {\n      return;\n    }\n  }\n\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n    if (value) {\n      this.options = this.layer.dataSource.options as WMSDataSourceOptions;\n    }\n  }\n  private _layer;\n\n  @Input() map: IgoMap;\n\n  @Input() color: string = 'primary';\n\n  @Input() header: boolean = true;\n\n  public timeFilterCollapse = false;\n\n  constructor() {}\n\n  ngOnInit() {\n    this.options = this.layer.dataSource.options as WMSDataSourceOptions;\n  }\n}\n","<div *ngIf=\"style === 'calendar' && type !=='year'\">\n  <div *ngIf=\"!isRange\" class=\"igo-col igo-col-100 igo-col-100-m\">\n    <mat-form-field>\n      <mat-datetimepicker-toggle [for]=\"datetimePicker\" matSuffix></mat-datetimepicker-toggle>\n      <mat-datetimepicker #datetimePicker type=\"{{type}}\" openOnFocus=\"true\" timeInterval=\"5\"></mat-datetimepicker>\n      <input matInput autocomplete=\"false\"\n        placeholder=\"{{'igo.geo.timeFilter.date' | translate}}\"\n        [matDatetimepicker]=\"datetimePicker\"\n        [(ngModel)]=\"date\"\n        [min]=\"min\"\n        [max]=\"max\"\n        readonly=\"readonly\"\n        (dateChange)=\"handleDateChange($event)\">\n    </mat-form-field>\n\n  </div>\n\n  <div *ngIf=\"isRange\">\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-datetimepicker-toggle [for]=\"minDatetimePicker\" matSuffix></mat-datetimepicker-toggle>\n        <mat-datetimepicker #minDatetimePicker type=\"{{type}}\" openOnFocus=\"true\" timeInterval=\"5\"></mat-datetimepicker>\n        <input matInput autocomplete=\"false\"\n          placeholder=\"{{'igo.geo.timeFilter.startDate' | translate}}\"\n          [matDatetimepicker]=\"minDatetimePicker\"\n          [(ngModel)]=\"startDate\"\n          [min]=\"min\"\n          [max]=\"getRangeMaxDate()\"\n          readonly=\"readonly\"\n          (input)=\"startDate\"\n          (dateChange)=\"handleDateChange($event)\">\n      </mat-form-field>\n    </div>\n\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-datetimepicker-toggle [for]=\"maxDatetimePicker\" matSuffix></mat-datetimepicker-toggle>\n        <mat-datetimepicker #maxDatetimePicker type=\"{{type}}\" openOnFocus=\"true\" timeInterval=\"5\"></mat-datetimepicker>\n        <input matInput autocomplete=\"false\"\n          placeholder=\"{{'igo.geo.timeFilter.endDate' | translate}}\"\n          [matDatetimepicker]=\"maxDatetimePicker\"\n          [(ngModel)]=\"endDate\"\n          [min]=\"getRangeMinDate()\"\n          [max]=\"max\"\n          readonly=\"readonly\"\n          (dateChange)=\"handleDateChange($event)\">\n      </mat-form-field>\n    </div>\n  </div>\n</div>\n\n<div *ngIf=\"style === 'calendar' && type ==='year'\">\n\n  <div *ngIf=\"!isRange\" class=\"igo-col igo-col-100 igo-col-100-m\">\n        <mat-form-field>\n            <mat-select placeholder=\"{{'igo.geo.timeFilter.date' | translate}}\" [(ngModel)]=\"year\" (selectionChange)=\"handleYearChange($event)\">\n                  <mat-option [value]=\"year\" *ngFor=\"let year of listYears\">{{year}}</mat-option>\n            </mat-select>\n        </mat-form-field>\n  </div>\n\n  <div *ngIf=\"isRange\">\n    <div class=\"igo-col igo-col-100\">\n        <mat-form-field>\n            <mat-select placeholder=\"{{'igo.geo.timeFilter.startDate' | translate}}\" [(ngModel)]=\"startYear\" (selectionChange)=\"handleYearChange($event)\">\n              <mat-option [value]=\"startYear\" *ngFor=\"let startYear of startListYears\">{{startYear}}</mat-option>\n            </mat-select>\n      </mat-form-field>\n    </div>\n\n    <div class=\"igo-col igo-col-100\">\n    <mat-form-field>\n        <mat-select placeholder=\"{{'igo.geo.timeFilter.endDate' | translate}}\" [(ngModel)]=\"endYear\" (selectionChange)=\"handleYearChange($event)\">\n              <mat-option [value]=\"endYear\" *ngFor=\"let endYear of endListYears\">{{endYear}}</mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </div>\n\n</div>\n\n\n  <br>\n  <div *ngIf=\"!isRange && style === 'slider' && type === 'year'\" class=\"igo-col igo-col-100 igo-col-100-m mat-typography\">\n    <span>{{startYear}}</span>\n    <mat-slider\n        id=\"time-slider\"\n        tickInterval=\"auto\"\n        step=\"{{step}}\"\n        [min]=\"startYear\"\n        [max]=\"endYear\"\n        [value]=\"handleSliderValue()\"\n        [color]=\"color\"\n        thumbLabel\n        (input)=\"handleSliderYearChange($event)\"\n        (change)=\"handleSliderYearChange($event)\"\n        [disabled]= \"!options.enabled || !layer.visible\">\n    </mat-slider>\n    <span>{{endYear}}</span>\n    <p *ngIf= \"options.enabled\" class=\"date-below\">{{year}}</p>\n    <div #actions class=\"igo-layer-actions-container\">\n      <mat-slide-toggle (change)=\"toggleFilterState()\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\" [color]=\"color\" [checked]=\"options.enabled\"\n        [disabled]=\"!layer.visible\">\n      </mat-slide-toggle>\n      <button [disabled]= \"!options.enabled  || !layer.visible\" mat-icon-button color=\"primary\" (click)=\"playYear($event)\">\n        <mat-icon svgIcon=\"{{playIcon}}\"></mat-icon>\n       </button>\n      <button [disabled]=\"!options.enabled  || !layer.visible\" mat-icon-button color=\"primary\" (click)=\"resetFilter($event)\">\n        <mat-icon svgIcon=\"{{resetIcon}}\"></mat-icon>\n      </button>\n    </div>\n  </div>\n\n<div *ngIf=\"style === 'slider' && type !== 'year'\" class=\"igo-col igo-col-100 igo-col-100-m\">\n  <mat-slider\n      id=\"time-slider\"\n      tickInterval=\"auto\"\n      step=\"{{step}}\"\n      [min]=\"dateToNumber(min)\"\n      [max]=\"dateToNumber(max)\"\n      [value]=\"handleSliderValue()\"\n      thumbLabel\n      (input)=\"handleSliderDateChange($event)\"\n      (selectionChange)=\"handleSliderDateChange($event)\">\n  </mat-slider>\n  <p class=\"date-below\">{{handleSliderTooltip()}}</p>\n  <button mat-icon-button color=\"primary\" (click)=\"playFilter($event)\">\n   <mat-icon svgIcon=\"{{playIcon}}\"></mat-icon>\n  </button>\n</div>\n","import {\n  Component,\n  OnInit,\n  Input,\n  Output,\n  EventEmitter,\n  ViewChild\n} from '@angular/core';\nimport { DateAdapter } from '@angular/material/core';\nimport { MatSlider } from '@angular/material/slider';\nimport * as moment from 'moment';\nimport olSourceImageWMS from 'ol/source/ImageWMS';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { TimeFilterOptions } from '../shared/time-filter.interface';\nimport { TimeFilterType, TimeFilterStyle } from '../shared/time-filter.enum';\n\n@Component({\n  selector: 'igo-time-filter-form',\n  templateUrl: './time-filter-form.component.html',\n  styleUrls: ['./time-filter-form.component.scss']\n})\nexport class TimeFilterFormComponent implements OnInit {\n  @Input() layer: Layer;\n\n  @Input() options: TimeFilterOptions;\n\n  public color = 'primary';\n  public date: Date;\n  public startDate: Date;\n  public endDate: Date;\n  public year: any;\n  public startYear: any;\n  public endYear: any;\n  public initStartYear: any;\n  public initEndYear: any;\n  public listYears: Array<string> = [];\n  public startListYears: Array<string> = [];\n  public endListYears: Array<string> = [];\n\n  @Input()\n  set currentValue(value: string) {\n    if (value) {\n      if (this.type !== TimeFilterType.YEAR) {\n        const valueArray = value.split('/');\n        if (valueArray.length > 0) {\n          const startDate = new Date(valueArray[0]);\n          const endDate = new Date(valueArray[1]);\n          if (!isNaN(startDate.valueOf())) {\n            this.startDate = startDate;\n          }\n          if (!isNaN(endDate.valueOf())) {\n            this.endDate = endDate;\n          }\n        }\n      }\n    }\n  }\n\n  public interval: any;\n  public playIcon = 'play-circle';\n  public resetIcon = 'replay';\n\n  @Output() change: EventEmitter<Date | [Date, Date]> = new EventEmitter();\n  @Output()\n  yearChange: EventEmitter<string | [string, string]> = new EventEmitter();\n  @ViewChild(MatSlider) mySlider;\n\n  get type(): TimeFilterType {\n    return this.options.type === undefined\n      ? TimeFilterType.DATE\n      : this.options.type;\n  }\n\n  get isRange(): boolean {\n    return this.options.range === undefined ||\n      this.options.style === TimeFilterStyle.SLIDER\n      ? false\n      : this.options.range;\n  }\n\n  get style(): TimeFilterStyle {\n    return this.options.style === undefined\n      ? TimeFilterStyle.SLIDER\n      : this.options.style;\n  }\n\n  get step(): number {\n    let step = 10800000;\n    if (this.options.step === undefined) {\n      switch (this.type) {\n        case TimeFilterType.DATE:\n        case TimeFilterType.DATETIME:\n          step = 10800000;\n          break;\n        case TimeFilterType.TIME:\n          step = 3600000;\n          break;\n        case TimeFilterType.YEAR:\n          step = 31536000000;\n          break;\n        default:\n          step = 10800000;\n      }\n    } else {\n      step = this.getStepDefinition(this.options.step);\n    }\n\n    return step;\n  }\n\n  get timeInterval(): number {\n    return this.options.timeInterval === undefined\n      ? 2000\n      : this.options.timeInterval;\n  }\n\n  get min(): Date {\n    if (this.options.min) {\n      const min = new Date(this.options.min);\n      return new Date(min.getTime() + min.getTimezoneOffset() * 60000);\n    } else {\n      return undefined;\n    }\n  }\n\n  get max(): Date {\n    if (this.options.max) {\n      const max = new Date(this.options.max);\n      return new Date(max.getTime() + max.getTimezoneOffset() * 60000);\n    } else {\n      return undefined;\n    }\n  }\n\n  get is(): boolean {\n    return this.options.range === undefined ? false : this.options.range;\n  }\n\n  constructor(private dateAdapter: DateAdapter<Date>) {\n    this.dateAdapter.setLocale('fr');\n  }\n\n  ngOnInit() {\n    if (this.startDate === undefined) {\n      this.startDate = new Date(this.min);\n    }\n    if (this.endDate === undefined) {\n      this.endDate = new Date(this.max);\n    }\n    if (this.startYear === undefined) {\n      this.startYear = new Date(this.startDate).getFullYear();\n      this.initStartYear = this.startYear;\n    }\n    if (this.endYear === undefined) {\n      this.endYear = new Date(this.endDate).getFullYear();\n      this.initEndYear = this.endYear;\n    }\n\n    if (!this.isRange) {\n      for (let i = this.startYear; i <= this.endYear + 1; i++) {\n        this.listYears.push(i);\n      }\n    } else {\n      for (let i = this.startYear; i < this.endYear; i++) {\n        this.startListYears.push(i);\n      }\n      for (let i = this.startYear + 1; i <= this.endYear; i++) {\n        this.endListYears.push(i);\n      }\n    }\n    this.options.enabled =\n      this.options.enabled === undefined ? true : this.options.enabled;\n    this.checkFilterValue();\n    if (this.options.enabled) {\n      if (!this.isRange && this.style === 'slider' && this.type === 'year') {\n        this.yearChange.emit(this.year);\n      }\n    } else {\n      this.storeCurrentFilterValue();\n      this.yearChange.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  storeCurrentFilterValue() {\n    // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    if (\n      !this.isRange &&\n      this.style === TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      this.options.value = this.year.toString();\n    }\n  }\n\n  checkFilterValue() {\n    const olSource = this.layer.dataSource.ol as olSourceImageWMS;\n    const timeFromWms = olSource.getParams().TIME;\n    if (\n      !this.isRange &&\n      this.style === TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      if (timeFromWms) {\n        this.year = new Date(timeFromWms.toString()).getFullYear() + 1;\n      } else if (this.options.value) {\n        this.year = new Date(this.options.value.toString()).getFullYear() + 1;\n      } else {\n        this.year = new Date(this.min).getFullYear() + 1;\n      }\n    } else if (\n      this.isRange &&\n      this.style === TimeFilterStyle.CALENDAR &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      if (timeFromWms) {\n        this.startYear = parseInt(timeFromWms.substr(0, 4), 10);\n        this.endYear = parseInt(timeFromWms.substr(5, 4), 10);\n        const newStartListYears: any[] = [];\n        const newEndListYears: any[] = [];\n        for (let i = this.initStartYear; i < this.endYear; i++) {\n          newStartListYears.push(i);\n        }\n        for (let i = this.startYear + 1; i <= this.initEndYear; i++) {\n          newEndListYears.push(i);\n        }\n        this.startListYears = newStartListYears;\n        this.endListYears = newEndListYears;\n      }\n    }\n    // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n  }\n\n  handleDateChange(event: any) {\n    this.setupDateOutput();\n    this.applyTypeChange();\n\n    // Only if is range, use 2 dates to make the range\n    if (this.isRange) {\n      this.change.emit([this.startDate, this.endDate]);\n    } else {\n      this.change.emit(this.startDate);\n    }\n  }\n\n  handleYearChange(event: any) {\n    if (this.isRange) {\n      this.endListYears = [];\n      for (let i = this.startYear + 1; i <= this.initEndYear; i++) {\n        this.endListYears.push(i);\n      }\n      this.startListYears = [];\n      for (let i = this.initStartYear + 1; i < this.endYear; i++) {\n        this.startListYears.push(i);\n      }\n      this.yearChange.emit([this.startYear, this.endYear]);\n    } else {\n      this.yearChange.emit(this.year);\n    }\n  }\n\n  handleListYearChange(event: any) {\n    this.handleYearChange([this.startYear, this.endYear]);\n  }\n\n  handleListYearStartChange(event: any) {\n    this.change.emit([this.startDate, this.endDate]);\n  }\n\n  dateToNumber(date: Date): number {\n    let newDate;\n    if (date) {\n      newDate = new Date(date);\n    } else {\n      newDate = new Date(this.min);\n    }\n\n    return newDate.getTime();\n  }\n\n  setSliderThumbLabel(label: string) {\n    const thumbLabel = this.findThumbLabel(\n      this.mySlider._elementRef.nativeElement.childNodes\n    );\n    if (thumbLabel) {\n      thumbLabel.textContent = label;\n    }\n  }\n\n  findThumbLabel(test: any[]): any {\n    let thumbLabel;\n\n    test.forEach(value => {\n      if (value.className === 'mat-slider-thumb-label-text') {\n        thumbLabel = value;\n      }\n\n      if (value.children.length > 0 && !thumbLabel) {\n        thumbLabel = this.findThumbLabel(value.childNodes);\n      }\n    }, this);\n    return thumbLabel;\n  }\n\n  toggleFilterState() {\n    this.options.enabled = !this.options.enabled;\n\n    if (this.options.enabled) {\n      if (\n        !this.isRange &&\n        TimeFilterStyle.SLIDER &&\n        this.type === TimeFilterType.YEAR\n      ) {\n        this.yearChange.emit(this.year);\n      }\n    } else {\n      this.stopFilter();\n      this.storeCurrentFilterValue();\n      this.change.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  resetFilter(event: any) {\n    this.date = new Date(this.min);\n    this.year = this.date.getFullYear();\n    if (\n      !this.isRange &&\n      TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      this.yearChange.emit(this.year);\n    } else {\n      this.setupDateOutput();\n      this.change.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  playFilter(event: any) {\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause-circle';\n      this.interval = setInterval(\n        that => {\n          let newMinDateNumber;\n          const maxDateNumber = new Date(that.max);\n\n          newMinDateNumber =\n            that.date === undefined ? that.min.getTime() : that.date.getTime();\n          newMinDateNumber += that.mySlider.step;\n          that.date = new Date(newMinDateNumber);\n\n          if (newMinDateNumber > maxDateNumber.getTime()) {\n            that.stopFilter();\n          }\n\n          that.handleDateChange({ value: that.date, date: that.date });\n        },\n        this.timeInterval,\n        this\n      );\n    }\n  }\n\n  playYear(event: any) {\n    if (\n      this.year + this.mySlider.step >\n      this.max.getFullYear() + this.mySlider.step\n    ) {\n      this.stopFilter();\n      this.resetFilter(event);\n    }\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause-circle';\n      this.interval = setInterval(() => {\n        if (\n          (this.year + this.mySlider.step) > this.max.getFullYear()) {\n          this.stopFilter();\n        } else {\n          this.year = this.year + this.mySlider.step;\n        }\n        this.yearChange.emit(this.year);\n\n      }, this.timeInterval, this);\n    }\n  }\n\n  stopFilter() {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play-circle';\n  }\n\n  handleSliderDateChange(event: any) {\n    this.date = new Date(event.value);\n    this.setSliderThumbLabel(this.handleSliderTooltip());\n    this.handleDateChange(event);\n  }\n\n  handleSliderYearChange(event: any) {\n    this.year = event.value;\n    this.yearChange.emit(this.year);\n  }\n\n  handleSliderValue(): number {\n    if (this.options.current === true || !this.min) {\n      const currentDate = new Date();\n      this.date = this.getRoundedDate(currentDate);\n    }\n    if (this.type === TimeFilterType.YEAR) {\n      return this.year;\n    } else {\n      return this.date === undefined ? this.min.getTime() : this.date.getTime();\n    }\n  }\n\n  handleSliderTooltip() {\n    let label: string;\n\n    switch (this.type) {\n      case TimeFilterType.DATE:\n        label =\n          this.date === undefined\n            ? this.min.toDateString()\n            : this.date.toDateString();\n        break;\n      case TimeFilterType.TIME:\n        label =\n          this.date === undefined\n            ? this.min.toTimeString()\n            : this.date.toTimeString();\n        break;\n      // datetime\n      default:\n        label =\n          this.date === undefined\n            ? this.min.toUTCString()\n            : this.date.toUTCString();\n        break;\n    }\n\n    return label;\n  }\n\n  setupDateOutput() {\n    if (this.style === TimeFilterStyle.SLIDER) {\n      this.startDate = new Date(this.date);\n      this.startDate.setSeconds(-(this.step / 1000));\n      this.endDate = new Date(this.startDate);\n      this.endDate.setSeconds(this.step / 1000);\n    } else if (!this.isRange && !!this.date) {\n      this.endDate = new Date(this.date);\n      this.startDate = new Date(this.date);\n    } else if (this.isRange && (!!this.date || !this.date)) {\n      this.startDate =\n        this.startDate === undefined ? new Date(this.min) : this.startDate;\n      this.endDate =\n        this.endDate === undefined ? new Date(this.max) : this.endDate;\n    } else if (!this.date) {\n      this.startDate =\n        this.startDate === undefined ? new Date(this.min) : this.startDate;\n      this.endDate =\n        this.endDate === undefined ? new Date(this.max) : this.endDate;\n    }\n  }\n\n  applyTypeChange() {\n    switch (this.type) {\n      case TimeFilterType.DATE:\n        if (this.startDate !== undefined || this.endDate !== undefined) {\n          this.startDate.setHours(0);\n          this.startDate.setMinutes(0);\n          this.startDate.setSeconds(0);\n          this.endDate.setHours(23);\n          this.endDate.setMinutes(59);\n          this.endDate.setSeconds(59);\n        }\n        break;\n      case TimeFilterType.TIME:\n        if (this.style === TimeFilterStyle.CALENDAR) {\n          if (this.startDate.getDay() !== this.min.getDay()) {\n            const selectedHour = this.startDate.getHours();\n            const selectedMinute = this.startDate.getMinutes();\n            this.startDate = this.min;\n            this.startDate.setHours(selectedHour);\n            this.startDate.setMinutes(selectedMinute);\n          }\n\n          if (this.endDate.getDay() !== this.min.getDay()) {\n            const selectedHour = this.endDate.getHours();\n            const selectedMinute = this.endDate.getMinutes();\n            this.endDate = this.min;\n            this.endDate.setHours(selectedHour);\n            this.endDate.setMinutes(selectedMinute);\n          }\n        }\n\n        if (!this.isRange && this.step > 60 * 60 * 1000) {\n          this.startDate.setMinutes(0);\n          this.startDate.setSeconds(0);\n          this.endDate.setMinutes(59);\n          this.endDate.setSeconds(59);\n        }\n        break;\n      // datetime\n      default:\n      // do nothing\n    }\n  }\n\n  getRangeMinDate(): Date {\n    return this.startDate === undefined ? this.min : this.startDate;\n  }\n\n  getRangeMaxDate(): Date {\n    return this.endDate === undefined ? this.max : this.endDate;\n  }\n\n  /**\n   * Round date at a certain time, 10 minutes by Default\n   * @param date - Date to Round\n   * @param atMinute - round to closest 'atMinute' minute, rounded 10 by default\n   * @return the rounded date\n   */\n  getRoundedDate(date, atMinute = 10) {\n    const coeff = 1000 * 60 * atMinute;\n    return new Date(Math.round(date.getTime() / coeff) * coeff);\n  }\n\n  /**\n   * Get the step (period) definition from the layer dimension tag\n   * @param step The step as ISO 8601 example: PT10M for 10 Minutes\n   * @return the duration in milliseconds\n   */\n  getStepDefinition(step) {\n    return moment.duration(step).asMilliseconds();\n  }\n}\n","<mat-list-item *ngIf=\"header\">\n  <mat-icon\n    class=\"igo-chevron\"\n    mat-list-avatar\n    igoCollapse\n    [target]=\"filters\"\n    [collapsed]=\"filtersCollapsed\"\n    (click)=\"toggleFiltersCollapsed()\"\n    svgIcon=\"chevron-up\" >\n  </mat-icon>\n  <h4 (click)=\"toggleLegendOnClick()\" [ngStyle]=\"{'cursor': filtersCollapsed ? 'default' : 'pointer'}\"  matLine>{{layer.title}}</h4>\n  \n  <button *ngIf=\"header\"\n    mat-icon-button\n    [color]=\"layer.visible ? 'primary' : 'default'\"\n    collapsibleButton\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"layer.visible ?\n                  ('igo.geo.layer.hideLayer' | translate) :\n                  ('igo.geo.layer.showLayer' | translate)\"\n    (click)=\"layer.visible = !layer.visible\">\n    <mat-icon\n      [ngClass]=\"{disabled: (inResolutionRange$ | async)===false}\"\n      [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\">\n    </mat-icon>\n  </button>\n\n</mat-list-item>\n\n<div #filters class=\"igo-datasource-filters-container\">\n  <div #legend class=\"igo-layer-legend-container\">\n    <igo-layer-legend *ngIf=\"showLegend$ | async\" [layer]=\"layer\">\n    </igo-layer-legend>\n  </div>\n  <igo-time-filter-form\n    [layer]= \"layer\"\n    [options]=\"datasource.options.timeFilter\"\n    [currentValue]=\"datasource.options.params.TIME\"\n    (change)=\"handleDateChange($event)\"\n    (yearChange)=\"handleYearChange($event)\">\n  </igo-time-filter-form>\n</div>\n","import { Component, Input, OnDestroy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { TimeFilterableDataSource } from '../shared/time-filter.interface';\nimport { TimeFilterService } from '../shared/time-filter.service';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\n@Component({\n  selector: 'igo-time-filter-item',\n  templateUrl: './time-filter-item.component.html',\n  styleUrls: ['./time-filter-item.component.scss']\n})\nexport class TimeFilterItemComponent implements OnInit, OnDestroy {\n  public color = 'primary';\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  private resolution$$: Subscription;\n\n  filtersCollapsed: boolean = false;\n\n  @Input() header: boolean = true;\n\n  @Input() layer: Layer;\n\n  get datasource(): TimeFilterableDataSource {\n    return this.layer.dataSource as TimeFilterableDataSource;\n  }\n  constructor(private timeFilterService: TimeFilterService) {}\n\n  ngOnInit(): void {\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.inResolutionRange$.next(this.layer.isInResolutionsRange);\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.resolution$$.unsubscribe();\n  }\n\n  handleYearChange(year: string | [string, string]) {\n    this.timeFilterService.filterByYear(this.datasource, year);\n  }\n\n  handleDateChange(date: Date | [Date, Date]) {\n    this.timeFilterService.filterByDate(this.datasource, date);\n  }\n\n  private toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    if (!this.filtersCollapsed) {\n      this.toggleLegend(this.showLegend$.value);\n    }\n  }\n\n  public setVisible() {\n    this.layer.visible = true;\n  }\n\n  toggleFiltersCollapsed() {\n    this.filtersCollapsed = !this.filtersCollapsed;\n  }\n}\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-layer [ngForOf]=\"layers | filterableDataSource: 'time'\">\n    <igo-time-filter-item [header]=\"true\" igoListItem [layer]=\"layer\"></igo-time-filter-item>\n  </ng-template>\n</igo-list>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\n@Component({\n  selector: 'igo-time-filter-list',\n  templateUrl: './time-filter-list.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class TimeFilterListComponent {\n  @Input()\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  set layers(value: Layer[]) {\n    this._layers = value;\n    this.cdRef.detectChanges();\n  }\n  private _layers: Layer[] = [];\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n}\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport { MapService } from '../../map/shared/map.service';\nimport { TimeFilterListComponent } from './time-filter-list.component';\n\n@Directive({\n  selector: '[igoTimeFilterListBinding]'\n})\nexport class TimeFilterListBindingDirective implements OnInit, OnDestroy {\n  private component: TimeFilterListComponent;\n  private layers$$: Subscription;\n\n  constructor(\n    @Self() component: TimeFilterListComponent,\n    private mapService: MapService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input layers\n    this.component.layers = [];\n\n    this.layers$$ = this.mapService.getMap().layers$.subscribe(layers => {\n      this.component.layers = layers;\n    });\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport * as olproj from 'ol/proj';\nimport olWKT from 'ol/format/WKT';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WktService {\n  constructor() {}\n\n  public wktToFeature(wkt, wktProj, featureProj) {\n    return new olWKT().readFeature(wkt, {\n      dataProjection: wktProj,\n      featureProjection: featureProj\n    });\n  }\n  public extentToWkt(epsgTO, extent, extentProj) {\n    let currentExtent = olproj.transformExtent(extent, extentProj, epsgTO);\n    currentExtent = this.roundCoordinateArray(currentExtent, epsgTO, 0);\n    const wktPoly = `POLYGON((\n      ${extent[0]} ${extent[1]},\n      ${extent[0]} ${extent[3]},\n      ${extent[2]} ${extent[3]},\n      ${extent[2]} ${extent[1]},\n      ${extent[0]} ${extent[1]}))`;\n    const wktLine = `LINESTRING(\n      ${extent[0]} ${extent[1]},\n      ${extent[0]} ${extent[3]},\n      ${extent[2]} ${extent[3]},\n      ${extent[2]} ${extent[1]},\n      ${extent[0]} ${extent[1]})`;\n    const wktMultiPoints = `MULTIPOINT(\n        ${extent[0]} ${extent[1]},\n        ${extent[0]} ${extent[3]},\n        ${extent[2]} ${extent[3]},\n        ${extent[2]} ${extent[1]})`;\n    return {\n      wktPoly,\n      wktLine,\n      wktMultiPoints\n    };\n  }\n\n  private roundCoordinateArray(coordinateArray, projection, decimal = 0) {\n    const lproj = olproj.get(projection);\n    const units = lproj.getUnits();\n    const olUnits = ['ft', 'm', 'us-ft'];\n    if (olUnits.indexOf(units) !== -1) {\n      coordinateArray = this.roundArray(coordinateArray, decimal);\n    }\n    return coordinateArray;\n  }\n\n  private roundArray(array, decimal = 0) {\n    let x = 0;\n    while (x < array.length) {\n      array[x] = array[x].toFixed(decimal);\n      x++;\n    }\n    return array;\n  }\n\n  public snrcToWkt(snrc, epsgTO) {\n    snrc = snrc.toLowerCase();\n    let wktPoly;\n    const ew = {\n      1: { from: -56, to: -64 },\n      2: { from: -64, to: -72 },\n      3: { from: -72, to: -80 },\n      4: { from: -80, to: -88 },\n      5: { from: -88, to: -96 },\n      6: { from: -96, to: -104 },\n      7: { from: -104, to: -112 },\n      8: { from: -112, to: -120 },\n      9: { from: -120, to: -128 },\n      10: { from: -128, to: -136 }\n    };\n    const sn = {\n      1: { from: 44, to: 48 },\n      2: { from: 48, to: 52 },\n      3: { from: 52, to: 56 },\n      4: { from: 56, to: 60 },\n      5: { from: 60, to: 64 },\n      6: { from: 64, to: 68 },\n      7: { from: 68, to: 72 },\n      8: { from: 72, to: 76 },\n      9: { from: 76, to: -128 }\n    };\n    const snrc250kIndex = [\n      ['m', 'n', 'o', 'p'],\n      ['l', 'k', 'j', 'i'],\n      ['e', 'f', 'g', 'h'],\n      ['d', 'c', 'b', 'a']\n    ];\n\n    const snrc50kIndex = [\n      ['13', '14', '15', '16'],\n      ['12', '11', '10', '09'],\n      ['05', '06', '07', '08'],\n      ['04', '03', '02', '01']\n    ];\n    const checkSNRC50k = /\\d{2,3}[a-p][0,1][0-9]/gi;\n    const checkSNRC250k = /\\d{2,3}[a-p]/gi;\n    const checkSNRC1m = /\\d{2,3}/gi;\n\n    let snrc1m = false;\n    let snrc250k = false;\n    let snrc50k = false;\n\n    if (checkSNRC50k.test(snrc)) {\n      snrc50k = true;\n    } else {\n      if (checkSNRC250k.test(snrc)) {\n        snrc250k = true;\n      } else {\n        if (checkSNRC1m.test(snrc)) {\n          snrc1m = true;\n        }\n      }\n    }\n\n    if (snrc1m) {\n      snrc += 'a01';\n    } else if (snrc250k) {\n      snrc += '01';\n    }\n    if (/\\d{2,3}[a-p][0,1][0-9]/gi.test(snrc)) {\n      const regex1m = /(?=[a-p])/gi;\n      const ar1m = snrc.split(regex1m);\n      const part1m = ar1m[0];\n      const part250k = ar1m[1][0];\n      const part50k = ar1m[1].split(part250k)[1];\n      let separator = 1;\n      if (part1m.length === 3) {\n        separator = 2;\n      }\n      const partEW = part1m.substring(0, separator);\n      const partSN = part1m.substring(separator);\n      const unit1mEW = 8;\n      const unit1mSN = 4;\n      const unit250kEW = 2;\n      const unit250kSN = 1;\n      const unit50kEW = 0.5;\n      const unit50kSN = 0.25;\n      let index250kEW = 0;\n      let index250kSN = 0;\n      let index50kEW = 0;\n      let index50kSN = 0;\n      snrc250kIndex.forEach(element => {\n        if (element.indexOf(part250k) !== -1) {\n          index250kSN = snrc250kIndex.indexOf(element);\n          index250kEW = element.indexOf(part250k);\n        }\n      });\n      snrc50kIndex.forEach(element => {\n        if (element.indexOf(part50k) !== -1) {\n          index50kSN = snrc50kIndex.indexOf(element);\n          index50kEW = element.indexOf(part50k);\n        }\n      });\n\n      let increment250kEW = 0;\n      let increment250kSN = 0;\n      let increment50kEW = 0;\n      let increment50kSN = 0;\n      let unitPerTypeEW = unit1mEW;\n      let unitPerTypeSN = unit1mSN;\n      if (snrc250k) {\n        increment250kEW = index250kEW * unit250kEW;\n        increment250kSN = index250kSN * unit250kSN;\n        increment50kEW = 0;\n        increment50kSN = 0;\n        unitPerTypeEW = unit250kEW;\n        unitPerTypeSN = unit250kSN;\n      } else if (snrc50k) {\n        increment250kEW = index250kEW * unit250kEW;\n        increment250kSN = index250kSN * unit250kSN;\n        increment50kEW = index50kEW * unit50kEW;\n        increment50kSN = index50kSN * unit50kSN;\n        unitPerTypeEW = unit50kEW;\n        unitPerTypeSN = unit50kSN;\n      }\n\n      const coord: {ul?: any, lr?: any, ur?: any, ll?: any} = {\n        ul: [\n          ew[partEW].to + increment250kEW + increment50kEW,\n          sn[partSN].to - increment250kSN - increment50kSN\n        ]\n      };\n\n      coord.lr = [\n        coord.ul[0] + unitPerTypeEW,\n        coord.ul[1] - unitPerTypeSN\n      ];\n      coord.ur = [coord.ul[0], coord.ul[1] - unitPerTypeSN];\n      coord.ll = [coord.ul[0] + unitPerTypeEW, coord.ul[1]];\n\n      coord.ul = olproj.transform(\n        [coord.ul[0], coord.ul[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.lr = olproj.transform(\n        [coord.lr[0], coord.lr[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.ur = olproj.transform(\n        [coord.ur[0], coord.ur[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.ll = olproj.transform(\n        [coord.ll[0], coord.ll[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n\n      // Rounded coordinate to shorten url in get\n      coord.ul = this.roundCoordinateArray(coord.ul, epsgTO, 0);\n      coord.lr = this.roundCoordinateArray(coord.lr, epsgTO, 0);\n      coord.ur = this.roundCoordinateArray(coord.ur, epsgTO, 0);\n      coord.ll = this.roundCoordinateArray(coord.ll, epsgTO, 0);\n\n      wktPoly =\n        'POLYGON((' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' '),\n          coord.ul.join(' ')\n        ].join(',') +\n        '))';\n      const wktLine =\n        'LINESTRING(' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' '),\n          coord.ul.join(' ')\n        ].join(',') +\n        ')';\n\n      const wktMultiPoints =\n        'MULTIPOINT(' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' ')\n        ].join(',') +\n        ')';\n      return {\n        wktPoly,\n        wktLine,\n        wktMultiPoints\n      };\n    }\n  }\n}\n","<mat-checkbox\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\n  (click)=\"$event.stopPropagation()\"\n  (change)=\"toggleFilterState($event)\"\n  [checked]=\"currentFilter.active\">\n</mat-checkbox>\n\n<mat-form-field\n  [ngClass]=\"{'logical': activeFilters.indexOf(currentFilter) !== 0 && currentFilter.active===true, 'logicalHidden': activeFilters.indexOf(currentFilter) === 0 || currentFilter.active!==true}\">\n  <mat-select\n    [disabled]=\"!currentFilter.active\"\n    [value]=\"currentFilter.parentLogical\"\n    tooltip-position=\"above\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"currentFilter.parentLogical ? (('igo.geo.operators.tooltip.'+ currentFilter.parentLogical) | translate) : ''\"\n    (selectionChange)=\"changeLogical($event.value)\">\n      <mat-option\n        [value]=ogcFilterOperator.And\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.And' | translate\">\n          {{'igo.geo.operators.And' | translate}}\n      </mat-option>\n      <mat-option\n        [value]=ogcFilterOperator.Or\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.Or' | translate\">\n          {{'igo.geo.operators.Or' | translate}}\n      </mat-option>\n  </mat-select>\n</mat-form-field>\n\n<mat-form-field\n  class=\"field\"\n  *ngIf=\"(currentFilterIsSpatial$ | async)===false && (fields$ | async) && (fields$| async).length > 0 && (fields$| async)[0].name !== ''\"\n  (mouseenter)=\"inputClearable = 'selectField'\"\n  (mouseleave)=\"inputClearable = undefined\"\n  [floatLabel]=\"floatLabel\">\n  <input\n  matInput\n  [placeholder]=\"'igo.geo.sourceFields.selectField' | translate\"\n  [disabled]=\"!currentFilter.active\"\n  [matAutocomplete]=\"autoCompleteField\"\n  [value]=\"(selectedField$ | async) ? (selectedField$ | async).alias : ''\"\n  tooltip-position=\"above\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"(selectedField$ | async) ? (selectedField$ | async).alias : ('igo.geo.sourceFields.selectField' | translate)\"\n  (input)=\"updateFieldsList($event.target.value)\">\n  <mat-autocomplete #autoCompleteField=\"matAutocomplete\"\n  (optionSelected)='changeField($event.option.id)'>\n    <mat-option\n      *ngFor=\"let field of filteredFields$ | async\"\n      matTooltipShowDelay=\"500\"\n      [value]=\"field.alias\"\n      [id]=\"field.name\"\n      [matTooltip]=\"field.alias\">\n      {{field.alias}}\n    </mat-option>\n  </mat-autocomplete>\n  <button mat-button\n    *ngIf=\"currentFilter.propertyName && inputClearable === 'selectField' && currentFilter.active\"\n    matSuffix\n    mat-icon-button\n    aria-label=\"Clear\"\n    [disabled]=\"!currentFilter.active\"\n    (click)=\"clearSelectedField()\">\n        <mat-icon svgIcon=\"close\"></mat-icon>\n  </button>\n</mat-form-field>\n\n\n<mat-form-field\n  [ngClass]=\"{'operator': (currentFilterIsSpatial$ | async)===false , 'dualInput': (currentFilterIsSpatial$ | async)}\"\n  [floatLabel]=\"floatLabel\">\n  <mat-select\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"currentFilter.operator ? (('igo.geo.operators.tooltip.'+ currentFilter.operator) | translate) : ('igo.geo.filter.selectOperator' | translate)\"\n    [disabled]=\"!currentFilter.active\"\n    [value]=\"currentFilter.operator\"\n    (selectionChange)=\"changeOperator($event.value)\">\n      <mat-option\n        *ngFor=\"let operator of (ogcFilterOperators$ | async) | keyvalue\"\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"operator.key\"\n        [matTooltip]=\"('igo.geo.operators.tooltip.'+ operator.key) | translate\">\n          {{('igo.geo.operators.'+ operator.key) | translate}}\n      </mat-option>\n  </mat-select>\n</mat-form-field>\n\n<mat-form-field\nclass=\"spatialSelector\"\n*ngIf=\"currentFilterIsSpatial$ | async\">\n  <mat-select\n    [disabled]=\"!currentFilter.active\"\n    [value]=\"currentFilter.igoSpatialSelector\"\n    (selectionChange)=\"changeSpatialSelector($event.value)\">\n      <mat-option\n        *ngFor=\"let igoSpatialSelector of igoSpatialSelectors\"\n        [value]=\"igoSpatialSelector.type\">\n          {{('igo.geo.spatialSelector.'+ igoSpatialSelector.type) | translate}}\n      </mat-option>\n  </mat-select>\n</mat-form-field>\n\n<mat-form-field\nclass=\"singleInput\"\n*ngIf=\"['expression','pattern'].indexOf(detectProperty()) !== -1\"\n(mouseenter)=\"inputClearable = 'selectProperty'\"\n(mouseleave)=\"inputClearable = undefined\"\n[floatLabel]=\"floatLabel\">\n  <input\n    matInput\n    [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n    [disabled]=\"!currentFilter.active\"\n    [matAutocomplete]=\"autoCompleteValues\"\n    [value]=\"detectProperty() === 'expression' ? currentFilter.expression : currentFilter.pattern\"\n    tooltip-position=\"above\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"detectProperty() === 'expression' ? currentFilter.expression || '' : currentFilter.pattern || ''\"\n    (input)=\"updateValuesList($event.target.value)\">\n  <mat-autocomplete #autoCompleteValues=\"matAutocomplete\"\n    (optionSelected)=\"changeProperty($event.option.value)\">\n    <mat-option\n      *ngFor=\"let value of filteredValues$ | async\"\n      matTooltipShowDelay=\"500\"\n      [value]=\"value\"\n      [matTooltip]=\"value\">\n      {{value}}\n    </mat-option>\n  </mat-autocomplete>\n  <button mat-button\n    *ngIf=\"isClearable() && inputClearable === 'selectProperty' && currentFilter.active\"\n    matSuffix\n    mat-icon-button\n    aria-label=\"Clear\"\n    [disabled]=\"!currentFilter.active\"\n    (click)=\"clearProperty()\">\n        <mat-icon svgIcon=\"close\"></mat-icon>\n  </button>\n</mat-form-field>\n\n<div class=\"igo-layer-button-group\">\n  <button\n    mat-icon-button\n    collapsibleButton\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.filter.removeFilter' | translate\"\n    color=\"warn\"\n    (click)=\"deleteFilter()\">\n    <mat-icon svgIcon=\"delete\"></mat-icon>\n  </button>\n</div>\n\n<mat-form-field\nclass=\"snrc\"\n*ngIf=\"(currentFilterIsSpatial$ | async) && currentFilter.igoSpatialSelector === 'snrc'\"\n(mouseenter)=\"inputClearable = 'selectSNRC'\"\n(mouseleave)=\"inputClearable = undefined\"\n[floatLabel]=\"floatLabel\">\n  <input\n    matInput\n    [placeholder]=\"'igo.geo.filter.placeholderSnrc' | translate\"\n    [value]=\"currentFilter.igoSNRC\"\n    tooltip-position=\"above\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"currentFilter.igoSNRC ? currentFilter.igoSNRC : ''\"\n    (input)=\"changeSNRC($event.target.value)\">\n  <button\n    mat-button\n    *ngIf=\"currentFilter.igoSNRC\"\n    matSuffix\n    mat-icon-button\n    aria-label=\"Clear\"\n    [disabled]=\"!currentFilter.active && inputClearable === 'selectSNRC' && currentFilter.active\"\n    (click)=\"currentFilter.igoSNRC=''\">\n      <mat-icon svgIcon=\"close\"></mat-icon>\n  </button>\n  </mat-form-field>\n\n  <ng-container *ngIf=\"(currentFilterIsSpatial$ | async) && currentFilter.igoSpatialSelector === 'fixedExtent'\">\n    <button\n    mat-button\n    [disabled]=\"!currentFilter.active\"\n    *ngIf=\"currentFilter.igoSpatialSelector === 'fixedExtent'\"\n    matSuffix\n    mat-icon-button\n    [disabled]=\"!currentFilter.active\"\n    (click)=\"changeMapExtentGeometry()\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.spatialSelector.btnSetExtent' | translate\">\n      <mat-icon svgIcon=\"arrow-expand-all\"></mat-icon>\n  </button>\n</ng-container>\n\n<br/>\n\n<mat-form-field\nclass=\"dualInput\"\n*ngIf=\"!isTemporalOperator() && ['lowerBoundary','begin'].indexOf(detectProperty(1)) !== -1\"\n(mouseenter)=\"inputClearable = 'selectProperty1'\"\n(mouseleave)=\"inputClearable = undefined\"\n[floatLabel]=\"floatLabel\">\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoDualValueOperator1\"\n      type=\"number\"\n      [value]=\"detectProperty(1) === 'lowerBoundary' ? currentFilter.lowerBoundary : currentFilter.begin\"\n      (input)=\"updateValuesList($event.target.value,1)\">\n    <mat-autocomplete #autoDualValueOperator1=\"matAutocomplete\"\n      (optionSelected)=\"changeNumericProperty($event.option.value,1)\">\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\">\n        {{value}}\n      </mat-option>\n    </mat-autocomplete>\n    <button mat-button\n      *ngIf=\"isClearable(1) && inputClearable === 'selectProperty1' && currentFilter.active\"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n    [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty(1)\">\n          <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n</mat-form-field>\n\n<mat-form-field\n  class=\"dualInput\"\n  *ngIf=\"!isTemporalOperator() && ['upperBoundary','end'].indexOf(detectProperty(2)) !== -1\"\n  (mouseenter)=\"inputClearable = 'selectProperty2'\"\n  (mouseleave)=\"inputClearable = undefined\"\n  [floatLabel]=\"floatLabel\">\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoDualValueOperator2\"\n      type=\"number\"\n      [value]=\"detectProperty(2) === 'upperBoundary' ? currentFilter.upperBoundary : currentFilter.end\"\n      (input)=\"updateValuesList($event.target.value,2)\">\n    <mat-autocomplete #autoDualValueOperator2=\"matAutocomplete\"\n      (optionSelected)=\"changeNumericProperty($event.option.value,2)\">\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\">\n        {{value}}\n      </mat-option>\n    </mat-autocomplete>\n    <button mat-button\n      *ngIf=\"isClearable(2) && inputClearable === 'selectProperty2' && currentFilter.active\"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty(2)\">\n          <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n</mat-form-field>\n\n<igo-ogc-filter-time *ngIf=\"isTemporalOperator()\"\n  [(datasource)]=\"datasource\"\n  [(currentFilter)]=\"currentFilter\"\n  (changeProperty)=\"changeProperty($event.value, $event.pos)\">\n</igo-ogc-filter-time>\n\n<!--\nTODO C'EST PERTINENT je crois\n<mat-form-field class=\"field\" *ngIf=\"!(currentFilterIsSpatial$ | async) && (fields$| async) && (fields$| async).length === 1 &&  (fields$| async)[0].name === ''\">\n<input [disabled]=\"!currentFilter.active\" matInput #fieldPerUser (keyup)=\"changeProperty(currentFilter,'propertyName',fieldPerUser.value)\"\n  (blur)=\"changeProperty(currentFilter,'propertyName',fieldPerUser.value)\" [(ngModel)]=\"currentFilter.propertyName\">\n<button mat-button *ngIf=\"currentFilter.propertyName\" matSuffix mat-icon-button aria-label=\"Clear\" (click)=\"currentFilter.propertyName=''\">\n  <mat-icon svgIcon=\"close\"></mat-icon>\n</button>\n</mat-form-field>\n\n\n\n<mat-checkbox labelPosition='before' (change)=\"changeCaseSensitive($event)\" [(ngModel)]=\"currentFilter.matchCase\">\n  {{('igo.geo.operators.caseSensitive') | translate}}\n</mat-checkbox>\n\n</mat-list-item> -->\n","import { Component, Input, OnInit } from '@angular/core';\nimport { FloatLabelType } from '@angular/material/form-field';\nimport { BehaviorSubject, Observable, of } from 'rxjs';\n\nimport {\n  OgcFilterableDataSource,\n  OgcFiltersOptions\n} from '../../filter/shared/ogc-filter.interface';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\nimport { WktService } from '../../wkt/shared/wkt.service';\nimport { IgoMap } from '../../map';\nimport { SourceFieldsOptionsParams } from '../../datasource/shared/datasources/datasource.interface';\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\n\n@Component({\n  selector: 'igo-ogc-filter-form',\n  templateUrl: './ogc-filter-form.component.html',\n  styleUrls: ['./ogc-filter-form.component.scss']\n})\nexport class OgcFilterFormComponent implements OnInit {\n  ogcFilterOperator = OgcFilterOperator;\n  filteredValues$: Observable<string[]>;\n  filteredFields$: Observable<SourceFieldsOptionsParams[]>;\n  public allOgcFilterOperators;\n  public ogcFilterOperators$ = new BehaviorSubject<{ [key: string]: any }>(\n    undefined\n  );\n  public igoSpatialSelectors;\n  public value = '';\n  public inputOperator;\n  public selectedField$ = new BehaviorSubject<SourceFieldsOptionsParams>(\n    undefined\n  );\n  public fields$ = new BehaviorSubject<SourceFieldsOptionsParams[]>([]);\n  public color = 'primary';\n  public disabled;\n  public currentFilterIsSpatial$ = new BehaviorSubject<boolean>(false);\n  public defaultStepMillisecond = 6000;\n  public inputClearable: string;\n\n  @Input() refreshFilters: () => void;\n\n  @Input() datasource: OgcFilterableDataSource;\n\n  @Input() map: IgoMap;\n\n  @Input() currentFilter: any;\n\n  set snrc(value: any) {\n    const checkSNRC50k = /^\\d{2}[a-l][0,1][0-9]$/gi;\n    const checkSNRC250k = /^\\d{2}[a-p]$/gi;\n    const checkSNRC1m = /^\\d{2}$/gi;\n    if (\n      checkSNRC1m.test(value) ||\n      checkSNRC250k.test(value) ||\n      checkSNRC50k.test(value)\n    ) {\n      this._snrc = value;\n      this.currentFilter.igoSNRC = value;\n    }\n  }\n\n  get snrc(): any {\n    return this._snrc;\n  }\n\n  private _snrc = '';\n\n  @Input() floatLabel: FloatLabelType = 'never';\n\n  get activeFilters() {\n    return this.datasource.options.ogcFilters.interfaceOgcFilters.filter(\n      (f) => f.active === true\n    );\n  }\n\n  get allowedOperators() {\n    return new OgcFilterWriter().computeAllowedOperators(\n      this.fields$.value,\n      this.currentFilter.propertyName,\n      this.datasource.options.ogcFilters.allowedOperatorsType\n    );\n  }\n\n  constructor(private wktService: WktService) {\n    // TODO: Filter permitted operator based on wfscapabilities\n    // Need to work on regex on XML capabilities because\n    // comaparison operator's name varies between WFS servers...\n    // Ex: IsNull vs PropertyIsNull vs IsNil ...\n    this.allOgcFilterOperators = new OgcFilterWriter().operators;\n    this.ogcFilterOperators$.next(this.allOgcFilterOperators);\n    this.igoSpatialSelectors = [\n      {\n        type: 'fixedExtent'\n      },\n      {\n        type: 'snrc'\n      }\n    ];\n    // TODO: selectFeature & drawFeature\n  }\n\n  ngOnInit() {\n\n    if ( this.datasource.options.sourceFields) {\n      const sFields = this.datasource.options.sourceFields.filter(\n        (sf) =>\n          sf.excludeFromOgcFilters === undefined || !sf.excludeFromOgcFilters\n      );\n      sFields.map((sfs) => {\n        if (sfs.values) {\n          sfs.values.sort();\n        }\n      });\n      this.fields$.next(sFields);\n    }\n\n    this.updateFieldsList();\n    this.selectedField$.next(\n      this.fields$.value.find((f) => f.name === this.currentFilter.propertyName)\n    );\n    this.updateValuesList();\n    this.selectedField$.subscribe((f) => {\n      this.ogcFilterOperators$.next(this.allowedOperators);\n      if (\n        Object.keys(this.allowedOperators).indexOf(\n          this.currentFilter.operator\n        ) === -1\n      ) {\n        this.currentFilter.operator = Object.keys(this.allowedOperators)[0];\n        this.currentFilter.operator = Object.keys(this.allowedOperators)[0];\n      }\n      this.updateValuesList();\n    });\n    this.currentFilterIsSpatial();\n  }\n\n  updateFieldsList(value?: string) {\n    this.filteredFields$ =\n      value && value.length > 0 ? of(this._filterFields(value)) : this.fields$;\n    if (this.fields$.value.find((f) => f.name === value)) {\n      this.changeField(value);\n    }\n  }\n\n  updateValuesList(value?: string, pos?: number) {\n    this.filteredValues$ =\n      value && value.length > 0\n        ? of(this._filterValues(value))\n        : this.selectedField$.value\n        ? of(this.selectedField$.value.values)\n        : of([]);\n    if (value && value.length >= 1) {\n      this.changeProperty(value, pos);\n    }\n  }\n\n  private _filterFields(value: string): SourceFieldsOptionsParams[] {\n    const keywordRegex = new RegExp(\n      value.normalize('NFD').replace(/[\\u0300-\\u036f]/g, ''),\n      'gi'\n    );\n    return this.fields$.value.filter((val) =>\n      keywordRegex.test(\n        val.alias.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')\n      )\n    );\n  }\n\n  private _filterValues(value: string): string[] {\n    const keywordRegex = new RegExp(\n      value\n        .toString()\n        .normalize('NFD')\n        .replace(/[\\u0300-\\u036f]/g, ''),\n      'gi'\n    );\n    return this.selectedField$.value.values.filter((val) =>\n      val && keywordRegex.test(\n        val\n          .toString()\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '')\n      )\n    );\n  }\n\n  clearSelectedField() {\n    this.currentFilter.propertyName = '';\n    this.selectedField$.next(undefined);\n    this.clearProperty();\n  }\n\n  isClearable(pos?: number) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      return this.currentFilter[detectedProperty];\n    }\n  }\n  clearProperty(pos?: number) {\n    // this.autoCompleteInputValues.closePanel();\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      return (this.currentFilter[detectedProperty] = '');\n    }\n  }\n\n  toggleFilterState(event) {\n    this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n      (f) => f.filterid === this.currentFilter.filterid\n    ).active = event.checked;\n    this.refreshFilters();\n  }\n\n  deleteFilter() {\n    const ogcFilters: OgcFiltersOptions = this.datasource.options.ogcFilters;\n    ogcFilters.interfaceOgcFilters = ogcFilters.interfaceOgcFilters.filter(\n      (f) => f.filterid !== this.currentFilter.filterid\n    );\n    this.refreshFilters();\n  }\n\n  changeLogical(logical: string) {\n    this.currentFilter.parentLogical = logical;\n    this.refreshFilters();\n  }\n\n  changeOperator(operator: string) {\n    this.currentFilter.operator = operator;\n    this.currentFilterIsSpatial();\n\n    if (\n      this.currentFilterIsSpatial$.value &&\n      this.currentFilter.wkt_geometry.length === 0\n    ) {\n      this.changeSpatialSelector(this.currentFilter.igoSpatialSelector);\n    } else {\n      this.refreshFilters();\n    }\n  }\n\n  changeField(field: string) {\n    this.currentFilter.propertyName = field;\n    this.selectedField$.next(\n      this.fields$.value.find((f) => f.name === this.currentFilter.propertyName)\n    );\n    this.refreshFilters();\n  }\n\n  // Issue with mapserver 7.2 and Postgis layers. Fixed in 7.4\n  // Due to this issue, the checkbox is hide.\n  changeCaseSensitive(matchCase) {\n    this.currentFilter.matchCase = matchCase.checked;\n    this.refreshFilters();\n  }\n\n  changeProperty(value: any, pos?: number, refreshFilter = true) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n        (f) => f.filterid === this.currentFilter.filterid\n      )[detectedProperty] = value;\n\n      if ( refreshFilter ) {\n        this.refreshFilters();\n      }\n    }\n  }\n\n  changeNumericProperty(value, pos: number) {\n    this.changeProperty(parseFloat(value), pos);\n  }\n\n  changeSpatialSelector(value: any) {\n    this.currentFilter.igoSpatialSelector = value;\n\n    if (value === 'fixedExtent') {\n      this.changeMapExtentGeometry(false);\n    }\n    this.currentFilterIsSpatial();\n    this.refreshFilters();\n  }\n\n  changeSNRC(value: any) {\n    this.snrc = value;\n    this.changeSNRCGeometry();\n  }\n\n  changeSNRCGeometry() {\n    const interfaceOgcFilter = this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n      (f) => f.filterid === this.currentFilter.filterid\n    );\n    if (!interfaceOgcFilter) {\n      return;\n    }\n\n    if (this.snrc && this.currentFilter.igoSpatialSelector === 'snrc') {\n      this.currentFilter.wkt_geometry = this.wktService.snrcToWkt(\n        this.snrc,\n        this.map.projection\n      ).wktPoly;\n    }\n    this.refreshFilters();\n  }\n\n  changeMapExtentGeometry(refresh: boolean = true) {\n    const interfaceOgcFilter = this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n      (f) => f.filterid === this.currentFilter.filterid\n    );\n    if (!interfaceOgcFilter) {\n      return;\n    }\n\n    if (this.currentFilter.igoSpatialSelector === 'fixedExtent') {\n      this.currentFilter.wkt_geometry = this.wktService.extentToWkt(\n        this.map.projection,\n        this.map.viewController.getExtent(),\n        this.map.projection\n      ).wktPoly;\n    }\n    if (refresh) {\n      this.refreshFilters();\n    }\n  }\n\n  detectProperty(pos?: number): string {\n    switch (this.currentFilter.operator) {\n      case OgcFilterOperator.PropertyIsNotEqualTo:\n      case OgcFilterOperator.PropertyIsEqualTo:\n      case OgcFilterOperator.PropertyIsGreaterThan:\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo:\n      case OgcFilterOperator.PropertyIsLessThan:\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo:\n        return 'expression';\n      case OgcFilterOperator.PropertyIsLike:\n        return 'pattern';\n      case OgcFilterOperator.PropertyIsBetween:\n        return pos && pos === 1\n          ? 'lowerBoundary'\n          : pos && pos === 2\n          ? 'upperBoundary'\n          : undefined;\n      case OgcFilterOperator.During:\n        return pos && pos === 1\n          ? 'begin'\n          : pos && pos === 2\n          ? 'end'\n          : undefined;\n      default:\n        return;\n    }\n  }\n\n  private currentFilterIsSpatial() {\n    let isSpatial = false;\n    if (this.currentFilter) {\n      isSpatial =\n        [\n          OgcFilterOperator.Contains,\n          OgcFilterOperator.Intersects,\n          OgcFilterOperator.Within\n        ].indexOf(this.currentFilter.operator) !== -1;\n    }\n    this.currentFilterIsSpatial$.next(isSpatial);\n  }\n\n  isTemporalOperator() {\n    return (\n      this.currentFilter.operator.toLowerCase() ===\n      this.ogcFilterOperator.During.toLowerCase()\n    );\n  }\n}\n","<igo-ogc-filter-selection\n  *ngIf=\"!advancedOgcFilters\"\n  igoListItem\n  [refreshFilters]=\"refreshFunc\"\n  [datasource]=\"datasource\"\n  [map]=\"map\"\n  [currentFilter]=\"currentFilter\">\n</igo-ogc-filter-selection>\n\n<ng-template \n*ngIf=\"advancedOgcFilters && datasource.options.ogcFilters.editable\"\nngFor let-currentFilter \n[ngForOf]=\"datasource.options.ogcFilters.interfaceOgcFilters\">\n<igo-ogc-filter-form\n  [currentFilter]=\"currentFilter\"\n  [refreshFilters]=\"refreshFunc\"\n  [datasource]=\"datasource\"\n  [map]=\"map\">\n</igo-ogc-filter-form>\n</ng-template>","import { Component, Input } from '@angular/core';\nimport { OgcFilterableDataSource } from '../shared/ogc-filter.interface';\nimport { IgoMap } from '../../map';\n\n@Component({\n  selector: 'igo-ogc-filterable-form',\n  templateUrl: './ogc-filterable-form.component.html'\n})\nexport class OgcFilterableFormComponent {\n\n  @Input() datasource: OgcFilterableDataSource;\n\n  @Input() map: IgoMap;\n\n  @Input() refreshFilters: () => void;\n\n  get refreshFunc() {\n    return this.refreshFilters;\n  }\n\n  get advancedOgcFilters(): boolean {\n    if (this.datasource.options.ogcFilters) {\n      return this.datasource.options.ogcFilters.advancedOgcFilters;\n    }\n    return;\n  }\n\n  get currentFilter(): any {\n    return this.datasource.options.ogcFilters.interfaceOgcFilters ?\n    this.datasource.options.ogcFilters.interfaceOgcFilters[0] : undefined;\n  }\n\n  public color = 'primary';\n\n  constructor() {}\n}\n","<mat-list-item>\n\n  <mat-icon\n    *ngIf=\"header\"\n    class=\"igo-chevron\"\n    mat-list-avatar\n    igoCollapse [target]=\"ogcFilters\"\n    [collapsed]=\"filtersCollapsed\"\n    (click)=\"toggleFiltersCollapsed()\"\n    svgIcon=\"chevron-up\">\n  </mat-icon>\n  <h4 (click)=\"toggleLegendOnClick()\" *ngIf=\"header\" [ngStyle]=\"{'cursor': filtersCollapsed ? 'default' : 'pointer'}\" matLine [matTooltip]=\"layer.title\" matTooltipShowDelay=\"500\">{{layer.title}}</h4>\n    <button *ngIf=\"isAdvancedOgcFilters() && filtersAreEditable\" [disabled]=\"addFilterDisabled()\" mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.filter.addFilter' | translate\" [color]=\"color\" (click)=\"addFilterToSequence()\">\n      <mat-icon svgIcon=\"plus\"></mat-icon>\n    </button>\n    <button *ngIf=\"header\"\n      mat-icon-button\n      [color]=\"layer.visible ? 'primary' : 'default'\"\n      collapsibleButton\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"layer.visible ?\n                    ('igo.geo.layer.hideLayer' | translate) :\n                    ('igo.geo.layer.showLayer' | translate)\"\n      (click)=\"layer.visible = !layer.visible\">\n      <mat-icon\n        [ngClass]=\"{disabled: (inResolutionRange$ | async)===false}\"\n        [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\">\n      </mat-icon>\n    </button>\n</mat-list-item>\n\n<div #ogcFilters>\n    <div *ngIf=\"header\" #legend class=\"igo-layer-legend-container\">\n      <igo-layer-legend *ngIf=\"showLegend$ | async\" [layer]=\"layer\">\n      </igo-layer-legend>\n    </div>\n  <igo-ogc-filterable-form [datasource]=\"datasource\" [map]=\"map\" [refreshFilters]=\"refreshFunc\">\n  </igo-ogc-filterable-form>\n\n  <section *ngIf=\"hasSelector && filtersAreEditable\" class=\"mat-typography advancedOgcFilters\">\n    <mat-divider></mat-divider>\n    <mat-checkbox labelPosition='before' (change)=\"changeOgcFilterType($event)\"\n      [(ngModel)]=\"datasource.options.ogcFilters.advancedOgcFilters\">\n      {{'igo.geo.filter.advancedOgcFilters' | translate}}\n    </mat-checkbox>\n  </section>\n</div>","import { Component, Input, OnDestroy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { WFSDataSourceOptionsParams } from '../../datasource/shared/datasources/wfs-datasource.interface';\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\n\nimport {\n  OgcFilterableDataSource,\n  OgcFiltersOptions,\n  OgcInterfaceFilterOptions\n} from '../shared/ogc-filter.interface';\nimport { OGCFilterService } from '../shared/ogc-filter.service';\nimport { IgoMap } from '../../map';\nimport { OgcFilterWriter } from '../shared/ogc-filter';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\n@Component({\n  selector: 'igo-ogc-filterable-item',\n  templateUrl: './ogc-filterable-item.component.html',\n  styleUrls: ['./ogc-filterable-item.component.scss']\n})\nexport class OgcFilterableItemComponent implements OnInit, OnDestroy {\n  public color = 'primary';\n  private lastRunOgcFilter;\n  private defaultLogicalParent = OgcFilterOperator.And;\n  public hasActiveSpatialFilter = false;\n  public filtersAreEditable = true;\n  public filtersCollapsed = true;\n  public hasSelector: boolean = false;\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  private resolution$$: Subscription;\n  private ogcFilterWriter;\n\n  @Input() layer: Layer;\n\n  @Input() map: IgoMap;\n\n  @Input() header: boolean = true;\n\n  get refreshFunc() {\n    return this.refreshFilters.bind(this);\n  }\n\n  get datasource(): OgcFilterableDataSource {\n    return this.layer.dataSource as OgcFilterableDataSource;\n  }\n\n  constructor(private ogcFilterService: OGCFilterService) {\n    this.ogcFilterWriter = new OgcFilterWriter();\n  }\n\n  ngOnInit() {\n    const ogcFilters = this.datasource.options.ogcFilters;\n    if (\n      (ogcFilters.pushButtons && ogcFilters.pushButtons.bundles.length > 0) ||\n      (ogcFilters.checkboxes && ogcFilters.checkboxes.bundles.length > 0) ||\n      (ogcFilters.radioButtons && ogcFilters.radioButtons.bundles.length > 0) ||\n      (ogcFilters.select && ogcFilters.select.bundles.length > 0)) {\n      if (ogcFilters.advancedOgcFilters === undefined) {\n        ogcFilters.advancedOgcFilters = false;\n      }\n      this.hasSelector = true;\n    }\n\n    switch (this.datasource.options.type) {\n      case 'wms':\n        this.ogcFilterService.setOgcWMSFiltersOptions(this.datasource);\n        break;\n      case 'wfs':\n        this.ogcFilterService.setOgcWFSFiltersOptions(this.datasource);\n        break;\n      default:\n        break;\n    }\n\n    if (ogcFilters) {\n      if (ogcFilters.interfaceOgcFilters) {\n        this.lastRunOgcFilter = JSON.parse(\n          JSON.stringify(ogcFilters.interfaceOgcFilters)\n        );\n        if (\n          ogcFilters.interfaceOgcFilters.filter(f => f.wkt_geometry).length >= 1\n        ) {\n          this.hasActiveSpatialFilter = true;\n        }\n      }\n\n      this.filtersAreEditable = ogcFilters.editable\n        ? ogcFilters.editable\n        : false;\n    }\n\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.inResolutionRange$.next(this.layer.isInResolutionsRange);\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.resolution$$.unsubscribe();\n  }\n\n  addFilterToSequence() {\n    this.filtersCollapsed = false;\n    const interfaceOgcFilters: OgcInterfaceFilterOptions[] = this.datasource\n      .options.ogcFilters.interfaceOgcFilters;\n    const arr = interfaceOgcFilters || [];\n    const lastLevel = arr.length === 0 ? 0 : arr[arr.length - 1].level;\n    let firstFieldName = '';\n    const includedFields = this.datasource.options.sourceFields.filter(f => !f.excludeFromOgcFilters);\n    if (includedFields.length > 0) {\n      firstFieldName =\n        includedFields[0].name === undefined ? '' : includedFields[0].name;\n    }\n    let fieldNameGeometry;\n    const datasourceOptions = this.datasource\n      .options as WFSDataSourceOptionsParams;\n    if (datasourceOptions.fieldNameGeometry) {\n      fieldNameGeometry = datasourceOptions.fieldNameGeometry;\n    } else if (\n      (this.datasource.options as any).paramsWFS &&\n      (this.datasource.options as any).paramsWFS.fieldNameGeometry\n    ) {\n      fieldNameGeometry = (this.datasource.options as any).paramsWFS\n        .fieldNameGeometry;\n    }\n    const allowedOperators = this.ogcFilterWriter.computeAllowedOperators(\n      this.datasource.options.sourceFields,\n      firstFieldName,\n      this.datasource.options.ogcFilters.allowedOperatorsType);\n    const firstOperatorName = Object.keys(allowedOperators)[0];\n\n    arr.push(\n      this.ogcFilterWriter.addInterfaceFilter(\n        {\n          propertyName: firstFieldName,\n          operator: firstOperatorName,\n          active: true,\n          igoSpatialSelector: 'fixedExtent',\n          srsName: this.map.projection,\n        } as OgcInterfaceFilterOptions,\n        fieldNameGeometry,\n        lastLevel,\n        this.defaultLogicalParent\n      )\n    );\n    this.datasource.options.ogcFilters.interfaceOgcFilters = arr;\n  }\n\n  refreshFilters(force?: boolean) {\n    if (force === true) {\n      this.lastRunOgcFilter = undefined;\n    }\n    const ogcFilters: OgcFiltersOptions = this.datasource.options.ogcFilters;\n    const activeFilters = ogcFilters.interfaceOgcFilters ?\n      ogcFilters.interfaceOgcFilters.filter(f => f.active === true) : [];\n    if (activeFilters.length === 0) {\n      ogcFilters.filters = undefined;\n      ogcFilters.filtered = false;\n    }\n    if (activeFilters.length > 1) {\n      activeFilters[0].parentLogical = activeFilters[1].parentLogical;\n    }\n    if (\n      activeFilters.filter(\n        af => ['Contains', 'Intersects', 'Within'].indexOf(af.operator) !== -1\n      ).length === 0\n    ) {\n      this.hasActiveSpatialFilter = false;\n    } else {\n      this.hasActiveSpatialFilter = true;\n    }\n\n    if (\n      !(JSON.stringify(this.lastRunOgcFilter) === JSON.stringify(activeFilters))\n    ) {\n      if (this.layer.dataSource.options.type === 'wfs') {\n        const ogcDataSource: any = this.layer.dataSource;\n        const ogcLayer: OgcFiltersOptions = ogcDataSource.options.ogcFilters;\n        ogcLayer.filters = this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(\n          activeFilters\n        );\n        this.layer.dataSource.ol.refresh();\n      } else if (\n        this.layer.dataSource.options.type === 'wms' &&\n        ogcFilters.enabled\n      ) {\n        let rebuildFilter = '';\n        if (activeFilters.length >= 1) {\n          const ogcDataSource: any = this.layer.dataSource;\n          const ogcLayer: OgcFiltersOptions = ogcDataSource.options.ogcFilters;\n          ogcLayer.filters = this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(\n            activeFilters\n          );\n          rebuildFilter = this.ogcFilterWriter.buildFilter(\n            ogcLayer.filters,\n            undefined,\n            undefined,\n            (this.layer.dataSource.options as any).fieldNameGeometry,\n            ogcDataSource.options\n          );\n        }\n        this.ogcFilterService.filterByOgc(\n          this.datasource as WMSDataSource,\n          rebuildFilter\n        );\n        this.datasource.options.ogcFilters.filtered =\n          activeFilters.length === 0 ? false : true;\n      }\n\n      this.lastRunOgcFilter = JSON.parse(JSON.stringify(activeFilters));\n    } else {\n      // identical filter. Nothing triggered\n    }\n    (this.layer.dataSource as OgcFilterableDataSource).setOgcFilters(ogcFilters, true);\n  }\n\n  public setVisible() {\n    this.layer.visible = true;\n  }\n\n  public isAdvancedOgcFilters(): boolean {\n    return this.datasource.options.ogcFilters.advancedOgcFilters;\n  }\n\n  public addFilterDisabled(): boolean {\n    return (\n      !this.datasource.options.sourceFields ||\n      this.datasource.options.sourceFields.length === 0\n    );\n  }\n\n  private changeOgcFiltersAdvancedOgcFilters(value: boolean) {\n    this.datasource.options.ogcFilters.advancedOgcFilters = value;\n  }\n\n  changeOgcFilterType(isAdvancedOgcFilters) {\n    this.changeOgcFiltersAdvancedOgcFilters(isAdvancedOgcFilters.checked);\n    if (isAdvancedOgcFilters.checked) {\n      this.refreshFilters(true);\n    }\n  }\n\n  private toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    if (!this.filtersCollapsed) {\n      this.toggleLegend(this.showLegend$.value);\n    }\n  }\n\n  toggleFiltersCollapsed() {\n    this.filtersCollapsed = !this.filtersCollapsed;\n  }\n}\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-layer [ngForOf]=\"layers | filterableDataSource: 'ogc'\">\n    <igo-ogc-filterable-item igoListItem [header]=\"true\" [layer]=\"layer\" \n    [map]=\"layer.map\" ></igo-ogc-filterable-item>\n  </ng-template>\n</igo-list>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { IgoMap } from '../../map';\n\n@Component({\n  selector: 'igo-ogc-filterable-list',\n  templateUrl: './ogc-filterable-list.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class OgcFilterableListComponent {\n\n  @Input() layers: Layer[];\n\n  @Input() map: IgoMap;\n\n  constructor() {}\n}\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport { MapService } from '../../map/shared/map.service';\nimport { OgcFilterableListComponent } from './ogc-filterable-list.component';\n\n@Directive({\n  selector: '[igoOgcFilterableListBinding]'\n})\nexport class OgcFilterableListBindingDirective implements OnInit, OnDestroy {\n  private component: OgcFilterableListComponent;\n  private layers$$: Subscription;\n\n  constructor(\n    @Self() component: OgcFilterableListComponent,\n    private mapService: MapService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input layers\n    this.component.layers = [];\n\n    this.layers$$ = this.mapService.getMap().layers$.subscribe(layers => {\n      this.component.layers = layers.filter(layer => layer.showInLayerList);\n    });\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n  }\n}\n","<button\n  *ngIf=\"header && options.ogcFilters && options.ogcFilters.enabled &&\n  (options.ogcFilters.pushButtons || options.ogcFilters.checkboxes || options.ogcFilters.radioButtons || options.ogcFilters.select || options.ogcFilters.editable)\"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.filter.filterBy' | translate\"\n  [color]=\"color\">\n  <mat-icon [matBadge]=\"badge\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" svgIcon=\"filter\"></mat-icon>\n</button>\n\n<div #ogcFilter class=\"igo-layer-actions-container\"\n*ngIf=\"options.ogcFilters && options.ogcFilters.enabled &&\n(options.ogcFilters.pushButtons || options.ogcFilters.checkboxes || options.ogcFilters.radioButtons || options.ogcFilters.select || options.ogcFilters.editable)\">\n  <igo-ogc-filterable-item\n    *ngIf=\"ogcFilterCollapse && options.ogcFilters.enabled\"\n    igoListItem\n    [header]=\"false\"\n    [map]=\"layer.map\"\n    [layer]=\"layer\">\n  </igo-ogc-filterable-item>\n</div>\n","import { Component, Input, ChangeDetectionStrategy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { IgoMap } from '../../map';\nimport { OgcFilterableDataSourceOptions, IgoOgcSelector } from '../shared/ogc-filter.interface';\n\n@Component({\n  selector: 'igo-ogc-filter-button',\n  templateUrl: './ogc-filter-button.component.html',\n  styleUrls: ['./ogc-filter-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class OgcFilterButtonComponent implements OnInit {\n\n  public options: OgcFilterableDataSourceOptions;\n\n  get badge() {\n    const filter = this.options.ogcFilters as any;\n    let cnt = 0;\n    if (filter && !filter.advancedOgcFilters) {\n      if (filter.pushButtons) {\n        const pushButtons = filter.pushButtons as IgoOgcSelector;\n        const currentPushButtonGroup = pushButtons.groups.find(gr => gr.enabled);\n        let cntPushButtons = 0;\n        if (currentPushButtonGroup) {\n          currentPushButtonGroup.computedSelectors.map(cb => cntPushButtons += (cb.selectors as any).filter(\n            button => button.enabled).length);\n        }\n        cnt += cntPushButtons;\n      }\n      if (filter.checkboxes) {\n        const checkboxes = filter.checkboxes as IgoOgcSelector;\n        const currentCheckboxGroup = checkboxes.groups.find(gr => gr.enabled);\n        let cntCheckboxes = 0;\n        if (currentCheckboxGroup) {\n          currentCheckboxGroup.computedSelectors.map(cb => cntCheckboxes += (cb.selectors as any).filter(\n            checkbox => checkbox.enabled).length);\n        }\n        cnt += cntCheckboxes;\n      }\n      if (filter.radioButtons) {\n        const radioButtons = filter.radioButtons as IgoOgcSelector;\n        const currentRadioButtonsGroup = radioButtons.groups.find(gr => gr.enabled);\n        let cntRadioButtons = 0;\n        if (currentRadioButtonsGroup) {\n          currentRadioButtonsGroup.computedSelectors.map(cb => cntRadioButtons += (cb.selectors as any).filter(\n            radio => radio.enabled).length);\n        }\n        cnt += cntRadioButtons;\n      }\n      if (filter.select) {\n        const select = filter.select as IgoOgcSelector;\n        const currentSelectGroup = select.groups.find(gr => gr.enabled);\n        let cntSelect = 0;\n        if (currentSelectGroup) {\n          currentSelectGroup.computedSelectors.map(cb => cntSelect += (cb.selectors as any).filter(\n            multi => multi.enabled).length);\n        }\n        cnt += cntSelect;\n      }\n    } else if (filter && filter.filters && !filter.filters.filters) {\n      return 1;\n    } else if (filter && filter.filters && filter.filters.filters) {\n      return filter.filters.filters.length;\n    }\n    if (filter.filters && filter.filters.operator === 'During' && filter.filters.active &&\n      filter.interfaceOgcFilters && filter.interfaceOgcFilters[0].active) {\n      const filterActiveValue = filter.interfaceOgcFilters[0];\n      if (filter.filters.calendarModeYear) {\n        // year mode check just year\n        if ((filterActiveValue.begin.substring(0,4) !== this.options.minDate.substring(0,4) ) ||\n        (filterActiveValue.end.substring(0,4) !== this.options.maxDate.substring(0,4) )) {\n          cnt += 1;\n        }\n      } else if ((filterActiveValue.begin !== this.options.minDate) || (filterActiveValue.end !== this.options.maxDate)) {\n        cnt += 1;\n      }\n    }\n    return cnt > 0 ? cnt : undefined;\n  }\n\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n    if (value) {\n      this.options = this.layer.dataSource.options as OgcFilterableDataSourceOptions;\n    }\n  }\n  private _layer;\n\n  @Input() map: IgoMap;\n\n  @Input() color: string = 'primary';\n\n  @Input() header: boolean;\n\n  public ogcFilterCollapse = false;\n\n  constructor() {}\n\n  ngOnInit() {\n    this.options = this.layer.dataSource.options as OgcFilterableDataSourceOptions;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport * as moment_ from 'moment';\nconst moment = moment_;\n\nimport {\n    OgcFilterableDataSource\n  } from './ogc-filter.interface';\n\n@Injectable()\nexport class OGCFilterTimeService {\n\n    readonly defaultStepMillisecond = 60000;\n\n    constructor() {}\n\n    step(datasource: OgcFilterableDataSource, currentFilter): string {\n    return datasource.options.stepDate\n      ? datasource.options.stepDate\n      : currentFilter.step;\n    }\n\n    stepMillisecond(dataSource: OgcFilterableDataSource, currentFilter): number {\n        const step = moment.duration(this.step(dataSource, currentFilter)).asMilliseconds();\n        return step === 0 ? this.defaultStepMillisecond : step;\n    }\n\n    stepIsYearDuration(step: string) {\n        const year = moment.duration(step);\n        return (\n            year.years() !== 0 &&\n            year.months() === 0 &&\n            year.weeks() === 0 &&\n            year.days() === 0 &&\n            year.hours() === 0 &&\n            year.minutes() === 0\n        );\n    }\n\n    stepIsMonthDuration(step: string) {\n        const month = moment.duration(step);\n        return (\n            month.months() !== 0 &&\n            month.weeks() === 0 &&\n            month.days() === 0 &&\n            month.hours() === 0 &&\n            month.minutes() === 0\n        );\n    }\n\n    stepIsWeekDuration(step: string) {\n        const week = moment.duration(step);\n        return (\n            week.weeks() !== 0 &&\n            week.days() === 7 &&\n            week.hours() === 0 &&\n            week.minutes() === 0\n        );\n    }\n\n    stepIsDayDuration(step: string) {\n        const day = moment.duration(step);\n        return day.days() !== 0 && day.hours() === 0 && day.minutes() === 0;\n    }\n\n    stepIsHourDuration(step: string) {\n        const hour = moment.duration(step);\n        return hour.hours() !== 0 && hour.minutes() === 0;\n    }\n\n    stepIsMinuteDuration(step: string) {\n        const minute = moment.duration(step);\n        return minute.minutes() !== 0;\n    }\n\n    dateToNumber(date: Date): number {\n        let newDate = new Date();\n        if (date) {\n          newDate = new Date(date);\n        }\n        return newDate.getTime();\n    }\n\n    public addStep(value, stepMillisecond) {\n        return moment(value).add(stepMillisecond, 'milliseconds').toDate();\n    }\n\n    public subtractStep(value, stepMillisecond) {\n        return moment(value).subtract(stepMillisecond, 'milliseconds').toDate();\n    }\n}\n","<form [formGroup]=\"form\">\n  <div *ngFor=\"let selector of ogcFiltersSelectors\">\n    <div class=\"pushButtonGroups\" *ngIf=\"selector.selectorType === 'pushButton'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getPushButtonsGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"pushButtonsGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentPushButtonsGroup\">\n            <mat-option *ngFor=\"let selectorGroup of getPushButtonsGroups()\"\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentPushButtonsGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <mat-button-toggle-group\n          formControlName=\"pushButtons\" class=\"mat-typography\" appearance=\"legacy\" vertical={{bundleIsVertical(bundle)}} multiple=\"true\">\n          <mat-button-toggle *ngFor=\"let ogcPushButton of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcPushButton)\" tooltip-position=\"below\" matTooltipShowDelay=\"500\" matTooltipClass=\"material-tooltip\"\n            [ngStyle]=\"getButtonColor(ogcPushButton)\"\n            [checked]=\"ogcPushButton.enabled\" (change)=\"onSelectionChange(ogcPushButton, selector.selectorType)\"\n            [value]=\"ogcPushButton\">{{ogcPushButton.title}}\n          </mat-button-toggle>\n        </mat-button-toggle-group>\n      </ng-container>\n    </div>\n\n    <div class=\"checkboxGroups\" *ngIf=\"selector.selectorType === 'checkbox'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getCheckboxesGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"checkboxesGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentCheckboxesGroup\">\n            <mat-option *ngFor=\"let selectorGroup of getCheckboxesGroups()\"\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentCheckboxesGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <div class=\"checkboxes mat-typography\">\n          <mat-checkbox *ngFor=\"let ogcCheckbox of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcCheckbox)\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            [checked]=\"ogcCheckbox.enabled\" (change)=\"onSelectionChange(ogcCheckbox, selector.selectorType)\"\n            [value]=\"ogcCheckbox\">{{ogcCheckbox.title}}\n          </mat-checkbox>\n        </div>\n        <p *ngIf=\"isLessResults(bundle, 'checkbox') || isMoreResults(bundle, 'checkbox')\">\n          <u *ngIf=\"isLessResults(bundle, 'checkbox')\"\n            class=\"lessResults mat-typography\"\n            (click)=\"displayLessResults('checkbox')\">{{ 'igo.geo.filter.displayLessResults' | translate }}\n          </u>\n          <u *ngIf=\"isMoreResults(bundle, 'checkbox')\"\n            class=\"moreResults mat-typography\"\n            (click)=\"displayMoreResults('checkbox')\">{{ 'igo.geo.filter.displayMoreResults' | translate }}\n          </u>\n        </p>\n      </ng-container>\n    </div>\n\n    <div class=\"radioButtonGroups\" *ngIf=\"selector.selectorType === 'radioButton'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getRadioButtonsGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"radioButtonsGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentRadioButtonsGroup\">\n            <mat-option *ngFor=\"let selectorGroup of getRadioButtonsGroups()\"\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentRadioButtonsGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <mat-radio-group\n          formControlName=\"radioButtons\" class=\"mat-typography\">\n          <mat-radio-button *ngIf=\"bundle.unfiltered\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            (change)=\"emptyRadioButtons()\">{{ 'igo.geo.filter.resetFilters' | translate }}\n          </mat-radio-button>\n          <mat-radio-button *ngFor=\"let ogcRadioButton of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcRadioButton)\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            [checked]=\"ogcRadioButton.enabled\" (change)=\"onSelectionChange(ogcRadioButton, selector.selectorType)\"\n            [value]=\"ogcRadioButton\">{{ogcRadioButton.title}}\n          </mat-radio-button>\n          <p *ngIf=\"isLessResults(bundle, 'radio') || isMoreResults(bundle, 'radio')\">\n            <u *ngIf=\"isLessResults(bundle, 'radio')\"\n              class=\"lessResults mat-typography\"\n              (click)=\"displayLessResults('radio')\">{{ 'igo.geo.filter.displayLessResults' | translate }}\n            </u>\n            <u *ngIf=\"isMoreResults(bundle, 'radio')\"\n              class=\"moreResults mat-typography\"\n              (click)=\"displayMoreResults('radio')\">{{ 'igo.geo.filter.displayMoreResults' | translate }}\n            </u>\n          </p>\n        </mat-radio-group>\n      </ng-container>\n    </div>\n\n    <div class=\"selectGroups\" *ngIf=\"selector.selectorType === 'select'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getSelectGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"selectGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentSelectGroup\">\n            <mat-option *ngFor=\"let selectorGroup of getSelectGroups()\"\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentSelectGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <div class=\"groupsSelector\">\n          <mat-button *ngIf=\"bundle.unfiltered && !bundle.multiple\"\n            mat-icon-button\n            color=\"warn\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            (click)=\"emptySelect()\">\n            <mat-icon svgIcon=\"filter-remove\"></mat-icon>\n          </mat-button>\n          <mat-form-field>\n            <div *ngIf=\"bundle.multiple; else notMulti\">\n              <mat-select\n                #selection [multiple]=\"bundle.multiple\" [placeholder]=\"bundle.title\"\n                [formControl]=\"select\" [(ngModel)]=\"enableds\">\n                <div class=\"checkboxes mat-typography\">\n                  <mat-checkbox *ngIf=\"bundle.multiple\"\n                    [(ngModel)]=\"allSelected\" [ngModelOptions]=\"{standalone: true}\"\n                    (change)=\"toggleAllSelection()\">Tous\n                  </mat-checkbox>\n                </div>\n                <mat-option *ngFor=\"let ogcSelect of bundle.selectors\"\n                  [matTooltip]=\"getToolTip(ogcSelect)\" tooltip-position=\"below\" matTooltipDelay=\"500\" matTooltipClass=\"material-tooltip\"\n                  (onSelectionChange)=\"optionClick()\"\n                  [value]=\"ogcSelect\">{{ogcSelect.title}}\n                </mat-option>\n              </mat-select>\n            </div>\n            <ng-template #notMulti>\n              <mat-select\n                [placeholder]=\"bundle.title\"\n                [formControl]=\"select\" [(ngModel)]=\"enabled\">\n                <mat-option *ngFor=\"let ogcSelect of bundle.selectors\"\n                  [matTooltip]=\"getToolTip(ogcSelect)\" tooltip-position=\"below\" matTooltipDelay=\"500\" matTooltipClass=\"material-tooltip\"\n                  [value]=\"ogcSelect\">{{ogcSelect.title}}\n                </mat-option>\n              </mat-select>\n            </ng-template>\n          </mat-form-field>\n        </div>\n      </ng-container>\n    </div>\n  </div>\n</form>\n\n<div *ngIf=\"isTemporalOperator()\">\n  <mat-divider></mat-divider>\n  <h4 *ngIf=\"!currentFilter.title\">{{ 'igo.geo.filter.reportingDate' | translate }}</h4>\n  <h4 *ngIf=\"currentFilter.title\">{{ currentFilter.title }}</h4>\n  <igo-ogc-filter-time\n    [(datasource)]=\"datasource\"\n    [(currentFilter)]=\"currentFilter\"\n    (changeProperty)=\"changeProperty($event.value, $event.pos)\">\n  </igo-ogc-filter-time>\n</div>","import {\n  Component,\n  Input,\n  OnInit,\n  ViewChild\n} from '@angular/core';\n\nimport {\n  OgcFilterableDataSource,\n  IgoOgcFilterObject,\n  OgcPushButton,\n  OgcSelectorBundle,\n  SelectorGroup\n\n} from '../../filter/shared/ogc-filter.interface';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\nimport { IgoMap } from '../../map';\nimport { OGCFilterService } from '../shared/ogc-filter.service';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { FormBuilder, FormControl, FormGroup, Validators } from '@angular/forms';\nimport { debounceTime } from 'rxjs/operators';\nimport { OgcFilterOperator } from '../shared/ogc-filter.enum';\nimport { MatSelect } from '@angular/material/select';\nimport { MatOption } from '@angular/material/core';\nimport { BehaviorSubject } from 'rxjs';\n\n@Component({\n  selector: 'igo-ogc-filter-selection',\n  templateUrl: './ogc-filter-selection.component.html',\n  styleUrls: ['./ogc-filter-selection.component.scss']\n})\nexport class OgcFilterSelectionComponent implements OnInit {\n\n  @ViewChild('selection') sel: MatSelect;\n\n  @Input() refreshFilters: () => void;\n\n  @Input() datasource: OgcFilterableDataSource;\n\n  @Input() map: IgoMap;\n\n  @Input() checkboxesIndex = 5;\n  @Input() radioButtonsIndex = 5;\n  @Input() baseIndex = 5;\n\n  @Input()\n  get currentFilter(): any {\n    return this._currentFilter;\n  }\n  set currentFilter(value) {\n    this._currentFilter = value;\n    if (this._currentFilter?.sliderOptions) {\n      this._currentFilter.sliderOptions.enabled = false; // remove slider toggle (animation temporelle)\n    }\n  }\n  private _currentFilter: any;\n\n  public ogcFilterOperator = OgcFilterOperator;\n\n  public form: FormGroup;\n  private ogcFilterWriter: OgcFilterWriter;\n  public color = 'primary';\n  public allSelected = false;\n  public select = new FormControl();\n  public enabled$ = new BehaviorSubject(undefined);\n  public enableds$ = new BehaviorSubject([]);\n\n  public applyFiltersTimeout;\n\n  get ogcFiltersSelectors() {\n    const ogcSelector = [];\n    if (this.datasource?.options?.ogcFilters?.pushButtons) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.pushButtons);\n    }\n    if (this.datasource?.options?.ogcFilters?.checkboxes) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.checkboxes);\n    }\n    if (this.datasource?.options?.ogcFilters?.radioButtons) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.radioButtons);\n    }\n    if (this.datasource?.options?.ogcFilters?.select) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.select);\n    }\n    ogcSelector.sort((a, b) => {\n      if (a.order < b.order) {\n        return -1;\n      }\n      if (a.order > b.order) {\n        return 1;\n      }\n      return 0;\n    });\n    return ogcSelector;\n  }\n\n  get currentPushButtonsGroup() {\n    return this.form.get('pushButtonsGroup').value;\n  }\n  set currentPushButtonsGroup(value) {\n    this.form.patchValue({ pushButtonsGroup: value });\n  }\n\n  get currentCheckboxesGroup() {\n    return this.form.get('checkboxesGroup').value;\n  }\n  set currentCheckboxesGroup(value) {\n    this.form.patchValue({ checkboxesGroup: value });\n  }\n\n  get currentRadioButtonsGroup() {\n    return this.form.get('radioButtonsGroup').value;\n  }\n  set currentRadioButtonsGroup(value) {\n    this.form.patchValue({ radioButtonsGroup: value });\n  }\n\n  get currentSelectGroup() {\n    return this.form.get('selectGroup').value;\n  }\n  set currentSelectGroup(value) {\n    this.form.patchValue({ selectGroup: value });\n  }\n\n  get enabled() {\n    return this.enabled$.value;\n  }\n\n  set enabled(value) {\n    this.enabled$.next(value);\n    clearTimeout(this.applyFiltersTimeout);\n    this.currentSelectGroup.computedSelectors.forEach(compSelect => {\n      compSelect.selectors.forEach(selector => {\n        value === selector ? selector.enabled = true : selector.enabled = false;\n      });\n    });\n\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  get enableds() {\n    return this.enableds$.value;\n  }\n\n  set enableds(value) {\n    this.enableds$.next(value);\n    clearTimeout(this.applyFiltersTimeout);\n    this.currentSelectGroup.computedSelectors.forEach(compSelect => {\n      compSelect.selectors.forEach(selector => {\n        value.includes(selector) ? selector.enabled = true : selector.enabled = false;\n      });\n    });\n\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  constructor(\n    private ogcFilterService: OGCFilterService,\n    private formBuilder: FormBuilder,\n  ) {\n    this.ogcFilterWriter = new OgcFilterWriter();\n    this.buildForm();\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      pushButtons: ['', [Validators.required]],\n      radioButtons: ['', [Validators.required]],\n      pushButtonsGroup: ['', [Validators.required]],\n      checkboxesGroup: ['', [Validators.required]],\n      radioButtonsGroup: ['', [Validators.required]],\n      selectGroup: ['', [Validators.required]],\n    });\n  }\n\n  getPushButtonsGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.pushButtons) {\n      return this.datasource.options.ogcFilters.pushButtons.groups;\n    }\n  }\n\n  getCheckboxesGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.checkboxes) {\n      return this.datasource.options.ogcFilters.checkboxes.groups;\n    }\n  }\n\n  getRadioButtonsGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.radioButtons) {\n      return this.datasource.options.ogcFilters.radioButtons.groups;\n    }\n  }\n\n  getSelectGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.select) {\n      return this.datasource.options.ogcFilters.select.groups;\n    }\n  }\n\n  ngOnInit() {\n    if (this.datasource.options.ogcFilters) {\n      if (this.datasource.options.ogcFilters.pushButtons) {\n        this.currentPushButtonsGroup =\n          this.datasource.options.ogcFilters.pushButtons.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.pushButtons.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.checkboxes) {\n        this.currentCheckboxesGroup =\n          this.datasource.options.ogcFilters.checkboxes.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.checkboxes.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.radioButtons) {\n        this.currentRadioButtonsGroup =\n          this.datasource.options.ogcFilters.radioButtons.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.radioButtons.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.select) {\n        this.currentSelectGroup =\n          this.datasource.options.ogcFilters.select.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.select.groups[0];\n        this.getSelectEnabled();\n      }\n      this.applyFilters();\n    }\n\n    this.form\n    .get('pushButtonsGroup')\n    .valueChanges\n    .pipe(debounceTime(750))\n    .subscribe(() => {\n      this.onPushButtonsChangeGroup();\n      this.applyFilters();\n      });\n    this.form\n    .get('checkboxesGroup')\n    .valueChanges\n    .pipe(debounceTime(750))\n    .subscribe(() => {\n      this.onCheckboxesChangeGroup();\n      this.applyFilters();\n      });\n    this.form\n      .get('radioButtonsGroup')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onRadioButtonsChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('selectGroup')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onSelectChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('pushButtons')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.applyFilters();\n      });\n    this.form\n      .get('radioButtons')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.applyFilters();\n      });\n  }\n\n  private getSelectEnabled() {\n    const enableds = [];\n    let enabled;\n    this.currentSelectGroup.computedSelectors.forEach(compSelect => {\n      if (compSelect.multiple) {\n        compSelect.selectors.forEach(selector => {\n          if (selector.enabled) {\n            enableds.push(selector);\n          }\n        });\n        this.enableds = enableds;\n      } else {\n        compSelect.selectors.forEach(selector => {\n          if (selector.enabled) {\n            enabled = selector;\n          }\n        });\n        this.enabled = enabled;\n      }\n    });\n  }\n\n  getToolTip(selector): string {\n    let toolTip;\n    if (selector.tooltip) {\n      if (Array.isArray(selector.tooltip)) {\n        toolTip = selector.tooltip.join('\\n');\n      } else {\n        toolTip = selector.tooltip;\n      }\n    }\n    return toolTip || '';\n  }\n\n  // getButtonStyle(pb: OgcPushButton): {} {\n\n  //   let styles;\n  //   if (pb.color) {\n  //     styles = {\n  //       'background-color': pb.enabled ? `rgba(${pb.color})` : `rgba(255,255,255,0)`\n  //     };\n  //   } else {\n  //     styles = {\n  //       'background-color': pb.enabled ? 'accent': `rgba(255,255,255,0)`,\n  //       'color': pb.enabled ? `rgba(0,0,0,0.9)` : `rgba(33,33,33,0.38)`\n  //     }\n  //   }\n  //   return styles;\n  // }\n\n  getButtonColor(pushButton: OgcPushButton): {} {\n    let styles;\n    if (pushButton.color && pushButton.enabled) {\n      styles = {\n        'background-color': `rgba(${pushButton.color})`\n      };\n    }\n    return styles;\n  }\n\n  bundleIsVertical(bundle: OgcSelectorBundle): boolean {\n    return bundle.vertical ? bundle.vertical : false;\n  }\n\n  private onPushButtonsChangeGroup() {\n    this.getPushButtonsGroups().map(group => group.enabled = false);\n    this.getPushButtonsGroups().find(group => group === this.currentPushButtonsGroup).enabled = true;\n  }\n\n  private onCheckboxesChangeGroup() {\n    this.getCheckboxesGroups().map(group => group.enabled = false);\n    this.getCheckboxesGroups().find(group => group === this.currentCheckboxesGroup).enabled = true;\n  }\n\n  private onRadioButtonsChangeGroup() {\n    this.getRadioButtonsGroups().map(group => group.enabled = false);\n    this.getRadioButtonsGroups().find(group => group === this.currentRadioButtonsGroup).enabled = true;\n  }\n\n  private onSelectChangeGroup() {\n    this.getSelectGroups().map(group => group.enabled = false);\n    this.getSelectGroups().find(group => group === this.currentSelectGroup).enabled = true;\n  }\n\n  onSelectionChange(currentOgcSelection?, selectorType?) {\n    clearTimeout(this.applyFiltersTimeout);\n    if (selectorType === 'radioButton') {\n      this.emptyRadioButtons();\n    }\n\n    if (currentOgcSelection) {\n      currentOgcSelection.enabled = !currentOgcSelection.enabled;\n    }\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  emptyRadioButtons() {\n    this.currentRadioButtonsGroup.computedSelectors.forEach(compSelect => {\n      compSelect.selectors.map(selector => selector.enabled = false);\n\n      this.applyFiltersTimeout = setTimeout(() => {\n        this.applyFilters();\n      }, 750);\n   });\n  }\n\n  emptySelect() {\n    this.enabled = [];\n  }\n\n  toggleAllSelection() {\n    if (this.allSelected) {\n      this.sel.options.forEach((item: MatOption) => item.select());\n    } else {\n      this.sel.options.forEach((item: MatOption) => item.deselect());\n    }\n  }\n\n  optionClick() {\n    let newStatus = true;\n    this.sel.options.forEach((item: MatOption) => {\n      if (!item.selected) {\n        newStatus = false;\n      }\n    });\n    this.allSelected = newStatus;\n  }\n\n  private applyFilters() {\n    let filterQueryString = '';\n    const conditions = [];\n    const currentGroups = [this.currentPushButtonsGroup, this.currentCheckboxesGroup,\n      this.currentRadioButtonsGroup, this.currentSelectGroup];\n    for (const currentGroup of currentGroups) {\n      if (currentGroup.computedSelectors) {\n        currentGroup.computedSelectors.map(selectorBundle => {\n          const bundleCondition = [];\n          selectorBundle.selectors\n          .filter(ogcSelector => ogcSelector.enabled === true)\n          .forEach(enabledSelector => bundleCondition.push(enabledSelector.filters));\n          if (bundleCondition.length >= 1 ) {\n            if (bundleCondition.length === 1) {\n              conditions.push(bundleCondition[0]);\n            } else {\n              conditions.push({logical: selectorBundle.logical, filters: bundleCondition});\n            }\n          }\n        });\n      }\n    }\n    if (this.isTemporalOperator() && this._currentFilter.active) {\n      conditions.push(this.datasource.options.ogcFilters.interfaceOgcFilters[0]);\n    }\n    if (conditions.length >= 1) {\n      filterQueryString = this.ogcFilterWriter\n        .buildFilter(conditions.length === 1 ?\n          conditions[0] : {logical: 'And', filters: conditions } as IgoOgcFilterObject);\n    }\n    if (this.datasource.options.type === 'wms') {\n      this.ogcFilterService.filterByOgc(this.datasource as WMSDataSource, filterQueryString );\n    }\n    if (this.datasource.options.type === 'wfs') {\n      // TODO: Check how to prevent wfs to refresh when filter icon is pushed...\n      this.datasource.ol.refresh();\n    }\n    this.datasource.setOgcFilters(this.datasource.options.ogcFilters, true);\n  }\n\n  isMoreResults(bundle, type) {\n    let selectorsLength = 0;\n    for (const selectors of bundle.selectors) {\n      selectorsLength++;\n    }\n    const index = type === 'radio' ? this.radioButtonsIndex : this.checkboxesIndex;\n    return selectorsLength > index;\n  }\n\n  displayMoreResults(type) {\n    type === 'radio' ? this.radioButtonsIndex += 5 : this.checkboxesIndex += 5;\n    return;\n  }\n\n  isLessResults(bundle, type) {\n    let selectorsLength = 0;\n    for (const selectors of bundle.selectors) {\n      selectorsLength++;\n    }\n    const index = type === 'radio' ? this.radioButtonsIndex : this.checkboxesIndex;\n    return this.baseIndex !== index && selectorsLength > this.baseIndex;\n  }\n\n  displayLessResults(type) {\n    type === 'radio' ? this.radioButtonsIndex = this.baseIndex : this.checkboxesIndex = this.baseIndex;\n    return;\n  }\n\n  isTemporalOperator() {\n    return (\n      this.currentFilter?.operator?.toLowerCase() ===\n      this.ogcFilterOperator.During.toLowerCase()\n    );\n  }\n\n  changeProperty(value: any, pos?: number, refreshFilter = true) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n        filter => filter.filterid === this.currentFilter.filterid\n      )[detectedProperty] = value;\n\n      if ( refreshFilter ) {\n        this.applyFilters();\n      }\n    }\n  }\n\n  detectProperty(pos?: number): string {\n    switch (this.currentFilter.operator) {\n      case OgcFilterOperator.PropertyIsNotEqualTo:\n      case OgcFilterOperator.PropertyIsEqualTo:\n      case OgcFilterOperator.PropertyIsGreaterThan:\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo:\n      case OgcFilterOperator.PropertyIsLessThan:\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo:\n        return 'expression';\n      case OgcFilterOperator.PropertyIsLike:\n        return 'pattern';\n      case OgcFilterOperator.PropertyIsBetween:\n        return pos && pos === 1\n          ? 'lowerBoundary'\n          : pos && pos === 2\n          ? 'upperBoundary'\n          : undefined;\n      case OgcFilterOperator.During:\n        return pos && pos === 1\n          ? 'begin'\n          : pos && pos === 2\n          ? 'end'\n          : undefined;\n      default:\n        return;\n    }\n  }\n}\n","<mat-tab-group\n  [selectedIndex]=\"selectedTypeIndex.value\"\n  (selectedIndexChange)=\"selectedTypeIndex.setValue($event)\"\n  (selectedTabChange)=\"onTypeChange($event)\">\n\n  <mat-tab [label]=\"'igo.geo.spatialFilter.predefined' |translate\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.spatialFilter.searchLabel' | translate}}</mat-label>\n      <mat-select (selectionChange)=\"onSelectionChange()\" [(value)]=\"selectedQueryType\">\n        <mat-option *ngFor=\"let queryType of queryType\" [value]=\"queryType\">\n          {{('igo.geo.terrapi.' + queryType) | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n    <igo-spatial-filter-list\n      [store]=\"store\"\n      [queryType]=\"selectedQueryType\"\n      [zone]=\"zone\"\n      [layers]=\"layers\"\n      (zoneChange)=\"zoneChange.emit($event)\"\n      (zoneWithBufferChange)=\"zoneWithBufferChange.emit($event)\"\n      (bufferChange)=\"bufferChange.emit($event)\"\n      (measureUnitChange)=\"measureUnitChange.emit($event)\">\n    </igo-spatial-filter-list>\n  </mat-tab>\n\n  <mat-tab [label]=\"'igo.geo.spatialFilter.draw' |translate\">\n    <div class=\"spatial-type-toggle\">\n      <mat-button-toggle-group\n        [value]=\"activeDrawType\"\n        (change)=\"onDrawTypeChange($event.value)\">\n        <mat-button-toggle [value]=\"spatialType.Polygon\" [matTooltip]=\"'igo.geo.spatialFilter.drawPolygon' |translate\">\n            <mat-icon svgIcon=\"pentagon-outline\"></mat-icon>\n        </mat-button-toggle>\n        <mat-button-toggle [value]=\"spatialType.Point\" [matTooltip]=\"'igo.geo.spatialFilter.drawCircle' |translate\">\n            <mat-icon svgIcon=\"record-circle-outline\"></mat-icon>\n        </mat-button-toggle>\n      </mat-button-toggle-group>\n    </div>\n  </mat-tab>\n\n</mat-tab-group>\n","import {\n  Component,\n  Input,\n  OnInit,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter\n} from '@angular/core';\nimport { SpatialFilterQueryType, SpatialFilterType } from '../../shared/spatial-filter.enum';\nimport { FormControl } from '@angular/forms';\nimport { EntityStore } from '@igo2/common';\nimport { Feature } from '../../../feature';\nimport { MeasureLengthUnit } from '../../../measure';\nimport { Layer } from '../../../layer';\n\n/**\n * Spatial Filter Type\n */\n@Component({\n  selector: 'igo-spatial-filter-type',\n  templateUrl: './spatial-filter-type.component.html',\n  styleUrls: ['./spatial-filter-type.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SpatialFilterTypeComponent implements OnInit {\n\n  @Input()\n  get store(): EntityStore<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStore<Feature>) {\n    this._store = store;\n  }\n  private _store: EntityStore<Feature>;\n\n  public queryType: string[] = ['Arrond', 'CircFed', 'CircProv', 'DirReg', 'Mun', 'MRC', 'AdmRegion', 'RegTour'];\n  public selectedTypeIndex = new FormControl(0);\n\n  /**\n   * Reference to the SpatialFIlterType enum\n   * @internal\n   */\n  public spatialType = SpatialFilterType;\n\n  public activeDrawType: SpatialFilterType = this.spatialType.Polygon;\n\n  @Input() selectedQueryType: SpatialFilterQueryType;\n\n  @Input() zone: Feature;\n\n  @Input() layers: Layer[] = [];\n\n  public type: SpatialFilterType;\n\n  @Output() eventType = new EventEmitter<SpatialFilterType>();\n\n  @Output() eventQueryType = new EventEmitter<SpatialFilterQueryType>();\n\n  @Output() zoneChange = new EventEmitter<Feature>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n\n  @Output() bufferChange = new EventEmitter<number>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  constructor() {}\n\n  ngOnInit() {\n    if (this.selectedTypeIndex.value === 0) {\n      this.type = this.spatialType.Predefined;\n    }\n    if (this.selectedTypeIndex.value === 1) {\n      this.type = this.activeDrawType;\n    }\n    this.eventType.emit(this.type);\n  }\n\n  onTypeChange(event) {\n    if (this.selectedTypeIndex.value === 0) {\n      this.type = SpatialFilterType.Predefined;\n    }\n    if (this.selectedTypeIndex.value === 1) {\n      this.type = this.activeDrawType;\n    }\n    this.eventType.emit(this.type);\n  }\n\n  onDrawTypeChange(spatialType: SpatialFilterType) {\n    this.activeDrawType = spatialType;\n    this.eventType.emit(this.activeDrawType);\n  }\n\n  onSelectionChange() {\n    this.eventQueryType.emit(this.selectedQueryType);\n    this.zoneChange.emit(undefined);\n  }\n}\n","<form class=\"form-list\">\n    <mat-form-field class=\"zone-list\">\n        <input #input type=\"text\" placeholder=\"{{'igo.geo.spatialFilter.listLabel' |translate}}\" matInput\n        [formControl]=\"formControl\" [matAutocomplete]=\"auto\">\n        <mat-autocomplete #auto=\"matAutocomplete\" (optionSelected)=\"onZoneChange($event.option.value)\"\n        [displayWith]=\"displayFn\">\n            <mat-option *ngFor=\"let entities of this.store.view.all$() | async\" [value]=\"entities\">\n                {{entities.properties.nom}}\n            </mat-option>\n        </mat-autocomplete>\n    </mat-form-field>\n<form>\n\n<div class=\"buffer-div\">\n    <form class=\"buffer-form\">\n        <mat-form-field class=\"buffer\">\n            <input type=\"number\" matInput placeholder=\"{{'igo.geo.spatialFilter.buffer' | translate}}\" [formControl]=\"bufferFormControl\"\n            [value]=\"0\" [readonly]=\"!zone\">\n        </mat-form-field>\n    </form>\n\n    <mat-form-field class=\"unit-field\">\n        <mat-select\n        [value]=\"measureUnit\"\n        (selectionChange)=\"onMeasureUnitChange($event.value)\">\n        <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n            {{('igo.geo.measure.' + measureUnit) | translate}}\n        </mat-option>\n        </mat-select>\n    </mat-form-field>\n</div>\n","import { debounceTime, distinctUntilChanged } from 'rxjs/operators';\nimport { EntityStore } from '@igo2/common';\nimport { SpatialFilterService } from './../../shared/spatial-filter.service';\nimport { SpatialFilterQueryType, SpatialFilterType } from './../../shared/spatial-filter.enum';\nimport {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter\n} from '@angular/core';\nimport { Subscription } from 'rxjs';\nimport { FormControl } from '@angular/forms';\nimport { Feature } from '../../../feature';\nimport { MeasureLengthUnit } from '../../../measure/shared';\nimport { LanguageService, MessageService } from '@igo2/core';\nimport { Layer } from '../../../layer';\n\n@Component({\n  selector: 'igo-spatial-filter-list',\n  templateUrl: './spatial-filter-list.component.html',\n  styleUrls: ['./spatial-filter-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SpatialFilterListComponent implements OnInit, OnDestroy {\n\n  @Input()\n  get store(): EntityStore<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStore<Feature>) {\n    this._store = store;\n  }\n  private _store: EntityStore<Feature>;\n\n  @Input()\n  get queryType(): SpatialFilterQueryType {\n    return this._queryType;\n  }\n  set queryType(queryType: SpatialFilterQueryType) {\n    this.formControl.setValue('');\n    this._queryType = queryType;\n  }\n  private _queryType: SpatialFilterQueryType;\n\n  @Input()\n  get zone() {\n    return this._zone;\n  }\n  set zone(value) {\n    this._zone = value;\n    if (!value) {\n      this.zoneWithBuffer = undefined;\n      this.bufferFormControl.setValue(0);\n    }\n  }\n  private _zone;\n\n  @Input() layers: Layer[] = [];\n\n  public zoneWithBuffer;\n  public selectedZone: any;\n\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n\n  public formControl = new FormControl();\n\n  public bufferFormControl = new FormControl();\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\n  }\n\n  @Output() zoneChange = new EventEmitter<Feature>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n  @Output() bufferChange = new EventEmitter<number>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  formValueChanges$$: Subscription;\n  bufferValueChanges$$: Subscription;\n\n  constructor(\n    private spatialFilterService: SpatialFilterService,\n    private messageService: MessageService,\n    private languageService: LanguageService) {}\n\n  ngOnInit() {\n    this.formValueChanges$$ = this.formControl.valueChanges.subscribe((value) => {\n      if (value.length) {\n        this.store.view.filter((feature) => {\n          const filterNormalized = value.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n          const featureNameNormalized = feature.properties.nom.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n          return featureNameNormalized.includes(filterNormalized);\n        });\n      }\n    });\n\n    this.bufferValueChanges$$ = this.bufferFormControl.valueChanges\n      .pipe(\n        debounceTime(500),\n        distinctUntilChanged()\n      )\n      .subscribe((value) => {\n        if (this.measureUnit === MeasureLengthUnit.Meters && value > 0 && value <= 100000) {\n          this.bufferChange.emit(value);\n          this.spatialFilterService.loadBufferGeometry(\n            this.selectedZone,\n            SpatialFilterType.Predefined,\n            value,\n            this.queryType\n          ).subscribe((featureGeom: Feature) => {\n            this.zoneWithBuffer = featureGeom;\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n          });\n        } else if (this.measureUnit === MeasureLengthUnit.Kilometers && value > 0 && value <= 100) {\n          this.bufferChange.emit(value);\n          this.spatialFilterService.loadBufferGeometry(\n            this.selectedZone,\n            SpatialFilterType.Predefined,\n            value * 1000,\n            this.queryType\n          ).subscribe((featureGeom: Feature) => {\n            this.zoneWithBuffer = featureGeom;\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n          });\n        } else if (value === 0 && this.layers.length > 0) {\n          this.bufferChange.emit(value);\n          this.zoneWithBufferChange.emit(this.selectedZone);\n        } else if (\n            value < 0 ||\n            (this.measureUnit === MeasureLengthUnit.Meters && value > 100000) ||\n            (this.measureUnit === MeasureLengthUnit.Kilometers && value > 100)) {\n            this.bufferFormControl.setValue(0);\n            this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.bufferAlert'),\n              this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\n        }\n    });\n  }\n\n  ngOnDestroy() {\n    this.formValueChanges$$.unsubscribe();\n  }\n\n  displayFn(feature?: Feature): string | undefined {\n    return feature ? feature.properties.nom : undefined;\n  }\n\n  onZoneChange(feature) {\n    if (feature && this.queryType) {\n      this.spatialFilterService.loadItemById(feature, this.queryType)\n      .subscribe((featureGeom: Feature) => {\n        this.selectedZone = featureGeom;\n        this.zoneChange.emit(featureGeom);\n      });\n    }\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureLengthUnit) {\n    if (unit === this.measureUnit) {\n      return;\n    } else {\n      this.measureUnit = unit;\n      this.measureUnitChange.emit(this.measureUnit);\n      this.measureUnit === MeasureLengthUnit.Meters ?\n        this.bufferFormControl.setValue(this.bufferFormControl.value * 1000) :\n        this.bufferFormControl.setValue(this.bufferFormControl.value / 1000);\n    }\n  }\n}\n","<igo-geometry-form-field-input\n  [formControl]=\"formControl\"\n  [map]=\"map\"\n  [geometryType]=\"geometryType\"\n  [drawGuide]=\"drawGuide$ | async\"\n  [measure]=\"measure\"\n  [drawControlIsActive]=\"drawControlIsActive\"\n  [freehandDrawIsActive]=\"freehandDrawIsActive\"\n  [drawStyle]=\"drawStyle$ | async\"\n  [overlayStyle]=\"overlayStyle$ | async\"\n  [radius]=\"radius\">\n</igo-geometry-form-field-input>\n\n<div class=\"header\">\n    <mat-slide-toggle *ngIf=\"!isPredefined()\"\n      [checked]=\"drawControlIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onDrawControlChange()\">\n      {{'igo.geo.spatialFilter.drawControl' | translate}}\n    </mat-slide-toggle>\n    <mat-slide-toggle *ngIf=\"!isPredefined()\"\n      [checked]=\"freehandDrawIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onfreehandControlChange()\">\n      {{'igo.geo.spatialFilter.freehandControl' | translate}}\n    </mat-slide-toggle>\n</div>\n\n<div class=\"buffer-unit\" *ngIf=\"isPolygon()\">\n  <form class=\"buffer-form\">\n    <mat-form-field class=\"buffer\">\n      <input type=\"number\" matInput placeholder=\"{{'igo.geo.spatialFilter.buffer' | translate}}\" [formControl]=\"bufferFormControl\"\n      [value]=\"0\" [readonly]=\"this.formControl.value === null\">\n    </mat-form-field>\n  </form>\n\n  <mat-form-field class=\"unit-field\">\n    <mat-select\n    [value]=\"measureUnit\"\n    (selectionChange)=\"onMeasureUnitChange($event.value)\">\n    <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n        {{('igo.geo.measure.' + measureUnit) | translate}}\n    </mat-option>\n    </mat-select>\n  </mat-form-field>\n</div>\n\n<div class=\"radius-unit\" *ngIf=\"isPoint()\">\n  <form class=\"radius-form\">\n    <mat-form-field class=\"radius\">\n      <input type=\"number\" matInput placeholder=\"{{'igo.geo.spatialFilter.radius' | translate}}\" [formControl]=\"radiusFormControl\"\n      [value]=\"1000\" (input)=\"getRadius()\" [readonly]=\"this.freehandDrawIsActive && this.formControl.value === null\">\n    </mat-form-field>\n  </form>\n\n  <mat-form-field class=\"unit-field\">\n    <mat-select\n    [value]=\"measureUnit\"\n    (selectionChange)=\"onMeasureUnitChange($event.value)\">\n    <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n        {{('igo.geo.measure.' + measureUnit) | translate}}\n    </mat-option>\n    </mat-select>\n  </mat-form-field>\n</div>\n\n<mat-label class=\"title mat-typography\">{{'igo.geo.spatialFilter.search' | translate}} : </mat-label>\n<mat-radio-group [value]=\"selectedItemType\">\n    <mat-radio-button *ngFor=\"let item of itemType\"\n      [value]=\"item\"\n      (change)=\"onItemTypeChange($event)\">\n      {{'igo.geo.spatialFilter.' + item | translate}}\n    </mat-radio-button>\n</mat-radio-group>\n\n<div class=\"thematics\" *ngIf=\"(selectedItemType==='Thematics' && !tableTemplate) || (selectedItemType==='Thematics' && tableTemplate && !listIsVisible)\">\n  <mat-table>\n      <!-- Name Column -->\n      <ng-container matColumnDef=\"name\">\n        <mat-header-cell *matHeaderCellDef class=\"thematics-header\">{{'igo.geo.spatialFilter.Thematics' | translate}}</mat-header-cell>\n      </ng-container>\n\n      <!-- Select Column -->\n      <ng-container matColumnDef=\"select\">\n        <mat-header-cell *matHeaderCellDef class=\"checks-header\">\n          <mat-checkbox (change)=\"$event ? masterToggle() : null\"\n                        [checked]=\"isAllSelected()\"\n                        [indeterminate]=\"selectedThematics.hasValue() && !isAllSelected()\">\n          </mat-checkbox>\n        </mat-header-cell>\n    </ng-container>\n\n    <mat-header-row *matHeaderRowDef=\"displayedColumns\"></mat-header-row>\n    <mat-row *matRowDef=\"let row; columns: displayedColumns;\"></mat-row>\n\n  </mat-table>\n\n  <mat-tree [dataSource]=\"dataSource\" [treeControl]=\"treeControl\">\n    <!-- This is the tree node template for leaf nodes -->\n    <mat-tree-node *matTreeNodeDef=\"let node\" matTreeNodeToggle>\n      <li class=\"mat-tree-node\">\n        <!-- use a disabled button to provide padding for tree leaf -->\n        <button mat-icon-button disabled></button>\n        {{node.name}}\n        <mat-checkbox class=\"tree-check\" (click)=\"$event.stopPropagation()\"\n                      (change)=\"$event ? onToggleChange(node) : null\"\n                      [checked]=\"selectedThematics.isSelected(node)\">\n        </mat-checkbox>\n      </li>\n    </mat-tree-node>\n\n    <!-- This is the tree node template for expandable nodes -->\n    <mat-nested-tree-node *matTreeNodeDef=\"let node; when: hasChild\">\n        <div class=\"mat-tree-node\">\n          <button mat-icon-button\n            (click)=\"onToggleClick(node)\">\n            <mat-icon [svgIcon]=\"treeControl.isExpanded(node) ? 'chevron-down' : 'chevron-right'\"></mat-icon>\n          </button>\n          {{node.name}}\n          <mat-checkbox class=\"tree-check-2\" (change)=\"$event ? childrensToggle(node) : null\"\n                        [checked]=\"isAllSelected(node)\"\n                        [indeterminate]=\"hasChildrenSelected(node) && !isAllSelected(node)\">\n          </mat-checkbox>\n        </div>\n        <ul class=\"tree-ul\" [class.example-tree-invisible]=\"!treeControl.isExpanded(node)\">\n          <ng-container matTreeNodeOutlet></ng-container>\n        </ul>\n    </mat-nested-tree-node>\n\n  </mat-tree>\n</div>\n\n<div class=\"buttons\">\n\n  <button *ngIf=\"isPredefined()\" mat-raised-button class=\"clear-search-button\" [disabled]=\"disabledClearSearch()\"\n    (click)=\"clearSearch()\">\n      {{'igo.geo.spatialFilter.clearSearch' | translate}}\n  </button>\n\n  <button *ngIf=\"isPolygon() || isPoint()\" mat-raised-button class=\"clear-form-button\" [disabled]=\"this.formControl.value === null\"\n    (click)=\"clearDrawZone()\">\n    {{'igo.geo.spatialFilter.clearForm' | translate}}\n  </button>\n\n  <button mat-raised-button class=\"search-button\" [disabled]=\"disableSearchButton()\" color=\"primary\"\n    (click)=\"toggleSearchButton()\">\n    {{'igo.geo.spatialFilter.goSearch' | translate}}\n  </button>\n\n  <button mat-raised-button class=\"remove-button\" [disabled]=\"allLayers.length === 0\" (click)=\"clearButton()\">\n    {{'igo.geo.spatialFilter.removeLayer' | translate}}\n  </button>\n\n  <button mat-raised-button class=\"export-button\" [disabled]=\"!store.entities$.getValue().length\" (click)=\"export.emit()\">\n    {{'igo.geo.spatialFilter.exportLayer' | translate}}\n  </button>\n\n</div>\n\n<button\n  class=\"chevron-down\"\n  *ngIf=\"store.all().length && tableTemplate && !listIsVisible\"\n  mat-icon-button\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.spatialFilter.showSearchResults' | translate\"\n  (click)=\"toggleVisibleList()\">\n  <mat-icon svgIcon=\"chevron-down\"></mat-icon>\n</button>\n\n<div class=\"results\" *ngIf=\"store.all().length && tableTemplate && listIsVisible\">\n  <button\n    *ngIf=\"listIsVisible\"\n    mat-icon-button\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.spatialFilter.hideSearchResults' | translate\"\n    (click)=\"toggleVisibleList()\">\n  <mat-icon svgIcon=\"chevron-up\"></mat-icon>\n  </button>\n  <igo-entity-table\n    class=\"results-list\"\n    [template]=\"tableTemplate\"\n    [store]=\"store\"\n    (entitySelectChange)=\"entityChange.emit($event)\">\n  </igo-entity-table>\n</div>\n","import OlFeature from 'ol/Feature';\nimport {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { SpatialFilterQueryType, SpatialFilterType } from '../../shared/spatial-filter.enum';\nimport { SelectionModel } from '@angular/cdk/collections';\nimport { IgoMap } from '../../../map';\nimport { SpatialFilterItemType } from './../../shared/spatial-filter.enum';\nimport { Feature } from './../../../feature/shared/feature.interfaces';\nimport { FormControl } from '@angular/forms';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport type { default as OlGeometryType } from 'ol/geom/GeometryType';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { GeoJSONGeometry } from '../../../geometry/shared/geometry.interfaces';\nimport * as olStyle from 'ol/style';\nimport * as olproj from 'ol/proj';\nimport OlPoint from 'ol/geom/Point';\nimport { MatTreeNestedDataSource } from '@angular/material/tree';\nimport { SpatialFilterService } from '../../shared/spatial-filter.service';\nimport { MeasureLengthUnit } from '../../../measure';\nimport { EntityStore, EntityStoreFilterSelectionStrategy, EntityTableColumnRenderer, EntityTableTemplate } from '@igo2/common';\nimport { Layer, VectorLayer } from '../../../layer/shared';\nimport { NestedTreeControl } from '@angular/cdk/tree';\nimport { SpatialFilterThematic } from './../../shared/spatial-filter.interface';\nimport { MessageService, LanguageService } from '@igo2/core';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { FeatureMotion, FeatureStoreSelectionStrategy } from '../../../feature';\nimport { FeatureDataSource } from '../../../datasource/shared';\n\n/**\n * Spatial-Filter-Item (search parameters)\n */\n@Component({\n  selector: 'igo-spatial-filter-item',\n  templateUrl: './spatial-filter-item.component.html',\n  styleUrls: ['./spatial-filter-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SpatialFilterItemComponent implements OnDestroy, OnInit {\n\n  @Input() map: IgoMap;\n\n  @Input()\n  get type(): SpatialFilterType {\n    return this._type;\n  }\n  set type(type: SpatialFilterType) {\n    this._type = type;\n    const index = this.geometryTypes.findIndex(geom => geom === this.type);\n    this.geometryType = this.geometryTypes[index];\n    this.formControl.reset();\n    this.radius = undefined;\n    this.drawGuide$.next(null);\n    this.drawStyle$.next(undefined);\n\n    // Necessary to keep reference to the geometry form field input\n    if (this.type === SpatialFilterType.Predefined) {\n      const geojson: GeoJSONGeometry = {\n        type: 'Point',\n        coordinates: ''\n      };\n      this.formControl.setValue(geojson);\n    }\n\n    // Necessary to apply the right style when geometry type is Point\n    if (this.type === SpatialFilterType.Point) {\n      this.radius = 1000; // Base radius\n      this.radiusFormControl.setValue(this.radius);\n      this.PointStyle = (feature: OlFeature<OlGeometry>, resolution: number) => {\n        const geom = feature.getGeometry() as OlPoint;\n        const coordinates = olproj.transform(geom.getCoordinates(), this.map.projection, 'EPSG:4326');\n        return new olStyle.Style ({\n          image: new olStyle.Circle ({\n            radius: this.radius / (Math.cos((Math.PI / 180) * coordinates[1])) / resolution, // Latitude correction\n            stroke: new olStyle.Stroke({\n              width: 2,\n              color: 'rgba(0, 153, 255)'\n            }),\n            fill: new olStyle.Fill({\n              color: 'rgba(0, 153, 255, 0.2)'\n            })\n          })\n        });\n      };\n      this.overlayStyle = this.PointStyle;\n      this.drawStyle$.next(this.overlayStyle);\n    } else {\n      // If geometry types is Polygon\n      this.radius = undefined;\n      this.PolyStyle = () => {\n        return new olStyle.Style ({\n          stroke: new olStyle.Stroke({\n            width: 2,\n            color: 'rgba(0, 153, 255)'\n          }),\n          fill: new olStyle.Fill({\n            color: 'rgba(0, 153, 255, 0.2)'\n          })\n        });\n      };\n      const color = [0, 153, 255];\n      const drawStyle = () => {\n        return new olStyle.Style({\n          image: new olStyle.Circle ({\n            radius: 8,\n            stroke: new olStyle.Stroke({\n              width: 2,\n              color: 'rgba(0, 153, 255)'\n            }),\n            fill: new olStyle.Fill({\n              color: 'rgba(0, 153, 255, 0.2)'\n            })\n          }),\n          stroke: new olStyle.Stroke({\n            color: color.concat([1]),\n            width: 2\n          }),\n          fill:  new olStyle.Fill({\n            color: color.concat([0.2])\n          })\n        });\n      };\n      this.overlayStyle = this.PolyStyle;\n      this.drawStyle$.next(drawStyle);\n    }\n    this.overlayStyle$.next(this.overlayStyle);\n  }\n  private _type: SpatialFilterType;\n\n  @Input() queryType: SpatialFilterQueryType;\n\n  @Input() zone: Feature;\n\n  @Input() loading;\n\n  @Input()\n  get store(): EntityStore<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStore<Feature>) {\n    this._store = store;\n    this._store.entities$.subscribe(() => { this.cdRef.detectChanges(); });\n  }\n  private _store: EntityStore<Feature>;\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\n  }\n\n  @Input() layers: Layer[] = [];\n\n  @Input() allLayers: Layer[] = [];\n\n  @Input()\n  get thematicLength(): number {\n    return this._thematicLength;\n  }\n  set thematicLength(value: number) {\n    this._thematicLength = value;\n  }\n  private _thematicLength: number;\n\n  @Output() toggleSearch = new EventEmitter();\n\n  @Output() itemTypeChange = new EventEmitter<SpatialFilterItemType>();\n\n  @Output() thematicChange = new EventEmitter<SpatialFilterThematic[]>();\n\n  @Output() drawZoneEvent = new EventEmitter<Feature>();\n\n  @Output() bufferEvent = new EventEmitter<number>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  @Output() radiusEvent = new EventEmitter<number>();\n  @Output() freehandControl = new EventEmitter<boolean>();\n\n  @Output() clearButtonEvent = new EventEmitter();\n\n  @Output() clearSearchEvent = new EventEmitter();\n\n  @Output() export = new EventEmitter();\n\n  @Output() openWorkspace = new EventEmitter();\n  @Output() entityChange = new EventEmitter<any>();\n\n  public itemType: SpatialFilterItemType[] = [SpatialFilterItemType.Address, SpatialFilterItemType.Thematics];\n  public selectedItemType: SpatialFilterItemType = SpatialFilterItemType.Address;\n  public selectedSourceAddress;\n\n  treeControl: NestedTreeControl<SpatialFilterThematic> = new NestedTreeControl<SpatialFilterThematic>(node => node.children);\n\n  // For thematics and results tables\n  public displayedColumns: string[] = ['name', 'select'];\n  public childrens: SpatialFilterThematic[] = [];\n  public groups: string[] = [];\n  public thematics: SpatialFilterThematic[] = [];\n  public dataSource = new MatTreeNestedDataSource<SpatialFilterThematic>();\n  public selectedThematics = new SelectionModel<SpatialFilterThematic>(true, []);\n\n  // For geometry form field input\n  value$: BehaviorSubject<GeoJSONGeometry> = new BehaviorSubject(undefined);\n  drawGuide$: BehaviorSubject<number> = new BehaviorSubject(null);\n  overlayStyle$: BehaviorSubject<olStyle.Style | ((feature, resolution) => olStyle.Style)> = new BehaviorSubject(undefined);\n  drawStyle$: BehaviorSubject<olStyle.Style | ((feature, resolution) => olStyle.Style)> = new BehaviorSubject(undefined);\n\n  private value$$: Subscription;\n  private radiusChanges$$: Subscription;\n  private bufferChanges$$: Subscription;\n\n  public formControl = new FormControl();\n  public geometryType: typeof OlGeometryType | string;\n  public geometryTypeField = false;\n  public geometryTypes: string[] = ['Point', 'Polygon'];\n  public drawGuideField = false;\n  public drawGuide: number = null;\n  public drawGuidePlaceholder = '';\n  public measure = false;\n  public drawControlIsActive = true;\n  public freehandDrawIsActive = false;\n  public drawStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public drawZone;\n  public overlayStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public PointStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public PolyStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n\n  public radius: number;\n  public buffer: number = 0;\n  public radiusFormControl = new FormControl();\n  public bufferFormControl = new FormControl();\n\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n  public zoneWithBuffer;\n\n  public listIsVisible = true;\n  public tableTemplate: EntityTableTemplate;\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private spatialFilterService: SpatialFilterService,\n    private messageService: MessageService,\n    private languageService: LanguageService) {}\n\n  ngOnInit() {\n    this.spatialFilterService.loadThematicsList()\n    .subscribe((items: SpatialFilterThematic[]) => {\n      for (const item of items) {\n        this.childrens.push(item);\n        this.childrens.sort((a, b) => {\n          return a.name.localeCompare(b.name);\n        });\n      }\n      this.groups.push(this.languageService.translate.instant('igo.geo.terrapi.limites'));\n      const limits: SpatialFilterThematic = {\n        name: this.groups[0],\n        children: []\n      };\n      this.thematics.push(limits);\n      this.childrens.forEach(child => {\n        if (child.group && (this.groups.indexOf(child.group) === -1)) {\n          this.groups.push(child.group);\n          const thematic: SpatialFilterThematic = {\n            name: child.group,\n            children: []\n          };\n          this.thematics.push(thematic);\n        }\n\n        if (!child.group) {\n          if (\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.AdmRegion') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.Mun') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.Arrond') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.CircFed') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.CircProv') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.DirReg') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.MRC') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.RegTour')) {\n              child.group = limits.name;\n          } else if (child.name === this.languageService.translate.instant('igo.geo.terrapi.routes')) {\n            child.group = this.languageService.translate.instant('igo.geo.spatialFilter.group.transport');\n          } else {\n            const thematic: SpatialFilterThematic = {\n              name: child.name,\n              children: [],\n              source: child.source\n            };\n            this.thematics.push(thematic);\n          }\n        }\n        this.thematics.sort((a, b) => {\n          return a.name.localeCompare(b.name);\n        });\n      });\n      this.thematics.forEach(thematic => {\n        for (const child of this.childrens) {\n          if (child.group === thematic.name) {\n            thematic.children.push(child);\n          }\n        }\n      });\n    });\n\n    this.dataSource.data = this.thematics;\n\n    this.drawGuide$.next(null);\n    this.value$.next(this.formControl.value ? this.formControl.value : undefined);\n    this.value$$ = this.formControl.valueChanges.subscribe((value: GeoJSONGeometry) => {\n      if (value) {\n        this.value$.next(value);\n        this.drawZone = this.formControl.value as Feature;\n        if (this.buffer !== 0) {\n          this.drawZoneEvent.emit(this.drawZone);\n          this.bufferFormControl.setValue(this.buffer);\n        }\n      } else {\n        this.value$.next(undefined);\n        this.drawZone = undefined;\n      }\n    });\n\n    this.value$.subscribe(() => {\n      this.getRadius();\n      this.cdRef.detectChanges();\n    });\n\n    this.radiusChanges$$ = this.radiusFormControl.valueChanges.subscribe(() => {\n      this.getRadius();\n      this.cdRef.detectChanges();\n    });\n\n    this.bufferChanges$$ = this.bufferFormControl.valueChanges\n      .pipe(\n        debounceTime(500)\n      )\n      .subscribe((value) => {\n        if (this.measureUnit === MeasureLengthUnit.Meters && value > 0 && value <= 100000) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.spatialFilterService.loadBufferGeometry(\n            this.drawZone,\n            SpatialFilterType.Polygon,\n            value\n          ).subscribe((featureGeom: Feature) => {\n            this.zoneWithBuffer = featureGeom;\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n          });\n        } else if (this.measureUnit === MeasureLengthUnit.Kilometers && value > 0 && value <= 100) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.spatialFilterService.loadBufferGeometry(\n            this.drawZone,\n            SpatialFilterType.Polygon,\n            value * 1000\n          ).subscribe((featureGeom: Feature) => {\n            this.zoneWithBuffer = featureGeom;\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n          });\n        } else if (value === 0) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.drawZoneEvent.emit(this.drawZone);\n        } else if (\n          value < 0 ||\n          (this.measureUnit === MeasureLengthUnit.Meters && value > 100000) ||\n          (this.measureUnit === MeasureLengthUnit.Kilometers && value > 100)) {\n            this.bufferFormControl.setValue(0);\n            this.buffer = 0;\n            this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.bufferAlert'),\n              this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\n        }\n    });\n\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: undefined,\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map: this.map,\n      hitTolerance: 15,\n      motion: FeatureMotion.Default,\n      many: true,\n      dragBox: true\n    });\n\n    this.store.addStrategy(selectionStrategy, true);\n    this.store.addStrategy(selectedRecordStrategy, false);\n  }\n\n  /**\n   * Unsubscribe to the value stream\n   * @internal\n   */\n  ngOnDestroy() {\n    this.value$$.unsubscribe();\n    this.radiusChanges$$.unsubscribe();\n    this.bufferChanges$$.unsubscribe();\n    this.cdRef.detach();\n    if (this.radiusChanges$$) {\n      this.radiusChanges$$.unsubscribe();\n    }\n    if (this.value$$) {\n      this.value$$.unsubscribe();\n    }\n  }\n\n  onItemTypeChange(event) {\n    this.selectedItemType = event.value;\n    this.itemTypeChange.emit(this.selectedItemType);\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureLengthUnit) {\n    if (unit === this.measureUnit) {\n      return;\n    } else {\n      this.measureUnit = unit;\n      this.measureUnitChange.emit(this.measureUnit);\n      if (this.isPolygon()) {\n        this.measureUnit === MeasureLengthUnit.Meters ?\n          this.bufferFormControl.setValue(this.bufferFormControl.value * 1000) :\n          this.bufferFormControl.setValue(this.bufferFormControl.value / 1000);\n      } else if (this.isPoint()) {\n        this.measureUnit === MeasureLengthUnit.Meters ?\n          this.radiusFormControl.setValue(this.radiusFormControl.value * 1000) :\n          this.radiusFormControl.setValue(this.radiusFormControl.value / 1000);\n      }\n    }\n  }\n\n  isPredefined() {\n    return this.type === SpatialFilterType.Predefined;\n  }\n\n  isPolygon() {\n    return this.type === SpatialFilterType.Polygon;\n  }\n\n  isPoint() {\n    return this.type === SpatialFilterType.Point;\n  }\n\n  hasChild(_: number, node: SpatialFilterThematic) {\n    if (node.children) {\n      return node.children.length;\n    }\n    return false;\n  }\n\n  onToggleClick(node: SpatialFilterThematic) {\n    this.treeControl.isExpanded(node) ? this.treeControl.collapse(node) : this.treeControl.expand(node);\n  }\n\n  isAllSelected(node?: SpatialFilterThematic) {\n    let numSelected;\n    let numNodes = 0;\n    if (!node) {\n      numSelected = this.selectedThematics.selected.length;\n      this.thematics.forEach(thematic => {\n        if (this.groups.indexOf(thematic.name) === -1) {\n          numNodes++;\n        }\n      });\n      this.childrens.forEach(children => {\n        if (!this.thematics.find(thematic => thematic.source === children.source)) {\n          numNodes++;\n        }\n      });\n    } else {\n      numSelected = node.children.length;\n      node.children.forEach(children => {\n        if (this.selectedThematics.selected.find(thematic => thematic === children)) {\n          numNodes++;\n        }\n      });\n    }\n\n    if (numNodes >= 1) {\n      return numSelected === numNodes;\n    } else {\n      return false;\n    }\n  }\n\n  hasChildrenSelected(node: SpatialFilterThematic) {\n    let bool = false;\n    node.children.forEach(child => {\n      if (this.selectedThematics.selected.find(thematic => thematic.source === child.source)) {\n        bool = true;\n      }\n    });\n    return bool;\n  }\n\n  /**\n   * Apply header checkbox\n   */\n  masterToggle() {\n    this.isAllSelected() ?\n      this.selectedThematics.clear() :\n      this.selectAll();\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n\n    if (this.isAllSelected()) {\n      this.thematics.forEach(thematic => {\n        if (this.hasChild(0, thematic)) {\n          this.treeControl.expand(thematic);\n        }\n      });\n    } else {\n      this.thematics.forEach(thematic => {\n        if (this.hasChild(0, thematic)) {\n          this.treeControl.collapse(thematic);\n        }\n      });\n    }\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  selectAll(node?: SpatialFilterThematic) {\n    if (!node) {\n      this.thematics.forEach(thematic => {\n        if (this.groups.indexOf(thematic.name) === -1) {\n          this.selectedThematics.select(thematic);\n        }\n      });\n      this.childrens.forEach(children => {\n        if (!this.selectedThematics.selected.find(thematic => thematic.source === children.source)) {\n          this.selectedThematics.select(children);\n        }\n      });\n    } else {\n      if (this.hasChild(0, node)) {\n        node.children.forEach(children => this.selectedThematics.select(children));\n      }\n    }\n  }\n\n  childrensToggle(node: SpatialFilterThematic) {\n    this.isAllSelected(node) ?\n    node.children.forEach(child => this.selectedThematics.deselect(child)) :\n    this.selectAll(node);\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n    this.treeControl.expand(node);\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  /**\n   * Apply changes to the thematics selected tree and emit event\n   */\n  onToggleChange(nodeSelected: SpatialFilterThematic) {\n    let selected = false;\n    if (this.selectedThematics.selected.find(thematic => thematic.source === nodeSelected.source) !== undefined) {\n      selected = true;\n    }\n\n    this.childrens.forEach(children => {\n      if (children === nodeSelected && selected === false) {\n        this.selectedThematics.select(children);\n      }\n      if (children === nodeSelected && selected === true) {\n        this.selectedThematics.deselect(children);\n      }\n    });\n    this.thematics.forEach(thematic => {\n      if (thematic === nodeSelected && selected === false) {\n        this.selectedThematics.select(thematic);\n      }\n      if (thematic === nodeSelected && selected === true) {\n        this.selectedThematics.deselect(thematic);\n      }\n    });\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  onDrawControlChange() {\n    this.drawControlIsActive = !this.drawControlIsActive;\n  }\n\n  onfreehandControlChange() {\n    this.freehandDrawIsActive = !this.freehandDrawIsActive;\n    this.freehandControl.emit(this.freehandDrawIsActive);\n  }\n\n  /**\n   * Launch search button\n   */\n  toggleSearchButton() {\n    if (!this.isPredefined()) {\n      if (this.buffer > 0) {\n        this.zoneWithBuffer.meta = {\n          id: undefined,\n          title: 'Zone'\n        };\n        this.zoneWithBuffer.properties = {\n          nom: 'Zone',\n          type: this.type as string\n        };\n        this.drawZoneEvent.emit(this.zoneWithBuffer);\n      } else {\n        this.drawZone.meta = {\n          id: undefined,\n          title: 'Zone'\n        };\n        this.drawZone.properties = {\n          nom: 'Zone',\n          type: this.type as string\n        };\n        this.drawZoneEvent.emit(this.drawZone);\n      }\n    }\n    if (this.isPoint()) {\n      this.radiusEvent.emit(this.radius);\n    } else if (this.isPolygon()) {\n      this.bufferEvent.emit(this.buffer);\n    }\n    this.toggleSearch.emit();\n    this.store.entities$.pipe(\n      debounceTime(500)\n    ).subscribe((value) => {\n      if (value.length && this.layers.length === this.thematicLength + 1) {\n        this.openWorkspace.emit();\n        this.createTableTemplate();\n      }\n    });\n  }\n\n  /**\n   * Launch clear button (clear store and map layers)\n   */\n  clearButton() {\n    this.loading = true;\n    if (this.store) {\n      this.store.clear();\n    }\n    if (this.isPoint() || this.isPolygon()) {\n      this.drawZone = undefined;\n      this.formControl.reset();\n    }\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n    this.bufferEvent.emit(0);\n    this.clearButtonEvent.emit();\n    this.loading = false;\n    this.tableTemplate = undefined;\n  }\n\n  clearDrawZone() {\n    this.formControl.reset();\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n  }\n\n  /**\n   * Launch clear search (clear field if type is predefined)\n   */\n  clearSearch() {\n    this.selectedThematics.clear();\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n    this.bufferEvent.emit(0);\n    this.thematicChange.emit([]);\n    this.clearSearchEvent.emit();\n  }\n\n  /**\n   * Verify conditions of incomplete fields or busy service\n   */\n  disableSearchButton(): boolean {\n    if (this.type === SpatialFilterType.Predefined) {\n      if (this.selectedItemType === SpatialFilterItemType.Address) {\n        if (this.queryType !== undefined && this.zone !== undefined) {\n          return this.loading;\n        }\n      }\n      if (this.selectedItemType === SpatialFilterItemType.Thematics) {\n        if (this.queryType !== undefined && this.zone !== undefined && this.selectedThematics.selected.length > 0) {\n          return this.loading;\n        }\n      }\n    }\n    if (this.type === SpatialFilterType.Polygon || this.type === SpatialFilterType.Point) {\n      if (this.selectedItemType === SpatialFilterItemType.Address && this.formControl.value !== null) {\n        return this.loading;\n      }\n      if (this.selectedItemType === SpatialFilterItemType.Thematics) {\n        if (this.selectedThematics.selected.length > 0 && this.formControl.value !== null) {\n          return this.loading;\n        }\n      }\n    }\n    return true;\n  }\n\n  disabledClearSearch() {\n    let disable = true;\n    this.selectedItemType === SpatialFilterItemType.Address ?\n      disable = this.queryType === undefined :\n      disable = this.queryType === undefined && this.selectedThematics.selected.length === 0;\n\n    return disable;\n  }\n\n  /**\n   * Manage radius value at user change\n   */\n  getRadius() {\n    let formValue;\n    if (this.formControl.value !== null) {\n      this.measureUnit === MeasureLengthUnit.Meters ?\n        formValue = this.formControl.value.radius :\n        formValue = this.formControl.value.radius / 1000;\n    } else {\n      formValue = undefined;\n    }\n\n    if (this.type === SpatialFilterType.Point) {\n      if (!this.freehandDrawIsActive) {\n        if (\n          this.radiusFormControl.value < 0 ||\n          (this.measureUnit === MeasureLengthUnit.Meters && this.radiusFormControl.value >= 100000) ||\n          (this.measureUnit === MeasureLengthUnit.Kilometers && this.radiusFormControl.value >= 100)) {\n          this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.radiusAlert'),\n            this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\n          this.radius = 1000;\n          this.measureUnit === MeasureLengthUnit.Meters ?\n            this.radiusFormControl.setValue(this.radius) :\n            this.radiusFormControl.setValue(this.radius / 1000);\n          this.drawGuide$.next(this.radius);\n          return;\n        }\n      } else {\n        if (formValue) {\n          if (formValue >= 100000) {\n            this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.radiusAlert'),\n              this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\n            this.formControl.reset();\n            return;\n          }\n          if (formValue !== this.radiusFormControl.value) {\n            this.radiusFormControl.setValue(formValue);\n            return;\n          }\n        }\n      }\n      if (this.measureUnit === MeasureLengthUnit.Meters) {\n        this.radius = this.radiusFormControl.value;\n        this.drawGuide$.next(this.radius);\n      } else {\n        this.radius = this.radiusFormControl.value * 1000;\n        this.drawGuide$.next(this.radius * 1000);\n      }\n      this.overlayStyle$.next(this.PointStyle);\n      this.drawStyle$.next(this.PointStyle);\n    }\n  }\n\n  toggleVisibleList() {\n    this.listIsVisible = !this.listIsVisible;\n  }\n\n  private createTableTemplate() {\n    const typeColumn = {\n      name: 'meta.title',\n      title: this.languageService.translate.instant('igo.geo.spatialFilter.type'),\n      renderer: EntityTableColumnRenderer.UnsanitizedHTML\n    };\n    const nameColumn = {\n      name: 'properties.nom',\n      title: this.languageService.translate.instant('igo.geo.spatialFilter.searchResults'),\n      renderer: EntityTableColumnRenderer.UnsanitizedHTML\n    };\n    const columns = [typeColumn, nameColumn];\n\n    this.tableTemplate = {\n      selection: true,\n      sort: true,\n      columns\n    };\n  }\n}\n","<div class=\"datetime-container\">\n  <mat-slide-toggle \n    *ngIf=\"this.currentFilter.sliderOptions?.enabled\"\n    [(ngModel)]=\"sliderMode\"\n    (change)=\"modeChange($event)\">\n    {{'igo.geo.filter.sliderModeTitle' | translate}}\n  </mat-slide-toggle>\n\n  <div class=\"slider-container\" *ngIf=\"sliderMode\">\n    <igo-ogc-filter-time-slider\n      [begin]=\"beginValue\"\n      [max]=\"this.restrictedToStep() ? this.maxDate : this.endValue\"\n      [currentFilter]=\"currentFilter\" \n      [datasource]=\"datasource\"\n      (changeProperty)=\"changePropertyByPass($event)\"\n    >\n    </igo-ogc-filter-time-slider>\n    \n  </div>\n\n  <div *ngIf=\"!sliderMode\">\n\n    <div class=\"year-input-container\" *ngIf=\"calendarTypeYear\">\n      <!-- to emulate a year-picker, 2 input: first input to show user just year and second input hiden and bind \n        with the datepicker  -->\n      <mat-form-field  class=\"year-input\">\n        <mat-label>{{'igo.geo.timeFilter.startYear'| translate}}</mat-label>\n        <input\n          matInput\n          class=\"year-input-only-year\"\n          value=\"{{onlyYearBegin}}\"\n          (change)= \"yearOnlyInputChange($event, beginDatepicker, 'begin')\"\n          [disabled]= \"filterStateDisable\"\n          >\n        <mat-datepicker-toggle matSuffix [for]=\"beginDatepicker\" [disabled]=\"filterStateDisable\"></mat-datepicker-toggle>\n  \n        <mat-datepicker\n          panelClass=\"datepicker-year\"\n          #beginDatepicker\n          [startView]=\"calendarView()\"\n          [startAt]=\"beginValue\"\n          (yearSelected)=\"yearSelected($event, beginDatepicker, 'begin')\"\n          >\n        </mat-datepicker>\n\n        <input #beginYear\n          class= \"year-input-hide\"\n          matInput\n          [matDatepicker]=\"beginDatepicker\"\n          enabled= false\n          readonly= true\n          [value]=\"beginValue?beginValue:handleDate(datasource.options.minDate)\"\n          [min]=\"handleDate(datasource.options.minDate)\"\n          [max]=\"(endValue && (!restrictedToStep()))?endValue:handleDate(datasource.options.maxDate)\"\n          >\n      </mat-form-field>\n\n      <mat-form-field  class=\"year-input\">\n        <mat-label>{{'igo.geo.timeFilter.endYear'| translate}}</mat-label>\n        <input\n          matInput\n          class=\"year-input-only-year\"\n          value=\"{{onlyYearEnd}}\"\n          (change)= \"yearOnlyInputChange($event, endDatepicker, 'end')\"\n          [disabled] = \"filterStateDisable\">\n        <mat-datepicker-toggle matSuffix [for]=\"endDatepicker\" [disabled]=\"filterStateDisable\"></mat-datepicker-toggle>\n        <mat-datepicker\n          panelClass=\"datepicker-year\"\n          #endDatepicker\n          [startView]=\"calendarView()\"\n          [startAt]=\"endValue\"\n          (yearSelected)=\"yearSelected($event, endDatepicker, 'end')\"\n          >\n        </mat-datepicker>\n\n        <input #endYear\n          class= \"year-input-hide\"\n          matInput\n          [matDatepicker]=\"endDatepicker\"\n          enabled= false\n          readonly= true\n          [value]=\"endValue?endValue:handleDate(datasource.options.maxDate)\"\n          [min]=\"beginValue?beginValue:handleDate(datasource.options.minDate)\"\n          [max]=\"handleDate(datasource.options.maxDate)\"\n          >\n      </mat-form-field>\n      <button class=\"reset-button\" \n        mat-icon-button\n        color=\"primary\" \n        (click)=\"resetFilter()\" \n        [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" \n        [disabled]= \"filterStateDisable\">\n        <mat-icon svgIcon=\"{{resetIcon}}\"></mat-icon>\n      </button>\n      <mat-slide-toggle \n        class='toggle-filter-state' \n        (change)=\"toggleFilterState()\" \n        [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\" \n        tooltip-position=\"below\" \n        matTooltipShowDelay=\"500\"\n        [checked]=\"!filterStateDisable\">\n      </mat-slide-toggle>\n\n    </div>\n\n    <div class=\"datetime-input-container\" *ngIf=\"calendarType()!=='year'\">\n      <div class=\"datetime-input\">\n        <mat-form-field class=\"date-input\">\n          <mat-datepicker-toggle matSuffix [for]=\"beginDatepicker\" [disabled]= \"filterStateDisable\"></mat-datepicker-toggle>\n          <input #begin\n            matInput\n            [matDatepicker]=\"beginDatepicker\"\n            [placeholder]=\"'igo.geo.timeFilter.startDate' | translate\"\n            [attr.disabled]=\"!currentFilter.active\"\n            (dateChange)=\"changeTemporalProperty(begin.value, 1)\"\n            [matDatepickerFilter]=\"dateFilter.bind(this, 'begin')\"\n            [value]=\"beginValue?beginValue:handleDate(datasource.options.minDate)\"\n            [min]=\"handleDate(datasource.options.minDate)\"\n            [max]=\"(endValue && (!restrictedToStep()))?endValue:handleDate(datasource.options.maxDate)\" \n            [disabled]= \"filterStateDisable\">\n          <span class=\"filler\"></span>\n          <mat-datepicker\n            #beginDatepicker\n            [startView]=\"calendarView()\"\n            [startAt]=\"beginValue\"\n            (yearSelected)=\"yearSelected($event, beginDatepicker, 'begin')\"\n            (monthSelected)=\"monthSelected($event, beginDatepicker, 'begin')\">\n          </mat-datepicker>\n        </mat-form-field>\n\n        <div class=\"time-input\">\n          <mat-form-field class=\"hour-input\" *ngIf=\"calendarType()==='datetime'\">\n            <mat-label>{{'igo.geo.timeFilter.hour' | translate}}</mat-label>\n            <mat-select\n              [formControl]=\"beginHourFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(begin.value, 1)\">\n              <mat-option *ngFor=\"let hour of beginHours\" [value]=\"hour\">{{hour}}</mat-option>\n            </mat-select>\n          </mat-form-field>\n          <mat-form-field class=\"minute-input\" *ngIf=\"calendarType()==='datetime'\">\n            <mat-label>{{'igo.geo.timeFilter.minute' | translate}}</mat-label>\n            <mat-select\n              [formControl]=\"beginMinuteFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(begin.value, 1)\">\n              <mat-option *ngFor=\"let minute of beginMinutes\" [value]=\"minute\">{{minute}}</mat-option>\n            </mat-select>\n          </mat-form-field>\n        </div>\n      </div>\n\n      <div class=\"datetime-input\" *ngIf=\"!restrictedToStep()\">\n        <mat-form-field class=\"date-input\">\n          <mat-datepicker-toggle matSuffix [for]=\"endDatepicker\" [disabled]= \"filterStateDisable\"></mat-datepicker-toggle>\n            <input #end\n              matInput\n              [matDatepicker]=\"endDatepicker\"\n              [placeholder]=\"'igo.geo.timeFilter.endDate' | translate\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (dateChange)=\"changeTemporalProperty(end.value, 2)\"\n              [matDatepickerFilter]=\"dateFilter.bind(this, 'end')\"\n              [value]=\"endValue?endValue:handleDate(datasource.options.maxDate)\"\n              [min]=\"beginValue?beginValue:handleDate(datasource.options.minDate)\"\n              [max]=\"handleDate(datasource.options.maxDate)\" \n              [disabled]= \"filterStateDisable\">\n            <span class=\"filler\"></span>\n            <mat-datepicker #endDatepicker\n              [startView]=\"calendarView()\"\n              [startAt]=\"endValue\"\n              (yearSelected)=\"yearSelected($event, endDatepicker, 'end')\"\n              (monthSelected)=\"monthSelected($event, endDatepicker, 'end')\">\n          </mat-datepicker>\n        </mat-form-field>\n\n        <div class=\"time-input\">\n          <mat-form-field class=\"hour-input\" *ngIf=\"calendarType()==='datetime'\" >\n            <mat-label>{{'igo.geo.timeFilter.hour' | translate}}</mat-label>\n            <mat-select\n              [formControl]=\"endHourFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(end.value, 2)\">\n              <mat-option *ngFor=\"let hour of endHours\" [value]=\"hour\">{{hour}}</mat-option>\n            </mat-select>\n          </mat-form-field>\n          <mat-form-field class=\"minute-input\" *ngIf=\"calendarType()==='datetime'\">\n            <mat-label>{{'igo.geo.timeFilter.minute' | translate}}</mat-label>\n            <mat-select\n              [formControl]=\"endMinuteFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(end.value, 2)\">\n              <mat-option *ngFor=\"let minute of endMinutes\" [value]=\"minute\">{{minute}}</mat-option>\n            </mat-select>\n          </mat-form-field>\n        </div>\n      </div>\n\n      <button class=\"reset-button\" \n        mat-icon-button color=\"primary\"\n        (click)=\"resetFilter()\" \n        [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" \n        [disabled]= \"filterStateDisable\">\n        <mat-icon svgIcon=\"{{resetIcon}}\"></mat-icon>\n      </button>\n      <mat-slide-toggle \n        class=\"toggle-filter-state\" \n        (change)=\"toggleFilterState()\" \n        tooltip-position=\"below\" \n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\" \n        [checked]= \"!filterStateDisable\">\n      </mat-slide-toggle>\n    </div>\n  </div>\n</div>\n","import {\n  Component,\n  Input,\n  ViewChild,\n  ElementRef,\n  Output,\n  EventEmitter,\n  OnInit\n} from '@angular/core';\nimport { FormControl } from '@angular/forms';\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\nimport { OGCFilterTimeService } from '../shared/ogc-filter-time.service';\nimport {\n  OgcFilterableDataSourceOptions,\n  OgcFilterableDataSource,\n  OgcFilterDuringOptions\n} from '../shared/ogc-filter.interface';\n\nimport * as moment_ from 'moment';\nconst moment = moment_;\n\n@Component({\n  selector: 'igo-ogc-filter-time',\n  templateUrl: './ogc-filter-time.component.html',\n  styleUrls: ['./ogc-filter-time.component.scss']\n})\nexport class OgcFilterTimeComponent implements OnInit {\n  @Input() datasource: OgcFilterableDataSource;\n  @Input() currentFilter: any;\n  @Output() changeProperty: EventEmitter<{\n    value: string;\n    pos: number;\n    refreshFilter: boolean;\n  }> = new EventEmitter<any>();\n\n  beginHours: number[];\n  endHours: number[];\n  beginMinutes: number[];\n  endMinutes: number[];\n  beginHourFormControl = new FormControl();\n  beginMinuteFormControl = new FormControl();\n  endHourFormControl = new FormControl();\n  endMinuteFormControl = new FormControl();\n  _beginValue: Date;\n  _endValue: Date;\n  readonly _defaultMin: string = '1900-01-01';\n  readonly _defaultMax: string = '2052-01-06';\n  readonly _defaultDisplayFormat: string = 'DD/MM/YYYY HH:mm A';\n  readonly _defaultSliderModeEnabled: boolean = true;\n  ogcFilterOperator = OgcFilterOperator;\n  public sliderMode = false;\n\n  readonly defaultStepMillisecond = 60000;\n  public options: OgcFilterableDataSourceOptions;\n\n  public onlyYearBegin: number;\n  public onlyYearEnd: number;\n  public calendarTypeYear = false;\n  public resetIcon = 'replay';\n  public filterStateDisable: boolean;\n\n  @ViewChild('endDatepickerTime') endDatepickerTime: ElementRef;\n  @ViewChild('beginDatepickerTime') beginDatepickerTime: ElementRef;\n  @ViewChild('beginTime') beginTime: HTMLInputElement;\n  @ViewChild('endTime') endTime: HTMLInputElement;\n\n  get step(): string {\n    return this.datasource.options.stepDate\n      ? this.datasource.options.stepDate\n      : this.currentFilter.step;\n  }\n\n  get stepMilliseconds(): number {\n    const step = moment.duration(this.step).asMilliseconds();\n    return step === 0 ? this.defaultStepMillisecond : step;\n  }\n\n  set beginValue(begin: Date) {\n    this._beginValue = begin;\n  }\n\n  get beginValue(): Date {\n    return this._beginValue;\n  }\n\n  set endValue(end: Date) {\n    this._endValue = end;\n  }\n\n  get endValue(): Date {\n    return this._endValue;\n  }\n\n  get sliderInterval(): number {\n    return this.currentFilter.sliderInterval === undefined\n      ? 2000\n      : this.currentFilter.sliderInterval;\n  }\n\n  get maxDate(): string {\n    return this.datasource.options.maxDate ? this.datasource.options.maxDate : this._defaultMax;\n  }\n\n  get displayFormat(): string {\n    return this.currentFilter.displayFormat ? this.currentFilter.displayFormat : this._defaultDisplayFormat;\n  }\n\n  constructor(public ogcFilterTimeService: OGCFilterTimeService) {}\n\n  ngOnInit(){\n    if (this.currentFilter.sliderOptions) {\n      this.currentFilter.sliderOptions.enabled = this.currentFilter.sliderOptions.enabled !== undefined ?\n        this.currentFilter.sliderOptions.enabled : this._defaultSliderModeEnabled;\n    }\n    this.beginValue = this.parseFilter(this.handleMin());\n    this.endValue = this.parseFilter(this.handleMax());\n\n    this.onlyYearBegin = this.beginValue.getUTCFullYear();\n    this.onlyYearEnd = this.endValue.getUTCFullYear();\n    this.calendarTypeYear = this.isCalendarYearMode();\n    this.setFilterStateDisable();\n    this.updateHoursMinutesArray();\n    // update value for now value\n    this.updateValues();\n  }\n\n  parseFilter(filter): Date {\n    if (!filter){\n      return new Date();\n    } else if ( isNaN( new Date(filter).getTime() ) ){\n      if (filter.search('now') >= 0 ){\n        const interval = filter.match(/years|months|weeks|days|hours|seconds/);\n        if (filter.match(/\\+/)) {\n          const intervalInt = parseInt(\n            filter.substring(filter.search('+') + 1, interval.index),\n            10\n          );\n          return moment().add(intervalInt, interval[0]).toDate();\n        }\n        if (filter.match(/\\-/)) {\n          const intervalInt = parseInt(\n            filter.substring(filter.search('-') + 1, interval.index),\n            10\n          );\n          return moment().subtract(intervalInt, interval[0]).toDate();\n        }\n        return new Date();\n      }\n      if (filter.search('today') >= 0){\n        const _now = moment().endOf('day').toDate();\n        const interval = filter.match(/years|months|weeks|days|hours|seconds/);\n        if ( filter.match(/\\+/) ) {\n          const intervalInt = parseInt( filter.substring(filter.search('+') + 1, interval.index), 10 );\n          return moment(_now).add(intervalInt, interval[0]).toDate();\n        }\n        if ( filter.match(/\\-/) ) {\n          const intervalInt = parseInt(filter.substring(filter.search('-') + 1, interval.index), 10);\n          return moment(_now).subtract(intervalInt, interval[0]).toDate();\n        }\n        return _now;\n      }\n      return new Date();\n    }\n    if (this.currentFilter.calendarModeYear) {\n      const date = this.getDateFromStringWithoutTime(filter);\n      return date;\n    } else {\n      return filter ? new Date(filter) : new Date();\n    }\n  }\n\n  changeTemporalProperty(value, position?, refreshFilter = true) {\n    let valueTmp = this.getDateTime(value, position);\n    if (this.isCalendarYearMode()) {\n      let dateStringFromYearNotime;\n      if (position === 1) {\n        this.beginValue = value;\n        this.onlyYearBegin = this.beginValue.getFullYear();\n        dateStringFromYearNotime = `${this.onlyYearBegin}-01-01`;\n      } else {\n        this.endValue = value;\n        this.onlyYearEnd = this.endValue.getFullYear();\n        dateStringFromYearNotime = `${this.onlyYearEnd}-01-01`;\n      }\n      // call service with string date without time\n      this.changeProperty.next({ value: dateStringFromYearNotime, pos: position, refreshFilter });\n      return;\n    }\n    if (position === 2 && this.calendarType() === 'date' && !this.sliderMode) {\n      /* Above month: see yearSelected or monthSelected */\n      valueTmp = moment(valueTmp).endOf('day').toDate();\n    }\n\n    if (position === 1) {\n      this.beginValue = valueTmp;\n      if (this.restrictedToStep()) {\n        this.changeTemporalProperty(this.ogcFilterTimeService.addStep(valueTmp, this.stepMilliseconds), 2, refreshFilter);\n      }\n    } else {\n      this.endValue = valueTmp;\n    }\n    this.updateHoursMinutesArray();\n    this.changeProperty.next({ value: valueTmp.toISOString(), pos: position, refreshFilter });\n  }\n\n  handleDate(value): Date {\n    if (!value || value === '') {\n      return undefined;\n    }\n    if (typeof(value) === 'string' && this.currentFilter.calendarModeYear) {\n      return this.getDateFromStringWithoutTime(value);\n    }\n    return new Date(value);\n  }\n\n  calendarType() {\n    if (this.currentFilter.calendarModeYear) {\n      return 'year';\n    }\n    if (this.stepMilliseconds < 86400000) {\n      return 'datetime';\n    }\n    return 'date';\n  }\n\n  isCalendarYearMode(): boolean {\n    if (this.calendarType() === 'year') {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  yearOnlyInputChange(changeEvent, datePicker?: any, property?: string) {\n    const year = changeEvent.target.value;\n    const date = this.getDateFromStringWithoutTime(year);\n    this.yearSelected(date, datePicker, property);\n  }\n\n  yearSelected(year, datePicker?: any, property?: string, refreshFilter = true) {\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      if (datePicker) {\n        datePicker.close();\n      }\n      if (property === 'end') {\n        // change value 01 jan to 31 dec same year\n        year = moment(year).endOf('year').toDate();\n      } else if (property === 'begin' && this.restrictedToStep() && !this.calendarTypeYear) {\n        this.yearSelected(year, undefined, 'end');\n      }\n      this.changeTemporalProperty(year, property === 'begin' ? 1 : 2, refreshFilter);\n    }\n  }\n\n  monthSelected(month, datePicker?: any, property?: string, refreshFilter = true) {\n    if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      if (datePicker) {\n        datePicker.close();\n      }\n      if (property === 'end') {\n        month = moment(month).endOf('month').toDate();\n      } else if (property === 'begin' && this.restrictedToStep()) {\n        this.monthSelected(month, undefined, 'end');\n      }\n      this.changeTemporalProperty(month, property === 'begin' ? 1 : 2, refreshFilter);\n    }\n  }\n\n  calendarView() {\n    const test = this.stepMilliseconds;\n    const diff = Math.abs(\n      this.parseFilter(this.currentFilter.end).getTime() -\n        this.parseFilter(this.currentFilter.begin).getTime()\n    );\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      return 'multi-year';\n    } else if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      return 'year';\n    } else if (test < 86400000 && diff < 86400000) {\n      return 'clock';\n    } else {\n      return 'month';\n    }\n  }\n\n  dateFilter(type: string, date: string): boolean {\n    const dateValue = new Date(date);\n    const diff = dateValue.getTime() - new Date(this.handleMin()).getTime();\n\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      const monthDiff = moment(dateValue).diff(moment(this.handleMin()), 'years', true);\n      if ( type === 'end' ) {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const monthDiffPlus1 = moment(dateValuePlus1).diff(moment(this.handleMin()), 'years', true);\n        return (monthDiffPlus1 % moment.duration(this.step).asYears()) === 0;\n      } else if ( type === 'begin' ) {\n        return (monthDiff % moment.duration(this.step).asYears()) === 0;\n      }\n    }\n    else if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      const monthDiff = moment(dateValue).diff(moment(this.handleMin()), 'months', true);\n      if ( type === 'end' ) {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const monthDiffPlus1 = moment(dateValuePlus1).diff(moment(this.handleMin()), 'months', true);\n        return (monthDiffPlus1 % moment.duration(this.step).asMonths()) === 0;\n      } else if ( type === 'begin' ) {\n        return (monthDiff % moment.duration(this.step).asMonths()) === 0;\n      }\n    } else if (this.ogcFilterTimeService.stepIsWeekDuration(this.step)) {\n      const weekDiff = moment(dateValue).diff(moment(this.handleMin()), 'weeks', true);\n      if ( type === 'end' ) {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const weekDiffPlus1 = moment(dateValuePlus1).diff(moment(this.handleMin()), 'weeks', true);\n        return (weekDiffPlus1 % moment.duration(this.step).asWeeks()) === 0;\n      } else if ( type === 'begin' ) {\n        return (weekDiff % moment.duration(this.step).asWeeks()) === 0;\n      }\n    } else if (this.ogcFilterTimeService.stepIsDayDuration(this.step)) {\n      const dayDiff = moment(dateValue).diff(moment(this.handleMin()), 'days', true);\n      if ( type === 'end' ) {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const dayDiffPlus1 = moment(dateValuePlus1).diff(moment(this.handleMin()), 'days', true);\n        const _mod = (dayDiffPlus1 % moment.duration(this.step).asDays());\n        return (_mod < 0.0000001 && _mod > -0.0000001) || _mod === 0 ; // 1 millisecond = 1.1574074074074076e-8\n      } else if ( type === 'begin' ) {\n        const _mod = ((dayDiff % moment.duration(this.step).asDays()) + 1);\n        return (_mod < 0.0000001 && _mod > -0.0000001 && _mod !== 0) || _mod === 1 ; // 1 millisecond = 1.1574074074074076e-8\n      }\n    } else if ( this.ogcFilterTimeService.stepIsHourDuration(this.step) ) {\n      const hourDiff = moment(dateValue).diff(moment(this.handleMin()), 'hours', true);\n      return (hourDiff % moment.duration(this.step).asHours()) === 0;\n\n    } else if ( this.ogcFilterTimeService.stepIsMinuteDuration(this.step) ) {\n      return true;\n    }\n\n    return diff % this.stepMilliseconds === 0;\n  }\n\n  getDateTime(date, pos) {\n    const valuetmp = new Date(date);\n    let valuetmp2;\n    if (!this.sliderMode) {\n      switch (pos) {\n        case 1: {\n          if (this.currentFilter.calendarModeYear) {\n            valuetmp2 = valuetmp.setHours(0, 0);\n            break;\n          } else {\n            valuetmp2 = valuetmp.setHours(\n            this.beginHourFormControl.value,\n            this.beginMinuteFormControl.value\n            );\n            break;\n          }\n        }\n        case 2: {\n          if (this.currentFilter.calendarModeYear) {\n            valuetmp2 = valuetmp.setHours(0, 0);\n            break;\n          } else {\n            valuetmp2 = valuetmp.setHours(\n              this.endHourFormControl.value,\n              this.endMinuteFormControl.value\n            );\n            break;\n          }\n        }\n      }\n    }\n    return new Date(valuetmp2 ? valuetmp2 : valuetmp);\n  }\n\n  handleMinuteIncrement() {\n    if (this.ogcFilterTimeService.stepIsMinuteDuration(this.step)) {\n      if (this.stepMilliseconds < 3600000) {\n        return this.stepMilliseconds / 1000 === 60 ? 1 : this.stepMilliseconds / 1000;\n      } else {\n        return (this.stepMilliseconds % 3600000) / 60;\n      }\n    } else if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\n      return 60;\n    }\n    return 1;\n  }\n\n  handleHourIncrement() {\n    if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\n      return this.stepMilliseconds / 1000 / 60 / 60;\n    }\n    return 1;\n  }\n\n  fullBeginHoursArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.beginHours = Array.from(\n        {\n          length:\n            (this.endHourFormControl.value - 0) / this.handleHourIncrement() + 1\n        },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    } else {\n      this.beginHours = Array.from(\n        { length: (23 - 0) / this.handleHourIncrement() + 1 },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    }\n    this.beginHourFormControl.setValue(this.beginValue.getHours());\n  }\n\n  fullEndHoursArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.endHours = Array.from(\n        {\n          length:\n            (23 - this.beginHourFormControl.value) /\n              this.handleHourIncrement() +\n            1\n        },\n        (_, i) =>\n          this.beginHourFormControl.value + i * this.handleHourIncrement()\n      );\n    } else {\n      this.endHours = Array.from(\n        { length: (23 - 0) / this.handleHourIncrement() + 1 },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    }\n    this.endHourFormControl.setValue(this.endValue.getHours());\n  }\n\n  fullBeginMinutesArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.beginMinutes = Array.from(\n        {\n          length:\n            (this.endMinuteFormControl.value - 0) /\n              this.handleMinuteIncrement() +\n            1\n        },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    } else {\n      this.beginMinutes = Array.from(\n        { length: (59 - 0) / this.handleMinuteIncrement() + 1 },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    }\n    this.beginMinuteFormControl.setValue(this.beginValue.getMinutes());\n  }\n\n  fullEndMinutesArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.endMinutes = Array.from(\n        {\n          length:\n            (59 - this.beginMinuteFormControl.value) /\n              this.handleMinuteIncrement() +\n            1\n        },\n        (_, i) =>\n          this.beginMinuteFormControl.value + i * this.handleMinuteIncrement()\n      );\n    } else {\n      this.endMinutes = Array.from(\n        { length: (59 - 0) / this.handleMinuteIncrement() + 1 },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    }\n    this.endMinuteFormControl.setValue(this.endValue.getMinutes());\n  }\n\n  updateHoursMinutesArray() {\n    const beginTmp = new Date(this.beginValue);\n    const endTmp = new Date(this.endValue);\n    if (beginTmp.setHours(0, 0) === endTmp.setHours(0, 0)) {\n      this.fullBeginHoursArray(true);\n      this.fullEndHoursArray(true);\n      if (this.beginValue.getHours() === this.endValue.getHours()) {\n        this.fullBeginMinutesArray(true);\n        this.fullEndMinutesArray(true);\n      }\n    } else {\n      this.fullBeginHoursArray();\n      this.fullEndHoursArray();\n      this.fullBeginMinutesArray();\n      this.fullEndMinutesArray();\n    }\n  }\n\n  private updateValues() {\n    this.changeTemporalProperty(this.beginValue, 1, false);\n    this.changeTemporalProperty(this.endValue, 2, true);\n  }\n\n  public restrictedToStep(): boolean {\n    return this.currentFilter.restrictToStep\n      ? this.currentFilter.restrictToStep : false;\n  }\n\n  public handleMin() {\n    return this.currentFilter.begin ? this.currentFilter.begin :\n              (this.datasource.options.minDate ? this.datasource.options.minDate : this._defaultMin);\n  }\n\n  public handleMax() {\n    return this.currentFilter.end ? this.currentFilter.end :\n              (this.datasource.options.maxDate ? this.datasource.options.maxDate : this._defaultMax);\n  }\n\n  changePropertyByPass(event) {\n    this.changeProperty.next(event);\n  }\n\n  modeChange(event) {\n    if (!event.checked) {\n      this.updateValues();\n    }\n  }\n\n  setFilterStateDisable() {\n    if (this.currentFilter) {\n      this.filterStateDisable = !this.currentFilter.active;\n    } else {\n      this.filterStateDisable = false;\n    }\n    if(this.calendarType() === 'datetime') {\n      if (this.filterStateDisable === true) {\n        this.beginHourFormControl.disable();\n        this.beginMinuteFormControl.disable();\n        this.endHourFormControl.disable();\n        this.endMinuteFormControl.disable();\n      } else {\n        this.beginHourFormControl.enable();\n        this.beginMinuteFormControl.enable();\n        this.endHourFormControl.enable();\n        this.endMinuteFormControl.enable();\n      }\n    }\n  }\n  getDateFromStringWithoutTime(stringDate: string): Date {\n    // warning create date with no time make a date UTC with TZ and the date create maybe not the same year, month and day\n    // exemple:\n    // new Date('2022-01-01') -> Fri Dec 31 2021 19:00:00 GMT-0500 (heure normale de lEst nord-amricain)\n    // to create same date as string, add time 00 in the creation\n    // new Date('2022-01-01 00:00:00') -> Sat Jan 01 2022 00:00:00 GMT-0500 (heure normale de lEst nord-amricain)\n    let year;\n    let month = '01';\n    let day = '01';\n    if (stringDate.length === 10) {\n       const dateItems = stringDate.split('-');\n        if (dateItems.length !== 3) {\n          throw new Error('Error in config date begin-end for ogcFilter: Date without time format need to be YYYY-MM-DD or YYYY');\n        } else {\n          year = dateItems[0];\n          month = dateItems[1];\n          day = dateItems[2];\n        }\n    } else if (stringDate.length === 4) {\n      year = stringDate;\n    } else {\n      return new Date(stringDate);\n    }\n    return new Date(`${year}-${month}-${day} 00:00:00`);\n  }\n\n  resetFilter() {\n    let filterOriginConfig = this.datasource.options.ogcFilters.filters as OgcFilterDuringOptions;\n\n    let minDefaultDate;\n    let maxDefaultDate;\n    let minDefaultISOString;\n    let maxDefaultISOString;\n\n    if (this.calendarTypeYear) {\n      if (filterOriginConfig.end === 'today') {\n        let todayDateStringNoTime = new Date().toLocaleDateString('en-CA'); // '2022-02-13'\n        maxDefaultISOString = `${todayDateStringNoTime.substring(0,4)}-01-01`;\n      } else {\n        maxDefaultISOString = `${filterOriginConfig.end.substring(0,4)}-01-01`;\n      }\n      minDefaultISOString = `${filterOriginConfig.begin.substring(0,4)}-01-01`;\n      minDefaultDate = this.getDateFromStringWithoutTime(minDefaultISOString);\n      maxDefaultDate = this.getDateFromStringWithoutTime(maxDefaultISOString);\n    } else {\n      minDefaultDate = this.parseFilter(filterOriginConfig.begin);\n      maxDefaultDate = this.parseFilter(filterOriginConfig.end);\n      minDefaultISOString = minDefaultDate.toISOString();\n      maxDefaultISOString = maxDefaultDate.toISOString();\n    }\n\n    if ((this.currentFilter.begin !== minDefaultISOString ) ||\n    (this.currentFilter.end !== maxDefaultISOString)) {\n      this.beginValue = minDefaultDate;\n      this.endValue = maxDefaultDate;\n      this.updateValues();\n    }\n  }\n\n  toggleFilterState() {\n    if (this.currentFilter.active === true) {\n      this.currentFilter.active = false;\n    } else {\n      this.currentFilter.active = true;\n    }\n    this.setFilterStateDisable();\n    this.updateValues();\n  }\n}\n","import {\n  Component,\n  Input,\n  ViewChild,\n  Output,\n  EventEmitter,\n  OnInit\n} from '@angular/core';\nimport { OGCFilterTimeService } from '../shared/ogc-filter-time.service';\n\nimport * as moment_ from 'moment';\nimport { MatSlider } from '@angular/material/slider';\nconst moment = moment_;\n\n@Component({\n  selector: 'igo-ogc-filter-time-slider',\n  templateUrl: './ogc-filter-time-slider.component.html',\n  styleUrls: ['./ogc-filter-time-slider.component.scss']\n})\nexport class OgcFilterTimeSliderComponent implements OnInit {\n  @Input() currentFilter: any;\n  @Input() begin: any;\n  @Input() max: any;\n  @Input() datasource: any;\n  @Output() changeProperty: EventEmitter<{\n    value: any;\n    pos: number;\n    refreshFilter: boolean;\n  }> = new EventEmitter<any>();\n  @ViewChild(MatSlider) slider: MatSlider;\n\n  interval;\n  sliderValue: number = 1;\n  calculatedStep: number = 0;\n  readonly _defaultDisplayFormat: string = 'DD/MM/YYYY HH:mm A';\n  readonly _defaultSliderInterval: number = 2000;\n  public playIcon = 'play-circle';\n  public resetIcon = 'replay';\n\n  get sliderInterval(): number {\n    return this.currentFilter.sliderInterval === undefined\n      ? this._defaultSliderInterval\n      : this.currentFilter.sliderInterval;\n  }\n\n  get displayFormat(): string {\n    if (this.currentFilter.sliderOptions?.displayFormat){\n      return this.currentFilter.sliderOptions.displayFormat;\n    }\n    if (this.currentFilter.displayFormat) {\n      return this.currentFilter.displayFormat;\n    }\n    return this._defaultDisplayFormat;\n  }\n\n  get beginMillisecond(): number {\n    return this.ogcFilterTimeService.dateToNumber(this.begin);\n  }\n\n  get maxMillisecond(): number {\n    return this.ogcFilterTimeService.dateToNumber(this.max);\n  }\n\n  get stepMillisecond(): number {\n    return this.ogcFilterTimeService.stepMillisecond(this.datasource, this.currentFilter);\n  }\n\n  constructor(public ogcFilterTimeService: OGCFilterTimeService) {\n    this.sliderDisplayWith = this.sliderDisplayWith.bind(this);\n  }\n\n  ngOnInit(){\n    this.calculateStep();\n    this.handleSliderInput({value: 1});\n  }\n\n  sliderDisplayWith(value) {\n    let dateTmp = new Date(this.beginMillisecond + ((value - 1) * this.stepMillisecond));\n\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter))) {\n      const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).years();\n      dateTmp = moment(this.beginMillisecond).add((value - 1) * toAdd, 'year').toDate();\n    } else if ( this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter))) {\n      const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).months();\n      dateTmp = moment(this.beginMillisecond).add((value - 1) * toAdd, 'month').toDate();\n    }\n\n    return moment(dateTmp).format(this.displayFormat);\n  }\n\n  playFilter(event: any) {\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause-circle';\n      this.interval = setInterval(\n        that => {\n\n          if (this.slider.value < this.calculatedStep) {\n            const _increment = '_increment';\n            const _emitInputEvent = '_emitInputEvent';\n            this.slider[_increment](1);\n            this.slider[_emitInputEvent]();\n          } else {\n            this.stopFilter();\n          }\n        },\n        this.sliderInterval,\n        this\n      );\n    }\n  }\n\n  stopFilter() {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play-circle';\n  }\n\n  resetFilter(event: any) {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play-circle';\n    this.slider.value = 1;\n    const _increment = '_increment';\n    const _emitInputEvent = '_emitInputEvent';\n    this.slider[_emitInputEvent]();\n  }\n\n  handleSliderInput(matSliderChange) {\n    if (matSliderChange) {\n\n      if ( this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ) {\n        const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).years();\n        const dateBeginTmp = moment(this.beginMillisecond).add((matSliderChange.value - 1) * toAdd, 'year').toDate();\n        const dateEndTmp = moment(dateBeginTmp).add(toAdd, 'year').toDate();\n        this.changeProperty.next({value: moment(dateBeginTmp).toDate().toISOString(),\n                                    pos: 1, refreshFilter: false});\n        this.changeProperty.next({value: moment(dateEndTmp).toDate().toISOString(),\n                                    pos: 2, refreshFilter: true});\n\n      } else if ( this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ) {\n        const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).months();\n        const dateBeginTmp = moment(this.beginMillisecond).add((matSliderChange.value - 1) * toAdd, 'month').toDate();\n        const dateEndTmp = moment(dateBeginTmp).add(toAdd, 'month').toDate();\n        this.changeProperty.next({value: moment(dateBeginTmp).startOf('month').toDate().toISOString(),\n                                    pos: 1, refreshFilter: false});\n        this.changeProperty.next({value: moment(dateEndTmp).toDate().toISOString(),\n                                    pos: 2, refreshFilter: true});\n\n      } else if ( this.ogcFilterTimeService.stepIsDayDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ||\n          this.ogcFilterTimeService.stepIsHourDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ||\n          this.ogcFilterTimeService.stepIsMinuteDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ) {\n            const dateTmp = new Date(this.beginMillisecond + (this.stepMillisecond * (matSliderChange.value - 1)));\n            this.changeProperty.next({value: dateTmp.toISOString(), pos: 1, refreshFilter: false});\n            this.changeProperty.next({value: new Date(this.ogcFilterTimeService.addStep(dateTmp.toISOString(),\n                                        this.stepMillisecond)).toISOString(),\n                                        pos: 2, refreshFilter: true});\n      }\n    }\n  }\n\n  calculateStep(){\n    for (let i = 1; (this.maxMillisecond - (this.beginMillisecond + (i * this.stepMillisecond))) >= -1; i++) {\n      this.calculatedStep = i;\n    }\n  }\n\n}\n","<div class=\"slider-container\">\n  <mat-slider\n    id=\"time-slider\"\n    [step]=\"1\"\n    [min]=\"1\"\n    [max]=\"calculatedStep\"\n    [(ngModel)]=\"sliderValue\"\n    [displayWith]=\"sliderDisplayWith\"\n    (input)=\"handleSliderInput($event)\"\n    thumbLabel\n    >\n  </mat-slider>\n  <button mat-icon-button color=\"primary\" (click)=\"playFilter($event)\">\n    <mat-icon [svgIcon]=\"playIcon\"></mat-icon>\n  </button>\n  <button mat-icon-button color=\"primary\" (click)=\"resetFilter($event)\">\n    <mat-icon svgIcon=\"{{resetIcon}}\"></mat-icon>\n  </button>\n  \n</div>","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatOptionModule, MatNativeDateModule, MAT_DATE_LOCALE } from '@angular/material/core';\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatSliderModule } from '@angular/material/slider';\nimport { MatTableModule } from '@angular/material/table';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatTreeModule } from '@angular/material/tree';\n\nimport {\n  MatDatetimepickerModule,\n  MatNativeDatetimeModule\n} from '@mat-datetimepicker/core';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoCollapsibleModule,\n  IgoListModule,\n  IgoKeyValueModule,\n  IgoEntityModule\n} from '@igo2/common';\nimport { IgoGeometryModule } from './../geometry/geometry.module';\n\nimport { FilterableDataSourcePipe } from './shared/filterable-datasource.pipe';\nimport { IgoLayerModule } from '../layer/layer.module';\nimport { TimeFilterButtonComponent } from './time-filter-button/time-filter-button.component';\nimport { TimeFilterFormComponent } from './time-filter-form/time-filter-form.component';\nimport { TimeFilterItemComponent } from './time-filter-item/time-filter-item.component';\nimport { TimeFilterListBindingDirective } from './time-filter-list/time-filter-list-binding.directive';\nimport { TimeFilterListComponent } from './time-filter-list/time-filter-list.component';\nimport { TimeFilterService } from './shared/time-filter.service';\n\nimport { OgcFilterFormComponent } from './ogc-filter-form/ogc-filter-form.component';\nimport { OgcFilterableFormComponent } from './ogc-filterable-form/ogc-filterable-form.component';\nimport { OgcFilterableItemComponent } from './ogc-filterable-item/ogc-filterable-item.component';\nimport { OgcFilterableListBindingDirective } from './ogc-filterable-list/ogc-filterable-list-binding.directive';\nimport { OgcFilterableListComponent } from './ogc-filterable-list/ogc-filterable-list.component';\nimport { OgcFilterButtonComponent } from './ogc-filter-button/ogc-filter-button.component';\nimport { OGCFilterService } from './shared/ogc-filter.service';\nimport { OGCFilterTimeService } from './shared/ogc-filter-time.service';\nimport { OgcFilterSelectionComponent } from './ogc-filter-selection/ogc-filter-selection.component';\n\nimport { SpatialFilterTypeComponent } from './spatial-filter/spatial-filter-type/spatial-filter-type.component';\nimport { SpatialFilterListComponent } from './spatial-filter/spatial-filter-list/spatial-filter-list.component';\nimport { SpatialFilterItemComponent } from './spatial-filter/spatial-filter-item/spatial-filter-item.component';\nimport { SpatialFilterService } from './shared/spatial-filter.service';\nimport { OgcFilterTimeComponent } from './ogc-filter-time/ogc-filter-time.component';\nimport { OgcFilterTimeSliderComponent } from './ogc-filter-time/ogc-filter-time-slider.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatAutocompleteModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTabsModule,\n    MatRadioModule,\n    MatMenuModule,\n    MatTableModule,\n    MatTreeModule,\n    MatButtonToggleModule,\n    MatCheckboxModule,\n    MatSliderModule,\n    MatSlideToggleModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatOptionModule,\n    MatSelectModule,\n    MatListModule,\n    MatTooltipModule,\n    MatDatepickerModule,\n    MatNativeDateModule,\n    MatDatetimepickerModule,\n    MatNativeDatetimeModule,\n    IgoLanguageModule,\n    IgoLayerModule,\n    IgoCollapsibleModule,\n    IgoListModule,\n    IgoEntityModule,\n    IgoKeyValueModule,\n    IgoGeometryModule,\n    MatBadgeModule\n  ],\n  exports: [\n    FilterableDataSourcePipe,\n    TimeFilterButtonComponent,\n    TimeFilterFormComponent,\n    TimeFilterItemComponent,\n    TimeFilterListComponent,\n    TimeFilterListBindingDirective,\n    OgcFilterFormComponent,\n    OgcFilterButtonComponent,\n    OgcFilterSelectionComponent,\n    OgcFilterableFormComponent,\n    OgcFilterableItemComponent,\n    OgcFilterableListComponent,\n    OgcFilterableListBindingDirective,\n    SpatialFilterTypeComponent,\n    SpatialFilterListComponent,\n    SpatialFilterItemComponent,\n    OgcFilterTimeComponent,\n    OgcFilterTimeSliderComponent\n  ],\n  declarations: [\n    FilterableDataSourcePipe,\n    TimeFilterButtonComponent,\n    TimeFilterFormComponent,\n    TimeFilterItemComponent,\n    TimeFilterListComponent,\n    TimeFilterListBindingDirective,\n    OgcFilterFormComponent,\n    OgcFilterButtonComponent,\n    OgcFilterSelectionComponent,\n    OgcFilterableFormComponent,\n    OgcFilterableItemComponent,\n    OgcFilterableListComponent,\n    OgcFilterableListBindingDirective,\n    SpatialFilterTypeComponent,\n    SpatialFilterListComponent,\n    SpatialFilterItemComponent,\n    OgcFilterTimeComponent,\n    OgcFilterTimeSliderComponent\n  ],\n  providers: [TimeFilterService, OGCFilterService, OGCFilterTimeService, SpatialFilterService]\n})\nexport class IgoFilterModule {\n  static forRoot(): ModuleWithProviders<IgoFilterModule> {\n    return {\n      ngModule: IgoFilterModule,\n      providers: [\n        {\n          provide: MAT_DATE_LOCALE,\n          useValue: 'fr-FR'\n        }\n      ]\n    };\n  }\n}\n","<button\n  *ngIf=\"layerIsExportable()\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.download.action' | translate\"\n  [color]=\"color\">\n  <!-- (click)=\"openDownload(layer)\"> -->\n  <mat-icon svgIcon=\"file-export\"></mat-icon>\n</button>\n\n","import { Component, Input, ChangeDetectionStrategy } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\nimport { VectorLayer } from '../../layer';\nimport { DataSourceOptions } from '../../datasource';\n\n@Component({\n  selector: 'igo-export-button',\n  templateUrl: './export-button.component.html',\n  styleUrls: ['./export-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ExportButtonComponent {\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n  }\n  private _layer: Layer;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor() {}\n\n  get options(): DataSourceOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.dataSource.options;\n  }\n\n  layerIsExportable(): boolean {\n    if (\n      (this.layer instanceof VectorLayer && this.layer.exportable === true) ||\n      (this.layer.dataSource.options.download && this.layer.dataSource.options.download.url) ||\n      (this.layer.options.workspace?.enabled &&\n        this.layer.options.workspace?.workspaceId !== this.layer.id)\n    ) {\n      return true;\n    }\n    return false;\n  }\n}\n","export class ExportError extends Error {}\n\nexport class ExportInvalidFileError extends ExportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ExportInvalidFileError.prototype);\n  }\n}\n\nexport class ExportNothingToExportError extends ExportError {\n  constructor() {\n    super('Nothing to export');\n    Object.setPrototypeOf(this, ExportNothingToExportError.prototype);\n  }\n}\n","import {\n  getEntityProperty,\n  EntityTableColumn,\n  EntityTableColumnRenderer\n} from '@igo2/common';\nimport { MessageService, LanguageService } from '@igo2/core';\nimport { downloadContent } from '@igo2/utils';\n\nimport { ExportNothingToExportError } from './export.errors';\n\nexport function handleFileExportError(\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  if (error instanceof ExportNothingToExportError) {\n    handleNothingToExportError(messageService, languageService);\n    return;\n  }\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.export.failed.title');\n  const message = translate.instant('igo.geo.export.failed.text');\n  messageService.error(message, title);\n}\n\nexport function handleFileExportSuccess(\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.export.success.title');\n  const message = translate.instant('igo.geo.export.success.text');\n  messageService.success(message, title);\n}\n\nexport function handleNothingToExportError(\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.export.nothing.title');\n  const message = translate.instant('igo.geo.export.nothing.text');\n  messageService.error(message, title);\n}\n\n/**\n * Export array to CSV\n *\n * @param rows Array of arrays to export as CSV\n * @param separator Cell separator\n */\nexport function exportToCSV(rows: any[][], fileName: string, separator: string = ';') {\n  const lines = rows.map((row: any[][], index: number) => row.join(separator));\n  const csvContent = lines.join('\\n');\n  downloadContent(csvContent, 'text/csv;charset=utf-8', fileName);\n}\n\n/**\n * Return an array of values from an array of entities.\n *\n * @param entities Array of entities\n * @param scolumns Columns definition of the output data\n */\nexport function entitiesToRowData(entities: object[], columns: EntityTableColumn[]) {\n  return entities.map((entity: object) => {\n    return columns.map((column: EntityTableColumn) => {\n      let valueAccessor;\n      if (column.renderer === undefined || column.renderer === EntityTableColumnRenderer.Default) {\n        valueAccessor = column.valueAccessor;\n      }\n      valueAccessor = valueAccessor ? valueAccessor : getEntityProperty;\n      return valueAccessor(entity, column.name);\n    });\n  });\n}\n","import { strEnum } from '@igo2/utils';\n\nexport const ExportFormat = strEnum(['URL', 'GeoJSON', 'GML', 'GPX', 'KML', 'Shapefile', 'CSVcomma', 'CSVsemicolon']);\nexport type ExportFormat = keyof typeof ExportFormat;\n\nexport const EncodingFormat = strEnum(['UTF8', 'LATIN1']);\nexport type EncodingFormat = keyof typeof EncodingFormat;\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\nimport { downloadContent } from '@igo2/utils';\n\nimport { Observable, Observer } from 'rxjs';\n\nimport * as olformat from 'ol/format';\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { ExportFormat, EncodingFormat } from './export.type';\n\nimport {\n  ExportInvalidFileError,\n  ExportNothingToExportError\n} from './export.errors';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ExportService {\n  static ogreFormats = {\n    GML: 'gml',\n    GPX: 'gpx',\n    KML: 'kml',\n    Shapefile: 'ESRI Shapefile',\n    CSVcomma: 'CSVcomma',\n    CSVsemicolon: 'CSVsemicolon'\n  };\n\n  static noOgreFallbacks = ['GML', 'GPX', 'KML'];\n\n  private ogreUrl: string;\n  private aggregateInComment: boolean = true;\n\n  constructor(private config: ConfigService) {\n    this.ogreUrl = this.config.getConfig('importExport.url');\n    const gpxAggregateInComment = this.config.getConfig(\n      'importExport.gpxAggregateInComment'\n    );\n    if (gpxAggregateInComment !== undefined) {\n      this.aggregateInComment = gpxAggregateInComment;\n    }\n  }\n\n  export(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat,\n    title: string,\n    encoding: EncodingFormat,\n    projectionIn = 'EPSG:4326',\n    projectionOut = 'EPSG:4326'\n  ): Observable<void> {\n    const exportOlFeatures = this.generateFeature(olFeatures, format);\n\n    return this.exportAsync(exportOlFeatures, format, title, encoding, projectionIn, projectionOut);\n  }\n\n  private generateFeature(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat\n  ): OlFeature<OlGeometry>[] {\n    if (format === ExportFormat.GPX && this.aggregateInComment) {\n      return this.generateAggregatedFeature(olFeatures);\n    }\n\n    return olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      const keys = olFeature\n        .getKeys()\n        .filter((key: string) => !key.startsWith('_'));\n      const properties = keys.reduce(\n        (acc: object, key: string) => {\n          acc[key] = olFeature.get(key);\n          return acc;\n        },\n        { geometry: olFeature.getGeometry() }\n      );\n      return new OlFeature(properties);\n    });\n  }\n\n  private generateAggregatedFeature(olFeatures: OlFeature<OlGeometry>[]): OlFeature<OlGeometry>[] {\n    return olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      const keys = olFeature.getKeys().filter((key: string) => !key.startsWith('_'));\n      let comment: string = '';\n      const properties = keys.reduce((acc: object, key: string) => {\n        if (key && key !== 'geometry') {\n          key === 'id' && olFeature.get('draw') ? comment += key + ':' + olFeature.get('draw') + '   \\r\\n'\n          : comment += key + ':' + olFeature.get(key) + '   \\r\\n';\n        }\n        acc[key] = olFeature.get(key);\n        return acc;\n      },\n      {\n        geometry: olFeature.getGeometry()\n      });\n      const newFeature = new OlFeature(properties);\n      newFeature.set('name', olFeature.getId());\n      newFeature.set('cmt', comment);\n\n      return newFeature;\n    });\n  }\n\n  private exportAsync(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat,\n    title: string,\n    encoding: EncodingFormat,\n    projectionIn: string,\n    projectionOut: string\n  ): Observable<void> {\n    const doExport = (observer: Observer<void>) => {\n      const nothingToExport = this.nothingToExport(olFeatures, format);\n      if (nothingToExport) {\n        observer.error(new ExportNothingToExportError());\n        return;\n      }\n\n      const ogreFormats = Object.keys(ExportService.ogreFormats);\n      if (ogreFormats.indexOf(format) >= 0) {\n        if (!this.ogreUrl) {\n          if (ExportService.noOgreFallbacks.indexOf(format) >= 0) {\n            this.exportToFile(olFeatures, observer, format, title, projectionIn, projectionOut);\n          } else {\n            observer.error(new ExportInvalidFileError());\n          }\n          return;\n        }\n        this.exportWithOgre(olFeatures, observer, format, title, encoding, projectionIn, projectionOut);\n      } else {\n        this.exportToFile(olFeatures, observer, format, title, projectionIn, projectionOut);\n      }\n    };\n\n    return new Observable(doExport);\n  }\n\n  protected exportToFile(\n    olFeatures: OlFeature<OlGeometry>[],\n    observer: Observer<void>,\n    format: ExportFormat,\n    title: string,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const olFormat = new olformat[format]();\n    const featuresText = olFormat.writeFeatures(olFeatures, {\n      dataProjection: projectionOut,\n      featureProjection: projectionIn,\n      featureType: 'feature',\n      featureNS: 'http://example.com/feature'\n    });\n\n    const fileName = `${title}.${format.toLowerCase()}`;\n\n    downloadContent(featuresText, 'text/plain;charset=utf-8', fileName);\n    observer.complete();\n  }\n\n  private exportWithOgre(\n    olFeatures: OlFeature<OlGeometry>[],\n    observer: Observer<void>,\n    format: string,\n    title: string,\n    encodingType: EncodingFormat,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const featuresText: string = new olformat.GeoJSON().writeFeatures(\n      olFeatures,\n      {\n        dataProjection: projectionOut,\n        featureProjection: projectionIn\n      }\n    );\n\n    const url = `${this.ogreUrl}/convertJson`;\n    const form = document.createElement('form');\n    form.style.display = 'none';\n    document.body.appendChild(form);\n    form.setAttribute('method', 'post');\n    form.setAttribute('target', '_blank');\n    form.setAttribute('action', url);\n\n    if (encodingType === EncodingFormat.UTF8) {\n      form.acceptCharset = 'UTF-8';\n      form.enctype = 'application/x-www-form-urlencoded; charset=utf-8;';\n    } else if (encodingType === EncodingFormat.LATIN1) {\n      const enctype = 'ISO-8859-1';\n      const encoding = document.createElement('input');\n      encoding.setAttribute('type', 'hidden');\n      encoding.setAttribute('name', 'encoding');\n      encoding.setAttribute('value', enctype);\n      form.appendChild(encoding);\n    }\n\n    if (format === 'CSVsemicolon') {\n      const options = document.createElement('input');\n      options.setAttribute('type', 'hidden');\n      options.setAttribute('name', 'lco');\n      options.setAttribute('value', 'SEPARATOR=SEMICOLON');\n      form.appendChild(options);\n    }\n\n    const geojsonField = document.createElement('input');\n    geojsonField.setAttribute('type', 'hidden');\n    geojsonField.setAttribute('name', 'json');\n    geojsonField.setAttribute('value', featuresText);\n    form.appendChild(geojsonField);\n\n    const outputNameField = document.createElement('input');\n    let outputName = format === 'Shapefile' ? `${title}.zip` : `${title}.${format.toLowerCase()}`;\n    if (format === 'CSVcomma' || format === 'CSVsemicolon') {\n      outputName = `${title}.csv`;\n    }\n    outputName = outputName.replace(' ', '_');\n    outputName = outputName.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n    outputNameField.setAttribute('type', 'hidden');\n    outputNameField.setAttribute('name', 'outputName');\n    outputNameField.setAttribute('value', outputName);\n    form.appendChild(outputNameField);\n\n    let ogreFormat = ExportService.ogreFormats[format];\n    if (format === 'CSVcomma' || format === 'CSVsemicolon') {\n      ogreFormat = 'CSV';\n    }\n    const outputFormatField = document.createElement('input');\n    outputFormatField.setAttribute('type', 'hidden');\n    outputFormatField.setAttribute('name', 'format');\n    outputFormatField.setAttribute('value', ogreFormat);\n    form.appendChild(outputFormatField);\n\n    form.submit();\n    document.body.removeChild(form);\n\n    observer.complete();\n  }\n\n  private nothingToExport(olFeatures: OlFeature<OlGeometry>[], format: string): boolean {\n    if (olFeatures.length === 0) {\n      return true;\n    }\n    if (format === 'GPX') {\n      const pointOrLine = olFeatures.find(olFeature => {\n        return (\n          ['Point', 'LineString', 'MultiLineString'].indexOf(olFeature.getGeometry().getType()) >= 0\n        );\n      });\n      return pointOrLine === undefined;\n    }\n    return false;\n  }\n}\n","import * as olStyle from 'ol/style';\n\nimport { MessageService, LanguageService } from '@igo2/core';\n\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { FeatureDataSourceOptions } from '../../datasource/shared/datasources/feature-datasource.interface';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport {\n  featureToOl,\n  moveToOlFeatures\n} from '../../feature/shared/feature.utils';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../map/shared/map';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { StyleService } from '../../layer/shared/style.service';\nimport { StyleByAttribute } from '../../layer/shared/vector-style.interface';\nimport { StyleListService } from '../style-list/style-list.service';\nimport { ClusterParam } from '../../layer/shared/clusterParam';\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\nimport { ClusterDataSourceOptions } from '../../datasource/shared/datasources/cluster-datasource.interface';\n\nexport function addLayerAndFeaturesToMap(\n  features: Feature[],\n  map: IgoMap,\n  layerTitle: string\n): VectorLayer {\n  const olFeatures = features.map((feature: Feature) =>\n    featureToOl(feature, map.projection)\n  );\n\n  const r = Math.floor(Math.random() * 255);\n  const g = Math.floor(Math.random() * 255);\n  const b = Math.floor(Math.random() * 255);\n  const stroke = new olStyle.Stroke({\n    color: [r, g, b, 1],\n    width: 2\n  });\n\n  const fill = new olStyle.Fill({\n    color: [r, g, b, 0.4]\n  });\n  const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n    type: 'vector',\n    queryable: true\n  };\n  const source = new FeatureDataSource(sourceOptions);\n  source.ol.addFeatures(olFeatures);\n  const layer = new VectorLayer({\n    title: layerTitle,\n    source,\n    style: new olStyle.Style({\n      stroke,\n      fill,\n      image: new olStyle.Circle({\n        radius: 5,\n        stroke,\n        fill\n      })\n    })\n  });\n  map.addLayer(layer);\n  moveToOlFeatures(map, olFeatures);\n\n  return layer;\n}\n\nexport function addLayerAndFeaturesStyledToMap(\n  features: Feature[],\n  map: IgoMap,\n  layerTitle: string,\n  styleListService: StyleListService,\n  styleService: StyleService\n): VectorLayer {\n  const olFeatures = features.map((feature: Feature) =>\n    featureToOl(feature, map.projection)\n  );\n  let style;\n  let distance: number;\n\n  if (\n    styleListService.getStyleList(layerTitle.toString() + '.styleByAttribute')\n  ) {\n    const styleByAttribute: StyleByAttribute = styleListService.getStyleList(\n      layerTitle.toString() + '.styleByAttribute'\n    );\n\n    style = feature => {\n      return styleService.createStyleByAttribute(feature, styleByAttribute);\n    };\n  } else if (\n    styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')\n  ) {\n    const clusterParam: ClusterParam = styleListService.getStyleList(\n      layerTitle.toString() + '.clusterParam'\n    );\n    distance = styleListService.getStyleList(\n      layerTitle.toString() + '.distance'\n    );\n\n    const baseStyle = styleService.createStyle(\n      styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')\n    );\n\n    style = feature => {\n      return styleService.createClusterStyle(feature, clusterParam, baseStyle);\n    };\n  } else if (styleListService.getStyleList(layerTitle.toString() + '.style')) {\n    style = styleService.createStyle(\n      styleListService.getStyleList(layerTitle.toString() + '.style')\n    );\n  } else if (\n    styleListService.getStyleList('default.clusterStyle') &&\n    features[0].geometry.type === 'Point'\n  ) {\n    const clusterParam: ClusterParam = styleListService.getStyleList(\n      'default.clusterParam'\n    );\n    distance = styleListService.getStyleList('default.distance');\n\n    const baseStyle = styleService.createStyle(\n      styleListService.getStyleList('default.clusterStyle')\n    );\n\n    style = feature => {\n      return styleService.createClusterStyle(feature, clusterParam, baseStyle);\n    };\n  } else {\n    style = styleService.createStyle(\n      styleListService.getStyleList('default.style')\n    );\n  }\n\n  let source;\n  if (styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')) {\n    const sourceOptions: ClusterDataSourceOptions &\n      QueryableDataSourceOptions = {\n      distance,\n      type: 'cluster',\n      queryable: true\n    };\n    source = new ClusterDataSource(sourceOptions);\n    source.ol.source.addFeatures(olFeatures);\n  } else if (styleListService.getStyleList(layerTitle.toString())) {\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n      type: 'vector',\n      queryable: true\n    };\n    source = new FeatureDataSource(sourceOptions);\n    source.ol.addFeatures(olFeatures);\n  } else if (\n    styleListService.getStyleList('default.clusterStyle') &&\n    features[0].geometry.type === 'Point'\n  ) {\n    const sourceOptions: ClusterDataSourceOptions &\n      QueryableDataSourceOptions = {\n      distance,\n      type: 'cluster',\n      queryable: true\n    };\n    source = new ClusterDataSource(sourceOptions);\n    source.ol.source.addFeatures(olFeatures);\n  } else {\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n      type: 'vector',\n      queryable: true\n    };\n    source = new FeatureDataSource(sourceOptions);\n    source.ol.addFeatures(olFeatures);\n  }\n\n  const layer = new VectorLayer({\n    title: layerTitle,\n    source,\n    style\n  });\n  map.addLayer(layer);\n  moveToOlFeatures(map, olFeatures);\n\n  return layer;\n}\n\nexport function handleFileImportSuccess(\n  file: File,\n  features: Feature[],\n  map: IgoMap,\n  messageService: MessageService,\n  languageService: LanguageService,\n  styleListService?: StyleListService,\n  styleService?: StyleService\n) {\n  if (features.length === 0) {\n    handleNothingToImportError(file, messageService, languageService);\n    return;\n  }\n\n  const layerTitle = computeLayerTitleFromFile(file);\n\n  if (!styleListService) {\n    addLayerAndFeaturesToMap(features, map, layerTitle);\n  } else {\n    addLayerAndFeaturesStyledToMap(\n      features,\n      map,\n      layerTitle,\n      styleListService,\n      styleService\n    );\n  }\n\n  const translate = languageService.translate;\n  const messageTitle = translate.instant('igo.geo.dropGeoFile.success.title');\n  const message = translate.instant('igo.geo.dropGeoFile.success.text', {\n    value: layerTitle\n  });\n  messageService.success(message, messageTitle);\n}\n\nexport function handleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService,\n  sizeMb?: number\n) {\n  sizeMb = sizeMb ? sizeMb : 30;\n  const errMapping = {\n    'Invalid file': handleInvalidFileImportError,\n    'File is too large': handleSizeFileImportError,\n    'Failed to read file': handleUnreadbleFileImportError,\n    'Invalid SRS definition': handleSRSImportError,\n    'Error 500 with OGRE': handleOgreServerImportError\n  };\n  errMapping[error.message](\n    file,\n    error,\n    messageService,\n    languageService,\n    sizeMb\n  );\n}\n\nexport function handleInvalidFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.dropGeoFile.invalid.title');\n  const message = translate.instant('igo.geo.dropGeoFile.invalid.text', {\n    value: file.name,\n    mimeType: file.type\n  });\n  messageService.error(message, title);\n}\n\nexport function handleUnreadbleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.dropGeoFile.unreadable.title');\n  const message = translate.instant('igo.geo.dropGeoFile.unreadable.text', {\n    value: file.name\n  });\n  messageService.error(message, title);\n}\n\nexport function handleSizeFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService,\n  sizeMb: number\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.dropGeoFile.tooLarge.title');\n  const message = translate.instant('igo.geo.dropGeoFile.tooLarge.text', {\n    value: file.name,\n    size: sizeMb\n  });\n  messageService.error(message, title);\n}\n\nexport function handleNothingToImportError(\n  file: File,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.dropGeoFile.empty.title');\n  const message = translate.instant('igo.geo.dropGeoFile.empty.text', {\n    value: file.name,\n    mimeType: file.type\n  });\n  messageService.error(message, title);\n}\n\nexport function handleSRSImportError(\n  file: File,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.dropGeoFile.invalidSRS.title');\n  const message = translate.instant('igo.geo.dropGeoFile.invalidSRS.text', {\n    value: file.name,\n    mimeType: file.type\n  });\n  messageService.error(message, title);\n}\n\nexport function handleOgreServerImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const title = languageService.translate.instant('igo.geo.dropGeoFile.ogreServer.title');\n  const message = languageService.translate.instant('igo.geo.dropGeoFile.ogreServer.text');\n  messageService.error(message, title);\n}\n\nexport function getFileExtension(file: File): string {\n  return file.name\n    .split('.')\n    .pop()\n    .toLowerCase();\n}\n\nexport function computeLayerTitleFromFile(file: File): string {\n  return file.name.substr(0, file.name.lastIndexOf('.'));\n}\n","export class ImportError extends Error {}\n\nexport class ImportInvalidFileError extends ImportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ImportInvalidFileError.prototype);\n  }\n}\n\nexport class ImportUnreadableFileError extends ImportError {\n  constructor() {\n      super('Failed to read file');\n      Object.setPrototypeOf(this, ImportUnreadableFileError.prototype);\n  }\n}\n\nexport class ImportNothingToImportError extends ImportError {\n  constructor() {\n      super('Nothing to import');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSizeError extends ImportError {\n  constructor() {\n      super('File is too large');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSRSError extends ImportError {\n  constructor() {\n      super('Invalid SRS definition');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportOgreServerError extends ImportError {\n  constructor() {\n      super('Error 500 with OGRE');\n      Object.setPrototypeOf(this, ImportOgreServerError.prototype);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\n\nimport { ConfigService } from '@igo2/core';\nimport { uuid } from '@igo2/utils';\n\nimport { Observable, Observer } from 'rxjs';\n\nimport * as olformat from 'ol/format';\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport {\n  ImportInvalidFileError,\n  ImportUnreadableFileError,\n  ImportSizeError,\n  ImportSRSError,\n  ImportOgreServerError\n} from './import.errors';\nimport { computeLayerTitleFromFile, getFileExtension } from './import.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ImportService {\n  static allowedMimeTypes = [\n    'application/gml+xml',\n    'application/vnd.google-earth.kml+xml',\n    'application/gpx+xml',\n    'application/json'\n  ];\n\n  static allowedZipMimeTypes = [\n    'application/zip',\n    'application/x-zip-compressed',\n    'application/x-zip'\n  ];\n\n  static allowedExtensions = ['geojson', 'kml', 'gpx', 'json', 'gml'];\n\n  private ogreUrl: string;\n  private clientSideFileSizeMax: number;\n\n  constructor(private http: HttpClient, private config: ConfigService) {\n    this.ogreUrl = this.config.getConfig('importExport.url');\n    const configFileSizeMb = this.config.getConfig('importExport.clientSideFileSizeMaxMb');\n    this.clientSideFileSizeMax = (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\n  }\n\n  import(\n    file: File,\n    projectionIn = 'EPSG:4326',\n    projectionOut = 'EPSG:4326'\n  ): Observable<Feature[]> {\n    return this.importAsync(file, projectionIn, projectionOut);\n  }\n\n  private getFileImporter(\n    file: File\n  ): (\n    file: File,\n    observer: Observer<Feature[]>,\n    projectionIn: string,\n    projectionOut: string\n  ) => void {\n    const extension = getFileExtension(file);\n    const mimeType = file.type;\n    const allowedMimeTypes = [\n      ...ImportService.allowedMimeTypes,\n      ...ImportService.allowedZipMimeTypes\n    ];\n    const allowedExtensions = ImportService.allowedExtensions;\n\n    if (\n      allowedMimeTypes.indexOf(mimeType) < 0 &&\n      allowedExtensions.indexOf(extension) < 0\n    ) {\n      return undefined;\n    } else if (\n      mimeType === 'application/json' ||\n      ['json', 'geojson', 'kml', 'gpx'].indexOf(extension) >= 0\n    ) {\n      return this.importFile;\n    } else if (this.ogreUrl !== undefined) {\n      return this.importFileWithOgre;\n    }\n\n    return undefined;\n  }\n\n  private importAsync(\n    file: File,\n    projectionIn: string,\n    projectionOut: string\n  ): Observable<Feature[]> {\n    const doImport = (observer: Observer<Feature[]>) => {\n      if (file.size >= this.clientSideFileSizeMax) {\n        observer.error(new ImportSizeError());\n        return;\n      }\n      const importer = this.getFileImporter(file);\n      if (importer === undefined) {\n        observer.error(new ImportInvalidFileError());\n        return;\n      }\n\n      importer.call(this, file, observer, projectionIn, projectionOut);\n    };\n\n    return new Observable(doImport);\n  }\n\n  private importFile(\n    file: File,\n    observer: Observer<Feature[]>,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const reader = new FileReader();\n\n    reader.onload = (event: any) => {\n      try {\n        const features = this.parseFeaturesFromFile(\n          file,\n          event.target.result,\n          projectionIn,\n          projectionOut\n        );\n        observer.next(features);\n      } catch (e) {\n        observer.error(new ImportUnreadableFileError());\n      }\n\n      observer.complete();\n    };\n\n    reader.onerror = evt => {\n      observer.error(new ImportUnreadableFileError());\n    };\n\n    reader.readAsText(file, 'UTF-8');\n  }\n\n  private importFileWithOgre(\n    file: File,\n    observer: Observer<Feature[]>,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const url = `${this.ogreUrl}/convert`;\n    const formData = new FormData();\n    formData.append('upload', file);\n    formData.append('sourceSrs', projectionIn);\n    formData.append('targetSrs', projectionOut);\n    formData.append('formatOutput', 'GEOJSON');\n    formData.append('skipFailures', '');\n\n    this.http.post(url, formData, { headers: new HttpHeaders() })\n    .subscribe(\n      (response: { errors?: string[] } | object | null) => {\n        if (response === null) {\n          observer.error(new ImportUnreadableFileError());\n          return;\n        }\n\n        const errors = (response as any).errors || [];\n        if (errors.length > 0) {\n          observer.error(new ImportUnreadableFileError());\n        } else {\n          const features = this.parseFeaturesFromGeoJSON(\n            file,\n            response,\n            projectionOut\n          );\n          observer.next(features);\n          observer.complete();\n        }\n      },\n      (error: any) => {\n        error.error.caught = true;\n        const errMsg = error.error.msg || '';\n        if (errMsg === 'No valid files found') {\n          observer.error(new ImportInvalidFileError());\n        } else if (errMsg && errMsg.startWith('ERROR 1: Failed to process SRS definition')\n        ) {\n          observer.error(new ImportSRSError());\n        } else if (error.status === 500) {\n          observer.error(new ImportOgreServerError());\n        } else {\n          observer.error(new ImportUnreadableFileError());\n        }\n      }\n    );\n  }\n\n  private parseFeaturesFromFile(\n    file: File,\n    data: string,\n    projectionIn: string,\n    projectionOut: string\n  ): Feature[] {\n    const extension = getFileExtension(file);\n    const mimeType = file.type;\n\n    const GeoJSON = new olformat.GeoJSON();\n\n    let format;\n    if (mimeType === 'application/vnd.google-earth.kml+xml') {\n      format = new olformat.KML();\n    } else if (mimeType === 'application/gml+xml') {\n      format = new olformat.GML();\n    } else if (mimeType === 'application/gpx+xml') {\n      format = new olformat.GPX();\n    } else {\n      switch (extension) {\n        case 'kml':\n          format = new olformat.KML();\n          break;\n        case 'gpx':\n          format = new olformat.GPX();\n          break;\n        case 'gml':\n          format = new olformat.GML();\n          break;\n        default:\n          format = GeoJSON;\n          break;\n      }\n    }\n\n    const olFeatures = format.readFeatures(data, {\n      dataProjection: projectionIn,\n      featureProjection: projectionOut\n    });\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      return Object.assign(GeoJSON.writeFeatureObject(olFeature), {\n        projection: projectionOut,\n        meta: {\n          id: uuid(),\n          title: computeLayerTitleFromFile(file)\n        }\n      });\n    });\n\n    return features;\n  }\n\n  private parseFeaturesFromGeoJSON(\n    file: File,\n    data: object,\n    projectionOut: string\n  ): Feature[] {\n    const olFormat = new olformat.GeoJSON();\n    const olFeatures = olFormat.readFeatures(data);\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      return Object.assign(olFormat.writeFeatureObject(olFeature), {\n        projection: projectionOut,\n        meta: {\n          id: uuid(),\n          title: computeLayerTitleFromFile(file)\n        }\n      });\n    });\n\n    return features as Feature[];\n  }\n}\n","import { Injectable, Injector } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { throwError } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { StyleListOptions } from './style-list.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StyleListService {\n  private styleList: object = {};\n\n  constructor(private injector: Injector) {}\n\n  /**\n   * Use to get the data found in styleList file\n   */\n  public getStyleList(key: string): any {\n    return ObjectUtils.resolve(this.styleList, key);\n  }\n\n  /**\n   * This method loads \"[path]\" to get all styleList's variables\n   */\n  public load(options: StyleListOptions) {\n    const baseStyleList = options.default || {};\n    if (!options.path) {\n      this.styleList = baseStyleList;\n      return true;\n    }\n\n    const http = this.injector.get(HttpClient);\n\n    return new Promise((resolve, _reject) => {\n      http\n        .get(options.path)\n        .pipe(\n          catchError((error: any): any => {\n            console.log(`StyleList file ${options.path} could not be read`);\n            resolve(true);\n            return throwError(error.error || 'Server error');\n          })\n        )\n        .subscribe((styleListResponse: object) => {\n          this.styleList = ObjectUtils.mergeDeep(baseStyleList, styleListResponse);\n          resolve(true);\n        });\n    });\n  }\n}\n","<div class=\"import-export-toggle mat-typography\">\n  <mat-button-toggle-group\n        [value]=\"selectedMode\"\n        (change)=\"onImportExportChange($event)\">\n        <mat-button-toggle [value]=\"'import'\">\n          {{'igo.geo.importExportForm.importTabTitle' | translate}}\n        </mat-button-toggle>\n        <mat-button-toggle [value]=\"'export'\">\n          {{'igo.geo.importExportForm.exportTabTitle' | translate}}\n        </mat-button-toggle>\n  </mat-button-toggle-group>\n</div>\n\n<form class=\"igo-form\" [formGroup]=\"importForm\" *ngIf=\"selectedMode === 'import'\">\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.importExportForm.importProjPlaceholder' | translate}}</mat-label>\n      <mat-select\n        [(value)]=\"inputProj\">\n        <mat-option\n          *ngFor=\"let projection of (projections$ | async)\"\n          [value]=\"projection\"\n          (click)=\"$event.stopPropagation()\">\n          <p mat-line *ngIf=\"projection.translateKey\">{{('igo.geo.importExportForm.projections.' + projection.translateKey) | translate: projection}}</p>\n          <p mat-line *ngIf=\"!projection.translateKey\">{{projection.alias}}</p>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"importForm.invalid ? ('igo.geo.importExportForm.projections.choose' | translate) : ('igo.geo.importExportForm.importButton' | translate)\"\n    class=\"igo-form-button-group\">\n    <button\n      [disabled]=\"importForm.invalid || (loading$ | async)\"\n      mat-raised-button\n      type=\"button\"\n      (click)=\"fileInput.click()\">\n        {{'igo.geo.importExportForm.importButton' | translate}}\n    </button>\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n    <input\n      hidden\n      #fileInput\n      type=\"file\"\n      [style.display]=\"'none'\"\n      (click)=\"fileInput.value = null\"\n      (change)=\"importFiles($event.target.files)\">\n  </div>\n</form>\n<section class=\"mat-typography\" *ngIf=\"selectedMode === 'import'\">\n  <h4>{{'igo.geo.importExportForm.importClarifications' | translate}}</h4>\n  <ul>\n    <li>{{'igo.geo.importExportForm.importSizeMax' | translate: {size: fileSizeMb} }}</li>\n    <li>{{'igo.geo.importExportForm.importFormatAuthorized' | translate}}</li>\n    <li>{{'igo.geo.importExportForm.importShpZip' | translate}}</li>\n  </ul>\n</section>\n\n<section class=\"mat-typography\" *ngIf=\"(exportableLayers$ | async).length === 0 && selectedMode === 'export'\">\n  <h4>{{'igo.geo.importExportForm.exportNoLayersExportable' | translate}}</h4>\n</section>\n\n<form class=\"igo-form\" [formGroup]=\"form\" *ngIf=\"(exportableLayers$ | async).length > 0 && selectedMode === 'export'\">\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.importExportForm.exportLayerPlaceholder' | translate}}</mat-label>\n      <mat-select\n        [(value)]=\"layers\" multiple>\n        <mat-select-trigger>\n          {{layers.length ? getLayerTitleById(layers[0]) : ''}}\n          <span *ngIf=\"layers.length > 1\" class=\"export-select-trigger\">\n            (+{{layers.length - 1}} {{(layers?.length === 2 ? 'igo.geo.importExportForm.other' : 'igo.geo.importExportForm.others') | translate }})\n          </span>\n        </mat-select-trigger>\n        <mat-option\n          *ngFor=\"let layer of (exportableLayers$ | async)\"\n          [ngClass]=\"{'igo-export-layer-mat-option': layerHasSelectedFeatures(layer)}\"\n          [value]=\"layer.id\"\n          (click)=\"$event.stopPropagation()\">\n          <p mat-line>{{layer.title}}</p>\n          <p mat-line>\n            <mat-slide-toggle *ngIf=\"layerHasSelectedFeatures(layer)\"\n              [labelPosition]=\"'after'\"\n              (click)=\"onlySelectedClick($event,layer.id)\"\n              (checked)=\"inLayersIdToExportSelectionOnly(layer)\"\n              (change)=\"onlySelected($event,layer.id)\">\n              <small>{{'igo.geo.importExportForm.exportSelectedFeature' | translate}}</small>\n            </mat-slide-toggle>\n          </p>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.importExportForm.exportFormatPlaceholder' | translate}}</mat-label>\n      <mat-select\n        formControlName=\"format\">\n        <ng-container *ngIf=\"(formats$ | async).length !== 0\">\n          <mat-option *ngFor=\"let format of (formats$ | async) | keyvalue\" [value]=\"format.key\">\n            {{'igo.geo.export.format.' + format.value | translate}}\n          </mat-option>\n        </ng-container>\n        <mat-option *ngIf=\"(formats$ | async).length === 0\" disabled=\"true\">\n          {{'igo.geo.export.noFormat.title' | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" *ngIf=\"forceNaming && form.value.format !== 'URL'\">\n    <mat-form-field>\n        <input matInput formControlName=\"name\" placeholder=\"{{'igo.geo.importExportForm.exportFileNamePlaceholder' | translate}}\">\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" *ngIf=\"form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon'\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.importExportForm.encodingPlaceholder' | translate}}</mat-label>\n      <mat-select\n        formControlName=\"encoding\">\n        <ng-container *ngIf=\"(encodings$ | async).length !== 0\">\n          <mat-option *ngFor=\"let encoding of (encodings$ | async) | keyvalue\" [value]=\"encoding.key\">\n            {{'igo.geo.export.encoding.' + encoding.value | translate}}\n          </mat-option>\n        </ng-container>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"export-combine-layers mat-typography\" *ngIf=\"layers.length > 1 && (form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon')\">\n    <mat-slide-toggle\n        formControlName=\"combineLayers\"\n        [labelPosition]=\"'before'\">\n          {{'igo.geo.importExportForm.exportCombineResults' | translate}}\n    </mat-slide-toggle>\n  </div>\n\n  <div class=\"export-separator mat-typography\" *ngIf=\"layers.length > 1 && (form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon') && form.value.combineLayers\">\n    <mat-slide-toggle\n        formControlName=\"separator\"\n        [labelPosition]=\"'before'\">\n          {{'igo.geo.importExportForm.exportSeparator' | translate}}\n    </mat-slide-toggle>\n  </div>\n\n  <div class=\"export-options mat-typography\" *ngIf=\"form.value.format !== 'URL'\">\n    <mat-slide-toggle\n        formControlName=\"featureInMapExtent\"\n        [labelPosition]=\"'before'\">\n          {{'igo.geo.importExportForm.exportFeatureInExtent' | translate}}\n    </mat-slide-toggle>\n  </div>\n\n  <div class=\"igo-form-button-group\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      [disabled]=\"!form.valid || (loading$ | async)\"\n      (click)=\"handleExportFormSubmit(form.value)\">\n      {{form.value.format !== 'URL'  ? ('igo.geo.importExportForm.exportButton' | translate): (form.value.layers.length > 1  ? ('igo.geo.importExportForm.exportButtonLinks' | translate): ('igo.geo.importExportForm.exportButtonLink' | translate))}}\n    </button>\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n  </div>\n\n</form>\n","import {\n  Component,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output,\n  EventEmitter,\n  ChangeDetectorRef\n} from '@angular/core';\nimport { FormGroup, FormBuilder, Validators } from '@angular/forms';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport {\n  MessageService,\n  LanguageService,\n  ConfigService,\n  StorageService\n} from '@igo2/core';\nimport { strEnum } from '@igo2/utils';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { IgoMap } from '../../map/shared/map';\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\nimport olPoint from 'ol/geom/Point';\nimport { circular } from 'ol/geom/Polygon';\n\nimport {\n  handleFileExportError,\n  handleFileExportSuccess\n} from '../shared/export.utils';\nimport { ExportOptions } from '../shared/export.interface';\nimport { ExportFormat, EncodingFormat } from '../shared/export.type';\nimport { ExportService } from '../shared/export.service';\nimport { ImportService } from '../shared/import.service';\nimport {\n  handleFileImportSuccess,\n  handleFileImportError\n} from '../shared/import.utils';\nimport { StyleService } from '../../layer/shared/style.service';\nimport { StyleListService } from '../style-list/style-list.service';\nimport { skipWhile } from 'rxjs/operators';\nimport { EntityRecord, Workspace } from '@igo2/common';\nimport type { WorkspaceStore } from '@igo2/common';\nimport { WfsWorkspace } from '../../workspace/shared/wfs-workspace';\nimport { EditionWorkspace } from '../../workspace/shared/edition-workspace';\nimport { FeatureWorkspace } from '../../workspace/shared/feature-workspace';\nimport { MatSlideToggleChange } from '@angular/material/slide-toggle';\nimport { InputProjections, ProjectionsLimitationsOptions } from '../../map/';\nimport { DownloadService } from '../../download/shared/download.service';\nimport { computeProjectionsConstraints } from '../../map';\n\nimport olVectorSource from 'ol/source/Vector';\nimport olClusterSource from 'ol/source/Cluster';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\n@Component({\n  selector: 'igo-import-export',\n  templateUrl: './import-export.component.html',\n  styleUrls: ['./import-export.component.scss']\n})\nexport class ImportExportComponent implements OnDestroy, OnInit {\n  public form: FormGroup;\n  public importForm: FormGroup;\n  public formats$ = new BehaviorSubject(undefined);\n  public encodings$ = new BehaviorSubject(undefined);\n  public exportableLayers$: BehaviorSubject<AnyLayer[]> = new BehaviorSubject(\n    []\n  );\n  public loading$ = new BehaviorSubject(false);\n  public forceNaming = false;\n  public controlFormat = 'format';\n\n  private layers$$: Subscription;\n  private exportableLayers$$: Subscription;\n  private formats$$: Subscription;\n  private encodings$$: Subscription;\n  private formLayer$$: Subscription;\n  private exportOptions$$: Subscription;\n\n\n  private espgCodeRegex = new RegExp('^\\\\d{4,6}');\n  private clientSideFileSizeMax: number;\n  public fileSizeMb: number;\n\n  public projections$: BehaviorSubject<InputProjections[]> = new BehaviorSubject([]);\n  private projectionsConstraints: ProjectionsLimitationsOptions;\n\n  public popupChecked: boolean = false;\n\n  private previousLayerSpecs$: BehaviorSubject<\n    {\n      id: string;\n      visible: boolean;\n      opacity: number;\n      queryable: boolean;\n    }[]\n  > = new BehaviorSubject(undefined);\n\n  @Input() selectFirstProj: boolean = false;\n\n  @Input() map: IgoMap;\n\n  private _projectionsLimitations: ProjectionsLimitationsOptions = {};\n  @Input()\n  set projectionsLimitations(value: ProjectionsLimitationsOptions) {\n    this._projectionsLimitations = value;\n    this.computeProjections();\n  }\n  get projectionsLimitations(): ProjectionsLimitationsOptions {\n    return this._projectionsLimitations || {};\n  }\n\n  /**\n   * Store that holds the available workspaces.\n   */\n  @Input() store: WorkspaceStore;\n\n  @Input() selectedMode = 'import';\n\n  @Output() selectMode = new EventEmitter<string>();\n\n  @Input() exportOptions$: BehaviorSubject<ExportOptions> = new BehaviorSubject(\n    undefined\n  );\n\n  @Output() exportOptionsChange = new EventEmitter<ExportOptions>();\n\n  get layers() {\n    return this.form.get('layers').value;\n  }\n  set layers(value) {\n    this.form.patchValue({ layers: value });\n  }\n\n  get inputProj() {\n    return this.importForm.get('inputProj').value;\n  }\n  set inputProj(value) {\n    this.importForm.patchValue({ inputProj: value });\n  }\n\n  get popupAllowed(): boolean {\n    return this.storageService.get('importExportPopupAllowed') as boolean || false;\n  }\n\n  set popupAllowed(value: boolean) {\n    this.storageService.set('importExportPopupAllowed', value);\n  }\n\n  constructor(\n    private importService: ImportService,\n    private exportService: ExportService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private styleListService: StyleListService,\n    private styleService: StyleService,\n    private formBuilder: FormBuilder,\n    private config: ConfigService,\n    private cdRef: ChangeDetectorRef,\n    private storageService: StorageService,\n    private downloadService: DownloadService\n  ) {\n    this.loadConfig();\n    this.buildForm();\n    this.computeProjections();\n  }\n\n  ngOnInit() {\n    this.layers$$ = this.map.layers$.subscribe((layers) => {\n      this.exportableLayers$.next(\n        layers.filter((layer: Layer) => {\n          return (\n            (layer instanceof VectorLayer && layer.exportable === true) ||\n            (layer.dataSource.options.download &&\n              layer.dataSource.options.download.url)\n          );\n        }) as AnyLayer[]\n      );\n    });\n    const configFileSizeMb = this.config.getConfig(\n      'importExport.clientSideFileSizeMaxMb'\n    );\n    this.clientSideFileSizeMax =\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\n    this.fileSizeMb = this.clientSideFileSizeMax / Math.pow(1024, 2);\n\n    this.exportOptions$$ = this.exportOptions$\n      .pipe(skipWhile((exportOptions) => !exportOptions))\n      .subscribe((exportOptions) => {\n        this.form.patchValue(exportOptions, { emitEvent: true });\n        if (exportOptions.layers) {\n          this.computeFormats(\n            exportOptions.layers.map((l) => this.map.getLayerById(l))\n          );\n        }\n      });\n    this.formLayer$$ = this.form\n      .get('format')\n      .valueChanges\n      .subscribe((format) => {\n        const ogreFormats = Object.keys(ExportService.ogreFormats);\n        if (\n          !this.popupChecked &&\n          this.form.get('layers').value?.length > 1 &&\n          (ogreFormats.indexOf(format) >= 0 || format === ExportFormat.URL)) {\n          if (!this.handlePopup(true)) {\n            this.form.patchValue({ format: undefined }, { emitEvent: false });\n          }\n        }\n      });\n\n    this.formLayer$$ = this.form\n      .get('layers')\n      .valueChanges.subscribe((layersId) => {\n        this.handlePreviousLayerSpecs();\n        const selectedLayers = layersId instanceof Array ? layersId : [layersId];\n        this.form.patchValue({ layers: selectedLayers }, { emitEvent: false });\n        const layers = selectedLayers.map((l) => this.map.getLayerById(l));\n        this.computeFormats(layers);\n\n        if (\n          Object.keys(this.formats$.value).indexOf(this.form.value.format) ===\n          -1\n        ) {\n          this.form.patchValue({ format: undefined });\n        }\n\n        this.loading$.next(true);\n        const previousSpecs: {\n          id: string;\n          visible: boolean;\n          opacity: number;\n          queryable: boolean;\n        }[] = [];\n        layers.forEach((layer) => {\n          if (\n            layer instanceof VectorLayer &&\n            layer.dataSource.ol.getFeatures().length === 0\n          ) {\n            previousSpecs.push({\n              id: layer.id,\n              visible: layer.visible,\n              opacity: layer.opacity,\n              queryable: (layer as any).queryable\n            });\n            layer.opacity = 0;\n            layer.visible = true;\n          }\n        });\n\n        this.previousLayerSpecs$.next(previousSpecs);\n        setTimeout(() => {\n          this.loading$.next(false);\n        }, 500);\n      });\n\n    this.formats$$ = this.formats$\n      .pipe(skipWhile((formats) => !formats))\n      .subscribe((formats) => {\n        if (Object.keys(formats).length === 1) {\n          this.form.patchValue({ format: formats[Object.keys(formats)[0]] });\n        }\n      });\n\n    this.encodings$$ = this.encodings$\n      .pipe(skipWhile((encodings) => !encodings))\n      .subscribe((encodings) => {\n        if (Object.keys(encodings).length === 1) {\n          this.form.patchValue({ encoding: encodings[Object.keys(encodings)[0]] });\n        }\n      });\n\n    this.exportableLayers$$ = this.exportableLayers$\n      .pipe(skipWhile((layers) => !layers))\n      .subscribe((layers) => {\n        if (layers.length === 1) {\n          this.form.patchValue({ layers: layers[0].id });\n        }\n      });\n\n    this.form.controls[this.controlFormat].valueChanges.subscribe((format) => {\n      if (format === ExportFormat.CSVcomma || format === ExportFormat.CSVsemicolon) {\n        this.form.patchValue({ encoding: EncodingFormat.LATIN1 });\n      } else {\n        this.form.patchValue({ encoding: EncodingFormat.UTF8 });\n      }\n      this.cdRef.detectChanges();\n    });\n\n    if (this.selectFirstProj) {\n      if (this.projections$.value.length === 0) {\n        this.importForm.patchValue({ inputProj: { translateKey: 'nad83', alias: 'NAD83', code: 'EPSG:4326', zone: '' } });\n      } else {\n        this.importForm.patchValue({ inputProj: this.projections$.value[0] });\n      }\n    } else {\n      this.importForm.patchValue({ inputProj: undefined });\n    }\n  }\n\n  private computeProjections() {\n    this.projectionsConstraints = computeProjectionsConstraints(this.projectionsLimitations);\n    const projections: InputProjections[] = [];\n\n    if (this.projectionsConstraints.nad83) {\n      projections.push({ translateKey: 'nad83', alias: 'NAD83', code: 'EPSG:4269', zone: '' });\n    }\n    if (this.projectionsConstraints.wgs84) {\n      projections.push({ translateKey: 'wgs84', alias: 'WGS84', code: 'EPSG:4326', zone: '' });\n    }\n    if (this.projectionsConstraints.webMercator) {\n      projections.push({ translateKey: 'webMercator', alias: 'Web Mercator', code: 'EPSG:3857', zone: '' });\n    }\n\n    if (this.projectionsConstraints.mtm) {\n      // all mtm zones\n      const minZone = this.projectionsConstraints.mtmZone.minZone;\n      const maxZone = this.projectionsConstraints.mtmZone.maxZone;\n\n      for (let mtmZone = minZone; mtmZone <= maxZone; mtmZone++) {\n        const code = mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n        projections.push({ translateKey: 'mtm', alias: `MTM ${mtmZone}`, code, zone: `${mtmZone}` });\n      }\n    }\n\n    if (this.projectionsConstraints.utm) {\n      // all utm zones\n      const minZone = this.projectionsConstraints.utmZone.minZone;\n      const maxZone = this.projectionsConstraints.utmZone.maxZone;\n\n      for (let utmZone = minZone; utmZone <= maxZone; utmZone++) {\n        const code = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n        projections.push({ translateKey: 'utm', alias: `UTM ${utmZone}`, code, zone: `${utmZone}` });\n      }\n    }\n\n    let configProjection = [];\n    if (this.projectionsConstraints.projFromConfig) {\n      configProjection = this.config.getConfig('projections') || [];\n    }\n\n    this.projections$.next(configProjection.concat(projections));\n  }\n\n  private getWorkspaceByLayerId(id: string): Workspace {\n    const wksFromLayerId = this.store\n      .all()\n      .find(workspace => (workspace as WfsWorkspace | FeatureWorkspace | EditionWorkspace).layer.id === id);\n    if (wksFromLayerId) {\n      return wksFromLayerId;\n    }\n    return;\n  }\n\n  public getLayerTitleById(id): string {\n    return this.map.getLayerById(id)?.title;\n  }\n\n\n  layerHasSelectedFeatures(layer: Layer): boolean {\n    const wksFromLayer = this.getWorkspaceByLayerId(layer.id);\n    if (wksFromLayer) {\n      const recs = wksFromLayer.entityStore.stateView\n        .firstBy((record: EntityRecord<Feature>) => {\n          return record.state.selected === true;\n        });\n      return recs ? true : false;\n    }\n  }\n\n  public onlySelected(event: MatSlideToggleChange, id: string) {\n    let layersWithSelection = this.form.value.layersWithSelection;\n    if (event.checked) {\n      layersWithSelection.push(id);\n    } else {\n      layersWithSelection = layersWithSelection.filter(layerId => layerId !== id);\n    }\n    this.form.patchValue({ layersWithSelection });\n  }\n\n  public onlySelectedClick(event, id: string) {\n    if (this.form.value.layers.find(layerId => layerId === id)) {\n      event.stopPropagation();\n    }\n  }\n\n  public inLayersIdToExportSelectionOnly(layer: Layer): boolean {\n    return this.form.value.layersWithSelection.find(layerId => layerId === layer.id) ? true : false;\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n    this.exportableLayers$$.unsubscribe();\n    this.formats$$.unsubscribe();\n    this.encodings$$.unsubscribe();\n    this.formLayer$$.unsubscribe();\n    if (this.exportOptions$$) {\n      this.exportOptions$$.unsubscribe();\n    }\n    this.exportOptionsChange.emit(this.form.value);\n    this.handlePreviousLayerSpecs();\n  }\n\n  private handlePreviousLayerSpecs() {\n    const previousSpecs = this.previousLayerSpecs$.value;\n    if (previousSpecs && previousSpecs.length) {\n      previousSpecs.forEach((specs) => {\n        const previousLayer = this.map.getLayerById(specs.id);\n        previousLayer.visible = specs.visible;\n        previousLayer.opacity = specs.opacity;\n        (previousLayer as any).queryable = specs.queryable;\n      });\n    }\n    this.previousLayerSpecs$.next(undefined);\n  }\n\n  importFiles(files: File[]) {\n    let inputProj = this.inputProj.code;\n    if (this.espgCodeRegex.test(inputProj)) {\n      inputProj = `EPSG:${inputProj}`;\n    }\n\n    this.loading$.next(true);\n    for (const file of files) {\n      this.importService.import(file, inputProj).subscribe(\n        (features: Feature[]) => this.onFileImportSuccess(file, features),\n        (error: Error) => this.onFileImportError(file, error),\n        () => {\n          this.loading$.next(false);\n        }\n      );\n    }\n  }\n\n  handlePopup(preCheck: boolean = true): boolean {\n    const p1 = window.open('', 'popup', 'width=1, height=1');\n    p1.close();\n    const p2 = window.open('', 'popup', 'width=1, height=1');\n    if (!p2 || p2.closed || typeof p2.closed === 'undefined' || p2 === null) {\n      this.onPopupBlockedError(preCheck);\n      this.popupAllowed = false;\n    } else {\n      p2.close();\n      this.popupAllowed = true;\n      this.popupChecked = true;\n    }\n    return this.popupAllowed;\n  }\n\n  handleExportFormSubmit(data: ExportOptions) {\n    this.loading$.next(true);\n\n    const ogreFormats = Object.keys(ExportService.ogreFormats);\n    if (!this.popupChecked && data.layers.length > 1 &&\n      (ogreFormats.indexOf(data.format) >= 0 || data.format === ExportFormat.URL) && !this.popupAllowed) {\n      this.handlePopup();\n    }\n\n    let geomTypesCSV: { geometryType: string, features: any[] }[] = [];\n    let featuresCSV: any[] = [];\n    let filename: string = \"\";\n\n    for (const [layerIndex, layer] of data.layers.entries()) {\n      const lay = this.map.getLayerById(layer);\n      if (!(data.format === ExportFormat.CSVsemicolon || data.format === ExportFormat.CSVcomma)\n      || !data.combineLayers || data.layers.length === 1) {\n        filename = lay.title;\n        if (data.name) {\n          filename = data.name;\n        }\n      } else {\n        filename = this.languageService.translate.instant('igo.geo.export.combinedLayers');\n      }\n      const dSOptions: DataSourceOptions = lay.dataSource.options;\n      if (data.format === ExportFormat.URL && dSOptions.download && (dSOptions.download.url || dSOptions.download.dynamicUrl)) {\n        setTimeout(() => {\n          // better look an feel\n          const url = dSOptions.download.url || dSOptions.download.dynamicUrl;\n          url.match(/service=wfs/gi) ? this.downloadService.open(lay) : window.open(url , '_blank');\n          this.loading$.next(false);\n        }, 500);\n        return;\n      }\n      const wks = this.getWorkspaceByLayerId(layer);\n      let olFeatures;\n      if (wks && wks.entityStore && wks.entityStore.stateView.all().length) {\n\n        if (data.layersWithSelection.indexOf(layer) !== -1 && data.featureInMapExtent) {\n          // Only export selected feature && into map extent\n          olFeatures = wks.entityStore.stateView.all()\n            .filter((e: EntityRecord<object>) => e.state.inMapExtent && e.state.selected).map(e => (e.entity as Feature).ol);\n        } else if (data.layersWithSelection.indexOf(layer) !== -1 && !data.featureInMapExtent) {\n          // Only export selected feature &&  (into map extent OR not)\n          olFeatures = wks.entityStore.stateView.all()\n            .filter((e: EntityRecord<object>) => e.state.selected).map(e => (e.entity as Feature).ol);\n        } else if (data.featureInMapExtent) {\n          // Only into map extent\n          olFeatures = wks.entityStore.stateView.all()\n            .filter((e: EntityRecord<object>) => e.state.inMapExtent).map(e => (e.entity as Feature).ol);\n        } else {\n          // All features\n          olFeatures = wks.entityStore.stateView.all().map(e => (e.entity as Feature).ol);\n        }\n      }\n      else {\n        const ol = lay.dataSource.ol as olVectorSource<OlGeometry> | olClusterSource ;\n        if (data.featureInMapExtent) {\n          olFeatures = ol.getFeaturesInExtent(\n            lay.map.viewController.getExtent()\n          );\n        } else {\n          olFeatures = ol.getFeatures();\n        }\n        if (lay.dataSource instanceof ClusterDataSource) {\n          olFeatures = olFeatures.flatMap((cluster: any) =>\n            cluster.get('features')\n          );\n        }\n      }\n\n      const translate = this.languageService.translate;\n      let geomTypes: { geometryType: string, features: any[] }[] = [];\n      if (data.format === ExportFormat.Shapefile || data.format === ExportFormat.GPX) {\n        olFeatures.forEach((olFeature) => {\n          const featureGeomType = olFeature.getGeometry().getType();\n          const currentGeomType = geomTypes.find(geomType => geomType.geometryType === featureGeomType);\n          if (currentGeomType) {\n            currentGeomType.features.push(olFeature);\n          } else {\n            geomTypes.push({ geometryType: featureGeomType, features: [olFeature] });\n          }\n        });\n      } else {\n        geomTypes = [{ geometryType: '', features: olFeatures }];\n      }\n\n      geomTypes.forEach(geomType => {\n        geomType.features.forEach(feature => {\n          const radius: number = feature.get('rad');\n          if (radius) {\n            const center4326: Array<number> = [feature.get('longitude'), feature.get('latitude')];\n            const circle = circular(center4326, radius, 500);\n            circle.transform('EPSG:4326', feature.get('_projection'));\n            feature.setGeometry(circle);\n          }\n        });\n      });\n\n      if (data.format === ExportFormat.GPX) {\n        const gpxFeatureCnt = geomTypes.length;\n        geomTypes = geomTypes.filter(geomType => ['LineString', 'Point'].includes(geomType.geometryType));\n        const gpxFeatureCntPointOrPoly = geomTypes.length;\n        if (gpxFeatureCnt > gpxFeatureCntPointOrPoly) {\n          const title = translate.instant('igo.geo.export.gpx.error.poly.title');\n          const message = translate.instant('igo.geo.export.gpx.error.poly.text');\n          this.messageService.error(message, title, { timeOut: 20000 });\n        }\n      } else if ((data.format === ExportFormat.CSVsemicolon || data.format === ExportFormat.CSVcomma) && data.combineLayers) {\n        geomTypes.forEach(geomType => geomTypesCSV.push(geomType));\n\n        if (layerIndex !== data.layers.length - 1) {\n          continue;\n        } else {\n          let previousFeature = undefined;\n          geomTypesCSV.forEach(geomType => {\n            geomType.features.forEach(currentFeature => {\n              if (data.separator) {\n                if (previousFeature) {\n                  if (currentFeature.get('_featureStore').layer.options.title !==\n                  previousFeature.get('_featureStore').layer.options.title) {\n                    const titleEmptyRows = this.createTitleEmptyRows(previousFeature, currentFeature);\n                    featuresCSV.push(titleEmptyRows[2]);\n                    featuresCSV.push(titleEmptyRows[0]);\n                    featuresCSV.push(titleEmptyRows[1]);\n                  }\n                } else {\n                  const titleEmptyRows = this.createTitleEmptyRows(currentFeature, currentFeature);\n                  featuresCSV.push(titleEmptyRows[0]);\n                }\n              }\n              featuresCSV.push(currentFeature);\n              previousFeature = currentFeature;\n            });\n          });\n        }\n      }\n\n      if (geomTypes.length === 0) {\n        this.loading$.next(false);\n        const title = translate.instant('igo.geo.export.nothing.title');\n        const message = translate.instant('igo.geo.export.nothing.text');\n        this.messageService.error(message, title, { timeOut: 20000 });\n\n      } else {\n        if (!(data.format === ExportFormat.CSVsemicolon || data.format === ExportFormat.CSVcomma) || !data.combineLayers) {\n          geomTypes.map(geomType =>\n            this.exportService.export(geomType.features, data.format, filename + geomType.geometryType, data.encoding, this.map.projection)\n            .subscribe(\n              () => {},\n              (error: Error) => this.onFileExportError(error),\n              () => {\n                this.onFileExportSuccess();\n\n                geomType.features.forEach(feature => {\n                  this.circleToPoint(feature);\n                });\n\n                this.loading$.next(false);\n            }\n          ));\n        }\n      }\n    };\n    if ((data.format === ExportFormat.CSVsemicolon || data.format === ExportFormat.CSVcomma) && data.combineLayers) {\n      this.exportService.export(featuresCSV, data.format, filename, data.encoding, this.map.projection)\n      .subscribe(\n        () => {},\n        (error: Error) => this.onFileExportError(error),\n        () => {\n          this.onFileExportSuccess();\n\n          featuresCSV.forEach(feature => {\n            this.circleToPoint(feature);\n          });\n\n          this.loading$.next(false);\n        }\n      );\n    }\n  }\n\n  private createTitleEmptyRows(previousFeature, currentFeature) {\n    const titleRow = currentFeature.clone();\n    const headerRow = currentFeature.clone();\n    const emptyRow = currentFeature.clone();\n    const previousFeatureKeys: Array<string> = previousFeature.getKeys();\n    let firstKeyPrevious: string = '';\n    for (const key in previousFeatureKeys) {\n      if (previousFeatureKeys[key] !== 'geometry') {\n        firstKeyPrevious = previousFeatureKeys[key];\n        break;\n      }\n    }\n\n    const currentFeatureKeys: Array<string> = currentFeature.getKeys();\n    let firstKeyCurrent: string = '';\n    for (const key in currentFeatureKeys) {\n      if (currentFeatureKeys[key] !== 'geometry') {\n        firstKeyCurrent = currentFeatureKeys[key];\n        break;\n      }\n    }\n    const allKeys: Array<string> = currentFeature.getKeys();\n    previousFeatureKeys.forEach(previousKey => {\n      if (allKeys.includes(previousKey) && previousKey !== firstKeyPrevious) {\n        allKeys.push(previousKey);\n      }\n    });\n    allKeys.unshift(firstKeyPrevious);\n\n    let firstKeyAll: string = '';\n    for (const key in allKeys) {\n      if (allKeys[key] !== 'geometry') {\n        firstKeyAll = allKeys[key];\n        break;\n      }\n    }\n    allKeys.forEach(key => {\n      const sameKeys: boolean = previousFeatureKeys.length === currentFeatureKeys.length &&\n      previousFeatureKeys.every((value, index) => value === currentFeatureKeys[index]);\n      if (key === firstKeyAll && !sameKeys) {\n        titleRow.set(key, currentFeature.get('_featureStore').layer.options.title + \" ===============>\", true);\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else if (key === firstKeyAll && sameKeys) {\n        titleRow.set(key, currentFeature.get('_featureStore').layer.options.title, true);\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else if (key === firstKeyCurrent) {\n        titleRow.set(key, currentFeature.get('_featureStore').layer.options.title, true);\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else if (key !== 'geometry') {\n        titleRow.unset(key, true);\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else {\n        titleRow.unset(key, true);\n        emptyRow.unset(key, true);\n      }\n\n      if (!(currentFeatureKeys.includes(key))) {\n        headerRow.unset(key, true);\n      }\n    });\n    const titleEmptyRows = [titleRow, headerRow, emptyRow];\n    return titleEmptyRows;\n  }\n\n  private circleToPoint(feature) {\n    const radius: number = feature.get('rad');\n\n    if (radius) {\n      const point = new olPoint([feature.get('longitude'), feature.get('latitude')]);\n      point.transform('EPSG:4326', feature.get('_projection'));\n      feature.setGeometry(point);\n    }\n  }\n\n  private buildForm() {\n    this.importForm = this.formBuilder.group({\n      inputProj: ['', [Validators.required]]\n    });\n\n    if (this.forceNaming) {\n      this.form = this.formBuilder.group({\n        format: ['', [Validators.required]],\n        layers: [[], [Validators.required]],\n        layersWithSelection: [[]],\n        encoding: [EncodingFormat.UTF8, [Validators.required]],\n        combineLayers: [true, [Validators.required]],\n        separator: [false, [Validators.required]],\n        featureInMapExtent: [false, [Validators.required]],\n        name: ['', [Validators.required]]\n      });\n    } else {\n      this.form = this.formBuilder.group({\n        format: ['', [Validators.required]],\n        layers: [[], [Validators.required]],\n        layersWithSelection: [[]],\n        encoding: [EncodingFormat.UTF8, [Validators.required]],\n        combineLayers: [true, [Validators.required]],\n        separator: [false, [Validators.required]],\n        featureInMapExtent: [false, [Validators.required]],\n      });\n    }\n  }\n\n  private onFileImportSuccess(file: File, features: Feature[]) {\n    if (!this.config.getConfig('importWithStyle')) {\n      handleFileImportSuccess(\n        file,\n        features,\n        this.map,\n        this.messageService,\n        this.languageService\n      );\n    } else {\n      handleFileImportSuccess(\n        file,\n        features,\n        this.map,\n        this.messageService,\n        this.languageService,\n        this.styleListService,\n        this.styleService\n      );\n    }\n  }\n\n  private onFileImportError(file: File, error: Error) {\n    this.loading$.next(false);\n    handleFileImportError(\n      file,\n      error,\n      this.messageService,\n      this.languageService,\n      this.fileSizeMb\n    );\n  }\n\n  private onPopupBlockedError(preCheck: boolean = true) {\n    this.loading$.next(false);\n    const translate = this.languageService.translate;\n    const title = translate.instant('igo.geo.export.popupBlocked.title');\n    const extraMessage = preCheck ?\n      translate.instant('igo.geo.export.popupBlocked.selectAgain') :\n      translate.instant('igo.geo.export.popupBlocked.retry');\n    const message = translate.instant('igo.geo.export.popupBlocked.text', { extraMessage });\n    this.messageService.error(message, title, { timeOut: 20000 });\n  }\n\n  private onFileExportError(error: Error) {\n    this.loading$.next(false);\n    handleFileExportError(error, this.messageService, this.languageService);\n  }\n\n  private loadConfig() {\n    if (this.config.getConfig('importExport.forceNaming') !== undefined) {\n      this.forceNaming = this.config.getConfig('importExport.forceNaming');\n    }\n    this.computeFormats();\n    this.loadEncodings();\n  }\n\n  public encodingDefaultValue(format: ExportFormat) {\n    if (format === ExportFormat.CSVcomma || format === ExportFormat.CSVsemicolon) {\n      this.form.patchValue({ encoding: EncodingFormat.LATIN1 });\n      return EncodingFormat.LATIN1;\n    } else {\n      this.form.patchValue({ encoding: EncodingFormat.UTF8 });\n      return EncodingFormat.UTF8;\n    }\n  }\n\n  private loadEncodings() {\n    this.encodings$.next(EncodingFormat);\n  }\n\n  private computeFormats(layers?: AnyLayer[]) {\n    let appliedformats: string[] = Object.keys(ExportFormat);\n    const formatsType = {\n      onlyUrl: false,\n      onlyVector: false,\n      vectorAndUrl: false,\n      customList: false\n    };\n    const customList = [];\n    if (layers && layers.length) {\n      layers.forEach((layer) => {\n        if (!layer) {\n          return;\n        }\n        if (layer.dataSource.options.download?.allowedFormats) {\n          formatsType.customList = true;\n          customList.push({layer: layer.title, formats: this.validateListFormat(layer.dataSource.options.download.allowedFormats)});\n        } else if (\n          !(layer instanceof VectorLayer) &&\n          layer.dataSource.options.download &&\n          layer.dataSource.options.download.url\n        ) {\n          formatsType.onlyUrl = true;\n        } else if (\n          layer.dataSource.options.download &&\n          (layer.dataSource.options.download.url || layer.dataSource.options.download.dynamicUrl)\n        ) {\n          formatsType.vectorAndUrl = true;\n        } else if (layer instanceof VectorLayer) {\n          formatsType.onlyVector = true;\n        }\n      });\n\n      if (formatsType.onlyUrl === true && formatsType.onlyVector === false) {\n        appliedformats = ['URL'];\n      } else if (\n        formatsType.onlyVector === true &&\n        formatsType.onlyUrl === false\n      ) {\n        this.computeFormats(); // reset\n        if (ExportFormat.URL in this.formats$.value) {\n          const keys = Object.keys(this.formats$.value).filter(\n            (key) => key !== 'URL'\n          );\n          appliedformats = keys;\n        }\n      } else if (\n        formatsType.vectorAndUrl === true &&\n        formatsType.onlyUrl === false &&\n        formatsType.onlyVector === false\n      ) {\n        this.computeFormats(); // reset\n        if (!(ExportFormat.URL in this.formats$.value)) {\n          const keys = Object.keys(this.formats$.value);\n          keys.push('URL');\n          appliedformats = keys;\n        }\n      }\n    }\n    if (this.config.getConfig('importExport.formats') !== undefined) {\n      const validatedListFormat = this.validateListFormat(\n        this.config.getConfig('importExport.formats')\n      );\n      appliedformats = validatedListFormat;\n    }\n    if (formatsType.customList) {\n      let commonFormats;\n      const layersWithCustomFormats = [];\n      let previousCustomListFormats = customList[0].formats;\n      customList.map(list => {\n        layersWithCustomFormats.push(list.layer);\n        commonFormats = list.formats.filter(value => previousCustomListFormats.includes(value));\n        previousCustomListFormats = list.formats;\n      });\n      const finalFormats = commonFormats.filter(value => appliedformats.includes(value));\n      if (finalFormats.length > 0) {\n        this.formats$.next(strEnum(finalFormats));\n\n        if (layers && layers.length) {\n          if (layers.length > 1) {\n            this.messageService.alert(\n              this.languageService.translate.instant('igo.geo.export.customList.text', { value: layersWithCustomFormats.join() }),\n              this.languageService.translate.instant('igo.geo.export.customList.title')\n            );\n          }\n        }\n      } else {\n        this.formats$.next([]);\n        this.messageService.alert(\n          this.languageService.translate.instant('igo.geo.export.noFormat.text'),\n          this.languageService.translate.instant('igo.geo.export.noFormat.title')\n        );\n      }\n      return;\n    } else {\n      this.formats$.next(strEnum(appliedformats));\n    }\n  }\n\n  private validateListFormat(formats: string[]): string[] {\n    return formats\n      .filter((format) => {\n        if (\n          format.toUpperCase() === ExportFormat.CSVcomma.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.CSVsemicolon.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GML.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GPX.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GeoJSON.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.KML.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.Shapefile.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.URL.toUpperCase()\n        ) {\n          return format;\n        }\n      })\n      .map((format) => {\n        if (format.toUpperCase() === ExportFormat.CSVcomma.toUpperCase()) {\n          format = ExportFormat.CSVcomma;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.CSVsemicolon.toUpperCase()) {\n          format = ExportFormat.CSVsemicolon;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GML.toUpperCase()) {\n          format = ExportFormat.GML;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GPX.toUpperCase()) {\n          format = ExportFormat.GPX;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GeoJSON.toUpperCase()) {\n          format = ExportFormat.GeoJSON;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.KML.toUpperCase()) {\n          format = ExportFormat.KML;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.Shapefile.toUpperCase()) {\n          format = ExportFormat.Shapefile;\n          return format;\n        }\n\n        if (format.toUpperCase() === ExportFormat.URL.toUpperCase()) {\n          format = ExportFormat.URL;\n          return format;\n        }\n      });\n  }\n\n  public modeChanged(mode) {\n    this.selectMode.emit(mode);\n  }\n\n  private onFileExportSuccess() {\n    handleFileExportSuccess(this.messageService, this.languageService);\n  }\n\n  onImportExportChange(event) {\n    this.selectedMode = event.value;\n  }\n}\n","import { Directive, HostListener, EventEmitter, OnInit, OnDestroy } from '@angular/core';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { MessageService, LanguageService, ConfigService } from '@igo2/core';\nimport { DragAndDropDirective } from '@igo2/common';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { ImportService } from './import.service';\nimport { handleFileImportSuccess, handleFileImportError } from '../shared/import.utils';\nimport { StyleService } from '../../layer/shared/style.service';\nimport { StyleListService } from '../style-list/style-list.service';\nimport { concatMap, first, skipWhile } from 'rxjs/operators';\n\n@Directive({\n  selector: '[igoDropGeoFile]'\n})\nexport class DropGeoFileDirective extends DragAndDropDirective implements OnInit, OnDestroy {\n\n  protected filesDropped: EventEmitter<File[]> = new EventEmitter();\n  protected filesInvalid: EventEmitter<File[]> = new EventEmitter();\n  private epsgCode$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n  private epsgCode$$: Subscription[] = [];\n  private filesDropped$$: Subscription;\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  constructor(\n    private component: MapBrowserComponent,\n    private importService: ImportService,\n    private languageService: LanguageService,\n    private styleListService: StyleListService,\n    private styleService: StyleService,\n    private config: ConfigService,\n    private messageService: MessageService\n  ) {\n    super();\n  }\n\n  ngOnInit() {\n    this.filesDropped$$ = this.filesDropped.subscribe((files: File[]) => {\n      this.onFilesDropped(files);\n    });\n  }\n\n  ngOnDestroy() {\n    this.filesDropped$$.unsubscribe();\n  }\n\n  @HostListener('dragover', ['$event'])\n  public onDragOver(evt) {\n    super.onDragOver(evt);\n  }\n\n  @HostListener('dragleave', ['$event'])\n  public onDragLeave(evt) {\n    super.onDragLeave(evt);\n  }\n\n  @HostListener('drop', ['$event'])\n  public onDrop(evt) {\n    super.onDrop(evt);\n  }\n\n  private onFilesDropped(files: File[]) {\n    for (const file of files) {\n      this.detectEPSG(file);\n      this.epsgCode$$.push(\n        this.epsgCode$.pipe(\n          skipWhile((code) => !code),\n          first(),\n          concatMap(epsgCode => {\n            const epsg = epsgCode === 'epsgNotDefined' ? undefined : epsgCode;\n            this.epsgCode$.next(undefined);\n            return this.importService.import(file, epsg);\n          }),\n        ).subscribe(\n          (features: Feature[]) => this.onFileImportSuccess(file, features),\n          (error: Error) => this.onFileImportError(file, error)\n        ));\n    }\n  }\n\n  private detectEPSG(file: File, nbLines: number = 500) {\n    if (!file.name.toLowerCase().endsWith('.geojson') && !file.name.toLowerCase().endsWith('.gml')) {\n      this.epsgCode$.next('epsgNotDefined');\n      return;\n    }\n    const reader = new FileReader();\n    reader.onload = (e) => {\n      if (file.name.toLowerCase().endsWith('.geojson')) {\n        const geojson = JSON.parse(reader.result as string);\n        if (geojson.crs?.properties?.name) {\n          const epsg = geojson.crs.properties.name.match(/EPSG:{1,2}\\d{0,6}/gm);\n          if (epsg !== null && epsg.length) {\n            this.epsgCode$.next(epsg[0].replace(/::/g, ':'));\n            return;\n          } else {\n            this.epsgCode$.next('epsgNotDefined');\n            return;\n          }\n        } else {\n          this.epsgCode$.next('epsgNotDefined');\n          return;\n      }\n      } else if (file.name.toLowerCase().endsWith('.gml')) {\n        const text = (reader.result as string);\n        const lines = (text as string).split('\\n');\n        for (let line = 0; line <= nbLines; line++) {\n          const epsg = lines[line].match(/EPSG:\\d{0,6}/gm);\n          if (epsg !== null && epsg.length) {\n              this.epsgCode$.next(epsg[0]);\n              break;\n          } else {\n            this.epsgCode$.next(undefined);\n            return;\n          }\n        }\n      } else {\n        this.epsgCode$.next('epsgNotDefined');\n        return;\n      }\n    };\n    reader.readAsText(file, 'UTF-8');\n  }\n\n  private onFileImportSuccess(file: File, features: Feature[]) {\n    if (!this.config.getConfig('importWithStyle')) {\n      handleFileImportSuccess(file, features, this.map, this.messageService, this.languageService);\n    } else {\n      handleFileImportSuccess(file, features, this.map, this.messageService, this.languageService,\n                               this.styleListService, this.styleService);\n    }\n  }\n\n  private onFileImportError(file: File, error: Error) {\n    handleFileImportError(\n      file,\n      error,\n      this.messageService,\n      this.languageService,\n      this.config.getConfig('importExport.clientSideFileSizeMaxMb'));\n  }\n}\n","import { APP_INITIALIZER, InjectionToken } from '@angular/core';\n\nimport { StyleListService } from './style-list.service';\nimport { StyleListOptions } from './style-list.interface';\n\nexport let STYLELIST_OPTIONS = new InjectionToken<StyleListOptions>('styleListOptions');\n\nexport function provideStyleListOptions(options: StyleListOptions) {\n  return {\n    provide: STYLELIST_OPTIONS,\n    useValue: options\n  };\n}\n\nexport function styleListFactory(\n  styleListService: StyleListService,\n  options: StyleListOptions\n) {\n  return () => styleListService.load(options);\n}\n\nexport function provideStyleListLoader() {\n  return {\n    provide: APP_INITIALIZER,\n    useFactory: styleListFactory,\n    multi: true,\n    deps: [StyleListService, STYLELIST_OPTIONS]\n  };\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { provideStyleListOptions, provideStyleListLoader } from './style-list.provider';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoStyleListModule {\n  static forRoot(): ModuleWithProviders<IgoStyleListModule> {\n    return {\n      ngModule: IgoStyleListModule,\n      providers: [provideStyleListOptions({}), provideStyleListLoader()]\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoKeyValueModule, IgoDrapDropModule, IgoSpinnerModule } from '@igo2/common';\n\nimport { ExportButtonComponent } from './export-button/export-button.component';\nimport { ImportExportComponent } from './import-export/import-export.component';\nimport { DropGeoFileDirective } from './shared/drop-geo-file.directive';\nimport { IgoStyleListModule } from './style-list/style-list.module';\n\n@NgModule({\n  imports: [\n    MatIconModule,\n    MatTooltipModule,\n    FormsModule,\n    ReactiveFormsModule,\n    CommonModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    MatTabsModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSlideToggleModule,\n    IgoLanguageModule,\n    IgoSpinnerModule,\n    IgoKeyValueModule,\n    IgoDrapDropModule,\n    IgoStyleListModule.forRoot()\n  ],\n  exports: [ImportExportComponent, DropGeoFileDirective, IgoStyleListModule, ExportButtonComponent],\n  declarations: [ImportExportComponent, DropGeoFileDirective, ExportButtonComponent]\n})\nexport class IgoImportExportModule {\n  static forRoot(): ModuleWithProviders<IgoImportExportModule> {\n    return {\n      ngModule: IgoImportExportModule\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoConfirmDialogModule } from '@igo2/common';\nimport { MapBrowserComponent } from './map-browser/map-browser.component';\nimport { ZoomButtonComponent } from './zoom-button/zoom-button.component';\nimport { GeolocateButtonComponent } from './geolocate-button/geolocate-button.component';\nimport { HomeExtentButtonComponent } from './home-extent-button/home-extent-button.component';\nimport { RotationButtonComponent } from './rotation-button/rotation-button.component';\nimport { BaseLayersSwitcherComponent } from './baselayers-switcher/baselayers-switcher.component';\nimport { MiniBaseMapComponent } from './baselayers-switcher/mini-basemap.component';\nimport { MapOfflineDirective } from './shared/mapOffline.directive';\nimport { OfflineButtonComponent } from './offline-button/offline-button.component';\nimport { PointerPositionDirective } from './shared/map-pointer-position.directive';\nimport { HoverFeatureDirective } from './shared/hover-feature.directive';\nimport { SwipeControlComponent } from './swipe-control/swipe-control.component';\nimport { MapCenterComponent } from './map-center/map-center.component';\nimport { MenuButtonComponent } from './menu-button/menu-button.component';\nimport { InfoSectionComponent } from './info-section/info-section.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoLanguageModule,\n    IgoConfirmDialogModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule\n  ],\n  exports: [\n    MapBrowserComponent,\n    ZoomButtonComponent,\n    GeolocateButtonComponent,\n    HomeExtentButtonComponent,\n    RotationButtonComponent,\n    InfoSectionComponent,\n    BaseLayersSwitcherComponent,\n    MiniBaseMapComponent,\n    MapOfflineDirective,\n    OfflineButtonComponent,\n    PointerPositionDirective,\n    HoverFeatureDirective,\n    SwipeControlComponent,\n    MapCenterComponent,\n    MenuButtonComponent\n  ],\n  declarations: [\n    MapBrowserComponent,\n    ZoomButtonComponent,\n    GeolocateButtonComponent,\n    HomeExtentButtonComponent,\n    RotationButtonComponent,\n    InfoSectionComponent,\n    BaseLayersSwitcherComponent,\n    MiniBaseMapComponent,\n    MapOfflineDirective,\n    OfflineButtonComponent,\n    PointerPositionDirective,\n    HoverFeatureDirective,\n    SwipeControlComponent,\n    MapCenterComponent,\n    MenuButtonComponent\n  ]\n})\nexport class IgoMapModule {}\n","<mat-form-field\n  class=\"measure-field\"\n  appearance=\"outline\"\n  floatLabel=\"always\">\n  <mat-label>{{placeholder}}</mat-label>\n  <input\n    matInput\n    [readonly]=\"true\"\n    [value]=\"((measure$ | async) || 0) | measureFormat: measureUnit\">\n</mat-form-field>\n<mat-form-field class=\"unit-field\">\n  <mat-select\n    [value]=\"measureUnit\"\n    [disabled]=\"auto\"\n    (selectionChange)=\"onMeasureUnitChange($event.value)\">\n    <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n      {{('igo.geo.measure.' + measureUnit) | translate}}\n    </mat-option>\n  </mat-select>\n</mat-form-field>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport {\n  MeasureType,\n  MeasureAreaUnit,\n  MeasureLengthUnit\n} from '../shared/measure.enum';\nimport { computeBestAreaUnit, computeBestLengthUnit } from '../shared/measure.utils';\n\n/**\n * Measurer item\n */\n@Component({\n  selector: 'igo-measurer-item',\n  templateUrl: './measurer-item.component.html',\n  styleUrls: ['./measurer-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MeasurerItemComponent implements OnDestroy {\n\n  /**\n   * Measure observable\n   * @internal\n   */\n  public measure$: BehaviorSubject<number> = new BehaviorSubject(undefined);\n\n  /**\n   * Subscription to the measure observable when the auto mode is on\n   * @internal\n   */\n  public measure$$: Subscription;\n\n  /**\n   * Measure type\n   */\n  @Input() measureType: MeasureType;\n\n  /**\n   * Measure unit\n   */\n  @Input() measureUnit: MeasureAreaUnit | MeasureLengthUnit;\n\n  /**\n   * Measure\n   */\n  @Input()\n  set measure(value: number) {\n    this.measure$.next(value);\n  }\n  get measure(): number { return this.measure$.value; }\n\n  /**\n   * Whther measure units should be automatically determined\n   */\n  @Input()\n  set auto(value: boolean) { this.toggleAutoUnit(value); }\n  get auto(): boolean { return this._auto; }\n  private _auto: boolean = false;\n\n  /**\n   * Placeholder\n   */\n  @Input() placeholder: string;\n\n  /**\n   * Event emitted when the measure unit changes\n   */\n  @Output() measureUnitChange = new EventEmitter<MeasureAreaUnit | MeasureLengthUnit>();\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    if (this.measureType === MeasureType.Area) {\n      return Object.values(MeasureAreaUnit);\n    }\n    return Object.values(MeasureLengthUnit);\n  }\n\n  constructor() {}\n\n  /**\n   * Toggle the auto unit off\n   * @internal\n   */\n  ngOnDestroy() {\n    this.toggleAutoUnit(false);\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureAreaUnit | MeasureLengthUnit) {\n    this.measureUnit = unit;\n    this.measureUnitChange.emit(unit);\n  }\n\n  private toggleAutoUnit(toggle: boolean) {\n    if (this.measure$$ !== undefined) {\n      this.measure$$.unsubscribe();\n    }\n    if (toggle === true) {\n      this.measure$$ = this.measure$.subscribe((measure: number) => {\n        this.computeBestMeasureUnit(measure);\n      });\n    }\n    this._auto = toggle;\n  }\n\n  private computeBestMeasureUnit(measure: number) {\n    let measureUnit = this.measureUnit;\n    if (this.measureType === MeasureType.Area) {\n      measureUnit = computeBestAreaUnit(measure);\n    } else if (this.measureType === MeasureType.Length) {\n      measureUnit = computeBestLengthUnit(measure);\n    }\n    if (measureUnit !== this.measureUnit) {\n      this.onMeasureUnitChange(measureUnit);\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatDividerModule } from '@angular/material/divider';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoEntityTableModule } from '@igo2/common';\n\nimport { MeasureFormatPipe } from './measure-format.pipe';\nimport { MeasurerItemComponent } from './measurer-item.component';\nimport { MeasurerComponent } from './measurer.component';\nimport { MeasurerDialogComponent } from './measurer-dialog.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSelectModule,\n    MatSlideToggleModule,\n    MatDividerModule,\n    IgoLanguageModule,\n    IgoEntityTableModule\n  ],\n  declarations: [\n    MeasureFormatPipe,\n    MeasurerItemComponent,\n    MeasurerComponent,\n    MeasurerDialogComponent\n  ],\n  exports: [\n    MeasureFormatPipe,\n    MeasurerComponent\n  ]\n})\nexport class IgoMeasurerModule {}\n","import { NgModule } from '@angular/core';\n\nimport { IgoMeasurerModule } from './measurer/measurer.module';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: [\n    IgoMeasurerModule\n  ]\n})\nexport class IgoMeasureModule {}\n","export enum OverlayAction {\n    None,\n    Move,\n    Zoom,\n    ZoomIfOutMapExtent\n  }\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\n\nimport { OverlayAction } from './overlay.enum';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class OverlayService {\n  public features$ = new BehaviorSubject<[Feature[], OverlayAction]>([\n    [],\n    undefined\n  ]);\n\n  constructor() {}\n\n  setFeatures(features: Feature[], action: OverlayAction = OverlayAction.None) {\n    this.features$.next([features, action]);\n  }\n\n  clear() {\n    this.features$.next([[], OverlayAction.None]);\n  }\n}\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\n\nimport { OverlayService } from '../shared/overlay.service';\nimport { OverlayAction } from '../shared/overlay.enum';\n\n@Directive({\n  selector: '[igoOverlay]'\n})\nexport class OverlayDirective implements OnInit, OnDestroy {\n  private features$$: Subscription;\n  private format = new olFormatGeoJSON();\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private overlayService: OverlayService\n  ) {}\n\n  ngOnInit() {\n    this.features$$ = this.overlayService.features$.subscribe(res =>\n      this.handleFeatures(res[0], res[1])\n    );\n  }\n\n  ngOnDestroy() {\n    this.features$$.unsubscribe();\n  }\n\n  private handleFeatures(features: Feature[], action: OverlayAction) {}\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\n\nimport { OverlayDirective } from './shared/overlay.directive';\n\n@NgModule({\n  imports: [],\n  exports: [OverlayDirective],\n  declarations: [OverlayDirective]\n})\nexport class IgoOverlayModule {\n  static forRoot(): ModuleWithProviders<IgoOverlayModule> {\n    return {\n      ngModule: IgoOverlayModule\n    };\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { Observable, Subject, forkJoin } from 'rxjs';\nimport { map as rxMap } from 'rxjs/operators';\n\nimport { saveAs } from 'file-saver';\nimport jspdf from 'jspdf';\nimport html2canvas from 'html2canvas';\nimport * as JSZip from 'jszip';\n\nimport { SubjectStatus } from '@igo2/utils';\nimport { SecureImagePipe } from '@igo2/common';\nimport { MessageService, ActivityService, LanguageService } from '@igo2/core';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { formatScale } from '../../map/shared/map.utils';\nimport { LegendMapViewOptions } from '../../layer/shared/layers/layer.interface';\nimport { getLayersLegends } from '../../layer/utils/outputLegend';\n\nimport { PrintOptions } from './print.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class PrintService {\n  zipFile: JSZip;\n  nbFileToProcess: number;\n  activityId: string;\n  constructor(\n    private http: HttpClient,\n    private messageService: MessageService,\n    private activityService: ActivityService,\n    private languageService: LanguageService\n  ) {}\n\n  print(map: IgoMap, options: PrintOptions): Subject<any> {\n    const status$ = new Subject();\n\n    const paperFormat: string = options.paperFormat;\n    const resolution = +options.resolution; // Default is 96\n    const orientation = options.orientation;\n    const legendPostion = options.legendPosition;\n\n    this.activityId = this.activityService.register();\n    const doc = new jspdf({\n      orientation,\n      format: paperFormat.toLowerCase()\n    });\n\n    const dimensions = [\n      doc.internal.pageSize.width,\n      doc.internal.pageSize.height\n    ];\n\n    const margins = [10, 10, 10, 10];\n    const width = dimensions[0] - margins[3] - margins[1];\n    const height = dimensions[1] - margins[0] - margins[2];\n    const size = [width, height];\n    let titleSizeResults = [0, 0];\n\n    if (options.title !== undefined) {\n      titleSizeResults = this.getTitleSize(options.title, width, height, doc); // return : size(pt) and left margin (mm)\n      this.addTitle(doc, options.title, titleSizeResults[0], margins[3] + titleSizeResults[1], titleSizeResults[0] * (25.4 / 72));\n    }\n    if (options.subtitle !== undefined) {\n      let subtitleSizeResult = 0;\n      const titleH = titleSizeResults[0];\n      subtitleSizeResult = this.getSubTitleSize(options.subtitle, width, height, doc); // return : size(pt) and left margin (mm)\n      this.addSubTitle(doc, options.subtitle, titleH * 0.7, margins[3] + subtitleSizeResult, titleH * 1.7 * (25.4 / 72));\n      margins[0] = margins[0] + titleSizeResults[0] * 0.7 * (25.4 / 72);\n    }\n    if (options.showProjection === true || options.showScale === true) {\n      this.addProjScale(\n        doc,\n        map,\n        resolution,\n        options.showProjection,\n        options.showScale\n        );\n    }\n    if (options.comment !== '') {\n      this.addComment(doc, options.comment);\n    }\n\n    this.addMap(doc, map, resolution, size, margins).subscribe(\n      async (status: SubjectStatus) => {\n        if (status === SubjectStatus.Done) {\n          await this.addScale(doc, map, margins);\n          await this.handleMeasureLayer(doc, map, margins);\n          if (options.legendPosition !== 'none') {\n            if (['topleft', 'topright', 'bottomleft', 'bottomright'].indexOf(options.legendPosition) > -1 ) {\n              await this.addLegendSamePage(doc, map, margins, resolution, options.legendPosition);\n            } else if (options.legendPosition === 'newpage') {\n              await this.addLegend(doc, map, margins, resolution);\n            }\n          } else {\n            await this.saveDoc(doc);\n          }\n        }\n\n        if (status === SubjectStatus.Done || status === SubjectStatus.Error) {\n          this.activityService.unregister(this.activityId);\n          status$.next(SubjectStatus.Done);\n        }\n      }\n    );\n\n    return status$;\n  }\n\n  /**\n   * Add measure overlay on the map on the document when the measure layer is present\n   * @param  doc - Pdf document where measure tooltip will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n  private async handleMeasureLayer(\n    doc: jspdf,\n    map: IgoMap,\n    margins: Array<number>\n  ) {\n    if (map.layers.find(layer => layer.visible && layer.id.startsWith('igo-measures-'))) {\n      let canvasOverlayHTMLMeasures;\n      const mapOverlayMeasuresHTML = map.ol.getOverlayContainer();\n      await html2canvas(mapOverlayMeasuresHTML, {\n        scale: 1,\n        backgroundColor: null\n      }).then(e => {\n        canvasOverlayHTMLMeasures = e;\n      });\n      this.addCanvas(doc, canvasOverlayHTMLMeasures, margins); // this adds measure overlays\n    }\n  }\n\n  /**\n   * Get html code for all layers legend\n   * @param  map IgoMap\n   * @param  width The width that the legend need to be\n   * @return Html code for the legend\n   */\n  getLayersLegendHtml(\n    map: IgoMap,\n    width: number,\n    resolution: number\n  ): Observable<string> {\n    return new Observable((observer) => {\n      let html = '';\n      const legends = getLayersLegends(\n        map.layers,\n        {\n          resolution: map.viewController.getResolution(),\n          extent: map.viewController.getExtent(),\n          projection: map.viewController.getOlProjection().getCode(),\n          scale: map.viewController.getScale(resolution),\n          size: map.ol.getSize()\n        } as LegendMapViewOptions\n      );\n      if (legends.length === 0) {\n        observer.next(html);\n        observer.complete();\n        return;\n      }\n      // Define important style to be sure that all container is convert\n      // to image not just visible part\n      html += '<style media=\"screen\" type=\"text/css\">';\n      html += '.html2canvas-container { width: ' + width + 'mm !important; height: 2000px !important; }';\n      html += 'table.tableLegend {table-layout: auto;}';\n      html += 'div.styleLegend {padding-top: 5px; padding-right:5px;padding-left:5px;padding-bottom:5px;}';\n      html += '</style>';\n      // The font size will also be lowered afterwards (globally along the legend size)\n      // this allows having a good relative font size here and to keep ajusting the legend size\n      // while keeping good relative font size\n      html += '<font size=\"3\" face=\"Times\" >';\n      html += '<div class=\"styleLegend\">';\n      html += '<table class=\"tableLegend\" >';\n\n      // For each legend, define an html table cell\n      const images$ = legends.map((legend) =>\n        this.getDataImage(legend.url).pipe(\n          rxMap((dataImage) => {\n            let htmlImg = '<tr><td>' + legend.title.toUpperCase() + '</td></tr>';\n            htmlImg += '<tr><td><img src=\"' + dataImage + '\"></td></tr>';\n            return htmlImg;\n          })\n        )\n      );\n      forkJoin(images$).subscribe((dataImages) => {\n        html = dataImages.reduce((acc, current) => (acc += current), html);\n        html += '</table>';\n        html += '</div>';\n        observer.next(html);\n        observer.complete();\n      });\n    });\n  }\n\n  getDataImage(url: string): Observable<string> {\n    const secureIMG = new SecureImagePipe(this.http);\n    return secureIMG.transform(url);\n  }\n\n  /**\n   * Get all the legend in a single image\n   * * @param  format - Image format. default value to \"png\"\n   * @return The image of the legend\n   */\n  async getLayersLegendImage(\n    map,\n    format: string = 'png',\n    doZipFile: boolean,\n    resolution: number\n  ) {\n    const status$ = new Subject();\n    // Get html code for the legend\n    const width = 200; // milimeters unit, originally define for document pdf\n    let html = await this.getLayersLegendHtml(\n      map,\n      width,\n      resolution\n    ).toPromise();\n    format = format.toLowerCase();\n\n    // If no legend show No LEGEND in an image\n    if (html.length === 0) {\n      html = '<font size=\"12\" face=\"Courier New\" >';\n      html += '<div align=\"center\"><b>NO LEGEND</b></div>';\n    }\n    // Create div to contain html code for legend\n    const div = window.document.createElement('div');\n    div.style.position = 'absolute';\n    div.style.top = '0';\n\n    // Add html code to convert in the new window\n    window.document.body.appendChild(div);\n    div.innerHTML = html;\n\n    await this.timeout(1);\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n      console.log(e);\n    });\n\n    if (canvas) {\n      let status = SubjectStatus.Done;\n      try {\n        if (!doZipFile) {\n          // Save the canvas as file\n          this.saveCanvasImageAsFile(canvas, 'legendImage', format);\n        } else {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(canvas, 'legendImage' + '.' + format);\n        }\n        div.parentNode.removeChild(div); // remove temp div (IE)\n      } catch (err) {\n        status = SubjectStatus.Error;\n      }\n      status$.next(status);\n    }\n\n    return status$;\n  }\n\n  getTitleSize(title: string, pageWidth: number, pageHeight: number, doc: jspdf) {\n    const pdfResolution = 96;\n    const titleSize = Math.round(2 * (pageHeight + 145) * 0.05) / 2;\n    doc.setFont('Times', 'bold');\n    const width = doc.getTextWidth(title);\n\n    const titleWidth = doc.getStringUnitWidth(title) * titleSize / doc.internal.scaleFactor;\n    const titleTailleMinimale = Math.round( 2 * (pageHeight + 150 ) * 0.037) / 2;\n    let titleFontSize = 0;\n\n    let titleMarginLeft;\n    if (titleWidth >= (pageWidth)) {\n      titleMarginLeft = 0;\n      titleFontSize = Math.round(((pageWidth / title.length) * pdfResolution) / 25.4);\n      // If the formula to find the font size gives below the defined minimum size\n      if (titleFontSize < titleTailleMinimale) {\n        titleFontSize = titleTailleMinimale;\n      }\n    } else {\n      titleMarginLeft = (pageWidth - titleWidth) / 2 ;\n      titleFontSize = titleSize;\n    }\n    return [titleFontSize, titleMarginLeft];\n  }\n\n  getSubTitleSize(subtitle: string, pageWidth: number, pageHeight: number, doc: jspdf) {\n    const subtitleSize = 0.7 * Math.round(2 * (pageHeight + 145) * 0.05) / 2; // 70% of the title's font size\n\n    doc.setFont('Times', 'bold');\n\n    const subtitleWidth = doc.getStringUnitWidth(subtitle) * subtitleSize / doc.internal.scaleFactor;\n\n    let subtitleMarginLeft;\n    if (subtitleWidth >= (pageWidth)) {\n      subtitleMarginLeft = 0;\n    } else {\n      subtitleMarginLeft = (pageWidth - subtitleWidth) / 2 ;\n    }\n    return subtitleMarginLeft;\n  }\n\n  private addTitle(doc: jspdf, title: string, titleFontSize: number, titleMarginLeft: number, titleMarginTop: number) {\n    doc.setFont('Times', 'bold');\n    doc.setFontSize(titleFontSize);\n    doc.text(title, titleMarginLeft, titleMarginTop);\n  }\n\n  private addSubTitle(doc: jspdf, subtitle: string, subtitleFontSize: number, subtitleMarginLeft: number, subtitleMarginTop: number) {\n    doc.setFont('Times', 'bold');\n    doc.setFontSize(subtitleFontSize);\n    doc.text(subtitle, subtitleMarginLeft, subtitleMarginTop);\n  }\n  /**\n   * Add comment to the document\n   * * @param  doc - pdf document\n   * * @param  comment - Comment to add in the document\n   * * @param  size - Size of the document\n   */\n  private addComment(doc: jspdf, comment: string) {\n    const commentSize = 16;\n    const commentMarginLeft = 20;\n    const marginBottom = 5;\n    const heightPixels = doc.internal.pageSize.height - marginBottom;\n\n    doc.setFont('courier');\n    doc.setFontSize(commentSize);\n    doc.text(comment, commentMarginLeft, heightPixels);\n  }\n  /**\n   * Add projection and/or scale to the document\n   * @param  doc - pdf document\n   * @param  map - Map of the app\n   * @param  dpi - DPI resolution of the document\n   * @param  projection - Bool to indicate if projection need to be added\n   * @param  scale - Bool to indicate if scale need to be added\n   */\n  private addProjScale(\n    doc: jspdf,\n    map: IgoMap,\n    dpi: number,\n    projection: boolean,\n    scale: boolean\n  ) {\n    const translate = this.languageService.translate;\n    const projScaleSize = 16;\n    const projScaleMarginLeft = 20;\n    const marginBottom = 15;\n    const heightPixels = doc.internal.pageSize.height - marginBottom;\n\n    let textProjScale: string = '';\n    if (projection === true) {\n      const projText = translate.instant('igo.geo.printForm.projection');\n      textProjScale += projText + ': ' + map.projection;\n    }\n    if (scale === true) {\n      if (projection === true) {\n        textProjScale += '   ';\n      }\n      const scaleText = translate.instant('igo.geo.printForm.scale');\n      const mapScale = map.viewController.getScale(dpi);\n      textProjScale += scaleText + ': ~ 1 / ' + formatScale(mapScale);\n    }\n    doc.setFont('courier');\n    doc.setFontSize(projScaleSize);\n    doc.text(textProjScale, projScaleMarginLeft, heightPixels);\n  }\n\n  /**\n   * Add the legend to the document\n   * @param  doc - Pdf document where legend will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n  private async addLegend(\n    doc: jspdf,\n    map: IgoMap,\n    margins: Array<number>,\n    resolution: number\n  ) {\n    // Get html code for the legend\n    const width = doc.internal.pageSize.width;\n    const html = await this.getLayersLegendHtml(\n      map,\n      width,\n      resolution\n    ).toPromise();\n    // If no legend, save the map directly\n    if (html === '') {\n      await this.saveDoc(doc);\n      return true;\n    }\n    // Create div to contain html code for legend\n    const div = window.document.createElement('div');\n    div.style.position = 'absolute';\n    div.style.top = '0';\n\n    // Add html code to convert in the new window\n    window.document.body.appendChild(div);\n    div.innerHTML = html;\n\n    await this.timeout(1);\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n      console.log(e);\n    });\n\n    if (canvas) {\n      const pourcentageReduction = 0.85;\n      const imageSize = [pourcentageReduction * (25.4 * canvas.width) / resolution, pourcentageReduction\n        * (25.4 * canvas.height) / resolution];\n      let imgData;\n      doc.addPage();\n      imgData = canvas.toDataURL('image/png');\n      doc.addImage(imgData, 'PNG', 10, 10, imageSize[0], imageSize[1]);\n      div.parentNode.removeChild(div); // remove temp div (IE style)\n    }\n\n    await this.saveDoc(doc);\n\n  }\n\n  /**\n   * Add the legend to the document\n   * @param  doc - Pdf document where legend will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n     private async addLegendSamePage(\n      doc: jspdf,\n      map: IgoMap,\n      margins: Array<number>,\n      resolution: number,\n      legendPosition: string\n    ) {\n      // Get html code for the legend\n      const width = doc.internal.pageSize.width;\n      const html = await this.getLayersLegendHtml(\n        map,\n        width,\n        resolution\n      ).toPromise();\n      // If no legend, save the map directly\n      if (html === '') {\n        await this.saveDoc(doc);\n        return true;\n      }\n      // Create div to contain html code for legend\n      const div = window.document.createElement('div');\n      div.style.position = 'absolute';\n      div.style.top = '0';\n      // Add html code to convert in the new window\n      window.document.body.appendChild(div);\n      div.innerHTML = html;\n      await this.timeout(1);\n      const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n        console.log(e);\n      });\n      let marginsLegend;\n      if (canvas) {\n        const pourcentageReduction = 0.85;\n        const imageSize = [pourcentageReduction * (25.4 * canvas.width) / resolution,\n           pourcentageReduction * (25.4 * canvas.height) / resolution];\n        // Move the legend to the correct position on the page\n        if ( legendPosition === 'bottomright') {\n          marginsLegend = [doc.internal.pageSize.height - margins[2] - imageSize[1], margins[1],\n           margins[2], doc.internal.pageSize.width - margins[1] - imageSize[0]];\n        } else if (legendPosition === 'topright') {\n          marginsLegend = [margins[0], margins[1], doc.internal.pageSize.height - margins[0] - imageSize[1],\n          doc.internal.pageSize.width - margins[1] - imageSize[0] ];\n        } else if (legendPosition === 'bottomleft') {\n          // When the legend is in the bottom left, raise the legend slightly upward so that attributions are visible\n          marginsLegend = [doc.internal.pageSize.height - margins[2] - imageSize[1] - 15,\n          doc.internal.pageSize.width - margins[3] - imageSize[0], margins[2] + 15, margins[3] ];\n        } else if (legendPosition === 'topleft') {\n          marginsLegend = [margins[0], doc.internal.pageSize.width - margins[3] - imageSize[0],\n           doc.internal.pageSize.height - margins[0] - imageSize[1], margins[3] ];\n        }\n        this.addCanvas(doc, canvas, marginsLegend); // this adds the legend\n        div.parentNode.removeChild(div); // remove temp div (IE style)\n        await this.saveDoc(doc);\n      }\n    }\n\n  /**\n   * Add scale and attributions on the map on the document\n   * @param  doc - Pdf document where legend will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n  private async addScale(\n    doc: jspdf,\n    map: IgoMap,\n    margins: Array<number>\n    ) {\n      const mapSize = map.ol.getSize();\n      const extent = map.ol.getView().calculateExtent(mapSize);\n      // Get the scale and attribution\n      // we use cloneNode to modify the nodes to print without modifying it on the page, using deep:true to get children\n      let canvasOverlayHTML;\n      const mapOverlayHTML = map.ol.getOverlayContainerStopEvent();\n      // Remove the UI buttons from the nodes\n      const OverlayHTMLButtons = mapOverlayHTML.getElementsByTagName('button');\n      const OverlayHTMLButtonsarr = Array.from(OverlayHTMLButtons);\n      for (const OverlayHTMLButton of OverlayHTMLButtonsarr) {\n        OverlayHTMLButton.setAttribute('data-html2canvas-ignore', 'true');\n      }\n      // Change the styles of hyperlink in the printed version\n      // Transform the Overlay into a canvas\n      // scale is necessary to make it in google chrome\n      // background as null because otherwise it is white and cover the map\n      // allowtaint is to allow rendering images in the attributions\n      // useCORS: true pour permettre de renderer les images (ne marche pas en local)\n      const canvas = await html2canvas(mapOverlayHTML, {\n        scale: 1,\n        backgroundColor: null,\n        allowTaint: true,\n        useCORS: true,\n      }).then( e => {\n        canvasOverlayHTML = e;\n      });\n      this.addCanvas(doc, canvasOverlayHTML, margins); // this adds scales and attributions\n }\n\n  defineNbFileToProcess(nbFileToProcess) {\n    this.nbFileToProcess = nbFileToProcess;\n  }\n\n  private timeout(ms) {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n  }\n\n  private addCanvas(\n    doc: jspdf,\n    canvas: HTMLCanvasElement,\n    margins: Array<number>\n  ) {\n    let image;\n    if (canvas) {\n      image = canvas.toDataURL('image/png');\n    }\n\n    if (image !== undefined) {\n      const imageSize = this.getImageSizeToFitPdf(doc, canvas, margins);\n      doc.addImage(\n        image,\n        'PNG',\n        margins[3],\n        margins[0],\n        imageSize[0],\n        imageSize[1]\n      );\n      doc.rect(margins[3], margins[0], imageSize[0], imageSize[1]);\n    }\n  }\n\n  // TODO fix printing with image resolution\n  private addMap(\n    doc: jspdf,\n    map: IgoMap,\n    resolution: number,\n    size: Array<number>,\n    margins: Array<number>\n  ) {\n    const status$ = new Subject();\n\n    const mapSize = map.ol.getSize();\n    const extent = map.ol.getView().calculateExtent(mapSize);\n\n    const widthPixels = Math.round((size[0] * resolution) / 25.4);\n    const heightPixels = Math.round((size[1] * resolution) / 25.4);\n\n    let timeout;\n\n    map.ol.once('rendercomplete', (event: any) => {\n      const canvases = event.target.getViewport().getElementsByTagName('canvas');\n      const mapStatus$$ = map.status$.subscribe((mapStatus: SubjectStatus) => {\n        clearTimeout(timeout);\n\n        if (mapStatus !== SubjectStatus.Done) {\n          return;\n        }\n\n        mapStatus$$.unsubscribe();\n\n        let status = SubjectStatus.Done;\n        try {\n          for (const canvas of canvases) {\n            if (canvas.width !== 0) {\n              this.addCanvas(doc, canvas, margins);\n            }\n          }\n        } catch (err) {\n          status = SubjectStatus.Error;\n          this.messageService.error(\n            this.languageService.translate.instant(\n              'igo.geo.printForm.corsErrorMessageBody'\n            ),\n            this.languageService.translate.instant(\n              'igo.geo.printForm.corsErrorMessageHeader'\n            )\n          );\n        }\n        this.renderMap(map, mapSize, extent);\n        status$.next(status);\n      });\n\n      // If no loading as started after 200ms, then probably no loading\n      // is required.\n      timeout = window.setTimeout(() => {\n        mapStatus$$.unsubscribe();\n\n        let status = SubjectStatus.Done;\n        try {\n          for (const canvas of canvases) {\n            if (canvas.width !== 0) {\n              this.addCanvas(doc, canvas, margins);\n            }\n          }\n        } catch (err) {\n          status = SubjectStatus.Error;\n          this.messageService.error(\n            this.languageService.translate.instant(\n              'igo.geo.printForm.corsErrorMessageBody'\n            ),\n            this.languageService.translate.instant(\n              'igo.geo.printForm.corsErrorMessageHeader'\n            )\n          );\n        }\n        this.renderMap(map, mapSize, extent);\n        status$.next(status);\n      }, 200);\n    });\n\n    this.renderMap(map, [widthPixels, heightPixels], extent);\n\n    return status$;\n  }\n\n  /**\n   * Download an image of the map with addition of informations\n   * @param  map - Map of the app\n   * @param  format - Image format. default value to \"png\"\n   * @param  projection - Indicate if projection need to be add. Default to false\n   * @param  scale - Indicate if scale need to be add. Default to false\n   * @param  legend - Indicate if the legend of layers need to be download. Default to false\n   * @param  title - Title to add for the map - Default to blank\n   * @param  subtitle - Subtitle to add for the map - Default to blank\n   * @param  comment - Comment to add for the map - Default to blank\n   * @param  doZipFile - Indicate if we do a zip with the file\n   * @return Image file of the map with extension format given as parameter\n   */\n  downloadMapImage(\n    map: IgoMap,\n    resolution: number,\n    format = 'png',\n    projection = false,\n    scale = false,\n    legend = false,\n    title = '',\n    subtitle = '',\n    comment = '',\n    doZipFile = true\n  ) {\n    const status$ = new Subject();\n    // const resolution = map.ol.getView().getResolution();\n    this.activityId = this.activityService.register();\n    const translate = this.languageService.translate;\n    map.ol.once('rendercomplete', (event: any) => {\n      format = format.toLowerCase();\n      const oldCanvas = event.target\n        .getViewport()\n        .getElementsByTagName('canvas')[0];\n      const newCanvas = document.createElement('canvas');\n      const newContext = newCanvas.getContext('2d');\n      // Postion in height to set the canvas in new canvas\n      let positionHCanvas = 0;\n      // Position in width to set the Proj/Scale in new canvas\n      let positionWProjScale = 10;\n      // Get height/width of map canvas\n      const width = oldCanvas.width;\n      let height = oldCanvas.height;\n      // Set Font to calculate comment width\n      newContext.font = '20px Calibri';\n      const commentWidth = newContext.measureText(comment).width;\n      // Add height for title if defined\n      height = title !== '' ? height + 30 : height;\n      // Add height for title if defined\n      height = subtitle !== '' ? height + 30 : height;\n      // Add height for projection or scale (same line) if defined\n      height = projection !== false || scale !== false ? height + 30 : height;\n      const positionHProjScale = height - 10;\n      // Define number of line depending of the comment length\n      const commentNbLine = Math.ceil(commentWidth / width);\n      // Add height for multiline comment if defined\n      height = comment !== '' ? height + commentNbLine * 30 : height;\n      let positionHComment = height - commentNbLine * 20 + 5;\n      // Set the new canvas with the new calculated size\n      newCanvas.width = width;\n      newCanvas.height = height;\n      // Patch Jpeg default black background to white\n      if (format === 'jpeg') {\n        newContext.fillStyle = '#ffffff';\n        newContext.fillRect(0, 0, width, height);\n        newContext.fillStyle = '#000000';\n      }\n      // If a title need to be added to canvas\n      if (title !== '') {\n        // Set font for title\n        // Adjust according to title length\n        newContext.font = '26px Calibri';\n        positionHCanvas = 30;\n        newContext.textAlign = 'center';\n        newContext.fillText(title, width / 2, 20, width * 0.9);\n      }\n      if (subtitle !== '') {\n        // Set font for subtitle\n        // Adjust according to title length\n        newContext.font = '26px Calibri';\n        positionHCanvas = 60;\n        newContext.textAlign = 'center';\n        newContext.fillText(subtitle, width / 2, 50, width * 0.9);\n      }\n      // Set font for next section\n      newContext.font = '20px Calibri';\n      // If projection need to be added to canvas\n      if (projection !== false) {\n        const projText = translate.instant('igo.geo.printForm.projection');\n        newContext.textAlign = 'start';\n        newContext.fillText(\n          projText + ': ' + map.projection,\n          positionWProjScale,\n          positionHProjScale\n        );\n        positionWProjScale += 200; // Width position change for scale position\n      }\n\n      // If scale need to be added to canvas\n      if (scale !== false) {\n        const scaleText = translate.instant('igo.geo.printForm.scale');\n        const mapScale = map.viewController.getScale(resolution);\n        newContext.textAlign = 'start';\n        newContext.fillText(\n          scaleText + ': ~ 1 / ' + formatScale(mapScale),\n          positionWProjScale,\n          positionHProjScale\n        );\n      }\n      // If a comment need to be added to canvas\n      if (comment !== '') {\n        newContext.textAlign = 'center';\n        // If only one line, no need to multiline the comment\n        if (commentNbLine === 1) {\n          newContext.fillText(comment, width / 2, positionHComment);\n        } else {\n          // Separate the setenses to be approx. the same length\n          const nbCommentChar = comment.length;\n          const CommentLengthToCut = Math.floor(nbCommentChar / commentNbLine);\n          let commentCurrentLine = '';\n          let positionFirstCutChar = 0;\n          let positionLastBlank;\n          // Loop for the number of line calculated\n          for (let i = 0; i < commentNbLine; i++) {\n            // For all line except last\n            if (commentNbLine - 1 > i) {\n              // Get comment current line to find the right place tu cut comment\n              commentCurrentLine = comment.substr(\n                positionFirstCutChar,\n                CommentLengthToCut\n              );\n              // Cut the setence at blank\n              positionLastBlank = commentCurrentLine.lastIndexOf(' ');\n              newContext.fillText(\n                commentCurrentLine.substr(0, positionLastBlank),\n                width / 2,\n                positionHComment\n              );\n              positionFirstCutChar += positionLastBlank;\n              // Go to next line for insertion\n              positionHComment += 20;\n            } else {\n              // Don't cut last part\n              newContext.fillText(\n                comment.substr(positionFirstCutChar),\n                width / 2,\n                positionHComment\n              );\n            }\n          }\n        }\n      }\n      // Add map to new canvas\n      newContext.drawImage(oldCanvas, 0, positionHCanvas);\n\n      let status = SubjectStatus.Done;\n      try {\n        // Save the canvas as file\n        if (!doZipFile) {\n          this.saveCanvasImageAsFile(newCanvas, 'map', format);\n        } else if (format.toLowerCase() === 'tiff') {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(\n            newCanvas,\n            'map' + map.projection.replace(':', '_') + '.' + format\n          );\n        } else {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(newCanvas, 'map' + '.' + format);\n        }\n      } catch (err) {\n        status = SubjectStatus.Error;\n      }\n\n      status$.next(status);\n\n      if (format.toLowerCase() === 'tiff') {\n        const tiwContent = this.getWorldFileInformation(map);\n        const blob = new Blob([tiwContent], {\n          type: 'text/plain;charset=utf-8'\n        });\n        if (!doZipFile) {\n          // saveAs automaticly replace ':' for '_'\n          saveAs(blob, 'map' + map.projection + '.tfw');\n          this.saveFileProcessing();\n        } else {\n          // Add the canvas to zip\n          this.addFileToZip(\n            'map' + map.projection.replace(':', '_') + '.tfw',\n            blob\n          );\n        }\n      }\n    });\n    map.ol.renderSync();\n\n    return status$;\n  }\n\n  private renderMap(map, size, extent) {\n    map.ol.updateSize();\n    map.ol.renderSync();\n  }\n\n  /**\n   * Save document\n   * @param  doc - Document to save\n   */\n  protected async saveDoc(doc: jspdf) {\n    await doc.save('map.pdf', { returnPromise: true });\n  }\n\n  /**\n   * Calculate the best Image size to fit in pdf\n   * @param doc - Pdf Document\n   * @param canvas - Canvas of image\n   * @param margins - Page margins\n   */\n  private getImageSizeToFitPdf(doc, canvas, margins) {\n    // Define variable to calculate best size to fit in one page\n    const pageHeight =\n      doc.internal.pageSize.getHeight() - (margins[0] + margins[2]);\n    const pageWidth =\n      doc.internal.pageSize.getWidth() - (margins[1] + margins[3]);\n    const canHeight = canvas.height;\n    const canWidth = canvas.width;\n    const heightRatio = canHeight / pageHeight;\n    const widthRatio = canWidth / pageWidth;\n    const maxRatio = heightRatio > widthRatio ? heightRatio : widthRatio;\n    const imgHeigh = maxRatio > 1 ? canHeight / maxRatio : canHeight;\n    const imgWidth = maxRatio > 1 ? canWidth / maxRatio : canWidth;\n\n    return [imgWidth, imgHeigh];\n  }\n\n  /**\n   * Get a world file information for tiff\n   * @param  map - Map of the app\n   */\n  private getWorldFileInformation(map) {\n    const currentResolution = map.viewController.getResolution();\n    const currentExtent = map.viewController.getExtent(); // Return [minx, miny, maxx, maxy]\n    return [\n      currentResolution,\n      0,\n      0,\n      -currentResolution,\n      currentExtent[0] + currentResolution / 0.5,\n      currentExtent[3] - currentResolution / 0.5\n    ].join('\\n');\n  }\n\n  /**\n   * Save canvas image as file\n   * @param canvas - Canvas to save\n   * @param name - Name of the file\n   * @param format - file format\n   */\n  private saveCanvasImageAsFile(canvas, name, format) {\n    const blobFormat = 'image/' + format;\n    const that = this;\n\n    try {\n      canvas.toDataURL(); // Just to make the catch trigger wihtout toBlob Error throw not catched\n      // If navigator is Internet Explorer\n      if (navigator.msSaveBlob) {\n        navigator.msSaveBlob(canvas.msToBlob(), name + '.' + format);\n        this.saveFileProcessing();\n      } else {\n        canvas.toBlob((blob) => {\n          // download image\n          saveAs(blob, name + '.' + format);\n          that.saveFileProcessing();\n        }, blobFormat);\n      }\n    } catch (err) {\n      this.messageService.error(\n        this.languageService.translate.instant(\n          'igo.geo.printForm.corsErrorMessageBody'\n        ),\n        this.languageService.translate.instant(\n          'igo.geo.printForm.corsErrorMessageHeader'\n        )\n      );\n    }\n  }\n\n  /**\n   * Add file to a zip\n   * @param canvas - File to add to the zip\n   * @param  name -Name of the fileoverview\n   */\n  private generateCanvaFileToZip(canvas, name) {\n    const blobFormat = 'image/' + 'jpeg';\n    const that = this;\n    if (\n      !this.hasOwnProperty('zipFile') ||\n      typeof this.zipFile === 'undefined'\n    ) {\n      this.zipFile = new JSZip();\n    }\n\n    try {\n      canvas.toDataURL(); // Just to make the catch trigger wihtout toBlob Error throw not catched\n      if (navigator.msSaveBlob) {\n        this.addFileToZip(name, canvas.msToBlob());\n      } else {\n        canvas.toBlob((blob) => {\n          that.addFileToZip(name, blob);\n        }, blobFormat);\n      }\n    } catch (err) {\n      this.messageService.error(\n        this.languageService.translate.instant(\n          'igo.geo.printForm.corsErrorMessageBody'\n        ),\n        this.languageService.translate.instant(\n          'igo.geo.printForm.corsErrorMessageHeader'\n        )\n      );\n    }\n  }\n\n  /**\n   * Add file to zip, if all file are zipped, download\n   * @param name - Name of the files\n   * @param blob - Contain of file\n   */\n  private addFileToZip(name, blob) {\n    // add file to zip\n    this.zipFile.file(name, blob);\n    this.nbFileToProcess--;\n\n    // If all files are proccessed\n    if (this.nbFileToProcess === 0) {\n      // Download zip file\n      this.getZipFile();\n      // Stop loading\n      this.activityService.unregister(this.activityId);\n    }\n  }\n\n  private saveFileProcessing() {\n    this.nbFileToProcess--;\n\n    // If all files are proccessed\n    if (this.nbFileToProcess === 0) {\n      // Stop loading\n      this.activityService.unregister(this.activityId);\n    }\n  }\n\n  /**\n   * Get the zipped file\n   * @return Retun a zip file\n   */\n  private getZipFile() {\n    const that = this;\n    this.zipFile.generateAsync({ type: 'blob' }).then((blob) => {\n      // 1) generate the zip file\n      saveAs(blob, 'map.zip');\n      delete that.zipFile;\n    });\n  }\n}\n","import { strEnum } from '@igo2/utils';\n\nexport const PrintOutputFormat = strEnum(['Pdf', 'Image']);\n\nexport type PrintOutputFormat = keyof typeof PrintOutputFormat;\n\nexport const PrintPaperFormat = strEnum([\n  'A0',\n  'A1',\n  'A2',\n  'A3',\n  'A4',\n  'A5',\n  'Letter',\n  'Legal'\n]);\nexport type PrintPaperFormat = keyof typeof PrintPaperFormat;\n\nexport const PrintOrientation = strEnum(['landscape', 'portrait']);\nexport type PrintOrientation = keyof typeof PrintOrientation;\n\nexport const PrintResolution = strEnum(['72', '96', '150', '300']);\nexport type PrintResolution = keyof typeof PrintResolution;\n\nexport const PrintSaveImageFormat = strEnum([\n  'Bmp',\n  'Gif',\n  'Jpeg',\n  'Png',\n  'Tiff'\n]);\nexport type PrintSaveImageFormat = keyof typeof PrintSaveImageFormat;\n\nexport const PrintLegendPosition = strEnum([\n  'none',\n  'topright',\n  'topleft',\n  'bottomleft',\n  'bottomright',\n  'newpage'\n]);\nexport type PrintLegendPosition = keyof typeof PrintLegendPosition;\n","<form class=\"igo-form\" [formGroup]=\"form\">\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <input\n        matInput\n        formControlName=\"title\"\n        placeholder=\"{{'igo.geo.printForm.title' | translate}}\">\n    </mat-form-field>\n  </div>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <input\n        matInput\n        formControlName=\"subtitle\"\n        placeholder=\"{{'igo.geo.printForm.subtitle' | translate}}\">\n    </mat-form-field>\n  </div>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <input\n        matInput\n        formControlName=\"comment\"\n        placeholder=\"{{'igo.geo.printForm.comment' | translate}}\">\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <div class=\"print-slide-toggle-container mat-typography\">\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"showProjection\"\n        [labelPosition]=\"'before'\">\n        {{'igo.geo.printForm.showProjection' | translate}}\n      </mat-slide-toggle>\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"showScale\"\n        [labelPosition]=\"'before'\">\n        {{'igo.geo.printForm.showScale' | translate}}\n      </mat-slide-toggle>\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"doZipFile\"\n        [labelPosition]=\"'before'\"\n        [style.display]=\"isPrintService ? 'none' : ''\">\n        {{'igo.geo.printForm.doZipFile' | translate}}\n      </mat-slide-toggle>\n    </div>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"legendPosition\"\n        placeholder=\"{{'igo.geo.printForm.legendPosition' | translate}}\">\n        <mat-option *ngFor=\"let legendPosition of legendPositions | keyvalue \" [value]=\"legendPosition.key\">\n            {{'igo.geo.printForm.legendPositions.' + legendPosition.value | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-select (selectionChange)=\"toggleImageSaveProp()\"\n        formControlName=\"outputFormat\"\n        placeholder=\"{{'igo.geo.printForm.outputFormat' | translate}}\">\n        <mat-option *ngFor=\"let outputFormat of outputFormats | keyvalue \" [value]=\"outputFormat.key\">\n            {{outputFormat.value}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" [style.display]=\"isPrintService ? 'block' : 'none'\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"paperFormat\"\n        placeholder=\"{{'igo.geo.printForm.paperFormat' | translate}}\">\n        <mat-option *ngFor=\"let paperFormat of paperFormats | keyvalue \" [value]=\"paperFormat.key\">\n          {{('igo.geo.printForm.paperFormats.' + paperFormat.value) | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" [style.display]=\"isPrintService ? 'none' : 'block'\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"imageFormat\"\n        placeholder=\"{{'igo.geo.printForm.imageFormat' | translate}}\">\n        <mat-option *ngFor=\"let imageFormat of imageFormats | keyvalue \" [value]=\"imageFormat.key\">\n          {{imageFormat.value}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" style=\"display: none;\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"resolution\"\n        placeholder=\"{{'igo.geo.printForm.resolution' | translate}}\">\n        <mat-option *ngFor=\"let resolution of resolutions | keyvalue \" [value]=\"resolution.key\">\n          {{resolution.value + ' PPI'}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" [style.display]=\"isPrintService ? 'block' : 'none'\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"orientation\"\n        placeholder=\"{{'igo.geo.printForm.orientation' | translate}}\">\n        <mat-option *ngFor=\"let orientation of orientations | keyvalue \" [value]=\"orientation.key\">\n          {{('igo.geo.printForm.' + orientation.value) | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-form-button-group print-button-top-padding\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      [disabled]=\"!form.valid || (disabled$ | async)\"\n      (click)=\"handleFormSubmit(form.value, form.valid)\">\n      {{'igo.geo.printForm.saveBtn' | translate}}\n    </button>\n  </div>\n\n</form>\n","import { Component, Input, Output, EventEmitter, OnInit } from '@angular/core';\nimport {\n  FormGroup,\n  FormBuilder,\n  FormControl,\n  Validators\n} from '@angular/forms';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { PrintOptions } from '../shared/print.interface';\n\nimport {\n  PrintOutputFormat,\n  PrintPaperFormat,\n  PrintOrientation,\n  PrintResolution,\n  PrintSaveImageFormat,\n  PrintLegendPosition\n} from '../shared/print.type';\n\n@Component({\n  selector: 'igo-print-form',\n  templateUrl: './print-form.component.html',\n  styleUrls: ['./print-form.component.scss']\n})\nexport class PrintFormComponent implements OnInit {\n  public form: FormGroup;\n  public outputFormats = PrintOutputFormat;\n  public paperFormats = PrintPaperFormat;\n  public orientations = PrintOrientation;\n  public resolutions = PrintResolution;\n  public imageFormats = PrintSaveImageFormat;\n  public legendPositions = PrintLegendPosition;\n  public isPrintService = true;\n\n  @Input() disabled$: BehaviorSubject<boolean>;\n\n  @Input()\n  get imageFormat(): PrintSaveImageFormat {\n    return this.imageFormatField.value;\n  }\n  set imageFormat(value: PrintSaveImageFormat) {\n    this.imageFormatField.setValue(value || PrintSaveImageFormat.Jpeg, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get outputFormat(): PrintOutputFormat {\n    return this.outputFormatField.value;\n  }\n  set outputFormat(value: PrintOutputFormat) {\n    this.outputFormatField.setValue(value || PrintOutputFormat.Pdf, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get paperFormat(): PrintPaperFormat {\n    return this.paperFormatField.value;\n  }\n  set paperFormat(value: PrintPaperFormat) {\n    this.paperFormatField.setValue(value || PrintPaperFormat.Letter, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get orientation(): PrintOrientation {\n    return this.orientationField.value;\n  }\n  set orientation(value: PrintOrientation) {\n    this.orientationField.setValue(value || PrintOrientation.landscape, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get resolution(): PrintResolution {\n    return this.resolutionField.value;\n  }\n  set resolution(value: PrintResolution) {\n    this.resolutionField.setValue(value || PrintResolution['96'], {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get legendPosition(): PrintLegendPosition {\n    return this.legendPositionField.value;\n  }\n  set legendPosition(value: PrintLegendPosition) {\n    this.legendPositionField.setValue(value || PrintLegendPosition.none, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get title(): string {\n    return this.titleField.value;\n  }\n  set title(value: string) {\n    this.titleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get subtitle(): string {\n    return this.subtitleField.value;\n  }\n  set subtitle(value: string) {\n    this.subtitleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get comment(): string {\n    return this.commentField.value;\n  }\n  set comment(value: string) {\n    this.commentField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showProjection(): boolean {\n    return this.showProjectionField.value;\n  }\n  set showProjection(value: boolean) {\n    this.showProjectionField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showScale(): boolean {\n    return this.showScaleField.value;\n  }\n  set showScale(value: boolean) {\n    this.showScaleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showLegend(): boolean {\n    return this.showLegendField.value;\n  }\n  set showLegend(value: boolean) {\n    this.showLegendField.setValue(value, { onlySelf: true });\n  }\n\n  @Input()\n  get doZipFile(): boolean {\n    return this.doZipFileField.value;\n  }\n  set doZipFile(value: boolean) {\n    this.doZipFileField.setValue(value, { onlySelf: true });\n  }\n\n  get outputFormatField() {\n    return (this.form.controls as any).outputFormat as FormControl;\n  }\n\n  get paperFormatField() {\n    return (this.form.controls as any).paperFormat as FormControl;\n  }\n\n  get imageFormatField() {\n    return (this.form.controls as any).imageFormat as FormControl;\n  }\n\n  get orientationField() {\n    return (this.form.controls as any).orientation as FormControl;\n  }\n\n  get resolutionField() {\n    return (this.form.controls as any).resolution as FormControl;\n  }\n\n  get commentField() {\n    return (this.form.controls as any).comment as FormControl;\n  }\n\n  get showProjectionField() {\n    return (this.form.controls as any).showProjection as FormControl;\n  }\n\n  get showScaleField() {\n    return (this.form.controls as any).showScale as FormControl;\n  }\n\n  get showLegendField() {\n    return (this.form.controls as any).showLegend as FormControl;\n  }\n\n  get doZipFileField() {\n    return (this.form.controls as any).doZipFile as FormControl;\n  }\n\n  get titleField() {\n    return (this.form.controls as any).title as FormControl;\n  }\n\n  get subtitleField() {\n    return (this.form.controls as any).subtitle as FormControl;\n  }\n\n  get legendPositionField() {\n    return (this.form.controls as any).legendPosition as FormControl;\n  }\n\n  @Output() submit: EventEmitter<PrintOptions> = new EventEmitter();\n\n  constructor(private formBuilder: FormBuilder) {\n    this.form = this.formBuilder.group({\n      title: ['', []],\n      subtitle: ['', []],\n      comment: ['', []],\n      outputFormat: ['', [Validators.required]],\n      paperFormat: ['', [Validators.required]],\n      imageFormat: [ '', [Validators.required]],\n      resolution: ['', [Validators.required]],\n      orientation: ['', [Validators.required]],\n      legendPosition: ['', [Validators.required]],\n      showProjection: false,\n      showScale: false,\n      showLegend: false,\n      doZipFile: [{hidden: this.isPrintService }]\n    });\n  }\n\n  ngOnInit() {\n    this.doZipFileField.setValue(false);\n  }\n\n  handleFormSubmit(data: PrintOptions, isValid: boolean) {\n    data.isPrintService = this.isPrintService;\n    if (isValid) {\n      this.submit.emit(data);\n    }\n  }\n\n  toggleImageSaveProp() {\n    if (this.outputFormatField.value === 'Image') {\n      this.isPrintService = false;\n    } else {\n      this.isPrintService = true;\n    }\n  }\n}\n","import { Component, Input } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport { take } from 'rxjs/operators';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { PrintOptions } from '../shared/print.interface';\n\nimport {\n  PrintOutputFormat,\n  PrintPaperFormat,\n  PrintOrientation,\n  PrintResolution,\n  PrintSaveImageFormat,\n  PrintLegendPosition\n} from '../shared/print.type';\n\nimport { PrintService } from '../shared/print.service';\n\n@Component({\n  selector: 'igo-print',\n  templateUrl: './print.component.html'\n})\nexport class PrintComponent {\n  public disabled$ = new BehaviorSubject(false);\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get outputFormat(): PrintOutputFormat {\n    return this._outputFormat;\n  }\n  set outputFormat(value: PrintOutputFormat) {\n    this._outputFormat = value;\n  }\n  private _outputFormat: PrintOutputFormat;\n\n  @Input()\n  get paperFormat(): PrintPaperFormat {\n    return this._paperFormat;\n  }\n  set paperFormat(value: PrintPaperFormat) {\n    this._paperFormat = value;\n  }\n  private _paperFormat: PrintPaperFormat;\n\n  @Input()\n  get orientation(): PrintOrientation {\n    return this._orientation;\n  }\n  set orientation(value: PrintOrientation) {\n    this._orientation = value;\n  }\n  private _orientation: PrintOrientation;\n\n  @Input()\n  get imageFormat(): PrintSaveImageFormat {\n    return this._imageFormat;\n  }\n  set imageFormat(value: PrintSaveImageFormat) {\n    this._imageFormat = value;\n  }\n  private _imageFormat: PrintSaveImageFormat;\n\n  @Input()\n  get legendPosition(): PrintLegendPosition {\n    return this._legendPosition;\n  }\n  set legendPosition(value: PrintLegendPosition) {\n    this._legendPosition = value;\n  }\n  private _legendPosition: PrintLegendPosition;\n\n  @Input()\n  get resolution(): PrintResolution {\n    return this._resolution;\n  }\n  set resolution(value: PrintResolution) {\n    this._resolution = value;\n  }\n  private _resolution: PrintResolution;\n\n  constructor(private printService: PrintService) {}\n\n  handleFormSubmit(data: PrintOptions) {\n\n    this.disabled$.next(true);\n\n    if (data.isPrintService === true) {\n      this.printService\n        .print(this.map, data)\n        .pipe(take(1))\n        .subscribe(() => {\n          this.disabled$.next(false);\n        });\n    } else {\n      let nbFileToProcess = 1;\n\n      if (data.showLegend) {\n        nbFileToProcess++;\n      }\n      if (data.imageFormat.toLowerCase() === 'tiff') {\n        nbFileToProcess++;\n      }\n\n      this.printService.defineNbFileToProcess(nbFileToProcess);\n\n      const resolution = +data.resolution;\n\n      let nbRequests = data.showLegend ? 2 : 1;\n      this.printService\n        .downloadMapImage(\n          this.map,\n          resolution,\n          data.imageFormat,\n          data.showProjection,\n          data.showScale,\n          data.showLegend,\n          data.title,\n          data.subtitle,\n          data.comment,\n          data.doZipFile\n        )\n        .pipe(take(1))\n        .subscribe(() => {\n          nbRequests--;\n          if (!nbRequests) {\n            this.disabled$.next(false);\n          }\n        });\n      if (data.showLegend) {\n        this.printService\n          .getLayersLegendImage(\n            this.map,\n            data.imageFormat,\n            data.doZipFile,\n            +resolution\n          )\n          .then(() => {\n            nbRequests--;\n            if (!nbRequests) {\n              this.disabled$.next(false);\n            }\n          });\n      }\n    }\n  }\n}\n","<igo-print-form\n  [outputFormat]=\"outputFormat\"\n  [paperFormat]=\"paperFormat\"\n  [orientation]=\"orientation\"\n  [imageFormat]=\"imageFormat\"\n  [resolution]=\"resolution\"\n  [legendPosition]=\"legendPosition\"\n  [disabled$]=\"disabled$\"\n  (submit)=\"handleFormSubmit($event)\">\n</igo-print-form>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoKeyValueModule } from '@igo2/common';\n\nimport { PrintComponent } from './print/print.component';\nimport { PrintFormComponent } from './print-form/print-form.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatButtonModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatInputModule,\n    MatFormFieldModule,\n    MatSlideToggleModule,\n    IgoLanguageModule,\n    IgoKeyValueModule\n  ],\n  exports: [PrintComponent, PrintFormComponent],\n  declarations: [PrintComponent, PrintFormComponent]\n})\nexport class IgoPrintModule {}\n","import { ConfigService } from '@igo2/core';\n\nimport { SearchSource } from '../../search/shared/sources/source';\n\nimport { QuerySearchSource } from './query-search-source';\n\n/**\n * Map search source factory\n * @ignore\n */\nexport function querySearchSourceFactory(config: ConfigService) {\n  return new QuerySearchSource(\n    config.getConfig(`searchSources.${QuerySearchSource.id}`) || {}\n  );\n}\n\n/**\n * Function that returns a provider for the map search source\n */\nexport function provideQuerySearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: querySearchSourceFactory,\n    multi: true,\n    deps: [ConfigService]\n  };\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { QueryDirective } from './shared/query.directive';\nimport { QueryService } from './shared/query.service';\nimport { provideQuerySearchSource } from './shared/query-search-source.providers';\n\n@NgModule({\n  imports: [CommonModule],\n  exports: [QueryDirective],\n  declarations: [QueryDirective],\n  providers: [QueryService]\n})\nexport class IgoQueryModule {\n  static forRoot(): ModuleWithProviders<IgoQueryModule> {\n    return {\n      ngModule: IgoQueryModule,\n      providers: [provideQuerySearchSource()]\n    };\n  }\n}\n","import { Observable } from 'rxjs';\n\n\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\n\nexport abstract class DirectionsSource {\n  abstract enabled: boolean;\n  abstract getName(): string;\n  abstract route(coordinates: [number, number][], directionsOptions: DirectionOptions): Observable<Direction[]>;\n}\n","import { DirectionsSource } from '../directions-sources/directions-source';\n\nexport class DirectionsSourceService {\n  constructor(public sources: DirectionsSource[]) {}\n}\n\nexport function directionsSourceServiceFactory(sources: DirectionsSource[]) {\n  return new DirectionsSourceService(sources);\n}\n\nexport function provideDirectionsSourceService() {\n  return {\n    provide: DirectionsSourceService,\n    useFactory: directionsSourceServiceFactory,\n    deps: [DirectionsSource]\n  };\n}\n","export enum DirectionsFormat {\n  GeoJSON,\n  JSON\n}\nexport enum SourceDirectionsType {\n  Route = 'route',\n  Trip = 'trip'\n}\n\nexport enum ProposalType {\n  Coord = 'coord',\n  Text = 'text'\n}\n\nexport enum DirectionType {\n  Stop = 'stop',\n  Route = 'route',\n  Vertex = 'vertex'\n}\n\nexport enum DirectionRelativePositionType {\n  Start = 'start',\n  Intermediate = 'intermediate',\n  End = 'end'\n}\n","import olFeature from 'ol/Feature';\nimport * as olStyle from 'ol/style';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olGeom from 'ol/geom';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport * as olProj from 'ol/proj';\n\nimport { uuid, NumberUtils } from '@igo2/utils';\n\nimport { Direction, FeatureWithDirection, FeatureWithStop, Stop } from './directions.interface';\nimport { createOverlayMarkerStyle } from '../../overlay/shared/overlay-marker-style.utils';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { tryBindStoreLayer } from '../../feature/shared/feature.utils';\nimport { tryAddLoadingStrategy } from '../../feature/shared/strategies.utils';\nimport { FeatureStoreLoadingStrategy } from '../../feature/shared/strategies/loading';\nimport { FEATURE, FeatureMotion } from '../../feature/shared/feature.enums';\nimport { LanguageService } from '@igo2/core';\nimport { FeatureGeometry } from '../../feature/shared/feature.interfaces';\nimport { DirectionRelativePositionType, DirectionType } from './directions.enum';\nimport { RoutesFeatureStore, StepFeatureStore, StopsFeatureStore, StopsStore } from './store';\n\n/**\n * Function that updat the sort of the list base on the provided field.\n * @param source stop store\n * @param direction asc / desc sort order\n * @param field the field to use to sort the view\n */\nexport function updateStoreSorting(stopsStore: StopsStore, direction: 'asc' | 'desc' = 'asc', field = 'position') {\n  stopsStore.view.sort({\n    direction,\n    valueAccessor: (entity: Stop) => entity[field]\n  });\n}\n\nexport function computeRelativePosition(index: number, totalLength): DirectionRelativePositionType {\n  let relativePosition = DirectionRelativePositionType.Intermediate;\n  if (index === 0) {\n    relativePosition = DirectionRelativePositionType.Start;\n  } else if (index === totalLength - 1) {\n    relativePosition = DirectionRelativePositionType.End;\n  }\n  return relativePosition;\n}\n\nexport function computeStopsPosition(stopsStore: StopsStore) {\n\n  const stopsToComputePosition = [...stopsStore.all()];\n  stopsToComputePosition.sort((a, b) => a.position - b.position);\n  stopsToComputePosition.map((stop, i) => {\n    stop.position = i;\n    stop.relativePosition = computeRelativePosition(stop.position, stopsToComputePosition.length);\n  });\n  if (stopsToComputePosition) {\n    stopsStore.updateMany(stopsToComputePosition);\n  }\n}\n\n/**\n * Function that add a stop to the stop store. Stop are always added before the last stop.\n * @param stopsStore stop store as an EntityStore\n */\nexport function addStopToStore(stopsStore: StopsStore): Stop {\n\n  const id = uuid();\n  const stops = stopsStore.all();\n  let positions: number[];\n  if (stopsStore.count === 0) {\n    positions = [0];\n  } else {\n    positions = stops.map(stop => stop.position);\n  }\n  const maxPosition: number = Math.max(...positions);\n  const insertPosition: number = maxPosition;\n  const lastPosition: number = maxPosition + 1;\n\n  const stopToUpdate = stopsStore.all().find(stop => stop.position === maxPosition);\n  if (stopToUpdate) {\n    stopToUpdate.position = lastPosition;\n    stopToUpdate.relativePosition = computeRelativePosition(lastPosition, stopsStore.count + 1);\n  }\n\n  stopsStore.insert({ id, position: insertPosition, relativePosition: computeRelativePosition(insertPosition, stopsStore.count + 1) });\n\n  updateStoreSorting(stopsStore);\n  return stopsStore.get(id);\n}\n\nexport function removeStopFromStore(stopsStore: StopsStore, stop: Stop) {\n  stopsStore.delete(stop);\n  computeStopsPosition(stopsStore);\n}\n\n/**\n * Create a style for the directions stops and routes\n * @param feature OlFeature\n * @returns OL style function\n */\nexport function directionsStyle(\n  feature: olFeature<OlGeometry>,\n  resolution: number\n): olStyle.Style | olStyle.Style[] {\n  const vertexStyle = [\n    new olStyle.Style({\n      geometry: feature.getGeometry(),\n      image: new olStyle.Circle({\n        radius: 7,\n        stroke: new olStyle.Stroke({ color: '#FF0000', width: 3 })\n      })\n    })\n  ];\n\n  const stopStyle = createOverlayMarkerStyle({\n    text: feature.get('stopText'),\n    opacity: feature.get('stopOpacity'),\n    markerColor: feature.get('stopColor'),\n    markerOutlineColor: [255, 255, 255]\n  });\n\n  const routeStyle = [\n    new olStyle.Style({\n      stroke: new olStyle.Stroke({ color: `rgba(106, 121, 130, ${feature.get('active') ? 0.75 : 0})`, width: 10 })\n    }),\n    new olStyle.Style({\n      stroke: new olStyle.Stroke({ color: `rgba(79, 169, 221, ${feature.get('active') ? 0.75 : 0})`, width: 6 })\n    })\n  ];\n\n  if (feature.get('type') === DirectionType.Stop) {\n    return stopStyle;\n  }\n  if (feature.get('type') === 'vertex') {\n    return vertexStyle;\n  }\n  if (feature.get('type') === DirectionType.Route) {\n    return routeStyle;\n  }\n}\n\nexport function initStopsFeatureStore(stopsFeatureStore: StopsFeatureStore, languageService: LanguageService) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const stopsLayer = new VectorLayer({\n    isIgoInternalLayer: true,\n    id: 'igo-direction-stops-layer',\n    title: languageService.translate.instant('igo.geo.directionsForm.stopLayer'),\n    zIndex: 911,\n    source: new FeatureDataSource(),\n    showInLayerList: true,\n    workspace: {\n      enabled: false,\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-stops-layer',\n      links: [\n        {\n          bidirectionnal: false,\n          syncedDelete: true,\n          linkedIds: ['igo-direction-route-layer'],\n          properties: []\n        }\n      ]\n    },\n    exportable: true,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(stopsFeatureStore, stopsLayer);\n  stopsFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(stopsFeatureStore, loadingStrategy);\n}\n\nexport function initRoutesFeatureStore(routesFeatureStore: RoutesFeatureStore, languageService: LanguageService) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const routeLayer = new VectorLayer({\n    isIgoInternalLayer: true,\n    id: 'igo-direction-route-layer',\n    title: languageService.translate.instant('igo.geo.directionsForm.routeLayer'),\n    zIndex: 910,\n    source: new FeatureDataSource(),\n    showInLayerList: true,\n    workspace: {\n      enabled: false,\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-route-layer'\n    },\n    exportable: true,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(routesFeatureStore, routeLayer);\n  routesFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(routesFeatureStore, loadingStrategy);\n}\n\nexport function initStepFeatureStore(stepFeatureStore: StepFeatureStore) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const stepLayer = new VectorLayer({\n    isIgoInternalLayer: true,\n    id: 'igo-direction-step-layer',\n    title: '',\n    zIndex: 910,\n    source: new FeatureDataSource(),\n    showInLayerList: false,\n    workspace: {\n      enabled: false,\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-route-layer'\n    },\n    exportable: false,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(stepFeatureStore, stepLayer);\n  stepFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(stepFeatureStore, loadingStrategy);\n}\n\n\nexport function addStopToStopsFeatureStore(\n  stop: Stop,\n  stopsStore: StopsStore,\n  stopsFeatureStore: StopsFeatureStore,\n  projection: string,\n  languageService: LanguageService) {\n  let stopColor;\n  let stopText;\n\n\n  switch (stop.relativePosition) {\n    case DirectionRelativePositionType.Start:\n      stopColor = '#008000';\n      stopText = languageService.translate.instant('igo.geo.directionsForm.start');\n      break;\n    case DirectionRelativePositionType.End:\n      stopColor = '#f64139';\n      stopText = languageService.translate.instant('igo.geo.directionsForm.end');\n      break;\n    default:\n      stopColor = '#ffd700';\n      stopText = languageService.translate.instant('igo.geo.directionsForm.intermediate') + ' #' + stop.position;\n      break;\n  }\n\n  const geometry = new olGeom.Point(\n    olProj.transform(stop.coordinates, projection, stopsFeatureStore.map.projection)\n  );\n\n  const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n    featureProjection: stopsFeatureStore.map.projection,\n    dataProjection: stopsFeatureStore.map.projection\n  }) as FeatureGeometry;\n\n  const previousStop = stopsFeatureStore.get(stop.id);\n  const previousStopRevision = previousStop ? previousStop.meta.revision : 0;\n\n  const stopFeatureStore: FeatureWithStop = {\n    type: FEATURE,\n    geometry: geojsonGeom,\n    projection: stopsFeatureStore.map.projection,\n    properties: {\n      id: stop.id,\n      type: DirectionType.Stop,\n      stopText,\n      stopColor,\n      stopOpacity: 1,\n      stop\n    },\n    meta: {\n      id: stop.id,\n      revision: previousStopRevision + 1\n    },\n    ol: new olFeature({ geometry })\n  };\n  stopsFeatureStore.update(stopFeatureStore);\n}\n\nexport function addDirectionToRoutesFeatureStore(\n  routesFeatureStore: RoutesFeatureStore,\n  direction: Direction,\n  projection: string,\n  active: boolean = false,\n  moveToExtent = false) {\n  const geom = direction.geometry.coordinates;\n  const geometry4326 = new olGeom.LineString(geom);\n  const geometry = geometry4326.transform(\n    projection,\n    routesFeatureStore.map.projection\n  );\n\n  const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n    featureProjection: routesFeatureStore.map.projection,\n    dataProjection: routesFeatureStore.map.projection\n  }) as FeatureGeometry;\n\n\n  const previousRoute = routesFeatureStore.get(direction.id);\n  const previousRouteRevision = previousRoute\n    ? previousRoute.meta.revision\n    : 0;\n\n  const routeFeatureStore: FeatureWithDirection = {\n    type: FEATURE,\n    geometry: geojsonGeom,\n    projection: routesFeatureStore.map.projection,\n    properties: {\n      id: direction.id,\n      type: DirectionType.Route,\n      active,\n      direction\n    },\n    meta: {\n      id: direction.id,\n      revision: previousRouteRevision + 1\n    },\n    ol: new olFeature({ geometry })\n  };\n  routesFeatureStore.update(routeFeatureStore);\n}\n\nexport function formatDistance(distance: number): string {\n  if (distance === 0) {\n    return;\n  }\n  if (distance >= 100000) {\n    return NumberUtils.roundToNDecimal(Math.round(distance) / 1000, 1) + ' km';\n  }\n  if (distance >= 10000) {\n    return NumberUtils.roundToNDecimal(Math.round(distance) / 100 / 10, 1) + ' km';\n  }\n  if (distance >= 1000) {\n    return NumberUtils.roundToNDecimal(Math.round(distance) / 100 / 10, 1) + ' km';\n  }\n  return NumberUtils.roundToNDecimal(distance, 0) + ' m';\n}\n\nexport function formatDuration(duration: number): string {\n  if (duration >= 3600) {\n    const hour = Math.floor(duration / 3600);\n    const minute = Math.round((duration / 3600 - hour) * 60);\n    if (minute === 60) {\n      return hour + 1 + ' h';\n    }\n    return hour + ' h ' + minute + ' min';\n  }\n\n  if (duration >= 60) {\n    return Math.round(duration / 60) + ' min';\n  }\n  return duration + ' s';\n}\n\nexport function formatInstruction(\n  type,\n  modifier,\n  route,\n  direction,\n  stepPosition,\n  exit,\n  languageService: LanguageService,\n  lastStep = false\n) {\n  const translate = languageService.translate;\n  let directive;\n  let image = 'forward';\n  let cssClass = 'rotate-270';\n  const translatedDirection = translateBearing(direction, languageService);\n  const translatedModifier = translateModifier(modifier, languageService);\n  const prefix = modifier === 'straight' ? '' : translate.instant('igo.geo.directions.modifier.prefix');\n\n  let aggregatedDirection = prefix + translatedModifier;\n\n\n  if (modifier?.search('slight') >= 0) {\n    aggregatedDirection = translatedModifier;\n  }\n\n  if (modifier === 'uturn') {\n    image = 'forward';\n    cssClass = 'rotate-90';\n  } else if (modifier === 'sharp right') {\n    image = 'subdirectory-arrow-right';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'right') {\n    image = 'subdirectory-arrow-right';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'slight right') {\n    image = 'forward';\n    cssClass = 'rotate-290';\n  } else if (modifier === 'straight') {\n    image = 'forward';\n  } else if (modifier === 'slight left') {\n    image = 'forward';\n    cssClass = 'rotate-250';\n  } else if (modifier === 'left') {\n    image = 'subdirectory-arrow-left';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'sharp left') {\n    image = 'subdirectory-arrow-left';\n    cssClass = 'icon-flipped';\n  }\n\n  if (type === 'turn') {\n    if (modifier === 'straight') {\n      directive = translate.instant('igo.geo.directions.turn.straight', { route });\n    } else if (modifier === 'uturn') {\n      directive = translate.instant('igo.geo.directions.turn.uturn', { route });\n    } else {\n      directive = translate.instant('igo.geo.directions.turn.else', { route, aggregatedDirection, translatedModifier });\n    }\n  } else if (type === 'new name') {\n    directive = translate.instant('igo.geo.directions.new name', { route, translatedDirection });\n    image = 'compass';\n    cssClass = '';\n  } else if (type === 'depart') {\n    directive = translate.instant('igo.geo.directions.depart', { route, translatedDirection });\n    image = 'compass';\n    cssClass = '';\n  } else if (type === 'arrive') {\n    if (lastStep) {\n      const coma = !translatedModifier ? '' : ', ';\n      aggregatedDirection = !translatedModifier ? '' : aggregatedDirection;\n      directive = translate.instant('igo.geo.directions.arrive.lastStep', { coma, aggregatedDirection });\n    } else {\n      directive = translate.instant('igo.geo.directions.arrive.intermediate', { route });\n      image = 'map-marker';\n      cssClass = '';\n    }\n  } else if (type === 'merge') {\n    directive = translate.instant('igo.geo.directions.merge', { route });\n    image = 'forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'on ramp') {\n    directive = translate.instant('igo.geo.directions.on ramp', { aggregatedDirection });\n  } else if (type === 'off ramp') {\n    directive = translate.instant('igo.geo.directions.off ramp', { aggregatedDirection });\n  } else if (type === 'fork') {\n    if (modifier.search('left') >= 0) {\n      directive = translate.instant('igo.geo.directions.fork.left', { route });\n    } else if (modifier.search('right') >= 0) {\n      directive = translate.instant('igo.geo.directions.fork.right', { route });\n    } else {\n      directive = translate.instant('igo.geo.directions.fork.else', { route });\n    }\n  } else if (type === 'end of road') {\n    directive = translate.instant('igo.geo.directions.end of road', { translatedModifier, route });\n  } else if (type === 'use lane') {\n    directive = translate.instant('igo.geo.directions.use lane');\n  } else if (type === 'continue' && modifier !== 'uturn') {\n    directive = translate.instant('igo.geo.directions.continue.notUturn', { route });\n    image = 'forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'roundabout') {\n    const cntSuffix = exit === 1 ?\n      translate.instant('igo.geo.directions.cntSuffix.first') :\n      translate.instant('igo.geo.directions.cntSuffix.secondAndMore');\n    directive = translate.instant('igo.geo.directions.roundabout', { exit, cntSuffix, route });\n    image = 'chart-donut';\n    cssClass = '';\n  } else if (type === 'rotary') {\n    directive = translate.instant('igo.geo.directions.rotary');\n    image = 'chart-donut';\n    cssClass = '';\n  } else if (type === 'roundabout turn') {\n    directive = translate.instant('igo.geo.directions.roundabout turn');\n    image = 'chart-donut';\n    cssClass = '';\n  } else if (type === 'exit roundabout') {\n    directive = translate.instant('igo.geo.directions.exit roundabout', { route });\n    image = 'forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'notification') {\n    directive = translate.instant('igo.geo.directions.notification');\n  } else if (modifier === 'uturn') {\n    directive = translate.instant('igo.geo.directions.uturnText', { translatedDirection, route });\n  } else {\n    directive = translate.instant('igo.geo.directions.unknown');\n  }\n\n  image = lastStep ? 'flag-variant' : image;\n  cssClass = lastStep ? '' : cssClass;\n  image = stepPosition === 0 ? 'compass' : image;\n  cssClass = stepPosition === 0 ? '' : cssClass;\n\n  return { instruction: directive, image, cssClass };\n}\n\nexport function translateModifier(modifier, languageService: LanguageService) {\n  const translate = languageService.translate;\n  if (modifier === 'uturn') {\n    return translate.instant('igo.geo.directions.uturn');\n  } else if (modifier === 'sharp right') {\n    return translate.instant('igo.geo.directions.sharp right');\n  } else if (modifier === 'right') {\n    return translate.instant('igo.geo.directions.right');\n  } else if (modifier === 'slight right') {\n    return translate.instant('igo.geo.directions.slight right');\n  } else if (modifier === 'sharp left') {\n    return languageService.translate.instant('igo.geo.directions.sharp left');\n  } else if (modifier === 'left') {\n    return languageService.translate.instant('igo.geo.directions.left');\n  } else if (modifier === 'slight left') {\n    return languageService.translate.instant('igo.geo.directions.slight left');\n  } else if (modifier === 'straight') {\n    return languageService.translate.instant('igo.geo.directions.straight');\n  } else {\n    return modifier;\n  }\n}\n\nexport function translateBearing(bearing: number, languageService: LanguageService) {\n  const translate = languageService.translate;\n  if (bearing >= 337 || bearing < 23) {\n    return translate.instant('igo.geo.cardinalPoints.n');\n  } else if (bearing < 67) {\n    return translate.instant('igo.geo.cardinalPoints.ne');\n  } else if (bearing < 113) {\n    return translate.instant('igo.geo.cardinalPoints.e');\n  } else if (bearing < 157) {\n    return translate.instant('igo.geo.cardinalPoints.se');\n  } else if (bearing < 203) {\n    return translate.instant('igo.geo.cardinalPoints.s');\n  } else if (bearing < 247) {\n    return translate.instant('igo.geo.cardinalPoints.sw');\n  } else if (bearing < 293) {\n    return translate.instant('igo.geo.cardinalPoints.w');\n  } else if (bearing < 337) {\n    return translate.instant('igo.geo.cardinalPoints.nw');\n  } else {\n    return;\n  }\n}\n\n\n","<div cdkDropList class=\"stops-list\" (cdkDropListDropped)=\"drop($event)\">\n  <div touchleave  \n  (touchenter)=\"onStopEnter(stop)\"\n  (touchleave)=\"onStopLeave()\"\n  (mouseover)=\"onStopEnter(stop)\"\n  (mouseleave)=\"onStopLeave()\"\n  (cdkDragStarted)=\"stopIsDragged=true\"\n  (cdkDragEnded)=\"stopIsDragged=false\"\n  cdkDragLockAxis=\"y\" class=\"stop-box mat-typography\" *ngFor=\"let stop of stopsStore.view.all$() | async; let i = index;\" cdkDrag>\n    <div [ngClass]=\"getNgClass(stop)\">\n      <mat-form-field>\n        <input id=\"{{stop.id}}\" type=\"text\"\n            [placeholder]=\"getPlaceholder(stop)\"\n            matTooltipShowDelay=\"500\"\n            [matTooltip]=\"stop.text\"\n            aria-label=\"Number\"\n            matInput\n            (focus)=\"onInputFocus(stop)\"\n            [(ngModel)]=\"stop.text\"\n            (keyup)=\"setStopText($event,stop)\"\n            (keydown.enter)=\"$event.preventDefault()\"\n            [matAutocomplete]=\"auto\">\n        <button \n            mat-button \n            *ngIf=\"(stop.text || stop.coordinates) && stopWithHover && stop.id===stopWithHover.id\"\n            matTooltipShowDelay=\"500\"\n            [matTooltip]=\"'igo.geo.directionsForm.clearStop' | translate\"\n            matSuffix mat-icon-button color=\"warn\" aria-label=\"Clear\" (click)=\"clearStop(stop)\">\n            <mat-icon svgIcon=\"close\"></mat-icon>\n        </button>\n      \n        <mat-autocomplete [displayWith]=\"getOptionText\" #auto=\"matAutocomplete\" (optionSelected)=\"chooseProposal($event,stop)\">\n          <mat-optgroup *ngFor=\"let source of stop.searchProposals\" [label]=\"source.source.title\" [disabled]=\"source.source.enabled === false\">\n          <mat-option *ngFor=\"let result of source.results\" [value]=\"result\" \n          matTooltipShowDelay=\"500\" [matTooltip]=\"result.meta ? result.meta.title : ''\">\n            {{ result.meta ? result.meta.title : '' }}\n          </mat-option>\n          </mat-optgroup>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n\n\n\n\n    <div class=\"igo-form-button-group\" *ngIf=\"!stopIsDragged && stopWithHover && stop.id === stopWithHover.id\">\n      <button class=\"swipe-vertical\" cdkDragHandle mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.directionsForm.moveStop' | translate\" color=\"primary\">\n        <mat-icon svgIcon=\"gesture-swipe-vertical\"></mat-icon>\n      </button>\n\n      <button *ngIf=\"(stopsStore.count$ | async)> 2\" mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.directionsForm.removeStop' | translate\" color=\"warn\" (click)=\"removeStop(stop)\">\n        <mat-icon svgIcon=\"delete\"></mat-icon>\n      </button>\n      <button *ngIf=\"(stopsStore.count$ | async)<= 2\" disabled=\"true\" mat-icon-button tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\" [matTooltip]=\"'igo.geo.directionsForm.removeStop' | translate\" color=\"warn\">\n        <mat-icon svgIcon=\"blank\"></mat-icon>\n      </button>\n    </div>\n  </div>\n</div>","import { Component, EventEmitter, Input, OnDestroy, Output } from '@angular/core';\nimport { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\n\nimport * as olProj from 'ol/proj';\nimport * as olObservable from 'ol/Observable';\n\nimport { Stop } from '../shared/directions.interface';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport pointOnFeature from '@turf/point-on-feature';\nimport { computeRelativePosition, removeStopFromStore, updateStoreSorting } from '../shared/directions.utils';\nimport { MatAutocomplete } from '@angular/material/autocomplete';\nimport { MatOption } from '@angular/material/core';\nimport { StopsFeatureStore, StopsStore } from '../shared/store';\nimport { roundCoordTo } from '../../map/shared/map.utils';\nimport { LanguageService } from '@igo2/core';\nimport { DirectionRelativePositionType } from '../shared/directions.enum';\n\n@Component({\n  selector: 'igo-directions-inputs',\n  templateUrl: './directions-inputs.component.html',\n  styleUrls: ['./directions-inputs.component.scss']\n})\nexport class DirectionsInputsComponent implements OnDestroy {\n\n  private readonly invalidKeys = ['Control', 'Shift', 'Alt'];\n  private onMapClickEventKeys = [];\n  public stopWithHover: Stop;\n  public stopIsDragged: boolean = false;\n  @Input() stopsStore: StopsStore;\n  @Input() stopsFeatureStore: StopsFeatureStore;\n  @Input() projection: string;\n  @Input() coordRoundedDecimals: number = 6;\n\n  @Input() debounce: number = 200;\n  @Input() length: number = 2;\n\n  @Output() stopInputHasFocus: EventEmitter<boolean> = new EventEmitter<boolean>(false);\n  constructor(private languageService: LanguageService) { }\n\n  ngOnDestroy(): void {\n    this.unlistenMapSingleClick();\n  }\n  onStopEnter(stop: Stop) {\n    this.stopWithHover = stop;\n  }\n  onStopLeave() {\n    this.stopWithHover = undefined;\n  }\n\n  getOptionText(option) {\n    if (option instanceof Object) {\n      return option?.meta ? option.meta.title : '';\n    }\n    return option;\n  }\n\n  chooseProposal(event: { source: MatAutocomplete, option: MatOption }, stop: Stop) {\n    const result: Feature = event.option.value;\n    if (result) {\n      let geomCoord;\n      const geom = result.geometry;\n      if (geom.type === 'Point') {\n        geomCoord = geom.coordinates;\n      } else {\n        const point = pointOnFeature(result.geometry);\n        geomCoord = [\n          point.geometry.coordinates[0],\n          point.geometry.coordinates[1]\n        ];\n      }\n      if (geomCoord) {\n        stop.coordinates = geomCoord;\n        stop.text = result.meta.title;\n        this.stopsStore.update(stop);\n      }\n    }\n  }\n\n  setStopText(event: KeyboardEvent, stop: Stop) {\n    this.unlistenMapSingleClick();\n    const term = (event.target as HTMLInputElement).value;\n    if (term.length === 0) {\n      this.clearStop(stop);\n    } else if (this.validateTerm(term)) {\n      stop.text = term;\n      this.stopsStore.update(stop);\n    }\n  }\n\n  validateTerm(term: string) {\n    if (\n      this.keyIsValid(term) &&\n      (term.length >= this.length || term.length === 0)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  private keyIsValid(key: string) {\n    return this.invalidKeys.find(value => value === key) === undefined;\n  }\n\n  getNgClass(stop: Stop): string {\n    if (!this.stopWithHover) {\n      return 'igo-input-container';\n    } else if (stop.id === this.stopWithHover.id) {\n      return 'igo-input-container reduce';\n    } else {\n      return 'igo-input-container';\n    }\n  }\n\n  getPlaceholder(stop: Stop): string {\n    let extra = '';\n    if (stop.relativePosition) {\n      if (stop.relativePosition === DirectionRelativePositionType.Intermediate) {\n        extra = ' #' + stop.position;\n      }\n      return this.languageService.translate.instant('igo.geo.directionsForm.' + stop.relativePosition) + extra;\n    } else {\n      return '';\n    }\n  }\n\n  removeStop(stop: Stop) {\n    removeStopFromStore(this.stopsStore, stop);\n  }\n\n  clearStop(stop: Stop) {\n    this.stopsStore.update({ id: stop.id, relativePosition: stop.relativePosition, position: stop.position });\n  }\n\n  drop(event: CdkDragDrop<string[]>) {\n    this.moveStops(event.previousIndex, event.currentIndex);\n  }\n\n  private moveStops(fromIndex, toIndex) {\n    if (fromIndex !== toIndex) {\n      const stops = [...this.stopsStore.view.all()];\n      moveItemInArray(stops, fromIndex, toIndex);\n      stops.map((stop, i) => {\n        stop.relativePosition = computeRelativePosition(i, stops.length);\n        stop.position = i;\n      });\n      this.stopsStore.updateMany(stops);\n      updateStoreSorting(this.stopsStore);\n    }\n  }\n\n  onInputFocus(stop: Stop) {\n    if (!stop.text || stop.text?.length === 0) {\n      this.unlistenMapSingleClick();\n      this.stopInputHasFocus.emit(true);\n      this.listenMapSingleClick(stop);\n    }\n  }\n\n  private listenMapSingleClick(stop: Stop) {\n    const key = this.stopsFeatureStore.layer.map.ol.once('singleclick', event => {\n      const clickCoordinates = olProj.transform(\n        event.coordinate,\n        this.stopsFeatureStore.layer.map.projection,\n        this.projection\n      );\n      const roundedCoord = roundCoordTo(clickCoordinates as [number, number], this.coordRoundedDecimals);\n      stop.text = roundedCoord.join(',');\n      stop.coordinates = roundedCoord;\n      this.stopsStore.update(stop);\n      setTimeout(() => {\n        this.stopInputHasFocus.emit(false);\n      }, 500);\n    });\n    this.onMapClickEventKeys.push(key);\n  }\n\n  private unlistenMapSingleClick() {\n    this.onMapClickEventKeys.map(key => {\n      olObservable.unByKey(key);\n    });\n    this.onMapClickEventKeys = [];\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable } from 'rxjs';\n\n\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\nimport { DirectionsSource } from '../directions-sources/directions-source';\nimport { DirectionsSourceService } from './directions-source.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DirectionsService {\n  constructor(private directionsSourceService: DirectionsSourceService) {}\n\n  route(coordinates: [number, number][], directionsOptions: DirectionOptions = {}): Observable<Direction[]>[] {\n    if (coordinates.length === 0) {\n      return;\n    }\n    return this.directionsSourceService.sources\n      .filter((source: DirectionsSource) => source.enabled)\n      .map((source: DirectionsSource) => this.routeSource(source, coordinates, directionsOptions));\n  }\n\n  routeSource(\n    source: DirectionsSource,\n    coordinates: [number, number][],\n    directionsOptions: DirectionOptions = {}\n  ): Observable<Direction[]> {\n    const request = source.route(coordinates, directionsOptions );\n    return request;\n  }\n}\n","import { FEATURE } from '../../feature/shared/feature.enums';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { SearchSource } from './sources/source';\nimport { SearchResult } from './search.interfaces';\n\n/**\n * Function that checks whether a search source implements TextSearch\n * @param source Search source\n * @returns True if the search source implements TextSearch\n */\nexport function sourceCanSearch(source: SearchSource): boolean {\n  return (source as any).search !== undefined;\n}\n\n/**\n * Function that checks whether a search source implements ReverseSearch\n * @param source Search source\n * @returns True if the search source implements ReverseSearch\n */\nexport function sourceCanReverseSearch(source: SearchSource): boolean {\n  return (source as any).reverseSearch !== undefined;\n}\n\n/**\n * Function that checks whether a search source implements ReverseSearch AND is shown in the pointer summary\n * @param source Search source\n * @returns True if the search source implements ReverseSearch AND is shown in the pointer summary\n */\nexport function sourceCanReverseSearchAsSummary(source: SearchSource): boolean {\n  return (source as any).reverseSearch !== undefined && source.showInPointerSummary === true;\n}\n\n/**\n * Return a search result out of an Feature. This is used to adapt\n * the IGO query module to the new Feature/SearchResult interfaces\n * @param feature feature\n * @param source Search source\n * @returns SearchResult\n */\nexport function featureToSearchResult(\n  feature: Feature,\n  source: SearchSource\n): SearchResult<Feature> {\n  feature.sourceId = source.getId();\n  return {\n    source,\n    data: feature,\n    meta: {\n      dataType: FEATURE,\n      id: feature.meta.id as string,\n      title: feature.meta.title,\n      icon: feature.meta.icon || 'map-marker'\n    }\n  };\n}\n\nexport function findDiff(str1: string, str2: string){\n  let diff = '';\n  str2.split('').forEach((val, i) => {\n    if (val !== str1.charAt(i)) {\n      diff += val;\n    }\n  });\n  return diff;\n}\n\n\n/**\n * Return a score calculation based on \"from\" term with the \"to\" term,\n * where the perfect match is 100 and a total difference is 0 or under.\n * @param from string\n * @param to string\n * @param caseSensitive boolean\n * @returns number\n */\nexport function computeTermSimilarity(from, to, caseSensitive: boolean = false): number {\n  if (!from || !to) {\n    return 0;\n  }\n  const termFrom = caseSensitive ? from : from.toLowerCase();\n  const termTo = caseSensitive ? to : to.toLowerCase();\n  const fromToDiff = findDiff(termFrom, termTo);\n  const toFromDiff = findDiff(termTo, termFrom);\n  const totalDiff = fromToDiff + toFromDiff;\n\n  let delta = 0;\n  if (totalDiff.length) {\n    delta = totalDiff.length / termFrom.length * 100;\n  }\n\n  return 100 - Math.floor(delta);\n}\n","import { SearchSource } from './sources/source';\nimport { SearchSourceSettings } from './sources/source.interfaces';\n\n/**\n * Service where all available search sources are registered.\n */\nexport class SearchSourceService {\n\n  constructor(private sources: SearchSource[]) {}\n\n  /**\n   * Return available search sources\n   * @returns Search sources\n   */\n  getSources(): SearchSource[] {\n    return this.sources;\n  }\n\n  /**\n   * Return enabled search sources\n   * @returns Search sources\n   */\n  getEnabledSources(): SearchSource[] {\n    return this.getSources().filter(\n      (source: SearchSource) => source.enabled === true\n    );\n  }\n\n  /**\n   * Enable search sources of given type\n   * @param type Search type\n   * @todo It would be better to track the enabled search sources\n   *  without updating their 'enabled' property.\n   */\n  enableSourcesByType(type: string) {\n    this.getSources().forEach((source: SearchSource) => {\n      if ((source.constructor as typeof SearchSource).type === type) {\n        source.enabled = true;\n      } else {\n        source.enabled = false;\n      }\n    });\n  }\n\n  /**\n   * Set Param from the selected settings\n   * @param source search-source\n   * @param setting settings\n   */\n  setParamFromSetting(source: SearchSource, setting: SearchSourceSettings) {\n    source.setParamFromSetting(setting);\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { stringToLonLat } from '../../map';\nimport { MapService } from '../../map/shared/map.service';\n\nimport { SearchSource, TextSearch, ReverseSearch } from './sources/source';\nimport {\n  TextSearchOptions,\n  ReverseSearchOptions\n} from './sources/source.interfaces';\nimport { SearchSourceService } from './search-source.service';\nimport { Research } from './search.interfaces';\nimport {\n  sourceCanSearch,\n  sourceCanReverseSearch,\n  sourceCanReverseSearchAsSummary\n} from './search.utils';\n\n/**\n * This service perform researches in all the search sources enabled.\n * It returns Research objects who's 'request' property needs to be\n * subscribed to in order to trigger the research. This services has\n * keeps internal state of the researches it performed\n * and the results they yielded.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class SearchService {\n  constructor(\n    private searchSourceService: SearchSourceService,\n    private mapService: MapService\n  ) {}\n\n  /**\n   * Perform a research by text\n   * @param term Any text\n   * @returns Researches\n   */\n  search(term: string, options: TextSearchOptions = {}): Research[] {\n    if (!this.termIsValid(term)) {\n      return [];\n    }\n\n    const proj = this.mapService.getMap()?.projection || 'EPSG:3857';\n    const response = stringToLonLat(term, proj, {\n      forceNA: options.forceNA\n    });\n    if (response.lonLat) {\n      return this.reverseSearch(response.lonLat, { distance: response.radius, conf: response.conf });\n    } else if (response.message) {\n      console.log(response.message);\n    }\n\n    options.extent = this.mapService\n      .getMap()\n      ?.viewController.getExtent('EPSG:4326');\n\n    let sources;\n\n    if (options.getEnabledOnly || options.getEnabledOnly === undefined) {\n      sources = this.searchSourceService.getEnabledSources();\n    } else {\n      sources = this.searchSourceService.getSources();\n    }\n\n    if (options.sourceId) {\n      sources = sources.filter((source) => source.getId() === options.sourceId);\n    } else if (options.searchType) {\n      sources = sources.filter(\n        (source) => source.getType() === options.searchType\n      );\n    }\n\n    sources = sources.filter(sourceCanSearch);\n    return this.searchSources(sources, term, options);\n  }\n\n  /**\n   * Perform a research by lon/lat\n   * @param lonLat Any lon/lat coordinates\n   * @returns Researches\n   */\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions,\n    asPointerSummary: boolean = false\n  ) {\n    const reverseSourceFonction = asPointerSummary\n      ? sourceCanReverseSearchAsSummary\n      : sourceCanReverseSearch;\n    const sources = this.searchSourceService\n      .getEnabledSources()\n      .filter(reverseSourceFonction);\n    return this.reverseSearchSources(sources, lonLat, options || {});\n  }\n\n  /**\n   * Create a text research out of all given search sources\n   * @param sources Search sources that implement TextSearch\n   * @param term Search term\n   * @returns Observable of Researches\n   */\n  private searchSources(\n    sources: SearchSource[],\n    term: string,\n    options: TextSearchOptions\n  ): Research[] {\n    return sources.map((source: SearchSource) => {\n      return {\n        request: ((source as any) as TextSearch).search(term, options),\n        reverse: false,\n        source\n      };\n    });\n  }\n\n  /**\n   * Create a reverse research out of all given search sources\n   * @param sources Search sources that implement ReverseSearch\n   * @param lonLat Any lon/lat coordinates\n   * @returns Observable of Researches\n   */\n  private reverseSearchSources(\n    sources: SearchSource[],\n    lonLat: [number, number],\n    options: ReverseSearchOptions\n  ): Research[] {\n    return sources.map((source: SearchSource) => {\n      return {\n        request: ((source as any) as ReverseSearch).reverseSearch(\n          lonLat,\n          options\n        ),\n        reverse: true,\n        source\n      };\n    });\n  }\n\n  /**\n   * Validate that a search term is valid\n   * @param term Search term\n   * @returns True if the search term is valid\n   */\n  private termIsValid(term: string): boolean {\n    return typeof term === 'string' && term !== '';\n  }\n}\n","<div class=\"igo-form-button-group\">\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.directionsForm.addStop' | translate\" color=\"primary\" (click)=\"addStop()\">\n    <mat-icon svgIcon=\"map-marker-plus\"></mat-icon>\n  </button>\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async)>=1 || (stopsStore.count$ | async)>=1\"\n    [matTooltip]=\"'igo.geo.directionsForm.resetDirectionsBtn' | translate\" color=\"warn\" (click)=\"resetStops()\">\n    <mat-icon svgIcon=\"file-restore\"></mat-icon>\n  </button>\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async)>=1\" (click)=\"zoomRoute()\"\n    [matTooltip]=\"'igo.geo.directionsForm.zoomRoute' | translate\" color=\"primary\">\n    <mat-icon svgIcon=\"magnify-plus-outline\"></mat-icon>\n  </button>\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async)>=1\" (click)=\"copyDirectionsToClipboard()\"\n    [matTooltip]=\"'igo.geo.directionsForm.copy' | translate\" color=\"primary\">\n    <mat-icon svgIcon=\"content-copy\"></mat-icon>\n  </button>\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async)>=1\" (click)=\"copyLinkToClipboard()\" \n    [matTooltip]=\"'igo.geo.directionsForm.link' | translate\" color=\"primary\">\n    <mat-icon svgIcon=\"link\"></mat-icon>\n  </button>\n</div>","import { Component, Input, Optional } from '@angular/core';\nimport { LanguageService, MessageService, RouteService } from '@igo2/core';\nimport { Clipboard } from '@igo2/utils';\nimport { Subject } from 'rxjs';\nimport { roundCoordTo } from '../../map/shared/map.utils';\nimport { FeatureWithDirection } from '../shared/directions.interface';\n\nimport { addStopToStore, formatDistance, formatDuration, formatInstruction } from '../shared/directions.utils';\nimport { RoutesFeatureStore, StopsStore } from '../shared/store';\n\n@Component({\n  selector: 'igo-directions-buttons',\n  templateUrl: './directions-buttons.component.html',\n  styleUrls: ['./directions-buttons.component.scss']\n})\nexport class DirectionsButtonsComponent {\n\n  get activeRoute() {\n    return this.routesFeatureStore.all().find(route => route.properties.active);\n  }\n  @Input() contextUri: string;\n  @Input() zoomToActiveRoute$: Subject<void> = new Subject();\n  @Input() stopsStore: StopsStore;\n  @Input() routesFeatureStore: RoutesFeatureStore;\n  constructor(\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    @Optional() private route: RouteService) { }\n\n  resetStops() {\n    this.stopsStore.clearStops();\n  }\n\n  // stop are always added before the last stop.\n  addStop(): void {\n    addStopToStore(this.stopsStore);\n  }\n\n\n  copyLinkToClipboard() {\n    const successful = Clipboard.copy(this.getUrl());\n    if (successful) {\n      const translate = this.languageService.translate;\n      const title = translate.instant(\n        'igo.geo.directionsForm.dialog.copyTitle'\n      );\n      const msg = translate.instant(\n        'igo.geo.directionsForm.dialog.copyMsgLink'\n      );\n      this.messageService.success(msg, title);\n    }\n  }\n\n  zoomRoute() {\n    this.zoomToActiveRoute$.next();\n  }\n\n  copyDirectionsToClipboard() {\n    const directionsBody = this.directionsToText();\n    const successful = Clipboard.copy(directionsBody);\n    if (successful) {\n      const translate = this.languageService.translate;\n      const title = translate.instant(\n        'igo.geo.directionsForm.dialog.copyTitle'\n      );\n      const msg = translate.instant('igo.geo.directionsForm.dialog.copyMsg');\n      this.messageService.success(msg, title);\n    }\n  }\n\n  private directionsToText() {\n    const indent = '\\t';\n    let activeRouteDirective =\n      this.languageService.translate.instant(\n        'igo.geo.directionsForm.instructions'\n      ) + ':\\n';\n    let wayPointList = '';\n    const summary =\n      this.languageService.translate.instant('igo.geo.directionsForm.summary') +\n      ': \\n' +\n      indent +\n      this.activeRoute.properties.direction.title +\n      '\\n' +\n      indent +\n      formatDistance(this.activeRoute.properties.direction.distance) +\n      '\\n' +\n      indent +\n      formatDuration(this.activeRoute.properties.direction.duration) +\n      '\\n\\n' +\n      this.languageService.translate.instant(\n        'igo.geo.directionsForm.stopsList'\n      ) +\n      ':\\n';\n\n    const url =\n      this.languageService.translate.instant('igo.geo.directionsForm.link') +\n      ':\\n' +\n      indent +\n      this.getUrl();\n\n    let wayPointsCnt = 1;\n    this.stopsStore.view.all().forEach(stop => {\n      let coord = '';\n      let stopText = '';\n      if (stop.text !== roundCoordTo(stop.coordinates).join(',')) {\n        stopText = stop.text;\n        coord = ` ( ${roundCoordTo(stop.coordinates).join(',')} )`;\n      } else {\n        stopText = roundCoordTo(stop.coordinates).join(\n          ','\n        );\n      }\n\n      wayPointList =\n        wayPointList +\n        indent +\n        wayPointsCnt.toLocaleString() +\n        '. ' +\n        stopText +\n        coord +\n        '\\n';\n      wayPointsCnt++;\n    });\n\n    let localCnt = 0;\n    this.activeRoute.properties.direction.steps.forEach(step => {\n      const instruction = this.formatStep(step, localCnt).instruction;\n      const distance =\n        formatDistance(step.distance) === undefined\n          ? ''\n          : ' (' + formatDistance(step.distance) + ')';\n      activeRouteDirective =\n        activeRouteDirective +\n        indent +\n        (localCnt + 1).toLocaleString() +\n        '. ' +\n        instruction +\n        distance +\n        '\\n';\n      localCnt++;\n    });\n\n    const directionsBody =\n      summary + wayPointList + '\\n' + url + '\\n\\n' + activeRouteDirective;\n\n    return directionsBody;\n  }\n\n  formatStep(step, cnt) {\n    return formatInstruction(\n      step.maneuver.type,\n      step.maneuver.modifier,\n      step.name,\n      step.maneuver.bearing_after,\n      cnt,\n      step.maneuver.exit,\n      this.languageService,\n      cnt === this.activeRoute.properties.direction.steps.length - 1\n    );\n  }\n\n  private getUrl() {\n    if (!this.route) {\n      return;\n    }\n    let context = '';\n    if (this.contextUri) {\n      context = `context=${this.contextUri}&`;\n    }\n\n    const pos = this.routesFeatureStore.all()\n    .map((direction: FeatureWithDirection) => direction.properties.id).indexOf(this.activeRoute.properties.id);\n    let routingOptions = '';\n    if (pos !== 0) {\n      const routingOptionsKey = this.route.options.directionsOptionsKey;\n      routingOptions = `&${routingOptionsKey}=result:${pos}`;\n    }\n    const directionsKey = this.route.options.directionsCoordKey;\n    const stopsCoordinates = this.stopsStore.view.all().map(stop => roundCoordTo(stop.coordinates, 6));\n    let directionsUrl = '';\n    if (stopsCoordinates.length >= 2) {\n      directionsUrl = `${directionsKey}=${stopsCoordinates.join(';')}`;\n      return `${location.origin}${location.pathname}?${context}tool=directions&sidenav=1&${directionsUrl}${routingOptions}`;\n    }\n    return;\n  }\n}\n","<div class=\"igo-input-container\" *ngIf=\"directions && activeDirection\">\n    <mat-form-field *ngIf=\"directions && directions.length > 1\">\n        <mat-select placeholder=\"{{'igo.geo.directionsForm.drivingOptions' | translate}}\"\n            (selectionChange)=\"changeRoute()\" [(ngModel)]=\"activeDirection\">\n            <mat-option *ngFor=\"let direction of directions; let cnt = index;\" [value]=\"direction\">\n                Option {{cnt + 1}} : {{formatDistance(direction.distance)}}\n                ({{formatDuration(direction.duration)}})\n            </mat-option>\n        </mat-select>\n    </mat-form-field>\n\n    <mat-divider *ngIf=\"directions && directions.length === 0\"></mat-divider>\n\n    <mat-list (mouseleave)=\"onStepsListBlur()\">\n        <h2 mat-header class=\"igo-route-title mat-typography\">{{activeDirection.title}}</h2>\n        <h2 mat-subheader>{{formatDistance(activeDirection.distance)}}, {{formatDuration(activeDirection.duration)}}</h2>\n        <mat-list-item class=\"igo-steps\" \n            (mouseenter)=\"showSegment(step)\" \n            (click)=\"showSegment(step,true)\" \n            *ngFor=\"let step of activeDirection.steps; let cnt = index;\" igoListItem>\n            <mat-icon [ngClass]=\"formatStep(step,cnt).cssClass\" mat-list-icon svgIcon=\"{{formatStep(step,cnt).image}}\">\n            </mat-icon>\n\n            <h4 mat-line>{{cnt +1}}. {{formatStep(step,cnt).instruction}}</h4>\n            <h4 mat-line class=\"right\">{{formatDistance(step.distance)}}</h4>\n        </mat-list-item>\n\n        <mat-divider></mat-divider>\n\n    </mat-list>\n\n</div>","import { ChangeDetectorRef, Component, Input, OnDestroy, OnInit } from '@angular/core';\nimport { LanguageService } from '@igo2/core';\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { Direction, FeatureWithStep, IgoStep } from '../shared/directions.interface';\nimport { formatDistance, formatDuration, formatInstruction } from '../shared/directions.utils';\nimport { RoutesFeatureStore, StepFeatureStore } from '../shared/store';\n\nimport olFeature from 'ol/Feature';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport * as olGeom from 'ol/geom';\n\nimport { FeatureGeometry } from '../../feature/shared/feature.interfaces';\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport { DirectionType } from '../shared/directions.enum';\n\n@Component({\n  selector: 'igo-directions-results',\n  templateUrl: './directions-results.component.html',\n  styleUrls: ['./directions-results.component.scss']\n})\nexport class DirectionsResultsComponent implements OnInit, OnDestroy {\n\n  public activeDirection: Direction;\n  public directions: Direction[];\n\n  private entities$$: Subscription;\n\n  @Input() routesFeatureStore: RoutesFeatureStore;\n  @Input() stepFeatureStore: StepFeatureStore;\n\n  constructor(\n    private languageService: LanguageService,\n    private cdRef: ChangeDetectorRef\n  ) { }\n\n  ngOnInit(): void {\n    this.entities$$ = this.routesFeatureStore.entities$\n      .pipe(debounceTime(200))\n      .subscribe(entities => {\n        const activeFeatureWithDirection = entities.find(entity => entity.properties.active);\n        this.directions = entities.map(entity => entity.properties.direction);\n        if (activeFeatureWithDirection) {\n          this.activeDirection = activeFeatureWithDirection.properties.direction;\n        } else {\n          this.activeDirection = undefined;\n        }\n        this.cdRef.detectChanges();\n      });\n  }\n\n  ngOnDestroy(): void {\n    this.entities$$.unsubscribe();\n  }\n\n  changeRoute() {\n    this.routesFeatureStore.entities$.value.map(entity =>\n      entity.properties.active = !entity.properties.active\n    );\n    this.routesFeatureStore.layer.ol.getSource().getFeatures().map(feature =>\n      feature.set('active', !feature.get('active'))\n    );\n  }\n\n  formatDistance(distance: number): string {\n    return formatDistance(distance);\n  }\n\n  formatDuration(duration: number): string {\n    return formatDuration(duration);\n  }\n\n  formatStep(step, cnt) {\n    return formatInstruction(\n      step.maneuver.type,\n      step.maneuver.modifier,\n      step.name,\n      step.maneuver.bearing_after,\n      cnt,\n      step.maneuver.exit,\n      this.languageService,\n      cnt === this.activeDirection.steps.length - 1\n    );\n  }\n\n  onStepsListBlur() {\n    this.stepFeatureStore.clear();\n  }\n\n  showSegment(step: IgoStep, zoomToExtent = false) {\n    this.showRouteSegmentGeometry(step, zoomToExtent);\n  }\n\n  showRouteSegmentGeometry(step: IgoStep, zoomToExtent = false) {\n\n    const coordinates = step.geometry.coordinates;\n    const vertexId = 'vertex';\n    const geometry4326 = new olGeom.LineString(coordinates);\n    const geometryMapProjection = geometry4326.transform(\n      'EPSG:4326',\n      this.stepFeatureStore.layer.map.projection\n    );\n    const routeSegmentCoordinates = (geometryMapProjection as any).getCoordinates();\n    const lastPoint = routeSegmentCoordinates[0];\n\n    const geometry = new olGeom.Point(lastPoint);\n    const feature = new olFeature({ geometry });\n\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n      featureProjection: this.stepFeatureStore.layer.map.projection,\n      dataProjection: this.stepFeatureStore.layer.map.projection\n    }) as FeatureGeometry;\n\n    const previousVertex = this.stepFeatureStore.get(vertexId);\n    const previousVertexRevision = previousVertex\n      ? previousVertex.meta.revision\n      : 0;\n\n    const stepFeature: FeatureWithStep = {\n      type: FEATURE,\n      geometry: geojsonGeom,\n      projection: this.stepFeatureStore.layer.map.projection,\n      properties: {\n        id: vertexId,\n        step,\n        type: DirectionType.Vertex\n      },\n      meta: {\n        id: vertexId,\n        revision: previousVertexRevision + 1\n      },\n      ol: feature\n    };\n    this.stepFeatureStore.update(stepFeature);\n    if (zoomToExtent) {\n      this.stepFeatureStore.layer.map.viewController.zoomToExtent(feature.getGeometry().getExtent() as [number, number, number, number]);\n    }\n  }\n\n}\n","import { ChangeDetectorRef, Component, Input, OnDestroy, OnInit } from '@angular/core';\n\nimport { debounceTime, distinctUntilChanged, map } from 'rxjs/operators';\n\nimport { LanguageService } from '@igo2/core';\nimport { EntityStoreWatcher } from '@igo2/common';\n\nimport * as olCondition from 'ol/events/condition';\nimport * as olInteraction from 'ol/interaction';\nimport * as olProj from 'ol/proj';\nimport { TranslateEvent } from 'ol/interaction/Translate';\nimport Collection from 'ol/Collection';\nimport { SelectEvent } from 'ol/interaction/Select';\n\nimport { DirectionOptions, FeatureWithStopProperties, Stop } from './shared/directions.interface';\nimport { Subject, Subscription } from 'rxjs';\nimport { addDirectionToRoutesFeatureStore, addStopToStopsFeatureStore, addStopToStore,\n  initRoutesFeatureStore, initStepFeatureStore, initStopsFeatureStore, updateStoreSorting } from './shared/directions.utils';\nimport { Feature } from '../feature/shared/feature.interfaces';\nimport { DirectionsService } from './shared/directions.service';\nimport { DirectionType, ProposalType } from './shared/directions.enum';\nimport { roundCoordTo, stringToLonLat } from '../map';\nimport { SearchService } from '../search/shared/search.service';\nimport { ChangeUtils, ObjectUtils } from '@igo2/utils';\nimport { RoutesFeatureStore, StepFeatureStore, StopsFeatureStore, StopsStore } from './shared/store';\nimport { FeatureStoreLoadingStrategy } from '../feature/shared/strategies/loading';\nimport { Research, SearchResult } from '../search/shared/search.interfaces';\nimport { QueryService } from '../query/shared/query.service';\n\n@Component({\n  selector: 'igo-directions',\n  templateUrl: './directions.component.html',\n  styleUrls: ['./directions.component.scss']\n})\nexport class DirectionsComponent implements OnInit, OnDestroy {\n\n  private watcher: EntityStoreWatcher<Stop>;\n\n  public projection: string = 'EPSG:4326';\n\n  private zoomRoute$$: Subscription;\n  private storeEmpty$$: Subscription;\n  private storeChange$$: Subscription;\n  private routesQueries$$: Subscription[] = [];\n\n  private selectStopInteraction: olInteraction.Select;\n  private translateStop: olInteraction.Translate;\n  private selectedRoute;\n  private focusOnStop: boolean = false;\n  private isTranslating: boolean = false;\n\n  public previousStops: Stop[] = [];\n\n  private searchs$$: Subscription[] = [];\n\n  @Input() contextUri: string;\n  @Input() stopsStore: StopsStore;\n  @Input() stopsFeatureStore: StopsFeatureStore;\n  @Input() routesFeatureStore: RoutesFeatureStore;\n  @Input() stepFeatureStore: StepFeatureStore;\n  @Input() debounce: number = 200;\n  @Input() length: number = 2;\n  @Input() coordRoundedDecimals: number = 6;\n  @Input() zoomToActiveRoute$: Subject<void> = new Subject();\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private languageService: LanguageService,\n    private directionsService: DirectionsService,\n    private searchService: SearchService,\n    private queryService: QueryService\n  ) { }\n\n\n  ngOnInit(): void {\n    this.queryService.queryEnabled = false;\n    this.initEntityStores();\n    setTimeout(() => {\n      initStopsFeatureStore(this.stopsFeatureStore, this.languageService);\n      initRoutesFeatureStore(this.routesFeatureStore, this.languageService);\n      initStepFeatureStore(this.stepFeatureStore);\n      this.initOlInteraction();\n    }, 1);\n\n  }\n\n  ngOnDestroy(): void {\n    this.queryService.queryEnabled = true;\n    this.storeEmpty$$.unsubscribe();\n    this.storeChange$$.unsubscribe();\n    this.routesQueries$$.map((u) => u.unsubscribe());\n    this.zoomRoute$$.unsubscribe();\n    this.freezeStores();\n  }\n\n  private freezeStores() {\n    this.stopsFeatureStore.layer.map.ol.removeInteraction(this.selectStopInteraction);\n    this.stopsFeatureStore.layer.map.ol.removeInteraction(this.translateStop);\n    this.routesFeatureStore.layer.map.ol.removeInteraction(this.selectedRoute);\n    this.stopsFeatureStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n    this.routesFeatureStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n    this.stepFeatureStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n  }\n\n  private initEntityStores() {\n    this.watcher = new EntityStoreWatcher(this.stopsStore, this.cdRef);\n    this.monitorEmptyEntityStore();\n    this.monitorEntityStoreChange();\n    this.monitorActiveRouteZoom();\n  }\n\n  private monitorActiveRouteZoom() {\n    this.zoomRoute$$ = this.zoomToActiveRoute$.subscribe(() => {\n      if (this.routesFeatureStore.count >= 1) {\n        const activeRoute = this.routesFeatureStore.all().find(route => route.properties.active);\n\n        if (activeRoute) {\n          activeRoute.ol.getGeometry();\n          const routeExtent = activeRoute.ol.getGeometry().getExtent();\n          this.routesFeatureStore.layer.map.viewController.zoomToExtent(routeExtent as [number, number, number, number]);\n        }\n      }\n    });\n  }\n\n  private initOlInteraction() {\n    this.selectStopInteraction = new olInteraction.Select({\n      layers: [this.stopsFeatureStore.layer.ol],\n      hitTolerance: 7,\n      condition: (event) => {\n        return event.type === 'pointermove' && !event.dragging;\n      }\n    });\n\n    this.translateStop = new olInteraction.Translate({\n      features: this.selectStopInteraction.getFeatures()\n    });\n    this.translateStop.on('translating', (evt: TranslateEvent) => {\n      this.isTranslating = true;\n      this.executeStopTranslation(evt.features);\n    });\n    this.translateStop.on('translateend', (evt: TranslateEvent) => {\n      this.isTranslating = false;\n      this.executeStopTranslation(evt.features);\n    });\n\n    this.selectedRoute = new olInteraction.Select({\n      layers: [this.routesFeatureStore.layer.ol],\n      condition: olCondition.click,\n      hitTolerance: 7,\n      filter: feature => {\n        return feature.get('type') === DirectionType.Route &&\n          feature.get('active') &&\n          !this.isTranslating;\n      }\n    });\n    this.selectedRoute.on('select', (evt: SelectEvent) => {\n      if (this.focusOnStop === false) {\n        const selectCoordinates = roundCoordTo(\n          olProj.transform(\n            (evt as any).mapBrowserEvent.coordinate,\n            this.routesFeatureStore.layer.map.projection,\n            this.projection\n          ) as [number, number], this.coordRoundedDecimals);\n        const addedStop = addStopToStore(this.stopsStore);\n        addedStop.text = selectCoordinates.join(',');\n        addedStop.coordinates = [selectCoordinates[0], selectCoordinates[1]];\n      }\n    });\n\n    this.stopsFeatureStore.layer.map.ol.addInteraction(this.selectStopInteraction);\n    this.stopsFeatureStore.layer.map.ol.addInteraction(this.translateStop);\n    this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute);\n  }\n\n  onStopInputHasFocusChange(stopInputHasFocus: boolean) {\n    stopInputHasFocus ?\n      this.routesFeatureStore.layer.map.ol.removeInteraction(this.selectedRoute) :\n      this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute);\n  }\n\n  private executeStopTranslation(\n    features: Collection<any>\n  ) {\n    if (features.getLength() === 0) {\n      return;\n    }\n    const firstFeature = features.getArray()[0];\n    const translatedStopId = firstFeature.getId();\n\n    const translationCoordinates = olProj.transform(\n      firstFeature.getGeometry().getCoordinates(),\n      this.stopsFeatureStore.layer.map.projection,\n      this.projection\n    );\n    const translatedStop = this.stopsStore.get(translatedStopId);\n    const roundedCoord = roundCoordTo(translationCoordinates as [number, number], this.coordRoundedDecimals);\n    translatedStop.coordinates = roundedCoord;\n    translatedStop.text = roundedCoord.join(',');\n    this.stopsStore.update(translatedStop);\n  }\n\n\n  private monitorEmptyEntityStore() {\n    // Watch if the store is empty to reset it\n    this.storeEmpty$$ = this.stopsStore.count$\n      .pipe(\n        distinctUntilChanged()\n      ).subscribe((count) => {\n        if (count < 2) {\n          addStopToStore(this.stopsStore);\n          if (this.stopsStore.count === 2) {\n            this.stopsStore.storeInitialized$.next(true);\n            return;\n          }\n          this.stopsStore.storeInitialized$.next(false);\n        }\n        this.routesQueries$$.map((u) => u.unsubscribe());\n      });\n  }\n\n  private monitorEntityStoreChange() {\n    this.storeChange$$ = this.stopsStore.entities$\n      .pipe(debounceTime(this.debounce))\n      .subscribe((stops: Stop[]) => {\n        this.handleStopDiff(stops);\n        updateStoreSorting(this.stopsStore);\n        this.handleStopsFeature();\n        this.getRoutes(this.isTranslating);\n      });\n  }\n\n  cancelSearch() {\n    this.searchs$$.map(s => s.unsubscribe());\n  }\n\n  private handleStopDiff(stops: Stop[]) {\n    const simplifiedStops = stops.map((stop: Stop) => {\n      return ObjectUtils.removeUndefined({ ...{ id: stop.id, text: stop.text, coordinates: stop.coordinates } });\n    });\n    const diff = ChangeUtils.findChanges(this.previousStops, simplifiedStops, ['coordinates']);\n    const stopIdToProcess = diff.added.concat(diff.modified);\n    if (stopIdToProcess) {\n      stopIdToProcess.map((change) => {\n        const changedStop = (change.newValue as Stop);\n        if (changedStop) {\n          const stop: Stop = this.stopsStore.get(changedStop.id);\n          const term = stop.text;\n          if (!term || term.length === 0) {\n            return;\n          }\n          const response = stringToLonLat(term, this.stopsFeatureStore.layer.map.projection);\n          let researches: Research[];\n          let isCoord = false;\n          if (response.lonLat) {\n            isCoord = true;\n          }\n          researches = this.searchService.search(term, { searchType: 'Feature' });\n          this.cancelSearch();\n          const requests$ = researches.map(res => res.request\n            .pipe(map((results: SearchResult[]) => results.filter(r =>\n              isCoord ? r.data.geometry.type === 'Point' && r.data.geometry : r.data.geometry)))\n\n          );\n          this.searchs$$ = requests$.map((request) => {\n            return request.pipe(map((results: SearchResult[]) => results.filter(r =>\n              isCoord ? r.data.geometry.type === 'Point' && r.data.geometry : r.data.geometry)))\n              .subscribe((res: SearchResult[]) => {\n                if (res.length > 0) {\n                  const source = res[0].source;\n                  const meta = res[0].meta;\n                  const results = res.map(r => r.data);\n                  if (!stop.searchProposals) {\n                    stop.searchProposals = [];\n                  }\n                  stop.searchProposals = stop.searchProposals.filter(sp => sp.type === (isCoord ? ProposalType.Coord : ProposalType.Text));\n                  let storedSource = stop.searchProposals.find(sp => sp.source === source);\n                  if (storedSource) {\n                    storedSource.results = results;\n                  } else {\n                    stop.searchProposals.push({\n                      type: isCoord ? ProposalType.Coord : ProposalType.Text,\n                      source,\n                      meta,\n                      results\n                    });\n                  }\n                }\n                this.cdRef.detectChanges();\n              });\n          });\n        }\n      });\n    }\n    this.previousStops = simplifiedStops;\n  }\n\n  private handleStopsFeature() {\n    const stops = this.stopsStore.all();\n    const stopsWithCoordinates = stops.filter(stop => stop.coordinates);\n    stopsWithCoordinates.map(stop => this.addStopOverlay(stop));\n    this.stopsFeatureStore.all().map(\n      (stopFeature: Feature<FeatureWithStopProperties>) => {\n        if (!this.stopsStore.get(stopFeature.properties.id)) {\n          this.stopsFeatureStore.delete(stopFeature);\n        }\n      });\n    const stopsWithoutCoordinates = stops.filter(stop => !stop.coordinates);\n    stopsWithoutCoordinates.map(stop => {\n      const stopFeature = this.stopsFeatureStore.get(stop.id);\n      if (stopFeature) {\n        this.stopsFeatureStore.delete(stopFeature);\n      }\n    });\n  }\n\n  private getRoutes(isOverview: boolean = false) {\n    const stopsWithCoordinates = this.stopsStore.view\n      .all()\n      .filter(stop => stop.coordinates);\n    if (stopsWithCoordinates.length < 2) {\n      this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\n      return;\n    }\n\n    const roundedCoordinates = stopsWithCoordinates.map((stop) => {\n      const roundedCoord = roundCoordTo(stop.coordinates, this.coordRoundedDecimals);\n      return roundedCoord;\n    });\n    const overviewDirectionsOptions: DirectionOptions = {\n      overview: true,\n      steps: false,\n      alternatives: false,\n      continue_straight: false\n    };\n    this.routesQueries$$.map((u) => u.unsubscribe());\n    const routeResponse = this.directionsService.route(\n      roundedCoordinates,\n      isOverview ? overviewDirectionsOptions : undefined\n    );\n    if (routeResponse) {\n      routeResponse.map(res =>\n        this.routesQueries$$.push(\n          res.subscribe(directions => {\n            this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\n            directions.map(direction =>\n              addDirectionToRoutesFeatureStore(\n                this.routesFeatureStore,\n                direction,\n                this.projection,\n                direction === directions[0] ? true : false)\n            );\n          })\n        )\n      );\n    }\n  }\n\n  public addStopOverlay(stop: Stop) {\n    addStopToStopsFeatureStore(stop, this.stopsStore, this.stopsFeatureStore, this.projection, this.languageService);\n  }\n}\n","<igo-directions-buttons [contextUri]=\"contextUri\" [zoomToActiveRoute$]=\"zoomToActiveRoute$\" [routesFeatureStore]=\"routesFeatureStore\" [stopsStore]=\"stopsStore\"></igo-directions-buttons>\n\n<igo-directions-inputs (stopInputHasFocus)=\"onStopInputHasFocusChange($event)\" [coordRoundedDecimals]=\"coordRoundedDecimals\" [projection]=\"projection\" [stopsFeatureStore]=\"stopsFeatureStore\" [stopsStore]=\"stopsStore\" [debounce]=\"debounce\" [length]=\"length\"></igo-directions-inputs>\n<br>\n<igo-directions-results [stepFeatureStore]=\"stepFeatureStore\" [routesFeatureStore]=\"routesFeatureStore\"></igo-directions-results>","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { provideDirectionsSourceService } from './shared/directions-source.service';\nimport { DragDropModule } from '@angular/cdk/drag-drop';\nimport { DirectionsInputsComponent } from './directions-inputs/directions-inputs.component';\nimport { DirectionsComponent } from './directions.component';\nimport { DirectionsButtonsComponent } from './directions-buttons/directions-buttons.component';\nimport { DirectionsResultsComponent } from './directions-results/directions-results.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    DragDropModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatButtonModule,\n    MatListModule,\n    MatDividerModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatOptionModule,\n    MatSelectModule,\n    MatTooltipModule,\n    MatAutocompleteModule,\n    IgoLanguageModule\n  ],\n  exports: [\n    DirectionsComponent,\n    DirectionsInputsComponent,\n    DirectionsButtonsComponent,\n    DirectionsResultsComponent\n  ],\n  declarations: [\n     DirectionsComponent,\n    DirectionsInputsComponent,\n    DirectionsButtonsComponent,\n    DirectionsResultsComponent\n  ],\n  providers: [provideDirectionsSourceService()]\n})\nexport class IgoDirectionsModule {\n  static forRoot(): ModuleWithProviders<IgoDirectionsModule> {\n    return {\n      ngModule: IgoDirectionsModule\n    };\n  }\n}\n","import { SearchSource } from './sources/source';\nimport { SearchSourceService } from './search-source.service';\n\n/**\n * Search source factory\n * @ignore\n */\nexport function searchSourceServiceFactory(sources: SearchSource[]) {\n  return new SearchSourceService(sources);\n}\n\n/**\n * Function that returns a provider for the SearchSource service\n */\nexport function provideSearchSourceService() {\n  return {\n    provide: SearchSourceService,\n    useFactory: searchSourceServiceFactory,\n    deps: [SearchSource]\n  };\n}\n","import { Injectable, Inject, Injector } from '@angular/core';\nimport { HttpClient, HttpParams, HttpParameterCodec } from '@angular/common/http';\n\nimport { Observable, of, BehaviorSubject } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\n\nimport { AuthService } from '@igo2/auth';\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport pointOnFeature from '@turf/point-on-feature';\n\nimport { FEATURE, Feature } from '../../../feature';\nimport { GoogleLinks } from './../../../utils/googleLinks';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch, ReverseSearch } from './source';\nimport {\n  SearchSourceOptions,\n  TextSearchOptions,\n  ReverseSearchOptions\n} from './source.interfaces';\nimport {\n  IChercheData,\n  IChercheResponse,\n  IChercheReverseData,\n  IChercheReverseResponse\n} from './icherche.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n@Injectable()\nexport class IChercheSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(result: SearchResult<Feature>): SearchResult<Feature> {\n    return result;\n  }\n}\n\n// Fix the \"+\" is replaced with space \" \" in a query string\n// https://github.com/angular/angular/issues/11058\nexport class IgoHttpParameterCodec implements HttpParameterCodec {\n  encodeKey(key: string): string {\n    return encodeURIComponent(key);\n  }\n\n  encodeValue(value: string): string {\n    return encodeURIComponent(value);\n  }\n\n  decodeKey(key: string): string {\n    return decodeURIComponent(key);\n  }\n\n  decodeValue(value: string): string {\n    return decodeURIComponent(value);\n  }\n}\n\n/**\n * ICherche search source\n */\n@Injectable()\nexport class IChercheSearchSource extends SearchSource implements TextSearch {\n  static id = 'icherche';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  private hashtagsLieuxToKeep = [];\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions,\n    @Inject(IChercheSearchResultFormatter)\n    private formatter: IChercheSearchResultFormatter,\n    injector: Injector\n  ) {\n    super(options, storageService);\n\n    this.languageService.translate\n      .get(this.options.title)\n      .subscribe((title) => this.title$.next(title));\n\n    const authService = injector.get(AuthService);\n    if (this.settings.length) {\n      if (!authService) {\n        this.getAllowedTypes();\n      } else {\n        authService.authenticate$.subscribe(() => {\n          this.getAllowedTypes();\n        });\n      }\n    }\n  }\n\n  getId(): string {\n    return IChercheSearchSource.id;\n  }\n\n  getType(): string {\n    return IChercheSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    const limit =\n      this.options.params && this.options.params.limit\n        ? Number(this.options.params.limit)\n        : undefined;\n    const ecmax =\n      this.options.params && this.options.params.ecmax\n        ? Number(this.options.params.ecmax)\n        : undefined;\n\n    const types = this.options.params?.type\n        ? this.options.params.type.replace(/\\s/g, '').toLowerCase().split(',')\n        : [\n            'adresses',\n            'codes-postaux',\n            'routes',\n            'intersections',\n            'municipalites',\n            'mrc',\n            'regadmin',\n            'lieux'\n          ];\n\n    return {\n      title: 'igo.geo.search.icherche.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/icherche',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.type.address',\n              value: 'adresses',\n              enabled: types.indexOf('adresses') !== -1,\n              hashtags: ['adresse']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.oldAddress',\n              value: 'anciennes-adresses',\n              enabled: types.indexOf('anciennes-adresses') !== -1,\n              hashtags: ['anciennes-adresses']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.postalCode',\n              value: 'codes-postaux',\n              enabled: types.indexOf('codes-postaux') !== -1,\n              hashtags: ['code-postal']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.road',\n              value: 'routes',\n              enabled: types.indexOf('routes') !== -1,\n              hashtags: ['route']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.intersection',\n              value: 'intersections',\n              enabled: types.indexOf('intersections') !== -1,\n              hashtags: ['intersection', '+']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.city',\n              value: 'municipalites',\n              enabled: types.indexOf('municipalites') !== -1,\n              hashtags: ['municipalit', 'mun']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.oldCity',\n              value: 'anciennes-municipalites',\n              enabled: types.indexOf('anciennes-municipalites') !== -1,\n              hashtags: ['anciennes-municipalites']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.mrc',\n              value: 'mrc',\n              enabled: types.indexOf('mrc') !== -1,\n              hashtags: ['mrc']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.regadmin',\n              value: 'regadmin',\n              enabled: types.indexOf('regadmin') !== -1,\n              hashtags: ['rgion-administrative', 'regadmin']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.entreprise',\n              value: 'entreprises',\n              enabled: types.indexOf('entreprises') !== -1,\n              available: false,\n              hashtags: ['entreprise']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.place',\n              value: 'lieux',\n              enabled: types.indexOf('lieux') !== -1,\n              hashtags: ['lieu']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.exit',\n              value: 'sorties-autoroute',\n              enabled: types.indexOf('sorties-autoroute') !== -1,\n              hashtags: ['sortie', 'sorties', 'exit']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.km',\n              value: 'bornes-km',\n              enabled: types.indexOf('bornes-km') !== -1,\n              hashtags: ['borne', 'bornes', 'repre', 'km']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.gcc',\n              value: 'bornes-gcc',\n              enabled: types.indexOf('bornes-gcc') !== -1,\n              hashtags: ['borne', 'bornes', 'repre', 'gcc', 'ccg']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.cn',\n              value: 'bornes-cn',\n              enabled: types.indexOf('bornes-cn') !== -1,\n              hashtags: ['borne', 'bornes', 'cn']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.sumi',\n              value: 'bornes-sumi',\n              enabled: types.indexOf('bornes-sumi') !== -1,\n              hashtags: ['borne', 'bornes', 'sumi']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.hq',\n              value: 'hq',\n              enabled: types.indexOf('hq') !== -1,\n              hashtags: ['hq']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.cadastre',\n              value: 'cadastre',\n              enabled: types.indexOf('cadastre') !== -1,\n              hashtags: ['cadastre']\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '1',\n              value: 1,\n              enabled: limit === 1\n            },\n            {\n              title: '5',\n              value: 5,\n              enabled: limit === 5 || !limit\n            },\n            {\n              title: '10',\n              value: 10,\n              enabled: limit === 10\n            },\n            {\n              title: '25',\n              value: 25,\n              enabled: limit === 25\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: limit === 50\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'ecmax',\n          name: 'ecmax',\n          values: [\n            {\n              title: '10 %',\n              value: 10,\n              enabled: ecmax === 10\n            },\n            {\n              title: '30 %',\n              value: 30,\n              enabled: ecmax === 30 || !ecmax\n            },\n            {\n              title: '50 %',\n              value: 50,\n              enabled: ecmax === 50\n            },\n            {\n              title: '75 %',\n              value: 75,\n              enabled: ecmax === 75\n            },\n            {\n              title: '100 %',\n              value: 100,\n              enabled: ecmax === 100\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'restrictExtent',\n          name: 'loc',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.restrictExtent.map',\n              value: 'true',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.icherche.restrictExtent.quebec',\n              value: 'false',\n              enabled: true\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a location by name or keyword\n   * @param term Location name or keyword\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(term, options || {});\n    if (!params.get('type').length) {\n      return of([]);\n    }\n    this.options.params.page = params.get('page') || '1';\n\n    return this.http.get(`${this.searchUrl}/geocode`, { params }).pipe(\n      map((response: IChercheResponse) => this.extractResults(response, term)),\n      catchError((err) => {\n        err.error.toDisplay = true;\n        err.error.title = this.languageService.translate.instant(\n          this.getDefaultOptions().title\n        );\n        throw err;\n      })\n    );\n  }\n\n  private getAllowedTypes() {\n    return this.http\n      .get(`${this.searchUrl}/types`)\n      .subscribe((types: string[]) => {\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        typeSetting.values.forEach((v) => {\n          const regex = new RegExp(`^${v.value}(\\\\.|$)`);\n          const typesMatched = types.filter((value) => regex.test(value));\n          v.available = typesMatched.length > 0;\n          if (v.value === 'lieux') {\n            this.hashtagsLieuxToKeep = [\n              ...(new Set(\n                typesMatched\n                  .map((t) => t.split('.'))\n                  .reduce((a, b) => a.concat(b))\n                  .filter((t) => t !== 'lieux')\n              ) as any)\n            ];\n          }\n        });\n        this.setParamFromSetting(typeSetting, false);\n      });\n  }\n\n  private computeRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    const queryParams: any = Object.assign(\n      {\n        geometry: true,\n        bbox: true,\n        icon: true,\n        type:\n          'adresses,codes-postaux,municipalites,mrc,regadmin,lieux,entreprises,bornes-sumi'\n      },\n      this.params,\n      this.computeOptionsParam(term, options || {}).params,\n      {\n        q: this.computeTerm(term),\n        page: options.page\n      }\n    );\n\n    if (queryParams.loc === 'true') {\n      const [xMin, yMin, xMax, yMax] = options.extent;\n      queryParams.loc = `${xMin},${yMin};${xMax},${yMin};${xMax},${yMax};${xMin},${yMax};${xMin},${yMin}`;\n    } else if (queryParams.loc === 'false') {\n      delete queryParams.loc;\n    }\n\n    if (/#[A-Za-z]+/.test(queryParams.q)) {\n      queryParams.type = 'lieux';\n    }\n\n    return new HttpParams({\n      fromObject: ObjectUtils.removeUndefined(queryParams),\n      encoder: new IgoHttpParameterCodec()\n    });\n  }\n\n  private extractResults(response: IChercheResponse, term: string): SearchResult<Feature>[] {\n    return response.features.map((data: IChercheData) => {\n      return this.formatter.formatResult(this.dataToResult(data, term, response));\n    });\n  }\n\n  private dataToResult(\n    data: IChercheData,\n    term: string,\n    response?: IChercheResponse\n  ): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, properties.code].join('.');\n\n    const titleHtml = data.highlight.title || data.properties.nom;\n    const subtitleHtml = data.highlight.title2\n      ? ' <small> ' + data.highlight.title2 + '</small>'\n      : '';\n    const subtitleHtml2 = data.highlight.title3\n      ? '<br><small> ' + data.highlight.title3 + '</small>'\n      : '';\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        extent: data.bbox,\n        properties,\n        meta: {\n          id,\n          title: data.properties.nom\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.nom,\n        titleHtml: titleHtml + subtitleHtml + subtitleHtml2,\n        icon: data.icon || 'map-marker',\n        score: data.score || computeTermSimilarity(term.trim(), data.properties.nom),\n        nextPage:\n          response.features.length % +this.options.params.limit === 0 &&\n          +this.options.params.page < 10\n      }\n    };\n  }\n\n  private computeProperties(data: IChercheData): { [key: string]: any } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      IChercheSearchSource.propertiesBlacklist\n    );\n\n    if (!data.geometry) {\n      return Object.assign({ type: data.index }, properties);\n    }\n\n    const googleLinksProperties: {\n      GoogleMaps: string;\n      GoogleStreetView?: string;\n    } = {\n      GoogleMaps: ''\n    };\n\n    let googleMaps;\n    if (data.geometry.type === 'Point') {\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\n        data.geometry.coordinates[0],\n        data.geometry.coordinates[1]\n      );\n    } else {\n      const point = pointOnFeature(data.geometry);\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\n        point.geometry.coordinates[0],\n        point.geometry.coordinates[1]\n      );\n    }\n\n    let googleMapsNom;\n    if (data.index === 'routes') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ', ' + data.properties.municipalite\n      );\n    } else if (data.index === 'municipalites') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ', ' + 'ville'\n      );\n    } else if (data.index === 'mrc') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        'mrc+' + data.properties.nom\n      );\n    } else if (data.index === 'regadmin') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ',+QC'\n      );\n    } else {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom || data.highlight.title\n      );\n    }\n\n    googleLinksProperties.GoogleMaps =\n      '<a href=' +\n      googleMaps +\n      ' target=\"_blank\">' +\n      this.languageService.translate.instant('igo.geo.searchByCoord') +\n      '</a> <br /> <a href=' +\n      googleMapsNom +\n      ' target=\"_blank\">' +\n      this.languageService.translate.instant('igo.geo.searchByName') +\n      '</a>';\n\n    if (data.geometry.type === 'Point') {\n      googleLinksProperties.GoogleStreetView = GoogleLinks.getGoogleStreetViewLink(\n        data.geometry.coordinates[0],\n        data.geometry.coordinates[1]\n      );\n    }\n\n    const routing: {\n      Route: string;\n    } = {\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n\n    return Object.assign(\n      { type: data.index },\n      properties,\n      googleLinksProperties,\n      routing\n    );\n  }\n\n  /**\n   * Remove hashtag from query\n   * @param term Query with hashtag\n   */\n  private computeTerm(term: string): string {\n    // Keep hashtags for \"lieux\"\n    const hashtags = term.match(/(#[A-Za-z]+)/g) || [];\n    let keep = false;\n    keep = hashtags.some((hashtag) => {\n      const hashtagKey = hashtag.substring(1);\n      return this.hashtagsLieuxToKeep.some(\n        (h) =>\n          h\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '') ===\n          hashtagKey\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '')\n      );\n    });\n\n    if (!keep) {\n      term = term.replace(/(#[A-Za-z]+)/g, '');\n    }\n\n    return term.replace(/[^\\w- !\\-\\+\\(\\)\\.\\/,'#]+/g, '');\n  }\n\n  /**\n   * Add hashtag to param if valid\n   * @param term Query with hashtag\n   * @param options TextSearchOptions\n   */\n  private computeOptionsParam(\n    term: string,\n    options: TextSearchOptions\n  ): TextSearchOptions {\n    const hashtags = super.getHashtagsValid(term, 'type');\n    if (hashtags) {\n      options.params = Object.assign(options.params || {}, {\n        type: hashtags.join(',')\n      });\n    }\n\n    return options;\n  }\n}\n\n/**\n * IChercheReverse search source\n */\n@Injectable()\nexport class IChercheReverseSearchSource extends SearchSource\n  implements ReverseSearch {\n  static id = 'icherchereverse';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions,\n    injector: Injector,\n  ) {\n    super(options, storageService);\n\n    this.languageService.translate\n      .get(this.options.title)\n      .subscribe((title) => this.title$.next(title));\n\n    const authService = injector.get(AuthService);\n    if (this.settings.length) {\n      if (!authService) {\n        this.getAllowedTypes();\n      } else {\n        authService.authenticate$.subscribe(() => {\n          this.getAllowedTypes();\n        });\n      }\n    }\n  }\n\n  getId(): string {\n    return IChercheReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return IChercheReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    const types =\n      this.options.params && this.options.params.type\n        ? this.options.params.type.replace(/\\s/g, '').toLowerCase().split(',')\n        : ['adresses', 'municipalites', 'mrc', 'regadmin'];\n\n    return {\n      title: 'igo.geo.search.ichercheReverse.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/terrapi',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.type.address',\n              value: 'adresses',\n              enabled: types.indexOf('adresses') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.road',\n              value: 'routes',\n              enabled: types.indexOf('routes') !== -1,\n              available: false\n            },\n            {\n              title: 'igo.geo.search.icherche.type.district',\n              value: 'arrondissements',\n              enabled: types.indexOf('arrondissements') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.city',\n              value: 'municipalites',\n              enabled: types.indexOf('municipalites') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.mrc',\n              value: 'mrc',\n              enabled: types.indexOf('mrc') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.regadmin',\n              value: 'regadmin',\n              enabled: types.indexOf('regadmin') !== -1\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'radius',\n          name: 'bufferInput',\n          values: [\n            {\n              title: '100 m',\n              value: 100,\n              enabled: !this.options.distance || this.options.distance === 100\n            },\n            {\n              title: '500 m',\n              value: 500,\n              enabled: this.options.distance === 500\n            },\n            {\n              title: '1 km',\n              value: 1000,\n              enabled: this.options.distance === 1000\n            },\n            {\n              title: '2 km',\n              value: 2000,\n              enabled: this.options.distance === 2000\n            },\n            {\n              title: '5 km',\n              value: 5000,\n              enabled: this.options.distance === 5000\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param distance Search raidus around lonLat\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(lonLat, options || {});\n    if (!params.get('type').length) {\n      return of([]);\n    }\n    return this.http.get(`${this.searchUrl}/locate`, { params }).pipe(\n      map((response: IChercheReverseResponse) => {\n        return this.extractResults(response);\n      })\n    );\n  }\n\n  private getAllowedTypes() {\n    return this.http\n      .get(`${this.searchUrl}/types`)\n      .subscribe((types: string[]) => {\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        typeSetting.values.forEach((v) => {\n          v.available = types.indexOf(v.value as string) > -1;\n        });\n        this.setParamFromSetting(typeSetting, false);\n      });\n  }\n\n  private computeRequestParams(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): HttpParams {\n    if (options.distance || this.options.distance) {\n      options.params = Object.assign(options.params || {}, {\n        bufferInput: options.distance || this.options.distance\n      });\n    }\n\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          loc: lonLat.join(','),\n          sort: 'distance',\n          geometry: true,\n          icon: true\n        },\n        options.params || {},\n        this.params\n      )\n    });\n  }\n\n  private extractResults(\n    response: IChercheReverseResponse\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: IChercheReverseData) => {\n      return this.dataToResult(data);\n    });\n  }\n\n  private getSubtitle(data: IChercheReverseData) {\n    if (!this.settings.length) {\n      return '';\n    }\n    let subtitle = '';\n    switch (data.properties.type) {\n      case 'arrondissements':\n        subtitle = data.properties.municipalite + ' (Arrondissement)';\n        break;\n      default:\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        const type = typeSetting.values.find(\n          (t) => t.value === data.properties.type\n        );\n        if (type) {\n          subtitle = this.languageService.translate.instant(type.title);\n        }\n    }\n    return subtitle;\n  }\n\n  private dataToResult(data: IChercheReverseData): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const extent = this.computeExtent(data);\n    const id = [this.getId(), properties.type, properties.code].join('.');\n\n    const titleHtml = data.properties.nom;\n    const subtitleHtml = ' <small> ' + this.getSubtitle(data) + '</small>';\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        extent,\n        properties,\n        meta: {\n          id,\n          title: data.properties.nom\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.nom,\n        titleHtml: titleHtml + subtitleHtml,\n        icon: data.icon || 'map-marker',\n        pointerSummaryTitle: this.getSubtitle(data)+ ': ' + data.properties.nom\n      }\n    };\n  }\n\n  private computeProperties(data: IChercheReverseData): { [key: string]: any } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      IChercheReverseSearchSource.propertiesBlacklist\n    );\n\n    const routing: {\n      Route: string;\n    } = {\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n\n    return Object.assign(properties, routing);\n  }\n\n  private computeExtent(\n    data: IChercheReverseData\n  ): [number, number, number, number] | undefined {\n    return data.bbox\n      ? [data.bbox[0], data.bbox[2], data.bbox[1], data.bbox[3]]\n      : undefined;\n  }\n}\n","import { Injector } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport {\n  IChercheSearchSource,\n  IChercheSearchResultFormatter,\n  IChercheReverseSearchSource\n} from './icherche';\n\n/**\n * ICherche search result formatter factory\n * @ignore\n */\nexport function defaultIChercheSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new IChercheSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the ICherche search result formatter\n */\nexport function provideDefaultIChercheSearchResultFormatter() {\n  return {\n    provide: IChercheSearchResultFormatter,\n    useFactory: defaultIChercheSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * ICherche search source factory\n * @ignore\n */\nexport function ichercheSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  formatter: IChercheSearchResultFormatter,\n  injector: Injector\n) {\n  return new IChercheSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${IChercheSearchSource.id}`),\n    formatter,\n    injector\n  );\n}\n\n/**\n * Function that returns a provider for the ICherche search source\n */\nexport function provideIChercheSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ichercheSearchSourceFactory,\n    multi: true,\n    deps: [\n      HttpClient,\n      LanguageService,\n      StorageService,\n      ConfigService,\n      IChercheSearchResultFormatter,\n      Injector\n    ]\n  };\n}\n\n/**\n * IChercheReverse search source factory\n * @ignore\n */\nexport function ichercheReverseSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  injector: Injector\n) {\n  return new IChercheReverseSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${IChercheReverseSearchSource.id}`),\n    injector\n  );\n}\n\n/**\n * Function that returns a provider for the IChercheReverse search source\n */\nexport function provideIChercheReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ichercheReverseSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService, Injector]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { Observable, BehaviorSubject, of } from 'rxjs';\nimport * as olproj from 'ol/proj';\nimport { fromCircle } from 'ol/geom/Polygon';\nimport OlCircle from 'ol/geom/Circle';\nimport * as olformat from 'ol/format';\n\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, ReverseSearch } from './source';\nimport { SearchSourceOptions, ReverseSearchOptions } from './source.interfaces';\n\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { GoogleLinks } from '../../../utils/googleLinks';\nimport { Projection } from '../../../map/shared/projection.interfaces';\nimport { lonLatConversion, roundCoordTo, convertDDToDMS } from '../../../map/shared/map.utils';\nimport { OsmLinks } from '../../../utils';\nimport { Cacheable } from 'ts-cacheable';\n\n@Injectable()\nexport class CoordinatesSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(result: SearchResult<Feature>): SearchResult<Feature> {\n    return result;\n  }\n}\n/**\n * CoordinatesReverse search source\n */\n@Injectable()\nexport class CoordinatesReverseSearchSource extends SearchSource\n  implements ReverseSearch {\n  static id = 'coordinatesreverse';\n  static type = FEATURE;\n\n  private projections;\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    @Inject('options') options: SearchSourceOptions,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('projections') projections: Projection[],\n  ) {\n    super(options, storageService);\n    this.projections = projections;\n    this.languageService.translate\n      .get(this.options.title)\n      .subscribe(title => this.title$.next(title));\n  }\n\n  getId(): string {\n    return CoordinatesReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return CoordinatesReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'igo.geo.search.coordinates.name',\n      order: 1,\n      showInSettings: false\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param options options of ReverseSearchOptions (distance, conf, zoom, params)\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    return of([this.dataToResult(lonLat, options)]);\n  }\n\n  private dataToResult(data: [number, number], options: ReverseSearchOptions): SearchResult<Feature> {\n    const dataDMS = convertDDToDMS(data);\n    const convertedCoord = lonLatConversion(data, this.projections);\n    const coords = convertedCoord.reduce((obj, item) => (\n      obj[item.alias] = item.igo2CoordFormat, obj), {});\n\n    const roundedCoordString = roundCoordTo(data, 6).join(', ');\n    const roundedCoordStringDMS = dataDMS.join(', ');\n\n    let geometry: FeatureGeometry = {\n      type: 'Point',\n      coordinates: [data[0], data[1]]\n    };\n\n    const properties = {};\n    let subtitleHtml = '';\n    if (options.distance) {\n      const radiusKey = this.languageService.translate.instant('igo.geo.search.coordinates.radius');\n      properties[radiusKey] = options.distance;\n      subtitleHtml = '<br><small>Rayon: ' + options.distance + ' m</small>';\n\n      // Create polygon\n      const center = olproj.transform([data[0], data[1]], 'EPSG:4326', 'EPSG:3857');\n      const circleGeometry = new OlCircle(center, options.distance);\n      const polygonGeometry = fromCircle(circleGeometry);\n      const writer = new olformat.GeoJSON();\n      geometry = JSON.parse(writer.writeGeometry(polygonGeometry.transform('EPSG:3857', 'EPSG:4326')));\n    }\n\n    if (options.conf) {\n      const confKey = this.languageService.translate.instant('igo.geo.search.coordinates.conf');\n      properties[confKey] = options.conf;\n      subtitleHtml += subtitleHtml === '' ? '<br>' : '<small> - </small>';\n      subtitleHtml += '<small>Confiance: ' + options.conf + '%</small>';\n    }\n\n    const coordKey = this.languageService.translate.instant('igo.geo.search.coordinates.coord');\n    properties[coordKey] = roundedCoordString;\n\n    const coordKeyDMS = this.languageService.translate.instant('igo.geo.search.coordinates.coordDMS');\n    properties[coordKeyDMS] = roundedCoordStringDMS;\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry,\n        extent: undefined,\n        properties: Object.assign(\n          properties,\n          coords,\n          {\n            GoogleMaps: GoogleLinks.getGoogleMapsCoordLink(data[0], data[1]),\n            GoogleStreetView: GoogleLinks.getGoogleStreetViewLink(\n              data[0],\n              data[1]\n            ),\n            OpenStreetMap: OsmLinks.getOpenStreetMapLink(data[0], data[1], 14),\n            Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>'\n          }\n        ),\n        meta: {\n          id: data[0].toString() + ',' + data[1].toString(),\n          title: roundedCoordString\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id: data[0].toString() + ',' + data[1].toString(),\n        title: roundedCoordString,\n        titleHtml: roundedCoordString + subtitleHtml,\n        icon: 'map-marker',\n        score: 100, // every coord exists\n      }\n    };\n  }\n}\n","import { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport {\n  CoordinatesReverseSearchSource,\n  CoordinatesSearchResultFormatter\n} from './coordinates';\nimport { Projection } from '../../../map/shared/projection.interfaces';\nimport { ProjectionService } from '../../../map/shared/projection.service';\n\n/**\n * ICherche search result formatter factory\n * @ignore\n */\nexport function defaultCoordinatesSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new CoordinatesSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the ICherche search result formatter\n */\nexport function provideDefaultCoordinatesSearchResultFormatter() {\n  return {\n    provide: CoordinatesSearchResultFormatter,\n    useFactory: defaultCoordinatesSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * CoordinatesReverse search source factory\n * @ignore\n */\nexport function CoordinatesReverseSearchSourceFactory(\n  config: ConfigService,\n  languageService: LanguageService,\n  storageService: StorageService,\n  _projectionService: ProjectionService\n) {\n  return new CoordinatesReverseSearchSource(\n    config.getConfig(`searchSources.${CoordinatesReverseSearchSource.id}`),\n    languageService,\n    storageService,\n    (config.getConfig('projections') as Projection[]) || []\n  );\n}\n\n/**\n * Function that returns a provider for the IChercheReverse search source\n */\nexport function provideCoordinatesReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: CoordinatesReverseSearchSourceFactory,\n    multi: true,\n    deps: [ConfigService, LanguageService, StorageService, ProjectionService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable, BehaviorSubject, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { getResolutionFromScale } from '../../../map/shared/map.utils';\nimport { LAYER } from '../../../layer';\nimport { QueryableDataSourceOptions, QueryFormat } from '../../../query';\nimport { QueryHtmlTarget } from './../../../query/shared/query.enums';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch } from './source';\nimport { TextSearchOptions } from './source.interfaces';\nimport {\n  ILayerSearchSourceOptions,\n  ILayerData,\n  ILayerItemResponse,\n  ILayerServiceResponse,\n  ILayerDataSource\n} from './ilayer.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n@Injectable()\nexport class ILayerSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(data: ILayerData): ILayerData {\n    const allowedKey = [\n      'title',\n      'abstract',\n      'groupTitle',\n      'metadataUrl',\n      'downloadUrl',\n      'urlInfo',\n      'name'\n    ];\n\n    const property = Object.entries(data.properties)\n      .filter(([key]) => allowedKey.indexOf(key) !== -1)\n      .reduce((out: { [key: string]: any }, entries: [string, any]) => {\n        const [key, value] = entries;\n        let newKey;\n        try {\n          newKey = this.languageService.translate.instant(\n            'igo.geo.search.ilayer.properties.' + key\n          );\n        } catch (e) {\n          newKey = key;\n        }\n        out[newKey] = value ? value : '';\n        return out;\n      }, {});\n\n    const dataR = Object.assign({}, data);\n    dataR.properties = property as ILayerDataSource;\n\n    return dataR;\n  }\n}\n\n/**\n * ILayer search source\n */\n@Injectable()\nexport class ILayerSearchSource extends SearchSource implements TextSearch {\n  static id = 'ilayer';\n  static type = LAYER;\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: ILayerSearchSourceOptions,\n    @Inject(ILayerSearchResultFormatter)\n    private formatter: ILayerSearchResultFormatter\n  ) {\n    super(options, storageService);\n    this.languageService.translate\n      .get(this.options.title)\n      .subscribe(title => this.title$.next(title));\n  }\n\n  getId(): string {\n    return ILayerSearchSource.id;\n  }\n\n  getType(): string {\n    return ILayerSearchSource.type;\n  }\n\n  protected getDefaultOptions(): ILayerSearchSourceOptions {\n    const limit =\n      this.options.params && this.options.params.limit\n        ? Number(this.options.params.limit)\n        : undefined;\n    const ecmax =\n      this.options.params && this.options.params.ecmax\n        ? Number(this.options.params.ecmax)\n        : undefined;\n    return {\n      title: 'igo.geo.search.ilayer.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/layers/search',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.ilayer.type.layer',\n              value: 'layer',\n              enabled: true,\n              hashtags: ['layer', 'layers', 'couche', 'couches']\n            },\n            {\n              title: 'igo.geo.search.ilayer.type.groupLayer',\n              value: 'group',\n              enabled: false,\n              hashtags: ['gr-layer', 'gr-layers', 'gr-couche', 'gr-couches']\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '1',\n              value: 1,\n              enabled: limit === 1\n            },\n            {\n              title: '5',\n              value: 5,\n              enabled: limit === 5 || !limit\n            },\n            {\n              title: '10',\n              value: 10,\n              enabled: limit === 10\n            },\n            {\n              title: '25',\n              value: 25,\n              enabled: limit === 25\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: limit === 50\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'ecmax',\n          name: 'ecmax',\n          values: [\n            {\n              title: '10 %',\n              value: 10,\n              enabled: ecmax === 10\n            },\n            {\n              title: '30 %',\n              value: 30,\n              enabled: ecmax === 30\n            },\n            {\n              title: '50 %',\n              value: 50,\n              enabled: ecmax === 50 || !ecmax\n            },\n            {\n              title: '75 %',\n              value: 75,\n              enabled: ecmax === 75\n            },\n            {\n              title: '100 %',\n              value: 100,\n              enabled: ecmax === 100\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a layer by name or keyword\n   * @param term Layer name or keyword\n   * @returns Observable of <SearchResult<LayerOptions>[]\n   */\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<ILayerItemResponse>[]> {\n    const params = this.computeSearchRequestParams(term, options || {});\n    if (!params.get('q') || !params.get('type')) {\n      return of([]);\n    }\n    this.options.params.page = params.get('page') || '1';\n\n    return this.http\n      .get(this.searchUrl, { params })\n      .pipe(\n        map((response: ILayerServiceResponse) => this.extractResults(response, term))\n      );\n  }\n\n  private computeSearchRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    return new HttpParams({\n      fromObject: ObjectUtils.removeUndefined(\n        Object.assign(\n          {\n            q: this.computeTerm(term)\n          },\n          this.params,\n          this.computeOptionsParam(term, options || {}).params,\n          {\n            page: options.page\n          }\n        )\n      )\n    });\n  }\n\n  /**\n   * Remove hashtag from query\n   * @param term Query with hashtag\n   */\n  private computeTerm(term: string): string {\n    return term.replace(/(#[^\\s]*)/g, '').replace(/[^\\w- !\\-\\(\\),'#]+/g, '');\n  }\n\n  /**\n   * Add hashtag to param if valid\n   * @param term Query with hashtag\n   * @param options TextSearchOptions\n   */\n  private computeOptionsParam(\n    term: string,\n    options: TextSearchOptions\n  ): TextSearchOptions {\n    const hashtags = super.getHashtagsValid(term, 'type');\n    if (hashtags) {\n      options.params = Object.assign(options.params || {}, {\n        type: hashtags.join(',')\n      });\n    }\n\n    return options;\n  }\n\n  private extractResults(\n    response: ILayerServiceResponse, term: string\n  ): SearchResult<ILayerItemResponse>[] {\n    return response.items.map((data: ILayerData) =>\n    this.dataToResult(data, term, response)\n    );\n  }\n\n  private dataToResult(\n    data: ILayerData,\n    term: string,\n    response?: ILayerServiceResponse\n  ): SearchResult<ILayerItemResponse> {\n    const layerOptions = this.computeLayerOptions(data);\n\n    const titleHtml = data.highlight.title || data.properties.title;\n    const groupTitle = data.highlight.groupTitle || data.properties.groupTitle;\n    const subtitleHtml = groupTitle\n      ? ' <small style=\"color: #6f6969\"> ' + groupTitle + '</small>'\n      : '';\n\n    return {\n      source: this,\n      meta: {\n        dataType: LAYER,\n        id: [this.getId(), data.properties.id].join('.'),\n        title: data.properties.title,\n        titleHtml: titleHtml + subtitleHtml,\n        icon: data.properties.type === 'Layer' ? 'layers' : 'map',\n        score: data.score || computeTermSimilarity(term.trim(), data.properties.name),\n        nextPage:\n          response.items.length % +this.options.params.limit === 0 &&\n          +this.options.params.page < 10\n      },\n      data: layerOptions\n    };\n  }\n\n  private computeLayerOptions(data: ILayerData): ILayerItemResponse {\n    const url = data.properties.url;\n    const queryParams: QueryableDataSourceOptions = this.extractQueryParamsFromSourceUrl(\n      url\n    );\n    return ObjectUtils.removeUndefined({\n      sourceOptions: {\n        id: data.properties.id,\n        type: data.properties.format,\n        url,\n        queryFormat: queryParams.queryFormat,\n        queryHtmlTarget: queryParams.queryHtmlTarget,\n        params: data.properties.format === 'wms' ? {LAYERS: data.properties.name} : undefined,\n        layer: data.properties.format === 'wms' ? undefined : data.properties.name,\n        optionsFromCapabilities: true,\n        crossOrigin: 'anonymous'\n      },\n      title: data.properties.title,\n      maxResolution: getResolutionFromScale(\n        Number(data.properties.maxScaleDenom)\n      ),\n      minResolution: getResolutionFromScale(\n        Number(data.properties.minScaleDenom)\n      ),\n      metadata: {\n        url: data.properties.metadataUrl,\n        extern: data.properties.metadataUrl ? true : undefined,\n        abstract: data.properties.abstract || undefined\n      },\n      properties: this.formatter.formatResult(data).properties\n    });\n  }\n\n  private extractQueryParamsFromSourceUrl(\n    url: string\n  ): { queryFormat: QueryFormat; queryHtmlTarget: QueryHtmlTarget } {\n    let queryFormat;\n    let queryHtmlTarget;\n    const formatOpt = (this.options as ILayerSearchSourceOptions).queryFormat;\n    if (formatOpt) {\n      for (const key of Object.keys(formatOpt)) {\n        const value = formatOpt[key];\n        if (value === '*') {\n          queryFormat = QueryFormat[key.toUpperCase()];\n          break;\n        }\n\n        const urls = ((value as any) as { urls: string[] }).urls;\n        if (Array.isArray(urls)) {\n          urls.forEach(urlOpt => {\n            if (url.indexOf(urlOpt) !== -1) {\n              queryFormat = QueryFormat[key.toUpperCase()];\n            }\n          });\n          break;\n        }\n      }\n\n      if (\n        queryFormat === QueryFormat.HTML ||\n        queryFormat === QueryFormat.HTMLGML2\n      ) {\n        queryHtmlTarget = 'iframe';\n      }\n    }\n\n    return {\n      queryFormat,\n      queryHtmlTarget\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport { ILayerSearchSource, ILayerSearchResultFormatter } from './ilayer';\n\n/**\n * ILayer search result formatter factory\n * @ignore\n */\nexport function ilayerSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new ILayerSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the ILayer search result formatter\n */\nexport function provideILayerSearchResultFormatter() {\n  return {\n    provide: ILayerSearchResultFormatter,\n    useFactory: ilayerSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * ILayer search source factory\n * @ignore\n */\nexport function ilayerSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  formatter: ILayerSearchResultFormatter\n) {\n  return new ILayerSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${ILayerSearchSource.id}`),\n    formatter\n  );\n}\n\n/**\n * Function that returns a provider for the ILayer search source\n */\nexport function provideILayerSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ilayerSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService, ILayerSearchResultFormatter]\n  };\n}\n","import { FEATURE } from '../../feature';\nimport { LAYER } from '../../layer';\n\nexport const SEARCH_TYPES = [FEATURE, LAYER];\n","<div class=\"igo-search-selector\">\n  <button\n    mat-icon-button\n    class=\"igo-search-selector-button\"\n    color=\"primary\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.search.menu.tooltip' | translate\"\n    [matMenuTriggerFor]=\"searchSelectorMenu\">\n    <mat-icon svgIcon=\"menu-down\"></mat-icon>\n  </button>\n\n  <mat-menu\n    #searchSelectorMenu=\"matMenu\"\n    class=\"no-border-radius\"\n    xPosition=\"before\"\n    yPosition=\"above\">\n    <mat-radio-group\n      class=\"igo-search-selector-radio-group\"\n      [value]=\"searchType$ | async\"\n      (change)=\"onSearchTypeChange($event.value)\">\n      <mat-radio-button *ngFor=\"let searchType of searchTypes\" [value]=\"searchType\">\n        {{getSearchTypeTitle(searchType) | translate}}\n      </mat-radio-button>\n    </mat-radio-group>\n  </mat-menu>\n\n</div>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nimport { SEARCH_TYPES } from '../shared/search.enums';\nimport { SearchSourceService } from '../shared/search-source.service';\n\n/**\n * This component allows a user to select a search type yo enable. In it's\n * current version, only one search type can be selected at once (radio). If\n * this component were to support more than one search source enabled (checkbox),\n * the searchbar component would require a small change to it's\n * placeholder getter. The search source service already supports having\n * more than one search source enabled.\n */\n@Component({\n  selector: 'igo-search-selector',\n  templateUrl: './search-selector.component.html',\n  styleUrls: ['./search-selector.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchSelectorComponent implements OnInit, OnDestroy {\n\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  /**\n   * Subscription to the search type\n   */\n  private searchType$$: Subscription;\n\n  /**\n   * List of available search types\n   */\n  @Input() searchTypes: string[] = SEARCH_TYPES;\n\n  /**\n   * The search type enabled\n   */\n  @Input()\n  set searchType(value: string) { this.setSearchType(value); }\n  get searchType(): string { return this.searchType$.value; }\n\n  /**\n   * Event emitted when the enabled search type changes\n   */\n  @Output() searchTypeChange = new EventEmitter<string>();\n\n  constructor(private searchSourceService: SearchSourceService) {}\n\n  ngOnInit() {\n    this.searchType$$ = this.searchType$\n      .pipe(distinctUntilChanged())\n      .subscribe((searchType: string) => this.onSetSearchType(searchType));\n  }\n\n  ngOnDestroy() {\n    this.searchType$$.unsubscribe();\n  }\n\n  /**\n   * Enable the selected search type\n   * @param searchType Search type\n   * @internal\n   */\n  onSearchTypeChange(searchType: string) {\n    this.setSearchType(searchType);\n  }\n\n  /**\n   * Get a search type's title. The title\n   * for all availables search typers needs to be defined in the locale\n   * files or an error will be thrown.\n   * @param searchType Search type\n   * @internal\n   */\n  getSearchTypeTitle(searchType: string) {\n    return `igo.geo.search.${searchType.toLowerCase()}.title`;\n  }\n\n  /**\n   * Emit an event and enable the search sources of the given type.\n   * @param searchType Search type\n   */\n  private setSearchType(searchType: string | undefined) {\n    this.searchType$.next(searchType);\n  }\n\n  private onSetSearchType(searchType: string) {\n    if (searchType === undefined || searchType === null) {\n      return;\n    }\n\n    this.searchSourceService.enableSourcesByType(searchType);\n    this.searchTypeChange.emit(searchType);\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { SearchSelectorComponent } from './search-selector.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatButtonModule,\n    MatMenuModule,\n    MatRadioModule,\n    MatTabsModule,\n    MatCheckboxModule,\n    IgoLanguageModule\n  ],\n  exports: [SearchSelectorComponent],\n  declarations: [SearchSelectorComponent]\n})\nexport class IgoSearchSelectorModule {}\n","<div class=\"igo-search-settings\">\n\n  <button\n    mat-icon-button\n    class=\"igo-search-settings-button\"\n    color=\"primary\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.search.menu.tooltip' | translate\"\n    [matMenuTriggerFor]=\"searchSettingsMenu\">\n    <mat-icon svgIcon=\"chevron-down\"></mat-icon>\n  </button>\n  <mat-menu\n    #searchSettingsMenu=\"matMenu\"\n    class=\"no-border-radius\">\n    <div class=\"checkAllButton\" *ngIf=\"getSearchSources().length>4\">\n      <button mat-raised-button\n        (click)=\"checkUncheckAllSources($event)\">{{!searchSourcesAllEnabled  ? ('igo.geo.search.searchSources.unselectAll' | translate): ('igo.geo.search.searchSources.selectAll' | translate)}}</button>\n    </div>\n      <ng-container *ngFor=\"let source of getSearchSources()\">\n        <span class=\"igo-search-settings-search-source\">\n          <mat-checkbox\n            class=\"igo-search-settings-checkbox\"\n            [checked]=\"source.enabled\"\n            [value]=\"source\"\n            (click)=\"$event.stopPropagation()\"\n            (change)=\"onCheckSearchSource($event, source)\">\n          </mat-checkbox>\n          <button *ngIf=\"source.settings.length>0\"\n            [matMenuTriggerFor]=\"sub_menu\"\n            mat-menu-item>{{source.title}}\n          </button>\n          <button\n            mat-menu-item\n            *ngIf=\"source.settings.length===0\">\n            {{source.title}}\n          </button>\n        </span>\n          <mat-menu #sub_menu=\"matMenu\">\n            <ng-container *ngFor=\"let setting of source.settings\">\n              <button\n                  mat-menu-item\n                  [matMenuTriggerFor]=\"test_sub_menu\">\n                {{'igo.geo.search.searchSources.settings.'+ setting.title | translate}}\n              </button>\n              <mat-menu #test_sub_menu=\"matMenu\"\n                [ngSwitch]=\"setting.type\"\n                yPosition=\"above\">\n                <span *ngSwitchCase=\"'radiobutton'\">\n                  <mat-radio-group\n                    class=\"igo-search-settings-radio-group\"\n                    [value]=\"setting\">\n                    <mat-radio-button *ngFor=\"let settingValue of setting.values\"\n                      class=\"mat-typography\"\n                      [value]=\"settingValue\"\n                      [matTooltip]=\"getAvailableHashtagsValues(settingValue)\"\n                      [checked]=\"settingValue.enabled\"\n                      (click)=\"$event.stopPropagation()\"\n                      (change)=\"settingsValueCheckedRadioButton($event, source, setting, settingValue)\">\n                      {{settingValue.title | translate}}\n                    </mat-radio-button>\n                  </mat-radio-group>\n                </span>\n                <span *ngSwitchCase=\"'checkbox'\">\n                  <div class=\"checkAllButton\" *ngIf=\"setting.values.length>3\">\n                    <button mat-raised-button\n                      (click)=\"checkUncheckAll($event, source, setting)\">{{setting.allEnabled || setting.allEnabled === undefined  ? ('igo.geo.search.searchSources.settings.unselectAll' | translate): ('igo.geo.search.searchSources.settings.selectAll' | translate)}}</button>\n                  </div>\n                  <mat-checkbox *ngFor=\"let settingValue of getAvailableValues(setting)\"\n                    class=\"mat-menu-item\"\n                    [style.display]=\"displayBlock\"\n                    [checked]=\"settingValue.enabled\"\n                    [value]=\"setting\"\n                    [matTooltip]=\"getAvailableHashtagsValues(settingValue)\"\n                    (click)=\"$event.stopPropagation()\"\n                    (change)=\"settingsValueCheckedCheckbox($event, source, setting, settingValue)\">\n                    {{settingValue.title | translate}}\n                  </mat-checkbox>\n                </span>\n              </mat-menu>\n            </ng-container>\n          </mat-menu>\n      </ng-container>\n      <span *ngIf=\"hasPointerReverseSearchSource && !isTouchScreen\">\n        <mat-divider></mat-divider>\n        <span class=\"pointer-summary-slide-toggle-container mat-typography\">\n          <mat-slide-toggle class=\"pointer-summary-option\" (change)=\"changePointerReverseSearch($event)\" tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\" [matTooltip]=\"'igo.geo.search.pointerSearchSummary.tooltip' | translate\"\n            (click)=\"$event.stopPropagation()\" [checked]=\"pointerSummaryEnabled\" [labelPosition]=\"'after'\">\n            {{'igo.geo.search.pointerSearchSummary.title' | translate}}\n          </mat-slide-toggle>\n          <mat-slide-toggle class=\"pointer-summary-option\" (change)=\"changeSearchResultsGeometry($event)\" tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\" [matTooltip]=\"'igo.geo.search.searchResultsGeometry.tooltip' | translate\"\n            (click)=\"$event.stopPropagation()\" [checked]=\"searchResultsGeometryEnabled\" [labelPosition]=\"'after'\">\n            {{'igo.geo.search.searchResultsGeometry.title' | translate}}\n          </mat-slide-toggle>\n        </span>\n      </span>\n  </mat-menu>\n</div>\n","import { MatCheckboxChange } from '@angular/material/checkbox';\nimport { MatRadioChange } from '@angular/material/radio';\n\nimport {\n  Component,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  HostListener,\n  Input\n} from '@angular/core';\n\nimport { SearchSourceService } from '../shared/search-source.service';\nimport { SearchSource } from '../shared/sources/source';\nimport {\n  SearchSourceSettings,\n  SettingOptions\n} from '../shared/sources/source.interfaces';\nimport {\n  sourceCanReverseSearchAsSummary,\n  sourceCanSearch,\n  sourceCanReverseSearch\n} from '../shared/search.utils';\nimport { MediaService, StorageService } from '@igo2/core';\n\n/**\n * This component allows a user to select a search type yo enable. In it's\n * current version, only one search type can be selected at once (radio). If\n * this component were to support more than one search source enabled (checkbox),\n * the searchbar component would require a small change to it's\n * placeholder getter. The search source service already supports having\n * more than one search source enabled.\n */\n@Component({\n  selector: 'igo-search-settings',\n  templateUrl: './search-settings.component.html',\n  styleUrls: ['./search-settings.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchSettingsComponent implements OnInit {\n  public hasPointerReverseSearchSource: boolean = false;\n  public searchSourcesAllEnabled: boolean = false;\n\n  public buffer = [];\n  public lastKeyTime = Date.now();\n\n  public displayBlock = 'block';\n\n  get isTouchScreen(): boolean {\n    return this.mediaService.isTouchScreen();\n  }\n\n  @Input() pointerSummaryEnabled: boolean = false;\n  @Input() searchResultsGeometryEnabled: boolean = false;\n\n  /**\n   * Event emitted when the enabled search source changes\n   */\n  @Output() searchSourceChange = new EventEmitter<SearchSource>();\n\n  /**\n   * Event emitted when the pointer summary is activated\n   */\n  @Output() pointerSummaryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Event emitted when the show geometry summary is changed\n   */\n  @Output() searchResultsGeometryStatus = new EventEmitter<boolean>();\n\n  @HostListener('document:keydown', ['$event'])\n  handleKeyboardEvent(event: KeyboardEvent) {\n    if (event.key === 'F2') {\n      this.pointerSummaryEnabled = !this.pointerSummaryEnabled;\n      this.pointerSummaryStatus.emit(this.pointerSummaryEnabled);\n    }\n  }\n\n  constructor(\n    private searchSourceService: SearchSourceService,\n    private mediaService: MediaService,\n    private storageService: StorageService\n  ) {}\n\n  ngOnInit(): void {\n    this.hasPointerReverseSearchSource = this.hasReverseSearchSourcesForPointerSummary();\n  }\n\n  /**\n   * Get all search sources\n   * @internal\n   */\n  getSearchSources(): SearchSource[] {\n    const textSearchSources = this.searchSourceService\n      .getSources()\n      .filter(sourceCanSearch)\n      .filter((s) => s.available && s.getId() !== 'map' && s.showInSettings);\n\n    const reverseSearchSources = this.searchSourceService\n      .getSources()\n      .filter(sourceCanReverseSearch)\n      .filter((s) => s.available && s.getId() !== 'map' && s.showInSettings);\n    const sources = textSearchSources.concat(reverseSearchSources);\n    this.computeSourcesCheckAllBehavior(sources);\n    return sources;\n  }\n\n  /**\n   * Get all search sources usable for pointer summary\n   * @internal\n   */\n  hasReverseSearchSourcesForPointerSummary(): boolean {\n    if (\n      this.searchSourceService\n        .getEnabledSources()\n        .filter(sourceCanReverseSearchAsSummary).length\n    ) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * Triggered when a setting is checked (checkbox style)\n   * @internal\n   */\n  settingsValueCheckedCheckbox(\n    event: MatCheckboxChange,\n    source: SearchSource,\n    setting: SearchSourceSettings,\n    settingValue: SettingOptions\n  ) {\n    settingValue.enabled = event.checked;\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  /**\n   * Defining the action to do for check/uncheck checkboxes (settings)\n   * return true if all checkbox must be checked\n   * return false if all checkbox must be unchecked\n   * @internal\n   */\n  computeSettingCheckAllBehavior(setting: SearchSourceSettings) {\n    if (setting.allEnabled === undefined) {\n      if (setting.values.find((settingValue) => settingValue.enabled)) {\n        setting.allEnabled = false;\n      } else {\n        setting.allEnabled = true;\n      }\n    } else {\n      setting.allEnabled = !setting.allEnabled;\n    }\n  }\n\n  /**\n   * Defining the action to do for check/uncheck checkboxes (sources)\n   * return true if all checkbox must be checked\n   * return false if all checkbox must be unchecked\n   * @internal\n   */\n  computeSourcesCheckAllBehavior(sources: SearchSource[]) {\n    const enabledSourcesCnt = sources.filter((source) => source.enabled).length;\n    const disabledSourcesCnt = sources.filter((source) => !source.enabled)\n      .length;\n    this.searchSourcesAllEnabled =\n      enabledSourcesCnt >= disabledSourcesCnt ? false : true;\n  }\n\n  /**\n   * Triggered when the check all / uncheck all type is clicked,\n   * @internal\n   */\n  checkUncheckAll(event, source: SearchSource, setting: SearchSourceSettings) {\n    event.stopPropagation();\n    this.computeSettingCheckAllBehavior(setting);\n    setting.values.forEach((settingValue) => {\n      settingValue.enabled = setting.allEnabled;\n    });\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  /**\n   * Triggered when the check all / uncheck all type is clicked,\n   * @internal\n   */\n  checkUncheckAllSources(event) {\n    event.stopPropagation();\n    this.getSearchSources().map((source) => {\n      source.enabled = this.searchSourcesAllEnabled;\n      this.searchSourceChange.emit(source);\n    });\n  }\n\n  /**\n   * Triggered when a setting is checked (radiobutton style)\n   * @internal\n   */\n  settingsValueCheckedRadioButton(\n    event: MatRadioChange,\n    source: SearchSource,\n    setting: SearchSourceSettings,\n    settingValue: SettingOptions\n  ) {\n    setting.values.forEach((conf) => {\n      if (conf.value !== settingValue.value) {\n        conf.enabled = !event.source.checked;\n      } else {\n        conf.enabled = event.source.checked;\n      }\n    });\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  onCheckSearchSource(event: MatCheckboxChange, source: SearchSource) {\n    source.enabled = event.checked;\n    const storage = (this.storageService.get(source.getId() + '.options') || {}) as SettingOptions;\n    storage.enabled = source.enabled;\n    this.storageService.set(\n      source.getId() + '.options',\n      storage\n    );\n    this.searchSourceChange.emit(source);\n  }\n\n  getAvailableValues(setting: SearchSourceSettings) {\n    return setting.values.filter((s) => s.available !== false);\n  }\n\n  getAvailableHashtagsValues(setting: SettingOptions) {\n    if (setting.hashtags) {\n      return setting.hashtags.map((h) => '#' + h).join(', ');\n    }\n    return;\n  }\n\n  stopPropagation(event) {\n    event.stopPropagation();\n  }\n\n  changePointerReverseSearch(event) {\n    this.pointerSummaryEnabled = event.checked;\n    this.pointerSummaryStatus.emit(this.pointerSummaryEnabled);\n  }\n\n  changeSearchResultsGeometry(event) {\n    this.searchResultsGeometryEnabled = event.checked;\n    this.searchResultsGeometryStatus.emit(this.searchResultsGeometryEnabled);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { SearchSettingsComponent } from './search-settings.component';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\n/**\n * @ignore\n */\n@NgModule({\n  declarations: [SearchSettingsComponent],\n  imports: [\n    CommonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatButtonModule,\n    MatMenuModule,\n    MatRadioModule,\n    MatCheckboxModule,\n    MatDividerModule,\n    MatSlideToggleModule,\n    IgoLanguageModule\n  ],\n  exports: [SearchSettingsComponent]\n})\nexport class IgoSearchSettingsModule { }\n","<div class=\"igo-search-bar-container\" [ngClass]=\"{empty: empty$ | async}\">\n  <mat-form-field [floatLabel]=\"floatLabel\" [appearance]=\"appearance\">\n    <mat-label *ngIf=\"label\">{{label}}</mat-label>\n    <input\n      #input\n      matInput\n      autocomplete=\"off\"\n      [ngClass]=\"{'hasSearchIcon': searchIcon}\"\n      [disabled]=\"disabled$ | async\"\n      [placeholder]=\"placeholder ? placeholder : (placeholder$ | async) ? (placeholder$.value | translate) : undefined\"\n      [value]=\"term$ | async\"\n      (keyup)=\"onKeyup($event)\"\n      (touchend)=\"onKeyup($event)\">\n  </mat-form-field>\n\n  <div class=\"search-bar-buttons\">\n    <button\n      mat-icon-button\n      [color]=\"color\"\n      *ngIf=\"searchIcon !== undefined\">\n      <mat-icon svgIcon=\"{{searchIcon}}\"></mat-icon>\n    </button>\n\n    <button\n      *ngIf=\"(empty$ | async)===false\"\n      mat-icon-button\n      [color]=\"color\"\n      (click)=\"onClearButtonClick()\">\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n\n    <igo-search-selector\n      *ngIf=\"searchSelector\"\n      [searchTypes]=\"searchTypes\"\n      [searchType]=\"searchType$ | async\"\n      (searchTypeChange)=\"onSearchTypeChange($event)\">\n    </igo-search-selector>\n\n    <igo-search-settings\n      *ngIf=\"searchSettings\"\n      [pointerSummaryEnabled]=\"pointerSummaryEnabled\"\n      (pointerSummaryStatus)=\"pointerSummaryStatus.emit($event)\"\n      [searchResultsGeometryEnabled]=\"searchResultsGeometryEnabled\"\n      (searchResultsGeometryStatus)=\"searchResultsGeometryStatus.emit($event)\"\n      (searchSourceChange)=\"onSearchSettingsChange()\">\n    </igo-search-settings>\n  </div>\n</div>\n","import {\n  Component,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Input,\n  Output,\n  EventEmitter,\n  ViewChild,\n  ElementRef\n} from '@angular/core';\nimport {\n  FloatLabelType,\n  MatFormFieldAppearance\n} from '@angular/material/form-field';\nimport { BehaviorSubject, Subscription, EMPTY, timer } from 'rxjs';\nimport { debounce, distinctUntilChanged } from 'rxjs/operators';\n\nimport { LanguageService } from '@igo2/core';\nimport { EntityStore } from '@igo2/common';\n\nimport { SEARCH_TYPES } from '../shared/search.enums';\nimport { SearchResult, Research } from '../shared/search.interfaces';\nimport { SearchService } from '../shared/search.service';\nimport { SearchSourceService } from '../shared/search-source.service';\n\n/**\n * Searchbar that triggers a research in all search sources enabled.\n * If the store input is defined, the search results will be loaded\n * into that store. An event is always emitted when a research is completed.\n */\n@Component({\n  selector: 'igo-search-bar',\n  templateUrl: './search-bar.component.html',\n  styleUrls: ['./search-bar.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchBarComponent implements OnInit, OnDestroy {\n  /**\n   * Invalid keys\n   */\n  static invalidKeys = [\n    'Control',\n    'Shift',\n    'Alt',\n    'ArrowDown',\n    'ArrowUp',\n    'ArrowRight',\n    'ArrowLeft'\n  ];\n\n  readonly placeholder$: BehaviorSubject<string> = new BehaviorSubject(\n    'igo.geo.search.placeholder'\n  );\n\n  readonly empty$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  /**\n   * Subscription to the ssearch bar term\n   */\n  private term$$: Subscription;\n\n  /**\n   * Search term stream\n   */\n  private stream$: BehaviorSubject<string> = new BehaviorSubject('');\n\n  /**\n   * Subscription to the search term stream\n   */\n  private stream$$: Subscription;\n\n  /**\n   * Subscription to the search type\n   */\n  private searchType$$: Subscription;\n\n  private researches$$: Subscription[];\n\n  /**\n   * List of available search types\n   */\n  @Input() searchTypes: string[] = SEARCH_TYPES;\n\n  /**\n   * Search term\n   */\n  @Input()\n  set searchType(value: string) {\n    this.setSearchType(value);\n  }\n  get searchType(): string {\n    return this.searchType$.value;\n  }\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(\n    undefined\n  );\n\n  /**\n   * Event emitted when the pointer summary is activated by the searchbar setting\n   */\n  @Output() pointerSummaryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Event emitted when the show geometry setting is changed\n   */\n   @Output() searchResultsGeometryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Search term\n   */\n  @Input()\n  set term(value: string) {\n    this.setTerm(value);\n  }\n  get term(): string {\n    return this.term$.value;\n  }\n  readonly term$: BehaviorSubject<string> = new BehaviorSubject('');\n\n  /**\n   * Whether this component is disabled\n   */\n  @Input()\n  set disabled(value: boolean) {\n    this.disabled$.next(value);\n  }\n  get disabled(): boolean {\n    return this.disabled$.value;\n  }\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  @Input() pointerSummaryEnabled: boolean = false;\n  @Input() searchResultsGeometryEnabled: boolean = false;\n  /**\n   * Whether a float label should be displayed\n   */\n  @Input() floatLabel: FloatLabelType = 'never';\n\n  @Input() appearance: MatFormFieldAppearance = 'legacy';\n\n  @Input() placeholder: string;\n\n  @Input() label: string;\n\n  /**\n   * Icons color (search and clear)\n   */\n  @Input() color = 'primary';\n\n  @Input() termSplitter: string = '|';\n\n  /**\n   * Debounce time between each keystroke\n   */\n  @Input() debounce = 200;\n\n  /**\n   * Minimum term length required to trigger a research\n   */\n  @Input() minLength = 2;\n\n  /**\n   * Search icon\n   */\n  @Input() searchIcon: string;\n\n  /**\n   * Search Selector\n   */\n  @Input() searchSelector = false;\n\n  /**\n   * Search Settings\n   */\n  @Input() searchSettings = false;\n\n  /**\n   * Force coordinates in north america\n   */\n  @Input() forceNA = false;\n\n  /**\n   * Search results store\n   */\n  @Input() store: EntityStore<SearchResult>;\n\n  /**\n   * Event emitted when the search term changes\n   */\n  @Output() searchTermChange = new EventEmitter<string>();\n\n  /**\n   * Event emitted when a research is completed\n   */\n  @Output() search = new EventEmitter<{\n    research: Research;\n    results: SearchResult[];\n  }>();\n\n  /**\n   * Event emitted when the search type changes\n   */\n  @Output() searchTypeChange = new EventEmitter<string>();\n\n  /**\n   * Event emitted when the search type changes\n   */\n  @Output() clearFeature = new EventEmitter();\n\n  /**\n   * Event emitted when the search settings changes\n   */\n  @Output() searchSettingsChange = new EventEmitter();\n\n  /**\n   * Input element\n   * @internal\n   */\n  @ViewChild('input', { static: true }) input: ElementRef;\n\n  /**\n   * Whether the search bar is empty\n   * @internal\n   */\n  get empty(): boolean {\n    return this.term.length === 0;\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    private searchService: SearchService,\n    private searchSourceService: SearchSourceService\n  ) {}\n\n  /**\n   * Subscribe to the search term stream and trigger researches\n   * @internal\n   */\n  ngOnInit(): void {\n    this.term$$ = this.term$.subscribe((term: string) => {\n      this.empty$.next(term === undefined || term.length === 0);\n    });\n\n    this.stream$$ = this.stream$\n      .pipe(\n        debounce((term: string) => (term === '' ? EMPTY : timer(this.debounce)))\n      )\n      .subscribe((term: string) => this.onSetTerm(term));\n\n    this.handlePlaceholder();\n\n    this.searchType$$ = this.searchType$\n      .pipe(distinctUntilChanged())\n      .subscribe((searchType: string) => this.onSetSearchType(searchType));\n  }\n\n  /**\n   * Unsubscribe to the search term stream\n   * @internal\n   */\n  ngOnDestroy() {\n    this.term$$.unsubscribe();\n    this.stream$$.unsubscribe();\n    this.searchType$$.unsubscribe();\n  }\n\n  /**\n   * When a user types, validates the key and send it into the\n   * stream if it's valid\n   * @param event Keyboard event\n   * @internal\n   */\n  onKeyup(event: KeyboardEvent) {\n    const key = event.key;\n    if (!this.keyIsValid(key)) {\n      return;\n    }\n    const term = (event.target as HTMLInputElement).value;\n    this.setTerm(term);\n  }\n\n  /**\n   * Clear the stream and the input\n   * @internal\n   */\n  onClearButtonClick() {\n    this.clear();\n    this.clearFeature.emit();\n  }\n\n  /**\n   * Update search type\n   * @param searchType Enabled search type\n   * @internal\n   */\n  onSearchTypeChange(searchType: string) {\n    this.setSearchType(searchType);\n  }\n\n  /**\n   * Update the placeholder with the enabled search type. The placeholder\n   * for all availables search typers needs to be defined in the locale\n   * files or an error will be thrown.\n   * @param searchType Enabled search type\n   * @internal\n   */\n  setSearchType(searchType: string) {\n    this.searchType$.next(searchType);\n  }\n\n  onSearchSettingsChange() {\n    this.doSearch(this.term);\n    this.searchSettingsChange.emit();\n    this.handlePlaceholder();\n  }\n\n  /**\n   * Send the term into the stream only if this component is not disabled\n   * @param term Search term\n   */\n  setTerm(term: string) {\n    if (this.disabled) {\n      return;\n    }\n\n    term = term || '';\n\n    if (term !== this.term) {\n      this.term$.next(term);\n    }\n\n    const slug = term.replace(/(#[^\\s]*)/g, '').trim();\n    if (slug.length >= this.minLength || slug.length === 0) {\n      this.stream$.next(term);\n    }\n  }\n\n  /**\n   * Clear the stream and the input\n   */\n  private clear() {\n    this.term$.next('');\n    this.stream$.next('');\n    this.input.nativeElement.focus();\n  }\n\n  /**\n   * Validate if a given key stroke is a valid input\n   */\n  private keyIsValid(key: string) {\n    return SearchBarComponent.invalidKeys.indexOf(key) === -1;\n  }\n\n  /**\n   * When the search term changes, emit an event and trigger a\n   * research in every enabled search sources.\n   * @param term Search term\n   */\n  private onSetTerm(term: string | undefined) {\n    this.searchTermChange.emit(term);\n    this.doSearch(term);\n  }\n\n  private handlePlaceholder() {\n    const searchTypes = [\n      ...new Set(\n        this.searchSourceService\n          .getEnabledSources()\n          .filter((ss) => !['map', 'coordinatesreverse'].includes(ss.getId()))\n          .map((ss) => ss.getType())\n      )\n    ];\n\n    let placeholder = `igo.geo.search.placeholder`;\n    if (searchTypes.length === 1) {\n      placeholder = `igo.geo.search.${searchTypes[0].toLowerCase()}.placeholder`;\n    } else if (searchTypes.length === 0) {\n      placeholder = `igo.geo.search.emptyType.placeholder`;\n    }\n    this.placeholder$.next(placeholder);\n  }\n\n  private onSetSearchType(searchType: string) {\n    if (searchType === undefined || searchType === null) {\n      return;\n    }\n\n    this.searchTypeChange.emit(searchType);\n\n    const placeholder = `igo.geo.search.${searchType.toLowerCase()}.placeholder`;\n    this.placeholder$.next(placeholder);\n\n    this.setTerm(this.term);\n  }\n\n  /**\n   * Execute the search\n   * @param term Search term\n   */\n  private doSearch(rawTerm: string | undefined) {\n    if (this.researches$$) {\n      this.researches$$.map((research) => research.unsubscribe());\n      this.researches$$ = undefined;\n    }\n\n    let terms;\n    if (this.termSplitter && rawTerm.match(new RegExp(this.termSplitter, 'g'))) {\n      terms = rawTerm.split(this.termSplitter).filter((t) => t.length >= this.minLength);\n      if (this.store) {\n        this.store.clear();\n      }\n    } else {\n      terms = [rawTerm];\n    }\n\n    let researches: Research[] = [];\n    terms.map((term: string) => {\n      const slug = term ? term.replace(/(#[^\\s]*)/g, '').trim() : '';\n      if (slug === '') {\n        if (this.store !== undefined) {\n          this.store.clear();\n        }\n        return;\n      }\n\n      researches = researches.concat(this.searchService.search(term, {\n        forceNA: this.forceNA\n      }));\n    });\n    this.researches$$ = researches.map((research) => {\n      return research.request.subscribe((results: SearchResult[]) => {\n        this.onResearchCompleted(research, results);\n      });\n    });\n  }\n\n  /**\n   * When a research  is completed, emit an event and update\n   * the store's items.\n   * @param research Research\n   * @param results Research results\n   */\n  private onResearchCompleted(research: Research, results: SearchResult[]) {\n    this.search.emit({ research, results });\n\n    if (this.store !== undefined) {\n      const newResults = this.store\n        .all()\n        .filter((result) => result.source !== research.source)\n        .concat(results);\n      this.store.updateMany(newResults);\n    }\n  }\n}\n","import {\n  Directive,\n  Self,\n  OnInit,\n  Optional,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { RouteService } from '@igo2/core';\n\nimport { SearchBarComponent } from './search-bar.component';\n\n@Directive({\n  selector: '[igoSearchUrlParam]'\n})\nexport class SearchUrlParamDirective implements OnInit {\n  constructor(\n    @Self() private component: SearchBarComponent,\n    private ref: ChangeDetectorRef,\n    @Optional() private route: RouteService\n  ) {}\n\n  ngOnInit() {\n    if (this.route && this.route.options.searchKey) {\n      this.route.queryParams.subscribe(params => {\n        const searchParams = params[this.route.options.searchKey as string];\n        if (searchParams) {\n          this.component.setTerm(searchParams);\n          this.ref.detectChanges();\n        }\n      });\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { IgoSearchSelectorModule } from '../search-selector/search-selector.module';\nimport { IgoSearchSettingsModule } from '../search-settings/search-settings.module';\nimport { SearchBarComponent } from './search-bar.component';\nimport { SearchUrlParamDirective } from './search-url-param.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatButtonModule,\n    MatMenuModule,\n    MatRadioModule,\n    MatFormFieldModule,\n    MatInputModule,\n    IgoLanguageModule,\n    IgoSearchSelectorModule,\n    IgoSearchSettingsModule\n  ],\n  exports: [\n    SearchBarComponent,\n  ],\n  declarations: [\n    SearchBarComponent,\n    SearchUrlParamDirective\n  ]\n})\nexport class IgoSearchBarModule {}\n","<mat-list-item>\n  <mat-icon *ngIf=\"icon\" mat-list-avatar svgIcon=\"{{showIcons ? icon : 'blank'}}\"></mat-icon>\n\n  <h4 matLine *ngIf=\"titleHtml\" [innerHtml]=\"titleHtml\" matTooltipShowDelay=\"500\" [matTooltip]=\"tooltipHtml\" matTooltipClass=\"search-result-tooltip\"></h4>\n  <h4 matLine *ngIf=\"!titleHtml\" matTooltipShowDelay=\"500\" [matTooltip]=\"title\">{{title}}</h4>\n\n  <button *ngIf=\"withZoomButton\"\n    igoStopPropagation\n    mat-icon-button\n    (click)=\"onZoomHandler()\">\n    <mat-icon svgIcon=\"magnify\"></mat-icon>\n  </button>\n\n  <ng-content\n    select=[igoSearchItemToolbar]>\n  </ng-content>\n\n</mat-list-item>\n","import { Component, Input, ChangeDetectionStrategy, EventEmitter, Output } from '@angular/core';\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\n\nimport {\n  getEntityTitle,\n  getEntityTitleHtml,\n  getEntityIcon\n} from '@igo2/common';\n\nimport { SearchResult } from '../shared/search.interfaces';\nimport { FeatureMotion, moveToOlFeatures } from '../../feature';\nimport { IgoMap } from '../../map';\n\n/**\n * Search results list item\n */\n@Component({\n  selector: 'igo-search-results-item',\n  templateUrl: './search-results-item.component.html',\n  styleUrls: ['./search-results-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchResultsItemComponent {\n  /**\n   * Search result item\n   */\n  @Input() result: SearchResult;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Search result title\n   * @internal\n   */\n\n  /**\n   * to show hide results icons\n   */\n  @Input() showIcons: boolean;\n\n  /**\n   * Whether there should be a zoom button\n   */\n  @Input() withZoomButton = false;\n\n  @Output() zoomEvent = new EventEmitter<boolean>();\n\n  private format = new olFormatGeoJSON();\n\n  get title(): string {\n    return getEntityTitle(this.result);\n  }\n\n  /**\n   * Search result HTML title\n   * @internal\n   */\n  get titleHtml(): string {\n    return getEntityTitleHtml(this.result);\n  }\n\n  /**\n   * Search result tooltip\n   * @internal\n   */\n  get tooltipHtml(): string {\n    return this.titleHtml\n      .replace(/<small?[^>]+(>|$)/g, '\\n')\n      .replace(/<\\/?[^>]+(>|$)/g, '');\n  }\n\n  /**\n   * Search result icon\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.result);\n  }\n\n  constructor() {}\n\n  onZoomHandler() {\n    const olFeature = this.format.readFeature(this.result.data, {\n      dataProjection: this.result.data.projection,\n      featureProjection: this.map.projection\n    });\n    moveToOlFeatures(this.map, [olFeature], FeatureMotion.Default);\n  }\n}\n","<igo-list [navigation]=\"true\">\n  <ng-template\n    #groupTemplate\n    ngFor let-group\n    [ngForOf]=\"results$ | async\">\n\n    <igo-collapsible [class]=\"group.source.getId()\"\n      *ngIf=\"mode === searchResultMode.Grouped; else flatTemplate\"\n      [title]=\"computeGroupTitle(group)\"\n      [collapsed]=\"collapsed[group.source.title]\"\n      (toggle)=\"collapsed[group.source.title] = $event\">\n      <ng-container *ngTemplateOutlet=\"storeItemTemplate; context: {results: group.results}\"></ng-container>\n    </igo-collapsible>\n\n    <ng-template #flatTemplate>\n      <ng-container *ngTemplateOutlet=\"storeItemTemplate; context: {results: group.results}\"></ng-container>\n    </ng-template>\n\n    <ng-template #storeItemTemplate let-results=\"results\">\n      <ng-template ngFor let-result [ngForOf]=\"results\">\n        <igo-search-results-item\n          igoListItem\n          color=\"accent\"\n          [map]=\"map\"\n          [result]=\"result\"\n          [showIcons]=\"showIcons\"\n          [withZoomButton]=\"withZoomButton\"\n          [focused]=\"store.state.get(result).focused\"\n          [selected]=\"store.state.get(result).selected\"\n          (focus)=\"resultFocus.emit(result)\"\n          (unfocus)=\"resultUnfocus.emit(result)\"\n          (select)=\"onResultSelect(result)\"\n          (mouseenter)=\"resultFocus.emit(result)\"\n          (mouseleave)=\"resultUnfocus.emit(result)\">\n\n          <ng-container igoSearchItemToolbar\n            [ngTemplateOutlet]=\"templateSearchToolbar\"\n            [ngTemplateOutletContext]=\"{result: result}\">\n          </ng-container>\n\n        </igo-search-results-item>\n      </ng-template>\n      <span class=\"moreResults mat-typography\" *ngIf=\"isMoreResults(group)\" (click)=\"displayMoreResults(group)\">\n        <u>{{ 'igo.geo.search.displayMoreResults' | translate }}</u>\n      </span>\n    </ng-template>\n\n  </ng-template>\n\n</igo-list>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ContentChild,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\nimport type { TemplateRef } from '@angular/core';\n\nimport { Observable, EMPTY, timer, BehaviorSubject, Subscription } from 'rxjs';\nimport { debounce, map } from 'rxjs/operators';\n\nimport { EntityState, EntityStore, EntityStoreFilterCustomFuncStrategy, EntityStoreWatcher } from '@igo2/common';\n\nimport { IgoMap } from '../../map';\n\nimport { TextSearchOptions } from '../shared/sources/source.interfaces';\nimport { SearchService } from '../shared/search.service';\nimport { SearchResult, Research } from '../shared/search.interfaces';\nimport { SearchSource } from '../shared/sources/source';\n\nexport enum SearchResultMode {\n  Grouped = 'grouped',\n  Flat = 'flat'\n}\n\n/**\n * List of search results with focus and selection capabilities.\n * This component is dumb and only emits events.\n */\n@Component({\n  selector: 'igo-search-results',\n  templateUrl: './search-results.component.html',\n  styleUrls: ['./search-results.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchResultsComponent implements OnInit, OnDestroy {\n  /**\n   * Reference to the SearchResultMode enum\n   * @internal\n   */\n  public searchResultMode = SearchResultMode;\n\n  /**\n   * Search results store watcher\n   */\n  private watcher: EntityStoreWatcher<SearchResult>;\n\n  private settingsChange$$: Subscription;\n\n  public pageIterator: {sourceId: string}[] = [];\n\n  public collapsed: {sourceId: string}[] = [];\n\n  @Input() map: IgoMap;\n\n  /**\n   * Search results store\n   */\n  @Input() store: EntityStore<SearchResult>;\n\n  /**\n   * to show hide results icons\n   */\n  @Input() showIcons: boolean;\n\n  /**\n   * Search results display mode\n   */\n  @Input() mode: SearchResultMode = SearchResultMode.Grouped;\n\n  /**\n   * Whether there should be a zoom button\n   */\n  @Input() withZoomButton = false;\n\n  /**\n   * Search term\n   */\n  @Input()\n  get term(): string {\n    return this._term;\n  }\n  set term(value: string) {\n    this._term = value;\n    this.pageIterator = [];\n  }\n  public _term: string;\n\n  @Input() settingsChange$ = new BehaviorSubject<boolean>(undefined);\n\n  @Input() termSplitter: string = '|';\n\n  /**\n   * Event emitted when a result is focused\n   */\n  @Output() resultFocus = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a result is unfocused\n   */\n  @Output() resultUnfocus = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a result is selected\n   */\n  @Output() resultSelect = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a research is completed after displaying more results is clicked\n   */\n  @Output() moreResults = new EventEmitter<{\n    research: Research;\n    results: SearchResult[];\n  }>();\n\n  /**\n   * Events emitted when a result is focus or unfocus by mouse event\n   */\n  @Output() resultMouseenter = new EventEmitter<SearchResult>();\n  @Output() resultMouseleave = new EventEmitter<SearchResult>();\n\n  @ContentChild('igoSearchItemToolbar', /* TODO: add static flag */ {}) templateSearchToolbar: TemplateRef<any>;\n\n  get results$(): Observable<{source: SearchSource; results: SearchResult[]}[]> {\n    if (this._results$ === undefined) {\n      this._results$ = this.liftResults();\n    }\n    return this._results$;\n  }\n  private _results$: Observable<\n    {source: SearchSource; results: SearchResult[]}[]\n  >;\n\n  constructor(private cdRef: ChangeDetectorRef,\n              private searchService: SearchService) {}\n\n  /**\n   * Bind the search results store to the watcher\n   * @internal\n   */\n  ngOnInit() {\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n\n    this.settingsChange$$ = this.settingsChange$.subscribe(() => {\n      this.pageIterator = [];\n    });\n  }\n\n  /**\n   * Unbind the search results store from the watcher\n   * @internal\n   */\n  ngOnDestroy() {\n    this.watcher.destroy();\n    this.settingsChange$$.unsubscribe();\n  }\n\n  /**\n   * Compute a group title\n   * @param group Search results group\n   * @returns Group title\n   * @internal\n   */\n  computeGroupTitle(group: {source: SearchSource; results: SearchResult[]}): string {\n    const parts = [group.source.title];\n    const count = group.results.length;\n    if (count > 1) {\n      parts.push(`(${count})`);\n    }\n    return parts.join(' ');\n  }\n\n  /**\n   * When a result is selected, update it's state in the store and emit\n   * an event. A selected result is also considered focused\n   * @param result Search result\n   * @internal\n   */\n  onResultSelect(result: SearchResult) {\n    if (this.store.state.get(result)) {\n      if (this.store.state.get(result).selected === true) {\n        return;\n      }\n    }\n    this.store.state.update(result, {focused: true, selected: true}, true);\n    this.resultSelect.emit(result);\n  }\n\n  /**\n   * Return an observable of the search results, grouped by search source\n   * @returns Observable of grouped search results\n   * @internal\n   */\n   private liftResults(): Observable<{source: SearchSource; results: SearchResult[]}[]> {\n    return this.store.stateView.all$().pipe(\n      debounce((results: {entity: SearchResult, state: EntityState}[]) => {\n        return results.length === 0 ? EMPTY : timer(200);\n      }),\n      map((results: {entity: SearchResult, state: EntityState}[]) => {\n        return this.groupResults(results.map(r => r.entity).sort(this.sortByOrder));\n      })\n    );\n  }\n\n  /**\n   * Sort the results by display order.\n   * @param r1 First result\n   * @param r2 Second result\n   */\n  private sortByOrder(r1: SearchResult, r2: SearchResult) {\n    return r1.source.displayOrder - r2.source.displayOrder;\n  }\n\n  /**\n   * Group results by search source\n   * @param results Search results from all sources\n   * @returns Search results grouped by source\n   */\n  private groupResults(results: SearchResult[]): {source: SearchSource; results: SearchResult[]}[] {\n    const grouped = new Map<SearchSource, SearchResult[]>();\n    results.forEach((result: SearchResult) => {\n      const source = result.source;\n      let sourceResults = grouped.get(source);\n      if (sourceResults === undefined) {\n        sourceResults = [];\n        grouped.set(source, sourceResults);\n      }\n      sourceResults.push(result);\n    });\n\n    return Array.from(grouped.keys()).map((source: SearchSource) => {\n      if (this.pageIterator[source.getId()] === undefined) {\n        this.pageIterator[source.getId()] = 1;\n      }\n      return {source, results: grouped.get(source)};\n    });\n  }\n\n  isMoreResults(group: { source: SearchSource; results: SearchResult[] }) {\n    // getStrategyOfType is to avoid display more result based on a filtered state\n    const stategy = this.store.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\n    const active = stategy?.active || false;\n    return !active && group.results &&\n      group.results[group.results.length - 1].meta.nextPage === true;\n  }\n\n  displayMoreResults(group: {source: SearchSource; results: SearchResult[]}) {\n    const options: TextSearchOptions = {\n      sourceId: group.source.getId(),\n      page: ++this.pageIterator[group.source.getId()]\n    };\n\n    let terms;\n    if (this.termSplitter && this.term.match(new RegExp(this.termSplitter, 'g'))) {\n      terms = this.term.split(this.termSplitter);\n    } else {\n      terms = [this.term];\n    }\n\n    let researches: Research[] = [];\n    terms.map((term: string) => {\n      researches = researches.concat(this.searchService.search(term, options));\n    });\n\n    researches.map(research => {\n      research.request.subscribe((results: SearchResult[]) => {\n        const newResults = group.results.concat(results);\n        if (!results.length) {\n          newResults[newResults.length - 1].meta.nextPage = false;\n        }\n        this.moreResults.emit({research, results: newResults});\n      });\n    });\n    return;\n  }\n}\n","<button\nigoStopPropagation\n(mouseenter)=\"onMouseEvent($event)\" (mouseleave)=\"onMouseEvent($event)\"\n*ngIf=\"layer.meta.dataType === 'Layer'\"\nmat-icon-button\ntooltip-position=\"below\"\nmatTooltipShowDelay=\"500\"\n[matTooltip]=\"(tooltip$ | async) | translate\"\n[color]=\"(isPreview$ | async) ? '' : added ? 'warn' : ''\"\n(click)=\"onToggleClick($event)\">\n<mat-icon\n  matBadge=\"icon\"\n  igoMatBadgeIcon=\"eye-off\"\n  igoMatBadgeInverseColor=\"true\"\n  [matBadgeHidden]=\"(inRange$ | async)\"\n  matBadgeDisabled=\"true\"\n  matBadgeSize=\"small\"\n  matBadgePosition=\"after\"\n  [svgIcon]=\"(isPreview$ | async) ? 'plus' : added ? 'delete' : 'plus'\">\n</mat-icon>\n</button>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { SearchResult } from '../shared/search.interfaces';\nimport { IgoMap } from '../../map/shared/map';\nimport { LayerOptions } from '../../layer/shared/layers/layer.interface';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { LAYER } from '../../layer/shared/layer.enums';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\n@Component({\n  selector: 'igo-search-add-button',\n  templateUrl: './search-results-add-button.component.html',\n  styleUrls: ['./search-results-add-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchResultAddButtonComponent implements OnInit, OnDestroy {\n  public tooltip$: BehaviorSubject<string> = new BehaviorSubject(\n    'igo.geo.catalog.layer.addToMap'\n  );\n\n  private resolution$$: Subscription;\n\n  public inRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  public isPreview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  private layersSubcriptions = [];\n\n  private lastTimeoutRequest;\n\n  private mouseInsideAdd: boolean = false;\n\n  @Input() layer: SearchResult;\n\n  /**\n   * Whether the layer is already added to the map\n   */\n  @Input() added: boolean;\n\n  /**\n   * The map to add the search result layer to\n   */\n  @Input() map: IgoMap;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor(private layerService: LayerService) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit(): void {\n    if (this.layer.meta.dataType === 'Layer') {\n      this.added =\n        this.map.layers.findIndex(\n          lay => lay.id === this.layer.data.sourceOptions.id\n        ) !== -1;\n    }\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(value => {\n      this.isInResolutionsRange(value);\n      this.tooltip$.next(this.computeTooltip());\n    });\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n  }\n\n  /**\n   * On mouse event, mouseenter /mouseleave\n   * @internal\n   */\n  onMouseEvent(event) {\n    this.onToggleClick(event);\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick(event) {\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      clearTimeout(this.lastTimeoutRequest);\n    }\n\n    if (event.type === 'mouseenter' && this.mouseInsideAdd ) {\n      return;\n    }\n    switch (event.type) {\n      case 'click':\n        if (!this.isPreview$.value) {\n          if (this.added) {\n            this.remove();\n          } else {\n            this.add();\n          }\n        }\n        this.isPreview$.next(false);\n        break;\n      case 'mouseenter':\n        if (!this.isPreview$.value && !this.added) {\n          this.lastTimeoutRequest = setTimeout(() => {\n            this.add();\n            this.isPreview$.next(true);\n          }, 500);\n        }\n        this.mouseInsideAdd = true;\n        break;\n      case 'mouseleave':\n        if (this.isPreview$.value) {\n          this.remove();\n          this.isPreview$.next(false);\n        }\n        this.mouseInsideAdd = false;\n        break;\n      default:\n        break;\n    }\n  }\n\n  private add() {\n    if (!this.added) {\n      this.added = true;\n      this.addLayerToMap();\n    }\n  }\n\n  private remove() {\n    if (this.added) {\n      this.added = false;\n      this.removeLayerFromMap();\n      this.layersSubcriptions.map(s => s.unsubscribe());\n      this.layersSubcriptions = [];\n    }\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private addLayerToMap() {\n    if (this.map === undefined) {\n      return;\n    }\n\n    if (this.layer.meta.dataType !== LAYER) {\n      return undefined;\n    }\n\n    const layerOptions = (this.layer as SearchResult<LayerOptions>).data;\n    if (layerOptions.sourceOptions.optionsFromApi === undefined) {\n      layerOptions.sourceOptions.optionsFromApi = true;\n    }\n    this.layersSubcriptions.push(\n      this.layerService\n        .createAsyncLayer(layerOptions)\n        .subscribe(layer => this.map.addLayer(layer))\n    );\n  }\n\n  /**\n   * Emit added change event with added = false\n   */\n  private removeLayerFromMap() {\n    if (this.map === undefined) {\n      return;\n    }\n\n    if (this.layer.meta.dataType !== LAYER) {\n      return undefined;\n    }\n\n    const oLayer = this.map.getLayerById(this.layer.data.sourceOptions.id);\n    this.map.removeLayer(oLayer);\n  }\n\n  isInResolutionsRange(resolution: number) {\n    const minResolution = this.layer.data.minResolution || 0;\n    const maxResolution = this.layer.data.maxResolution || Infinity;\n    this.inRange$.next(\n      resolution >= minResolution && resolution <= maxResolution\n    );\n  }\n\n  computeTooltip(): string {\n    if (this.added) {\n      return this.inRange$.value\n        ? 'igo.geo.catalog.layer.removeFromMap'\n        : 'igo.geo.catalog.layer.removeFromMapOutRange';\n    } else {\n      return this.inRange$.value\n        ? 'igo.geo.catalog.layer.addToMap'\n        : 'igo.geo.catalog.layer.addToMapOutRange';\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport {\n  IgoCollapsibleModule,\n  IgoListModule,\n  IgoMatBadgeIconModule,\n  IgoStopPropagationModule\n} from '@igo2/common';\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { IgoMetadataModule } from './../../metadata/metadata.module';\nimport { SearchResultsComponent } from './search-results.component';\nimport { SearchResultsItemComponent } from './search-results-item.component';\nimport { SearchResultAddButtonComponent } from './search-results-add-button.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatBadgeModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatListModule,\n    MatButtonModule,\n    IgoCollapsibleModule,\n    IgoListModule,\n    IgoStopPropagationModule,\n    IgoLanguageModule,\n    IgoMatBadgeIconModule,\n    IgoMetadataModule,\n  ],\n  exports: [\n    SearchResultsComponent,\n    SearchResultAddButtonComponent\n  ],\n  declarations: [\n    SearchResultsComponent,\n    SearchResultsItemComponent,\n    SearchResultAddButtonComponent\n  ]\n})\nexport class IgoSearchResultsModule {}\n","import { FeatureGeometry } from './../../feature/shared/feature.interfaces';\nimport {\n  Directive,\n  Input,\n  OnDestroy,\n  Self,\n  OnInit,\n  AfterContentChecked\n} from '@angular/core';\n\nimport { Subscription } from 'rxjs';\n\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { SearchService } from './search.service';\n\nimport olFeature from 'ol/Feature';\nimport { transform } from 'ol/proj';\nimport * as olstyle from 'ol/style';\nimport * as olgeom from 'ol/geom';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { SearchResult, Research } from './search.interfaces';\nimport { EntityStore } from '@igo2/common';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { take } from 'rxjs/operators';\nimport { tryBindStoreLayer } from '../../feature/shared/feature.utils';\nimport { FeatureStore } from '../../feature/shared/store';\nimport { FeatureMotion, FEATURE } from '../../feature/shared/feature.enums';\nimport { SearchSourceService } from './search-source.service';\nimport { sourceCanReverseSearchAsSummary } from './search.utils';\nimport { MediaService } from '@igo2/core';\nimport { unByKey } from 'ol/Observable';\n\n/**\n * This directive makes the mouse coordinate trigger a reverse search on available search sources.\n * The search results are placed into a label, on a cross icon, representing the mouse coordinate.\n * By default, no search sources. Config in config file must be defined.\n * the layer level.\n */\n@Directive({\n  selector: '[igoSearchPointerSummary]'\n})\nexport class SearchPointerSummaryDirective implements OnInit, OnDestroy, AfterContentChecked {\n\n  public store: FeatureStore<Feature>;\n  private lonLat: [number, number];\n  private pointerSearchStore: EntityStore<SearchResult> = new EntityStore<SearchResult>([]);\n  private lastTimeoutRequest;\n  private store$$: Subscription;\n  private layers$$: Subscription;\n  private reverseSearch$$: Subscription[] = [];\n  private hasPointerReverseSearchSource: boolean = false;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  private searchPointerSummaryFeatureId: string = 'searchPointerSummaryFeatureId';\n  /**\n   * The delay where the mouse must be motionless before trigger the reverse search\n   */\n  @Input() igoSearchPointerSummaryDelay: number = 1000;\n\n  /**\n   * If the user has enabled or not the directive\n   */\n  @Input() igoSearchPointerSummaryEnabled: boolean = false;\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private searchService: SearchService,\n    private searchSourceService: SearchSourceService,\n    private mediaService: MediaService\n  ) { }\n\n  /**\n   * Start listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnInit() {\n    this.listenToMapPointerMove();\n    this.subscribeToPointerStore();\n\n    this.map.status$.pipe(take(1)).subscribe(() => {\n      this.store = new FeatureStore<Feature>([], {map: this.map});\n      this.initStore();\n    });\n\n    // To handle context change without using the contextService.\n    this.layers$$ = this.map.layers$.subscribe((layers) => {\n      if (this.store && !layers.find(l => l.id === 'searchPointerSummaryId')) {\n        this.initStore();\n      }\n    });\n\n  }\n\n  /**\n   * Initialize the pointer position store\n   * @internal\n   */\n  private initStore() {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      isIgoInternalLayer: true,\n      id : 'searchPointerSummaryId',\n      title: 'searchPointerSummary',\n      zIndex: 900,\n      source: new FeatureDataSource(),\n      showInLayerList: false,\n      exportable: false,\n      browsable: false,\n      style: pointerPositionSummaryMarker\n    });\n    tryBindStoreLayer(store, layer);\n  }\n\n  ngAfterContentChecked(): void {\n      if (!this.searchSourceService.getEnabledSources().filter(sourceCanReverseSearchAsSummary).length) {\n        this.hasPointerReverseSearchSource = false;\n      } else {\n        this.hasPointerReverseSearchSource = true;\n      }\n    }\n\n  /**\n   * Stop listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unsubscribeToPointerStore();\n    this.unsubscribeReverseSearch();\n    this.layers$$.unsubscribe();\n  }\n\n  /**\n   * Subscribe to pointermove result store\n   * @internal\n   */\n  subscribeToPointerStore() {\n    this.store$$ = this.pointerSearchStore.entities$.subscribe(resultsUnderPointerPosition => {\n      this.entitiesToPointerOverlay(resultsUnderPointerPosition);\n    });\n  }\n\n  /**\n   * Build an object based on the closest feature by type (base on type and distance properties )\n   * @param results SearchResult[]\n   * @returns OL style function\n   */\n  private computeSummaryClosestFeature(results: SearchResult[]): {} {\n    const closestResultByType = {};\n\n    results.map(result => {\n      if (result.data.properties.type && result.data.properties.distance >= 0) {\n        if (closestResultByType.hasOwnProperty(result.data.properties.type)) {\n          const prevDistance = closestResultByType[result.data.properties.type].distance;\n          if (result.data.properties.distance < prevDistance) {\n            const title = result.meta.pointerSummaryTitle || result.meta.title;\n            closestResultByType[result.data.properties.type] = { distance: result.data.properties.distance, title };\n          }\n        } else {\n          const title = result.meta.pointerSummaryTitle || result.meta.title;\n          closestResultByType[result.data.properties.type] = { distance: result.data.properties.distance, title };\n        }\n      }\n    });\n\n    return closestResultByType;\n  }\n\n  /**\n   * convert store entities to a pointer position overlay with label summary on.\n   * @param event OL map browser pointer event\n   */\n  private entitiesToPointerOverlay(resultsUnderPointerPosition: SearchResult[]) {\n    const closestResultByType = this.computeSummaryClosestFeature(resultsUnderPointerPosition);\n    const summarizedClosestType = Object.keys(closestResultByType);\n    const processedSummarizedClosestType = [];\n    const summary = [];\n    resultsUnderPointerPosition.map(result => {\n      const typeIndex = summarizedClosestType.indexOf(result.data.properties.type);\n      if (typeIndex !== -1) {\n        summary.push(closestResultByType[result.data.properties.type].title);\n        summarizedClosestType.splice(typeIndex, 1);\n        processedSummarizedClosestType.push(result.data.properties.type);\n      } else {\n        if (processedSummarizedClosestType.indexOf(result.data.properties.type) === -1) {\n          summary.push(result.meta.pointerSummaryTitle || result.meta.title);\n        }\n      }\n    });\n    if (summary.length) {\n      this.addPointerOverlay(summary.join('\\n'));\n    }\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Unsubscribe to pointer store.\n   * @internal\n   */\n  unsubscribeToPointerStore() {\n    this.store$$.unsubscribe();\n  }\n  /**\n   * Unsubscribe to reverse seatch store.\n   * @internal\n   */\n  unsubscribeReverseSearch() {\n    this.reverseSearch$$.map(s => s.unsubscribe());\n    this.reverseSearch$$ = [];\n  }\n\n  /**\n   * Stop listening for map pointermove\n   * @internal\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Trigger reverse search when the mouse is motionless during the defined delay (pointerMoveDelay).\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: MapBrowserPointerEvent<any>) {\n    if (\n      event.dragging || !this.igoSearchPointerSummaryEnabled ||\n      !this.hasPointerReverseSearchSource || this.mediaService.isTouchScreen()) {\n      this.clearLayer();\n      return;\n    }\n    if (typeof this.lastTimeoutRequest !== 'undefined') { // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n      this.clearLayer();\n      this.unsubscribeReverseSearch();\n    }\n\n    this.lonLat = transform(event.coordinate, this.mapProjection, 'EPSG:4326') as [number, number];\n\n    this.lastTimeoutRequest = setTimeout(() => {\n      this.onSearchCoordinate();\n    }, this.igoSearchPointerSummaryDelay);\n  }\n\n    /**\n   * Sort the results by display order.\n   * @param r1 First result\n   * @param r2 Second result\n   */\n     private sortByOrder(r1: SearchResult, r2: SearchResult) {\n      return r1.source.displayOrder - r2.source.displayOrder;\n    }\n\n  private onSearchCoordinate() {\n    this.pointerSearchStore.clear();\n    const results = this.searchService.reverseSearch(this.lonLat, { params: { geometry: 'false', icon: 'false' } }, true);\n\n    for (const i in results) {\n      if (results.length > 0) {\n        this.reverseSearch$$.push(\n          results[i].request.subscribe((_results: SearchResult<Feature>[]) => {\n            this.onSearch({ research: results[i], results: _results });\n          }));\n      }\n    }\n  }\n\n  private onSearch(event: { research: Research; results: SearchResult[] }) {\n    const results = event.results;\n    const newResults = this.pointerSearchStore.all()\n      .filter((result: SearchResult) => result.source !== event.research.source)\n      .concat(results);\n    this.pointerSearchStore.load(newResults.sort(this.sortByOrder));\n  }\n\n  /**\n   * Add a feature to the pointer store\n   * @param text string\n   */\n  private addPointerOverlay(text: string) {\n    this.clearLayer();\n\n    const geometry = new olgeom.Point(\n      transform(this.lonLat, 'EPSG:4326', this.mapProjection)\n    );\n    const feature = new olFeature({ geometry });\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n      featureProjection: this.mapProjection,\n      dataProjection: this.mapProjection\n    }) as FeatureGeometry;\n\n    const f: Feature = {\n      type: FEATURE,\n      geometry: geojsonGeom,\n      projection: this.mapProjection,\n      properties: {\n        id: this.searchPointerSummaryFeatureId,\n        pointerSummary: text\n      },\n      meta: {\n        id: this.searchPointerSummaryFeatureId\n      },\n      ol: feature\n    };\n    this.store.setLayerFeatures([f], FeatureMotion.None);\n  }\n\n/**\n * Clear the pointer store features\n */\nprivate clearLayer() {\n  if (this.store) {\n    this.store.clearLayer();\n  }\n}\n\n}\n\n/**\n * Create a default style for the pointer position and it's label summary.\n * @param feature OlFeature\n * @returns OL style function\n */\nexport function pointerPositionSummaryMarker(feature: olFeature<OlGeometry>, resolution: number): olstyle.Style {\n  return new olstyle.Style({\n    image: new olstyle.Icon({\n      src: './assets/igo2/geo/icons/cross_black_18px.svg',\n      imgSize: [18, 18], // for ie\n    }),\n\n    text: new olstyle.Text({\n      text: feature.get('pointerSummary'),\n      textAlign: 'left',\n      textBaseline: 'bottom',\n      font: '12px Calibri,sans-serif',\n      fill: new olstyle.Fill({ color: '#000' }),\n      backgroundFill: new olstyle.Fill({ color: 'rgba(255, 255, 255, 0.5)' }),\n      backgroundStroke: new olstyle.Stroke({ color: 'rgba(200, 200, 200, 0.75)', width: 2 }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true,\n      offsetX: 10,\n      offsetY: -10,\n      padding: [2.5, 2.5, 2.5, 2.5]\n    })\n  });\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { SearchService } from './shared/search.service';\nimport { provideSearchSourceService } from './shared/search-source-service.providers';\nimport { provideDefaultIChercheSearchResultFormatter } from './shared/sources/icherche.providers';\nimport { provideDefaultCoordinatesSearchResultFormatter } from './shared/sources/coordinates.providers';\nimport { provideILayerSearchResultFormatter } from './shared/sources/ilayer.providers';\n\nimport { IgoSearchBarModule } from './search-bar/search-bar.module';\nimport { IgoSearchSelectorModule } from './search-selector/search-selector.module';\nimport { IgoSearchResultsModule } from './search-results/search-results.module';\nimport { IgoSearchSettingsModule } from './search-settings/search-settings.module';\nimport { SearchPointerSummaryDirective } from './shared/search-pointer-summary.directive';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoSearchBarModule,\n    IgoSearchSelectorModule,\n    IgoSearchResultsModule,\n    IgoSearchSettingsModule\n  ],\n  exports: [\n    IgoSearchBarModule,\n    IgoSearchSelectorModule,\n    IgoSearchResultsModule,\n    IgoSearchSettingsModule,\n    SearchPointerSummaryDirective\n  ],\n  declarations: [SearchPointerSummaryDirective]\n})\nexport class IgoSearchModule {\n  static forRoot(): ModuleWithProviders<IgoSearchModule> {\n    return {\n      ngModule: IgoSearchModule,\n      providers: [\n        SearchService,\n        provideSearchSourceService(),\n        provideDefaultIChercheSearchResultFormatter(),\n        provideDefaultCoordinatesSearchResultFormatter(),\n        provideILayerSearchResultFormatter()\n      ]\n    };\n  }\n}\n","<igo-flexible #flex\n  collapsedMobile=\"51px\"\n  expandedMobile=\"300px\"\n  [state]=\"state\"\n  (swipeup)=\"swipe($event.type)\"\n  (swipedown)=\"swipe($event.type)\">\n\n  <igo-panel [title]=\"title\">\n    <button\n      mat-icon-button\n      panelLeftButton\n      (click)=\"toggle()\">\n      <mat-icon [svgIcon]=\"['collapsed', 'initial'].indexOf(flex.state) >= 0 ? 'arrow_upward' : 'arrow_downward'\"></mat-icon>\n    </button>\n\n    <button mat-icon-button panelRightButton class=\"igo-icon-button\" (click)=\"zoomToFeatureExtent()\" *ngIf=\"feature.geometry\">\n      <mat-icon svgIcon=\"zoom-in\"></mat-icon>\n    </button>\n\n    <igo-feature-details [feature]=\"feature\"></igo-feature-details>\n  </igo-panel>\n\n</igo-flexible>\n","import { Component, Input, Output, EventEmitter } from '@angular/core';\n\nimport { FlexibleState, getEntityTitle } from '@igo2/common';\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\nimport { Feature } from '../feature/shared/feature.interfaces';\nimport { FeatureMotion } from '../feature/shared/feature.enums';\nimport { moveToOlFeatures } from '../feature/shared/feature.utils';\nimport { IgoMap } from '../map/shared/map';\n\n@Component({\n  selector: 'igo-toast',\n  templateUrl: './toast.component.html',\n  styleUrls: ['./toast.component.scss']\n})\nexport class ToastComponent {\n  static SWIPE_ACTION = {\n    UP: 'swipeup',\n    DOWN: 'swipedown'\n  };\n  private format = new olFormatGeoJSON();\n\n  @Input()\n  get expanded(): boolean {\n    return this._expanded;\n  }\n  set expanded(value: boolean) {\n    this.state = value ? 'expanded' : 'collapsed';\n    this._expanded = value;\n  }\n  private _expanded: boolean;\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get feature(): Feature {\n    return this._feature;\n  }\n  set feature(value: Feature) {\n    this._feature = value;\n  }\n  private _feature: Feature;\n\n  @Output() opened = new EventEmitter<boolean>();\n\n  public state: FlexibleState;\n\n  /**\n   * @internal\n   */\n  get title(): string { return getEntityTitle(this.feature); }\n\n  constructor() {}\n\n  toggle() {\n    this.expanded = !this.expanded;\n    this.opened.emit(this.expanded);\n  }\n\n  zoomToFeatureExtent() {\n    if (this.feature.geometry) {\n      const olFeature = this.format.readFeature(this.feature, {\n        dataProjection: this.feature.projection,\n        featureProjection: this.map.projection\n      });\n      moveToOlFeatures(this.map, [olFeature], FeatureMotion.Zoom);\n    }\n  }\n\n  swipe(action: string) {\n    if (action === ToastComponent.SWIPE_ACTION.UP) {\n      if (!this.expanded) {\n        this.toggle();\n      }\n    } else if (action === ToastComponent.SWIPE_ACTION.DOWN) {\n      if (this.expanded) {\n        this.toggle();\n      }\n    }\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule, IgoFlexibleModule } from '@igo2/common';\n\nimport { IgoFeatureModule } from '../feature/feature.module';\nimport { ToastComponent } from './toast.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatButtonModule,\n    IgoPanelModule,\n    IgoFlexibleModule,\n    IgoFeatureModule\n  ],\n  exports: [ToastComponent],\n  declarations: [ToastComponent]\n})\nexport class IgoToastModule {\n  static forRoot(): ModuleWithProviders<IgoToastModule> {\n    return {\n      ngModule: IgoToastModule\n    };\n  }\n}\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { OnUpdateInputs, WidgetComponent } from '@igo2/common';\n\nimport { Layer } from '../../../layer/shared/layers/layer';\nimport { IgoMap } from '../../../map/shared/map';\n\n@Component({\n  selector: 'igo-ogc-filter',\n  templateUrl: './ogc-filter.component.html',\n  styleUrls: ['./ogc-filter.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class OgcFilterComponent implements OnUpdateInputs, WidgetComponent {\n\n  @Input() layer: Layer;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Event emitted on complete\n   */\n  @Output() complete = new EventEmitter<void>();\n\n  /**\n   * Event emitted on cancel\n   */\n  @Output() cancel = new EventEmitter<void>();\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * Implemented as part of OnUpdateInputs\n   */\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n\n  /**\n   * On close, emit the cancel event\n   */\n  onClose() {\n    this.cancel.emit();\n  }\n\n}\n","<igo-ogc-filterable-item\n  igoListItem\n  [layer]=\"layer\"\n  [header]=\"false\" \n  [map]=\"map\" >\n</igo-ogc-filterable-item>","import { InjectionToken } from '@angular/core';\n\nimport { Widget, WidgetService } from '@igo2/common';\n\nimport { OgcFilterComponent } from './ogc-filter/ogc-filter.component';\n\nexport const OgcFilterWidget = new InjectionToken<Widget>('OgcFilterWidget');\n\nexport function ogcFilterWidgetFactory(widgetService: WidgetService): Widget {\n  return widgetService.create(OgcFilterComponent);\n}\n\nexport function provideOgcFilterWidget() {\n  return {\n    provide: OgcFilterWidget,\n    useFactory: ogcFilterWidgetFactory,\n    deps: [WidgetService]\n  };\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { IgoFilterModule } from '../../../filter/filter.module';\nimport { OgcFilterComponent } from './ogc-filter.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatButtonModule,\n    IgoLanguageModule,\n    IgoFilterModule\n  ],\n  exports: [OgcFilterComponent],\n  declarations: [OgcFilterComponent]\n})\nexport class IgoOgcFilterModule {}\n","import {\n  Workspace,\n  WorkspaceOptions\n} from '@igo2/common';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\n\nexport interface WfsWorkspaceOptions extends WorkspaceOptions {\n  layer: VectorLayer;\n  map: IgoMap;\n}\n\nexport class WfsWorkspace extends Workspace {\n\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  get layer(): VectorLayer { return this.options.layer; }\n\n  get map(): IgoMap { return this.options.map; }\n\n  constructor(protected options: WfsWorkspaceOptions) {\n    super(options);\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\n      if (mapResolution > this.layer.minResolution && mapResolution < this.layer.maxResolution) {\n        this.inResolutionRange$.next(true);\n      } else {\n        this.inResolutionRange$.next(false);\n      }\n    });\n  }\n\n  public getLayerWksOptionTabQuery(): boolean {\n    if (this.layer.options.workspace.queryOptions?.tabQuery !== undefined) {\n      return this.layer.options.workspace.queryOptions.tabQuery;\n    }\n    return true;\n  }\n\n  public getLayerWksOptionMapQuery(): boolean {\n    if (this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab !== undefined) {\n      return this.layer.options.workspace.queryOptions.mapQueryOnOpenTab;\n    }\n    return true;\n  }\n\n  private getInResolutionRange(): boolean {\n    return this.inResolutionRange$.value;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport {\n  ActionStore,\n  EntityTableTemplate,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityRecord,\n  EntityStoreStrategyFuncOptions,\n  EntityStoreFilterSelectionStrategy,\n  EntityTableColumnRenderer\n} from '@igo2/common';\n\nimport {\n  FeatureStore,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy,\n  FeatureStoreInMapExtentStrategy,\n  Feature,\n  FeatureMotion,\n  FeatureStoreInMapResolutionStrategy\n} from '../../feature';\nimport { VectorLayer } from '../../layer';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map';\nimport { SourceFieldsOptionsParams, FeatureDataSource, RelationOptions } from '../../datasource';\n\nimport { WfsWorkspace } from './wfs-workspace';\nimport { skipWhile, take } from 'rxjs/operators';\nimport { StorageService } from '@igo2/core';\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WfsWorkspaceService {\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n\n  constructor(private storageService: StorageService) {}\n\n  createWorkspace(layer: VectorLayer, map: IgoMap): WfsWorkspace {\n    if (layer.options.workspace?.enabled === false || layer.dataSource.options.edition) {\n      return;\n    }\n\n    layer.options.workspace = Object.assign({}, layer.options.workspace,\n      {\n        srcId: layer.id,\n        workspaceId: layer.id,\n        enabled: true\n      } as GeoWorkspaceOptions);\n\n    const wks = new WfsWorkspace({\n      id: layer.id,\n      title: layer.title,\n      layer,\n      map,\n      entityStore: this.createFeatureStore(layer, map),\n      actionStore: new ActionStore([]),\n      meta: {\n        tableTemplate: undefined\n      }\n    });\n    this.createTableTemplate(wks, layer);\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], {map});\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: undefined,\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n\n  private createTableTemplate(workspace: WfsWorkspace, layer: VectorLayer): EntityTableTemplate {\n    const fields = layer.dataSource.options.sourceFields || [];\n\n    const relations = layer.dataSource.options.relations || [];\n\n    if (fields.length === 0) {\n      workspace.entityStore.entities$.pipe(\n        skipWhile(val => val.length === 0),\n        take(1)\n      ).subscribe(entities => {\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n        const columnsFromFeatures = ol.getKeys()\n        .filter(\n          col => !col.startsWith('_') &&\n          col !== 'geometry' &&\n          col !== ol.getGeometryName() &&\n          !col.match(/boundedby/gi))\n        .map(key => {\n          return {\n            name: `properties.${key}`,\n            title: key,\n            renderer: EntityTableColumnRenderer.UnsanitizedHTML\n          };\n        });\n        workspace.meta.tableTemplate = {\n          selection: true,\n          sort: true,\n          columns: columnsFromFeatures\n        };\n      });\n      return;\n    }\n    const columns = fields.map((field: SourceFieldsOptionsParams) => {\n      return {\n        name: `properties.${field.name}`,\n        title: field.alias ? field.alias : field.name,\n        renderer: EntityTableColumnRenderer.UnsanitizedHTML,\n        tooltip: field.tooltip\n      };\n    });\n\n    const relationsColumn = relations.map((relation: RelationOptions) => {\n      return {\n        name: `properties.${relation.name}`,\n        title: relation.alias ? relation.alias : relation.name,\n        renderer: EntityTableColumnRenderer.Icon,\n        icon: relation.icon,\n        parent: relation.parent,\n        type: 'relation',\n        tooltip: relation.tooltip,\n        onClick: () => {\n            this.ws$.next(relation.title);\n        },\n        cellClassFunc: () => {\n          return { 'class_icon': true };\n        }\n      };\n    });\n\n    columns.push(...relationsColumn);\n    workspace.meta.tableTemplate = {\n      selection: true,\n      sort: true,\n      columns\n    };\n  }\n  private createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<object>) => {\n      return record.state.inMapExtent === true && record.state.inMapResolution === true;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport {\n  ActionStore,\n  EntityRecord,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy,\n  EntityStoreStrategyFuncOptions,\n  EntityTableColumnRenderer,\n  EntityTableTemplate } from '@igo2/common';\nimport { StorageService } from '@igo2/core';\nimport { skipWhile, take } from 'rxjs/operators';\nimport { RelationOptions, SourceFieldsOptionsParams, WMSDataSource } from '../../datasource';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { WFSDataSourceOptions } from '../../datasource/shared/datasources/wfs-datasource.interface';\nimport {\n  Feature,\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreInMapExtentStrategy,\n  FeatureStoreInMapResolutionStrategy,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy } from '../../feature';\n\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\nimport { ImageLayer, LayerService, LayersLinkProperties, LinkedProperties, VectorLayer } from '../../layer';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { WfsWorkspace } from './wfs-workspace';\n\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WmsWorkspaceService {\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n\n  constructor(private layerService: LayerService, private storageService: StorageService) { }\n\n  createWorkspace(layer: ImageLayer, map: IgoMap): WfsWorkspace {\n    if (\n      !layer.options.workspace ||\n      map.layers.find(lay => lay.id === layer.id + '.WfsWorkspaceTableDest') ||\n      layer.dataSource.options.edition) {\n      return;\n    }\n    const dataSource: WMSDataSource = layer.dataSource as WMSDataSource ;\n    const wmsLinkId = layer.id + '.WmsWorkspaceTableSrc';\n    const wfsLinkId = layer.id + '.WfsWorkspaceTableDest';\n    if (!layer.options.linkedLayers) {\n      layer.options.linkedLayers = { linkId: wmsLinkId, links: [] };\n    }\n    const linkProperties = {\n      bidirectionnal: true,\n      syncedDelete: true,\n      linkedIds: [wfsLinkId],\n      properties: [\n        LinkedProperties.ZINDEX,\n        LinkedProperties.VISIBLE]\n    } as LayersLinkProperties;\n\n    if (!layer.options.workspace?.minResolution) {\n       linkProperties.properties.push(LinkedProperties.MINRESOLUTION);\n    }\n    let hasOgcFilters = false;\n    if ((dataSource.options as OgcFilterableDataSourceOptions).ogcFilters?.enabled) {\n      linkProperties.properties.push(LinkedProperties.OGCFILTERS);\n      hasOgcFilters = true;\n    }\n    if (!layer.options.workspace?.maxResolution) {\n      linkProperties.properties.push(LinkedProperties.MAXRESOLUTION);\n    }\n\n    let clonedLinks: LayersLinkProperties[] = [];\n    if (layer.options.linkedLayers.links) {\n      clonedLinks = JSON.parse(JSON.stringify(layer.options.linkedLayers.links));\n    }\n    clonedLinks.push(linkProperties);\n\n    layer.options.linkedLayers.linkId = layer.options.linkedLayers.linkId ? layer.options.linkedLayers.linkId : wmsLinkId,\n      layer.options.linkedLayers.links = clonedLinks;\n    interface WFSoptions extends WFSDataSourceOptions, OgcFilterableDataSourceOptions { }\n\n    let wks;\n    let wksLayerOption = {\n      srcId: layer.id,\n      workspaceId: undefined,\n      enabled: false,\n      queryOptions: {\n        mapQueryOnOpenTab: layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\n        tabQuery: layer.options.workspace?.queryOptions?.tabQuery\n      },\n      pageSize: layer.options.workspace?.pageSize,\n      pageSizeOptions: layer.options.workspace?.pageSizeOptions\n    };\n\n    this.layerService\n      .createAsyncLayer({\n        isIgoInternalLayer: true,\n        id: wfsLinkId,\n        linkedLayers: {\n          linkId: wfsLinkId\n        },\n        workspace: wksLayerOption,\n        showInLayerList: false,\n        opacity: 0,\n        title: layer.title,\n        minResolution: layer.options.workspace?.minResolution || layer.minResolution || 0,\n        maxResolution: layer.options.workspace?.maxResolution || layer.maxResolution || Infinity,\n        sourceOptions: {\n          download: dataSource.options.download,\n          type: 'wfs',\n          url: dataSource.options.urlWfs || dataSource.options.url,\n          queryable: true,\n          relations: dataSource.options.relations,\n          queryTitle: (dataSource.options as QueryableDataSourceOptions).queryTitle,\n          queryFormatAsWms: (dataSource.options as QueryableDataSourceOptions).queryFormatAsWms,\n          params: dataSource.options.paramsWFS,\n          ogcFilters: Object.assign({}, dataSource.ogcFilters$.value, {enabled: hasOgcFilters}),\n          sourceFields: dataSource.options.sourceFields || undefined\n        } as WFSoptions\n      })\n      .subscribe((workspaceLayer: VectorLayer) => {\n        map.addLayer(workspaceLayer);\n        layer.ol.setProperties({ linkedLayers: { linkId: layer.options.linkedLayers.linkId, links: clonedLinks } }, false);\n        workspaceLayer.dataSource.ol.refresh();\n\n        if (!layer.options.workspace?.enabled) {\n          return;\n        }\n        wks = new WfsWorkspace({\n          id: layer.id,\n          title: layer.title,\n          layer: workspaceLayer,\n          map,\n          entityStore: this.createFeatureStore(workspaceLayer, map),\n          actionStore: new ActionStore([]),\n          meta: {\n            tableTemplate: undefined\n          }\n        });\n        this.createTableTemplate(wks, workspaceLayer);\n\n        workspaceLayer.options.workspace.workspaceId = workspaceLayer.id;\n        layer.options.workspace = Object.assign({}, layer.options.workspace,\n          {\n            enabled: true,\n            srcId: layer.id,\n            workspaceId: workspaceLayer.id,\n            queryOptions: {\n              mapQueryOnOpenTab: layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\n              tabQuery: layer.options.workspace?.queryOptions?.tabQuery\n            },\n            pageSize: layer.options.workspace?.pageSize,\n            pageSizeOptions: layer.options.workspace?.pageSizeOptions\n          } as GeoWorkspaceOptions);\n\n        delete dataSource.options.download;\n        return wks;\n\n      });\n\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], { map });\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: undefined,\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n\n  private createTableTemplate(workspace: WfsWorkspace, layer: VectorLayer): EntityTableTemplate {\n    const fields = layer.dataSource.options.sourceFields || [];\n\n    const relations = layer.dataSource.options.relations || [];\n\n    if (fields.length === 0) {\n      workspace.entityStore.entities$.pipe(\n        skipWhile(val => val.length === 0),\n        take(1)\n      ).subscribe(entities => {\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n        const columnsFromFeatures = ol.getKeys()\n          .filter(\n            col => !col.startsWith('_') &&\n              col !== 'geometry' &&\n              col !== ol.getGeometryName() &&\n              !col.match(/boundedby/gi))\n          .map(key => {\n            return {\n              name: `properties.${key}`,\n              title: key,\n              renderer: EntityTableColumnRenderer.UnsanitizedHTML\n            };\n          });\n        workspace.meta.tableTemplate = {\n          selection: true,\n          sort: true,\n          columns: columnsFromFeatures\n        };\n      });\n      return;\n    }\n    const columns = fields.map((field: SourceFieldsOptionsParams) => {\n      return {\n        name: `properties.${field.name}`,\n        title: field.alias ? field.alias : field.name,\n        renderer: EntityTableColumnRenderer.UnsanitizedHTML,\n        tooltip: field.tooltip\n      };\n    });\n\n    const relationsColumn = relations.map((relation: RelationOptions) => {\n      return {\n        name: `properties.${relation.name}`,\n        title: relation.alias ? relation.alias : relation.name,\n        renderer: EntityTableColumnRenderer.Icon,\n        icon: relation.icon,\n        parent: relation.parent,\n        type: 'relation',\n        tooltip: relation.tooltip,\n        onClick: () => {\n            this.ws$.next(relation.title);\n        },\n        cellClassFunc: () => {\n          return { 'class_icon': true };\n        }\n      };\n    });\n\n    columns.push(...relationsColumn);\n    workspace.meta.tableTemplate = {\n      selection: true,\n      sort: true,\n      columns\n    };\n  }\n\n  private createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<object>) => {\n      return record.state.inMapExtent === true && record.state.inMapResolution === true;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n}\n","import { LanguageService } from '@igo2/core';\nimport { Component, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nexport interface DialogData {\n  type: string;\n  cancel: boolean;\n}\n\n@Component({\n    selector: 'igo-confirmation-popup-component',\n    templateUrl: './confirmation-popup.component.html',\n    styleUrls: ['./confirmation-popup.component.scss']\n  })\n  export class ConfirmationPopupComponent {\n\n    constructor(\n      public dialogRef: MatDialogRef<ConfirmationPopupComponent>,\n      public languageService: LanguageService,\n      @Inject(MAT_DIALOG_DATA) public data: {type: string, cancel: boolean}) {}\n\n    cancelAction() {\n      this.data.cancel = true;\n      this.dialogRef.close(this.data.cancel);\n    }\n\n    confirmedAction() {\n      this.data.cancel = false;\n      this.dialogRef.close(this.data.cancel);\n    }\n  }\n","<div mat-dialog-content>\n  <p class=\"mat-typography\">{{data.type === 'add' ?\n    languageService.translate.instant('igo.geo.workspace.addConfirmation') :\n    languageService.translate.instant('igo.geo.workspace.deleteConfirmation')}}</p>\n</div>\n<div mat-dialog-actions>\n  <button\n    mat-raised-button\n    color=\"primary\"\n    (click)=\"confirmedAction()\">Ok\n  </button>\n  <button\n    mat-raised-button\n    (click)=\"cancelAction()\">{{languageService.translate.instant('igo.geo.workspace.cancel')}}\n  </button>\n</div>","import { MatDialog } from '@angular/material/dialog';\nimport {\n  Workspace,\n  WorkspaceOptions,\n  EntityRecord\n} from '@igo2/common';\nimport { ConfigService } from '@igo2/core';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { ImageLayer, VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\nimport { EditionWorkspaceService } from './edition-workspace.service';\nimport { ConfirmationPopupComponent } from '../confirmation-popup/confirmation-popup.component';\nimport { DrawControl } from '../../geometry';\nimport { createInteractionStyle, GeometryType } from '../../draw';\nimport { featureToOl } from '../../feature';\n\nimport type { default as OlGeometryType } from 'ol/geom/GeometryType';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlVectorSource from 'ol/source/Vector';\nimport * as OlStyle from 'ol/style';\nimport OlModify from 'ol/interaction/Modify';\nimport Collection from 'ol/Collection';\nimport OlFeature from 'ol/Feature';\nimport { FeatureDataSource } from '../../datasource/shared';\n\nexport interface EditionWorkspaceOptions extends WorkspaceOptions {\n  layer: ImageLayer | VectorLayer;\n  map: IgoMap;\n}\n\nexport class EditionWorkspace extends Workspace {\n\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  get layer(): ImageLayer | VectorLayer { return this.options.layer; }\n\n  get map(): IgoMap { return this.options.map; }\n\n  private drawControl: DrawControl;\n  private drawEnd$$: Subscription;\n  private olDrawingLayerSource = new OlVectorSource();\n  private olDrawingLayer: VectorLayer;\n  public geometryType = GeometryType; // Reference to the GeometryType enum\n  public modify; // Reference to the ol interaction\n\n  public modifyStyle = new OlStyle.Style({\n    stroke: new OlStyle.Stroke({\n      color: 'rgba(255,255,255,1)',\n      width: 1\n    }),\n    fill: new OlStyle.Fill({\n      color: 'rgba(0,161,222,1)'\n    }),\n    image: new OlStyle.Circle({\n      radius: 7,\n      stroke: new OlStyle.Stroke({\n        color: 'rgba(255,255,255,1)',\n        width: 1\n      }),\n      fill: new OlStyle.Fill({\n        color: 'rgba(0,161,222,1)'\n      })\n    })\n  });\n\n  private filterClauseFunc = (record: EntityRecord<object>) => {\n    return record.state.newFeature === true;\n  };\n\n  public fillColor: string;\n  public strokeColor: string;\n  public strokeWidth: number;\n\n  constructor(\n    protected options: EditionWorkspaceOptions,\n    private editionWorkspaceService: EditionWorkspaceService,\n    private dialog: MatDialog,\n    private configService: ConfigService) {\n    super(options);\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\n      if (mapResolution > this.layer.minResolution && mapResolution < this.layer.maxResolution) {\n        this.inResolutionRange$.next(true);\n      } else {\n        this.inResolutionRange$.next(false);\n      }\n    });\n\n    this.drawControl = this.createDrawControl();\n    this.drawControl.setGeometryType(this.geometryType.Point as any);\n\n    this.map.removeLayer(this.olDrawingLayer);\n\n    this.olDrawingLayer = new VectorLayer({\n      id: 'igo-draw-layer',\n      title: 'edition',\n      zIndex: 300,\n      source: new FeatureDataSource(),\n      showInLayerList: false,\n      exportable: false,\n      browsable: false,\n      workspace: {\n        enabled: false\n      },\n    });\n  }\n\n  private getInResolutionRange(): boolean {\n    return this.inResolutionRange$.value;\n  }\n\n  deleteFeature(feature, workspace) {\n    setTimeout(() => {\n      const dialogRef = this.dialog.open(ConfirmationPopupComponent, {\n        disableClose: false,\n        data: {type: 'delete'}\n    });\n\n      dialogRef.afterClosed().subscribe(result => {\n        if (result === false) {\n          const baseUrl = workspace.layer.dataSource.options.edition.baseUrl;\n          const deleteUrl = workspace.layer.dataSource.options.edition.deleteUrl;\n          let id;\n          let url;\n          if (baseUrl) {\n            url = this.configService.getConfig('edition.url') + baseUrl + '?' + deleteUrl;\n          } else {\n            url = this.configService.getConfig('edition.url') + deleteUrl;\n          }\n\n          for (const column of workspace.meta.tableTemplate.columns) {\n            for (const property in feature.properties) {\n              let columnName = column.name;\n              if (columnName.includes('properties.')) {\n                columnName = columnName.split('.')[1];\n              }\n              if (columnName === property && column.primary === true) {\n                id = feature.properties[property];\n              }\n            }\n          }\n          if (url) {\n            url += id;\n            this.editionWorkspaceService.deleteFeature(workspace, url);\n          }\n        }\n      });\n    }, 250);\n  }\n\n  editFeature(feature, workspace: EditionWorkspace) {\n    feature.edition = true;\n    let id;\n    let find = false;\n    const editionOpt = workspace.layer.dataSource.options.edition;\n    for (const column of workspace.meta.tableTemplate.columns ) {\n\n      // Update domain list\n      if (column.type === 'list' || column.type === 'autocomplete') {\n        this.editionWorkspaceService.getDomainValues(column.relation.table).subscribe(result => {\n          column.domainValues = result;\n        });\n      }\n      if (find === false) {\n        for (const property in feature.properties) {\n          let columnName = column.name;\n          if (columnName.includes('properties.')) {\n            columnName = columnName.split('.')[1];\n          }\n          if (columnName === property && column.primary === true) {\n            id = feature.properties[property];\n            find = true;\n            break;\n          }\n        }\n      }\n    }\n    if (id) {\n      feature.original_properties = JSON.parse(JSON.stringify(feature.properties));\n      feature.original_geometry = feature.geometry;\n      feature.idkey = id;\n      this.addFeatureToStore(feature, workspace);\n    } else {\n      // Only for edition with it's own geometry\n      if (!feature.newFeature && editionOpt.geomType) {\n        feature.newFeature = true;\n        this.editionWorkspaceService.adding$.next(true);\n        workspace.entityStore.state.updateAll({ newFeature: false });\n        workspace.entityStore.stateView.filter(this.filterClauseFunc);\n        if (editionOpt.addWithDraw) {\n          const geometryType = editionOpt.geomType;\n          this.onGeometryTypeChange(geometryType, feature, workspace);\n        } else {\n          workspace.entityStore.insert(feature);\n          workspace.entityStore.state.update(feature, { newFeature: true }, true);\n        }\n      }\n    }\n  }\n\n  /**\n   * Create a Draw Control\n   * @param fillColor the fill color\n   * @param strokeColor the stroke color\n   * @param strokeWidth the stroke width\n   * @returns a Draw Control\n   */\n  createDrawControl(fillColor?: string, strokeColor?: string, strokeWidth?: number) {\n    const drawControl = new DrawControl({\n      geometryType: undefined,\n      drawingLayerSource: this.olDrawingLayerSource,\n      drawingLayerStyle: new OlStyle.Style({}),\n      interactionStyle: createInteractionStyle(fillColor, strokeColor, strokeWidth),\n    });\n\n    return drawControl;\n  }\n\n  /**\n   * Called when the user selects a new geometry type\n   * @param geometryType the geometry type selected by the user\n   */\n  onGeometryTypeChange(geometryType: typeof OlGeometryType, feature, workspace: EditionWorkspace) {\n      this.drawControl.setGeometryType(geometryType);\n      this.toggleDrawControl(feature, workspace);\n    }\n\n  /**\n   * Activate the correct control\n   */\n  private toggleDrawControl(feature, workspace: EditionWorkspace) {\n    this.deactivateDrawControl();\n    this.activateDrawControl(feature, workspace);\n  }\n\n  /**\n   * Deactivate the active draw control\n   */\n  public deactivateDrawControl() {\n    if (!this.drawControl) {\n      return;\n    }\n\n    if (this.drawEnd$$) {\n      this.drawEnd$$.unsubscribe();\n    }\n\n    this.drawControl.setOlMap(undefined);\n  }\n\n  /**\n   * Activate a given control\n   */\n  private activateDrawControl(feature, workspace: EditionWorkspace) {\n    this.drawEnd$$ = this.drawControl.end$.subscribe((olGeometry: OlGeometry) => {\n      this.addFeatureToStore(feature, workspace, olGeometry);\n    });\n\n    this.drawControl.setOlMap(this.map.ol, true);\n  }\n\n  /**\n   * Add a feature to layer. The loading strategy of the layer\n   * will trigger and add the feature to the workspace store.\n   * @internal\n   */\n  private addFeatureToStore(feature, workspace: EditionWorkspace, olGeometry?: OlGeometry) {\n    const projection = this.map.ol.getView().getProjection();\n    let geometry = feature.geometry;\n\n    // If an olGeometry is passed, it means that it is a new feature\n    if (olGeometry) {\n      workspace.entityStore.insert(feature);\n      workspace.entityStore.state.update(feature, { newFeature: true }, true);\n      geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\n        featureProjection: projection,\n        dataProjection: 'EPSG:4326'\n      }) as any;\n\n      feature.geometry = geometry;\n    }\n\n    feature.projection = 'EPSG:4326';\n\n    const featureOl = featureToOl(feature, projection.getCode());\n\n    this.olDrawingLayer.dataSource.ol.clear();\n    this.olDrawingLayer.dataSource.ol.addFeature(featureOl);\n    this.map.addLayer(this.olDrawingLayer);\n\n    this.deactivateDrawControl();\n    this.createModifyInteraction(featureOl, feature, workspace);\n  }\n\n  /**\n   * Delete drawings layer and source from the map AND feature from the entity store.\n   * Layer refresh will automatically add the new feature into the store.\n   */\n  deleteDrawings() {\n    this.map.removeLayer(this.olDrawingLayer);\n    this.olDrawingLayerSource.clear();\n    this.map.ol.removeInteraction(this.modify);\n  }\n\n  /**\n   * Create a modify interaction to allow a geometry change one feature at the time (drag and drop)\n   */\n  createModifyInteraction(olFeature: OlFeature<OlGeometry>, feature, workspace: EditionWorkspace) {\n    this.map.ol.removeInteraction(this.modify);\n    const olCollection = new Collection([olFeature], { unique: true });\n    this.modify = new OlModify({\n      features: olCollection\n    });\n\n    this.map.ol.addInteraction(this.modify);\n    olCollection.forEach(feature => {\n      feature.setStyle(this.modifyStyle);\n    });\n\n    this.modify.on('modifyend', (event) => {\n      const olGeometry = event.features.getArray()[0]?.getGeometry();\n      if (olGeometry) {\n        this.addFeatureToStore(feature, workspace, olGeometry);\n      }\n    });\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpErrorResponse, HttpHeaders } from '@angular/common/http';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport {\n  ActionStore,\n  EntityRecord,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy,\n  EntityStoreStrategyFuncOptions,\n  EntityTableColumnRenderer,\n  EntityTableTemplate,\n  EntityTableButton} from '@igo2/common';\nimport { ConfigService, LanguageService, MessageService, StorageService } from '@igo2/core';\nimport { AuthInterceptor } from '@igo2/auth';\nimport { catchError, map, skipWhile, take } from 'rxjs/operators';\nimport { RelationOptions, SourceFieldsOptionsParams, WMSDataSource } from '../../datasource';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { WFSDataSourceOptions } from '../../datasource/shared/datasources/wfs-datasource.interface';\nimport {\n  Feature,\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreInMapExtentStrategy,\n  FeatureStoreInMapResolutionStrategy,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy} from '../../feature';\n\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\nimport { ImageLayer, LayerService, LayersLinkProperties, LinkedProperties, VectorLayer } from '../../layer';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { EditionWorkspace } from './edition-workspace';\n\nimport olFeature from 'ol/Feature';\nimport olSourceImageWMS from 'ol/source/ImageWMS';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { BehaviorSubject, Observable, throwError } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class EditionWorkspaceService {\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n  public adding$ = new BehaviorSubject<boolean>(false);\n  public relationLayers$ = new BehaviorSubject<ImageLayer[] | VectorLayer[]>(undefined);\n  public rowsInMapExtentCheckCondition$ = new BehaviorSubject<boolean>(true);\n  public loading = false;\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    private layerService: LayerService,\n    private storageService: StorageService,\n    private configService: ConfigService,\n    private messageService: MessageService,\n    private languageService: LanguageService,\n    private http: HttpClient,\n    private dialog: MatDialog,\n    public authInterceptor?: AuthInterceptor) { }\n\n  createWorkspace(layer: ImageLayer, map: IgoMap): EditionWorkspace {\n    if (layer.options.workspace?.enabled !== true || layer.dataSource.options.edition.enabled !== true) {\n      return;\n    }\n    let wksConfig;\n    if (layer.options.workspace) {\n      wksConfig = layer.options.workspace;\n    } else {\n      wksConfig = {};\n    }\n    wksConfig.srcId = layer.id;\n    wksConfig.workspaceId = layer.id;\n    wksConfig.enabled = true;\n    wksConfig.pageSize = layer.options.workspace?.pageSize;\n    wksConfig.pageSizeOptions = layer.options.workspace?.pageSizeOptions;\n\n    const dataSource: WMSDataSource = layer.dataSource as WMSDataSource ;\n    const wmsLinkId = layer.id + '.WmsWorkspaceTableSrc';\n    const wfsLinkId = layer.id + '.WfsWorkspaceTableDest';\n    if (!layer.options.linkedLayers) {\n      layer.options.linkedLayers = { linkId: wmsLinkId, links: [] };\n    }\n    const linkProperties = {\n      bidirectionnal: true,\n      syncedDelete: true,\n      linkedIds: [wfsLinkId],\n      properties: [\n        LinkedProperties.ZINDEX,\n        LinkedProperties.VISIBLE]\n    } as LayersLinkProperties;\n\n    if (!layer.options.workspace?.minResolution) {\n       linkProperties.properties.push(LinkedProperties.MINRESOLUTION);\n    }\n    let hasOgcFilters = false;\n    if ((dataSource.options as OgcFilterableDataSourceOptions).ogcFilters?.enabled) {\n      linkProperties.properties.push(LinkedProperties.OGCFILTERS);\n      hasOgcFilters = true;\n    }\n    if (!layer.options.workspace?.maxResolution) {\n      linkProperties.properties.push(LinkedProperties.MAXRESOLUTION);\n    }\n\n    let clonedLinks: LayersLinkProperties[] = [];\n    if (layer.options.linkedLayers.links) {\n      clonedLinks = JSON.parse(JSON.stringify(layer.options.linkedLayers.links));\n    }\n    clonedLinks.push(linkProperties);\n\n    layer.options.linkedLayers.linkId = layer.options.linkedLayers.linkId ? layer.options.linkedLayers.linkId : wmsLinkId,\n      layer.options.linkedLayers.links = clonedLinks;\n    interface WFSoptions extends WFSDataSourceOptions, OgcFilterableDataSourceOptions { }\n    let wks;\n    this.layerService\n      .createAsyncLayer({\n        id: wfsLinkId,\n        linkedLayers: {\n          linkId: wfsLinkId\n        },\n        workspace: {\n          srcId: layer.id,\n          workspaceId: undefined,\n          enabled: false,\n          queryOptions: {\n            mapQueryOnOpenTab: layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\n            tabQuery: false\n          },\n          pageSize: layer.options.workspace?.pageSize,\n          pageSizeOptions: layer.options.workspace?.pageSizeOptions\n        },\n        showInLayerList: false,\n        opacity: 0,\n        title: layer.title,\n        minResolution: layer.options.workspace?.minResolution || layer.minResolution || 0,\n        maxResolution: layer.options.workspace?.maxResolution || layer.maxResolution || Infinity,\n        sourceOptions: {\n          download: dataSource.options.download,\n          type: 'wfs',\n          url: dataSource.options.urlWfs || dataSource.options.url,\n          queryable: true,\n          relations: dataSource.options.relations,\n          queryTitle: (dataSource.options as QueryableDataSourceOptions).queryTitle,\n          params: dataSource.options.paramsWFS,\n          ogcFilters: Object.assign({}, dataSource.ogcFilters$.value, {enabled: hasOgcFilters}),\n          sourceFields: dataSource.options.sourceFields || undefined,\n          edition: dataSource.options.edition\n        } as WFSoptions\n      })\n      .subscribe((workspaceLayer: VectorLayer) => {\n        map.addLayer(workspaceLayer);\n        layer.ol.setProperties({ linkedLayers: { linkId: layer.options.linkedLayers.linkId, links: clonedLinks } }, false);\n        workspaceLayer.dataSource.ol.refresh();\n\n        wks = new EditionWorkspace({\n          id: layer.id,\n          title: layer.title,\n          layer: workspaceLayer,\n          map,\n          entityStore: this.createFeatureStore(workspaceLayer, map),\n          actionStore: new ActionStore([]),\n          meta: {\n            tableTemplate: undefined\n          }\n        }, this, this.dialog, this.configService);\n        this.createTableTemplate(wks, workspaceLayer);\n\n        workspaceLayer.options.workspace.workspaceId = workspaceLayer.id;\n        layer.options.workspace = Object.assign({}, layer.options.workspace,\n          {\n            wksConfig\n          } as GeoWorkspaceOptions);\n\n        delete dataSource.options.download;\n        return wks;\n\n      });\n\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], { map });\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: undefined,\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n\n  private createTableTemplate(workspace: EditionWorkspace, layer: VectorLayer): EntityTableTemplate {\n    const fields = layer.dataSource.options.sourceFields || [];\n\n    const relations = layer.dataSource.options.relations || [];\n\n    let rendererType = EntityTableColumnRenderer.UnsanitizedHTML;\n    let buttons = [];\n    let columns = [];\n    let relationsColumn = [];\n\n    buttons = [{\n      name: 'edition',\n      title: undefined,\n      renderer: EntityTableColumnRenderer.ButtonGroup,\n      primary: false,\n      valueAccessor: () => {\n        return [{\n          editMode: false,\n          icon: 'pencil',\n          color: 'primary',\n          click: (feature) => { workspace.editFeature(feature, workspace); }\n        },\n        {\n          editMode: false,\n          icon: 'delete',\n          color: 'warn',\n          click: (feature) => { workspace.deleteFeature(feature, workspace); }\n        },\n        {\n          editMode: true,\n          icon: 'check',\n          color: 'primary',\n          disabled: this.loading,\n          click: (feature) => { this.saveFeature(feature, workspace); }\n        },\n        {\n          editMode: true,\n          icon: 'alpha-x',\n          color: 'primary',\n          disabled: this.loading,\n          click: (feature) => { this.cancelEdit(workspace, feature); }\n        }] as EntityTableButton[];\n      }\n    }];\n\n\n    if (fields.length === 0) {\n      workspace.entityStore.entities$.pipe(\n        skipWhile(val => val.length === 0),\n        take(1)\n      ).subscribe(entities => {\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n        const columnsFromFeatures = ol.getKeys()\n          .filter(\n            col => !col.startsWith('_') &&\n              col !== 'geometry' &&\n              col !== ol.getGeometryName() &&\n              !col.match(/boundedby/gi))\n          .map(key => {\n            return {\n              name: `properties.${key}`,\n              title: key,\n              renderer: rendererType,\n            };\n          });\n        workspace.meta.tableTemplate = {\n          selection: false,\n          sort: true,\n          columns: columnsFromFeatures\n        };\n      });\n      return;\n    }\n\n    columns = fields.map((field: SourceFieldsOptionsParams) => {\n\n      let column = {\n        name: `properties.${field.name}`,\n        title: field.alias ? field.alias : field.name,\n        renderer: rendererType,\n        valueAccessor: undefined,\n        cellClassFunc: () => {\n          const cellClass = {};\n          if (field.type) {\n            cellClass[`class_${field.type}`] = true;\n            return cellClass;\n          }\n        },\n        primary: field.primary === true ? true : false,\n        visible: field.visible,\n        validation: field.validation,\n        type: field.type,\n        domainValues: undefined,\n        relation: undefined,\n        multiple: field.multiple,\n        step: field.step,\n        tooltip: field.tooltip\n      };\n\n      if (field.type === 'list' || field.type === 'autocomplete') {\n        this.getDomainValues(field.relation.table).subscribe(result => {\n          column.domainValues = result;\n          column.relation = field.relation;\n        });\n      }\n      return column;\n    });\n\n    relationsColumn = relations.map((relation: RelationOptions) => {\n      return {\n        name: `properties.${relation.name}`,\n        title: relation.alias ? relation.alias : relation.name,\n        renderer: EntityTableColumnRenderer.Icon,\n        icon: relation.icon,\n        parent: relation.parent,\n        type: 'relation',\n        tooltip: relation.tooltip,\n        onClick: () => {\n          if (this.adding$.getValue() === false) {\n            this.ws$.next(relation.title);\n          }\n        },\n        cellClassFunc: () => {\n          return { 'class_icon': true };\n        }\n      };\n    });\n\n    columns.push(...relationsColumn);\n    columns.push(...buttons);\n\n    workspace.meta.tableTemplate = {\n      selection: false,\n      sort: true,\n      columns\n    };\n  }\n\n  private createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<object>) => {\n      return record.state.inMapExtent === true && record.state.inMapResolution === true;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n\n  public saveFeature(feature, workspace: EditionWorkspace) {\n    if (!this.validateFeature(feature, workspace)){\n      return false;\n    }\n\n    this.sanitizeParameter(feature, workspace);\n\n    let url = this.configService.getConfig('edition.url');\n\n    if (workspace.layer.dataSource.options.edition.baseUrl) {\n      url += workspace.layer.dataSource.options.edition.baseUrl;\n    }\n\n    if (feature.newFeature) {\n      url += workspace.layer.dataSource.options.edition.addUrl;\n\n      const addHeaders = workspace.layer.dataSource.options.edition.addHeaders;\n      const headers = new HttpHeaders(addHeaders);\n\n      this.addFeature(feature, workspace, url, headers);\n    } else {\n      if (workspace.layer.dataSource.options.edition.modifyProtocol !== \"post\") {\n        url += '?' + workspace.layer.dataSource.options.edition.modifyUrl + feature.idkey;\n      }\n      else {\n        url += workspace.layer.dataSource.options.edition.modifyUrl;\n      }\n\n      const protocole = workspace.layer.dataSource.options.edition.modifyProtocol;\n      const modifyHeaders = workspace.layer.dataSource.options.edition.modifyHeaders;\n      const headers = new HttpHeaders(modifyHeaders);\n\n      this.modifyFeature(feature, workspace, url, headers, protocole);\n    }\n  }\n\n  public addFeature(feature, workspace: EditionWorkspace, url: string, headers: {[key: string]: any}) {\n    // TODO: adapt to any kind of geometry\n    if (workspace.layer.dataSource.options.edition.hasGeometry) {\n      //feature.properties[geom] = feature.geometry;\n      feature.properties[\"longitude\"] = feature.geometry.coordinates[0];\n      feature.properties[\"latitude\"] = feature.geometry.coordinates[1];\n    }\n\n    for (const property in feature.properties) {\n      for (const sf of workspace.layer.dataSource.options.sourceFields) {\n        if (sf.name === property && sf.validation?.readonly) {\n          delete feature.properties[property];\n        }\n      }\n    }\n\n    this.loading = true;\n    this.http.post(`${url}`, feature.properties, { headers: headers }).subscribe(\n      () => {\n        this.loading = false;\n        workspace.entityStore.stateView.clear();\n        workspace.deleteDrawings();\n        workspace.entityStore.delete(feature);\n\n        const message = this.languageService.translate.instant(\n          'igo.geo.workspace.addSuccess'\n        );\n        this.messageService.success(message);\n\n        this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\n        this.adding$.next(false);\n        this.rowsInMapExtentCheckCondition$.next(true);\n      },\n      error => {\n        this.loading = false;\n        error.error.caught = true;\n        const genericErrorMessage = this.languageService.translate.instant(\n          'igo.geo.workspace.addError'\n        );\n        const messages = workspace.layer.dataSource.options.edition.messages;\n        if (messages) {\n          let text;\n          messages.forEach(message => {\n            const key = Object.keys(message)[0];\n            if (error.error.message.includes(key)) {\n              text = message[key];\n              this.messageService.error(text);\n            }\n          });\n          if (!text) {\n            this.messageService.error(genericErrorMessage);\n          }\n        } else {\n          this.messageService.error(genericErrorMessage);\n        }\n      }\n    );\n  }\n\n  public deleteFeature(workspace: EditionWorkspace, url: string) {\n    this.loading = true;\n    this.http.delete(`${url}`, {}).subscribe(\n      () => {\n        this.loading = false;\n        const message = this.languageService.translate.instant(\n          'igo.geo.workspace.deleteSuccess'\n        );\n        this.messageService.success(message);\n\n        this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\n        for (const relation of workspace.layer.options.sourceOptions.relations) {\n          workspace.map.layers.forEach((layer) => {\n            if (layer.title === relation.title) {\n              layer.dataSource.ol.refresh();\n            }\n          });\n        }\n      },\n      error => {\n        this.loading = false;\n        error.error.caught = true;\n          const genericErrorMessage = this.languageService.translate.instant(\n            'igo.geo.workspace.addError'\n          );\n          const messages = workspace.layer.dataSource.options.edition.messages;\n          if (messages) {\n            let text;\n            messages.forEach(message => {\n              const key = Object.keys(message)[0];\n              if (error.error.message.includes(key)) {\n                text = message[key];\n                this.messageService.error(text);\n              }\n            });\n            if (!text) {\n              this.messageService.error(genericErrorMessage);\n            }\n          } else {\n            this.messageService.error(genericErrorMessage);\n          }\n      }\n    );\n  }\n\n  public modifyFeature(feature, workspace: EditionWorkspace, url: string, headers: {[key: string]: any}, protocole = 'patch' ) {\n    //TODO: adapt to any kind of geometry\n    if (workspace.layer.dataSource.options.edition.hasGeometry) {\n      //feature.properties[geom] = feature.geometry;\n      feature.properties[\"longitude\"] = feature.geometry.coordinates[0];\n      feature.properties[\"latitude\"] = feature.geometry.coordinates[1];\n    }\n\n    for (const property in feature.properties) {\n      for (const sf of workspace.layer.dataSource.options.sourceFields) {\n        if ((sf.name === property && sf.validation?.readonly) || property === 'boundedBy') {\n          delete feature.properties[property];\n        }\n      }\n    }\n\n    this.loading = true;\n    this.http[protocole](`${url}`, feature.properties, { headers: headers }).subscribe(\n      () => {\n        this.loading = false;\n        this.cancelEdit(workspace, feature, true);\n\n        const message = this.languageService.translate.instant(\n          'igo.geo.workspace.modifySuccess'\n        );\n        this.messageService.success(message);\n\n        this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\n\n        let relationLayers = [];\n        for (const relation of workspace.layer.options.sourceOptions.relations) {\n          workspace.map.layers.forEach((layer) => {\n            if (layer.title === relation.title) {\n              relationLayers.push(layer);\n              layer.dataSource.ol.refresh();\n            }\n          });\n        }\n        this.relationLayers$.next(relationLayers);\n      },\n      error => {\n        this.loading = false;\n        error.error.caught = true;\n        const genericErrorMessage = this.languageService.translate.instant(\n          'igo.geo.workspace.addError'\n        );\n        const messages = workspace.layer.dataSource.options.edition.messages;\n        if (messages) {\n          let text;\n          messages.forEach(message => {\n            const key = Object.keys(message)[0];\n            if (error.error.message.includes(key)) {\n              text = message[key];\n              this.messageService.error(text);\n            }\n          });\n          if (!text) {\n            this.messageService.error(genericErrorMessage);\n          }\n        } else {\n          this.messageService.error(genericErrorMessage);\n        }\n      }\n    );\n  }\n\n  cancelEdit(workspace: EditionWorkspace, feature, fromSave = false) {\n    feature.edition = false;\n    this.adding$.next(false);\n    workspace.deleteDrawings();\n\n    if (feature.newFeature) {\n      workspace.entityStore.stateView.clear();\n      workspace.entityStore.delete(feature);\n      workspace.deactivateDrawControl();\n\n      this.rowsInMapExtentCheckCondition$.next(true);\n    } else {\n      if (!fromSave) {\n        feature.properties = feature.original_properties;\n        feature.geometry = feature.original_geometry;\n      }\n      delete feature.original_properties;\n      delete feature.original_geometry;\n    }\n  }\n\n  getDomainValues(table: string): Observable<any> {\n    let url = this.configService.getConfig('edition.url') + table;\n\n    return this.http.get<any>(url).pipe(\n      map(result => {\n        return result;\n      }),\n      catchError((err: HttpErrorResponse) => {\n        return throwError(err);\n      })\n    );\n  }\n\n  /*\n   * Refresh both wms and wfs layer\n   * A new wfs loader is used to ensure cache is not retrieving old data\n   * WMS params are updated to ensure layer is correctly refreshed\n   */\n  refreshMap(layer: VectorLayer, map: IgoMap) {\n    const wfsOlLayer = layer.dataSource.ol;\n    const loader = (extent, resolution, proj, success, failure) => {\n      layer.customWFSLoader(\n        layer.ol.getSource(),\n        layer.options.sourceOptions,\n        this.authInterceptor,\n        extent,\n        resolution,\n        proj,\n        success,\n        failure,\n        true\n      );\n    };\n    wfsOlLayer.setLoader(loader);\n    wfsOlLayer.refresh();\n\n    for (const lay of map.layers) {\n      if (\n        lay.id !== layer.id &&\n        lay.options.linkedLayers?.linkId.includes(layer.id.substr(0, layer.id.indexOf('.') - 1)) &&\n        lay.options.linkedLayers?.linkId.includes('WmsWorkspaceTableSrc')\n      )\n        {\n          const wmsOlLayer = lay.dataSource.ol as olSourceImageWMS;\n          let params = wmsOlLayer.getParams();\n          params._t = new Date().getTime();\n          wmsOlLayer.updateParams(params);\n        }\n    }\n  }\n\n  validateFeature(feature, workspace: EditionWorkspace) {\n    const translate = this.languageService.translate;\n    let message ;\n    let key;\n    let valid = true;\n    workspace.meta.tableTemplate.columns.forEach(column => {\n      if (column.hasOwnProperty('validation') && column.validation) {\n        key = getColumnKeyWithoutPropertiesTag(column.name);\n        Object.keys( column.validation).forEach((type) => {\n          switch (type) {\n            case 'mandatory': {\n              if (column.validation[type] && (!feature.properties.hasOwnProperty(key) || !feature.properties[key])) {\n                valid = false;\n                  message = translate.instant('igo.geo.formValidation.mandatory',\n                  {\n                    column: column.title\n                  }\n                );\n                this.messageService.error(message);\n              }\n              break;\n            }\n            case 'minValue': {\n              if (feature.properties.hasOwnProperty(key) && feature.properties[key] && feature.properties[key] < column.validation[type]) {\n                valid = false;\n                message = translate.instant('igo.geo.formValidation.minValue',\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n                this.messageService.error(message);\n              }\n              break;\n            }\n            case 'maxValue': {\n              if (feature.properties.hasOwnProperty(key) && feature.properties[key] && feature.properties[key] > column.validation[type]) {\n                valid = false;\n                message = translate.instant('igo.geo.formValidation.maxValue',\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n                this.messageService.error(message);\n              }\n              break;\n            }\n            case 'minLength': {\n              if (\n                feature.properties.hasOwnProperty(key) && feature.properties[key] &&\n                feature.properties[key].length < column.validation[type])\n              {\n                valid = false;\n                message = translate.instant('igo.geo.formValidation.minLength',\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n                this.messageService.error(message);\n              }\n              break;\n            }\n            case 'maxLength': {\n              if (\n                feature.properties.hasOwnProperty(key) && feature.properties[key] &&\n                feature.properties[key].length > column.validation[type])\n              {\n                valid = false;\n                message = translate.instant('igo.geo.formValidation.maxLength',\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n                this.messageService.error(message);\n              }\n              break;\n            }\n            }\n          });\n      }\n    });\n    return valid;\n  }\n\n  sanitizeParameter(feature, workspace: EditionWorkspace) {\n    workspace.meta.tableTemplate.columns.forEach(column => {\n      if (column.type === 'list' && feature.properties[getColumnKeyWithoutPropertiesTag(column.name)]) {\n        feature.properties[getColumnKeyWithoutPropertiesTag(column.name)] =\n          feature.properties[getColumnKeyWithoutPropertiesTag(column.name)].toString();\n      }\n\n    });\n  }\n\n}\n\nfunction getColumnKeyWithoutPropertiesTag(column: string) {\n  if (column.includes('properties.')) {\n    return column.split('.')[1];\n  }\n  return column;\n}\n","import {\n  Workspace,\n  WorkspaceOptions\n} from '@igo2/common';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\n\nexport interface FeatureWorkspaceOptions extends WorkspaceOptions {\n  layer: VectorLayer;\n  map: IgoMap;\n}\n\nexport class FeatureWorkspace extends Workspace {\n\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  get layer(): VectorLayer { return this.options.layer; }\n\n  get map(): IgoMap { return this.options.map; }\n\n  constructor(protected options: FeatureWorkspaceOptions) {\n    super(options);\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\n      if (mapResolution > this.layer.minResolution && mapResolution < this.layer.maxResolution) {\n        this.inResolutionRange$.next(true);\n      } else {\n        this.inResolutionRange$.next(false);\n      }\n    });\n  }\n\n  public getLayerWksOptionTabQuery(): boolean {\n    if (this.layer.options.workspace.queryOptions?.tabQuery !== undefined) {\n      return this.layer.options.workspace.queryOptions.tabQuery;\n    }\n    return true;\n  }\n\n  public getLayerWksOptionMapQuery(): boolean {\n    if (this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab !== undefined) {\n      return this.layer.options.workspace.queryOptions.mapQueryOnOpenTab;\n    }\n    return true;\n  }\n\n  private getInResolutionRange(): boolean {\n    return this.inResolutionRange$.value;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport {\n  ActionStore,\n  EntityTableTemplate,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityRecord,\n  EntityStoreStrategyFuncOptions,\n  EntityStoreFilterSelectionStrategy,\n  EntityTableColumnRenderer\n} from '@igo2/common';\n\nimport {\n  FeatureStore,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy,\n  FeatureStoreInMapExtentStrategy,\n  Feature,\n  FeatureMotion,\n  FeatureStoreInMapResolutionStrategy\n} from '../../feature';\nimport { VectorLayer } from '../../layer';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map';\nimport { SourceFieldsOptionsParams, FeatureDataSource, RelationOptions } from '../../datasource';\n\nimport { FeatureWorkspace } from './feature-workspace';\nimport { skipWhile, take } from 'rxjs/operators';\nimport { StorageService } from '@igo2/core';\n\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FeatureWorkspaceService {\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n\n  constructor(private storageService: StorageService) {}\n\n  createWorkspace(layer: VectorLayer, map: IgoMap): FeatureWorkspace {\n    if (layer.options.workspace?.enabled === false || layer.dataSource.options.edition) {\n      return;\n    }\n\n    layer.options.workspace = Object.assign({}, layer.options.workspace,\n      {\n        srcId: layer.id,\n        workspaceId: layer.id,\n        enabled: true\n      } as GeoWorkspaceOptions);\n\n\n    const wks = new FeatureWorkspace({\n      id: layer.id,\n      title: layer.title,\n      layer,\n      map,\n      entityStore: this.createFeatureStore(layer, map),\n      actionStore: new ActionStore([]),\n      meta: {\n        tableTemplate: undefined\n      }\n    });\n    this.createTableTemplate(wks, layer);\n    return wks;\n\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], {map});\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: undefined,\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n\n  private createTableTemplate(workspace: FeatureWorkspace, layer: VectorLayer): EntityTableTemplate {\n    const fields = layer.dataSource.options.sourceFields || [];\n\n    const relations = layer.dataSource.options.relations || [];\n\n    if (fields.length === 0) {\n      workspace.entityStore.entities$.pipe(\n        skipWhile(val => val.length === 0),\n        take(1)\n      ).subscribe(entities => {\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n        const columnsFromFeatures = ol.getKeys()\n        .filter(\n          col => !col.startsWith('_') &&\n          col !== 'geometry' &&\n          col !== ol.getGeometryName() &&\n          !col.match(/boundedby/gi))\n        .map(key => {\n          return {\n            name: `properties.${key}`,\n            title: key,\n            renderer: EntityTableColumnRenderer.UnsanitizedHTML\n          };\n        });\n        workspace.meta.tableTemplate = {\n          selection: true,\n          sort: true,\n          columns: columnsFromFeatures\n        };\n      });\n      return;\n    }\n    const columns = fields.map((field: SourceFieldsOptionsParams) => {\n      return {\n        name: `properties.${field.name}`,\n        title: field.alias ? field.alias : field.name,\n        renderer: EntityTableColumnRenderer.UnsanitizedHTML,\n        tooltip: field.tooltip\n      };\n    });\n\n    const relationsColumn = relations.map((relation: RelationOptions) => {\n      return {\n        name: `properties.${relation.name}`,\n        title: relation.alias ? relation.alias : relation.name,\n        renderer: EntityTableColumnRenderer.Icon,\n        icon: relation.icon,\n        parent: relation.parent,\n        type: 'relation',\n        tooltip: relation.tooltip,\n        onClick: () => {\n            this.ws$.next(relation.title);\n        },\n        cellClassFunc: () => {\n          return { 'class_icon': true };\n        }\n      };\n    });\n\n    columns.push(...relationsColumn);\n    workspace.meta.tableTemplate = {\n      selection: true,\n      sort: true,\n      columns\n    };\n  }\n\n  private createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<object>) => {\n      return record.state.inMapExtent === true && record.state.inMapResolution === true;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n}\n","import { Directive, Input, OnInit, OnDestroy, Output, EventEmitter } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { Workspace, WorkspaceStore, WorkspaceSelectorComponent } from '@igo2/common';\n\nimport { Layer, ImageLayer, VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\nimport { WFSDataSource, WMSDataSource, FeatureDataSource } from '../../datasource';\nimport { OgcFilterableDataSourceOptions } from '../../filter';\n\nimport { WfsWorkspaceService } from '../shared/wfs-workspace.service';\nimport { WmsWorkspaceService } from '../shared/wms-workspace.service';\nimport { EditionWorkspaceService } from '../shared/edition-workspace.service';\nimport { FeatureWorkspaceService } from '../shared/feature-workspace.service';\nimport { FeatureStoreInMapExtentStrategy } from '../../feature/shared/strategies/in-map-extent';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\n\n@Directive({\n  selector: '[igoWorkspaceSelector]'\n})\nexport class WorkspaceSelectorDirective implements OnInit, OnDestroy {\n\n  private layers$$: Subscription;\n  private entities$$: Subscription[] = [];\n\n  @Input() map: IgoMap;\n\n  @Output() changeWorkspace = new EventEmitter<string>();\n  @Output() disableSwitch = new EventEmitter<boolean>();\n  @Output() relationLayers = new EventEmitter<ImageLayer[] | VectorLayer[]>();\n  @Output() rowsInMapExtentCheckCondition = new EventEmitter<boolean>();\n\n  get workspaceStore(): WorkspaceStore {\n    return this.component.store;\n  }\n\n  constructor(\n    private component: WorkspaceSelectorComponent,\n    private wfsWorkspaceService: WfsWorkspaceService,\n    private wmsWorkspaceService: WmsWorkspaceService,\n    private editionWorkspaceService: EditionWorkspaceService,\n    private featureWorkspaceService: FeatureWorkspaceService\n  ) {}\n\n  ngOnInit() {\n    this.layers$$ = this.map.layers$\n      .pipe(debounceTime(50))\n      .subscribe((layers: Layer[]) =>\n        this.onLayersChange(layers)\n      );\n\n    this.featureWorkspaceService.ws$.subscribe((ws) => { this.changeWorkspace.emit(ws); });\n    this.wmsWorkspaceService.ws$.subscribe((ws) => { this.changeWorkspace.emit(ws); });\n    this.wfsWorkspaceService.ws$.subscribe((ws) => { this.changeWorkspace.emit(ws); });\n    this.editionWorkspaceService.ws$.subscribe((ws) => { this.changeWorkspace.emit(ws); });\n    this.editionWorkspaceService.adding$.subscribe((adding) => { this.disableSwitch.emit(adding); });\n    this.editionWorkspaceService.relationLayers$.subscribe((layers) => { this.relationLayers.emit(layers); });\n    this.editionWorkspaceService.rowsInMapExtentCheckCondition$.subscribe((condition) => {\n      this.rowsInMapExtentCheckCondition.emit(condition);\n    });\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n    this.entities$$.map(entities => entities.unsubscribe());\n  }\n\n  private onLayersChange(layers: Layer[]) {\n    const editableLayers = layers.filter((layer: Layer) =>\n      this.layerIsEditable(layer)\n    );\n    const editableLayersIds = editableLayers.map((layer: Layer) => layer.id);\n\n    const workspacesToAdd = editableLayers\n      .map((layer: VectorLayer) => this.getOrCreateWorkspace(layer))\n      .filter((workspace: Workspace | undefined) => workspace !== undefined);\n\n    const workspacesToRemove = this.workspaceStore.all()\n      .filter((workspace: Workspace) => {\n        return editableLayersIds.indexOf(workspace.id) < 0;\n      });\n\n    if (workspacesToRemove.length > 0) {\n      workspacesToRemove.forEach((workspace: Workspace) => {\n        workspace.entityStore.deactivateStrategyOfType(FeatureStoreInMapExtentStrategy);\n        workspace.deactivate();\n      });\n      this.workspaceStore.state.updateMany(workspacesToRemove, {active: false, selected: false});\n      this.workspaceStore.deleteMany(workspacesToRemove);\n    }\n\n    if (workspacesToAdd.length > 0) {\n      this.workspaceStore.insertMany(workspacesToAdd);\n    }\n  }\n\n  private getOrCreateWorkspace(layer: VectorLayer | ImageLayer): Workspace | undefined {\n    const workspace = this.workspaceStore.get(layer.id);\n    if (workspace !== undefined) {\n      return;\n    }\n    if (layer.dataSource instanceof WFSDataSource && layer.dataSource.options.edition?.enabled !== true) {\n      const wfsWks = this.wfsWorkspaceService.createWorkspace(layer as VectorLayer, this.map);\n      return wfsWks;\n    } else if (layer.dataSource instanceof WMSDataSource && layer.dataSource.options.edition?.enabled !== true) {\n      if (!layer.dataSource.options.paramsWFS) { return; }\n      const wmsWks = this.wmsWorkspaceService.createWorkspace(layer as ImageLayer, this.map);\n      wmsWks?.inResolutionRange$.subscribe((inResolutionRange) => {\n        (layer.dataSource.options as QueryableDataSourceOptions).queryable = !inResolutionRange;\n        (wmsWks.layer.dataSource.options as QueryableDataSourceOptions).queryable = inResolutionRange;\n      });\n      return wmsWks;\n    } else if (\n        layer.dataSource instanceof FeatureDataSource &&\n        (layer as VectorLayer).exportable === true &&\n        layer.dataSource.options.edition?.enabled !== true) {\n      const featureWks = this.featureWorkspaceService.createWorkspace(layer as VectorLayer, this.map);\n      return featureWks;\n    } else if (layer.dataSource instanceof WMSDataSource && layer.dataSource.options.edition?.enabled === true) {\n      const editionWks = this.editionWorkspaceService.createWorkspace(layer as ImageLayer, this.map);\n      return editionWks;\n    }\n\n    return;\n  }\n\n  private layerIsEditable(layer: Layer): boolean {\n    const dataSource = layer.dataSource;\n    if (dataSource instanceof WFSDataSource) {\n      return true;\n    }\n    if (dataSource instanceof FeatureDataSource) {\n      return true;\n    }\n    if (dataSource instanceof WMSDataSource) {\n      const dataSourceOptions = (dataSource.options ||\n        {}) as OgcFilterableDataSourceOptions;\n      return (dataSourceOptions.ogcFilters?.enabled || dataSource.options.paramsWFS?.featureTypes !== undefined);\n    }\n\n    return false;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { WorkspaceSelectorDirective } from './workspace-selector.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n   WorkspaceSelectorDirective\n  ],\n  declarations: [\n    WorkspaceSelectorDirective\n  ]\n})\nexport class IgoWorkspaceSelectorModule {}\n","import { Directive, Input, OnInit, OnDestroy } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { Workspace } from '@igo2/common';\nimport type { WorkspaceStore } from '@igo2/common';\nimport { Layer, ImageLayer, VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\nimport { WFSDataSource, WMSDataSource, FeatureDataSource } from '../../datasource';\nimport { OgcFilterableDataSourceOptions } from '../../filter';\n\nimport { WfsWorkspaceService } from '../shared/wfs-workspace.service';\nimport { WmsWorkspaceService } from '../shared/wms-workspace.service';\nimport { EditionWorkspaceService } from '../shared/edition-workspace.service';\nimport { FeatureWorkspaceService } from '../shared/feature-workspace.service';\nimport { FeatureStoreInMapExtentStrategy } from '../../feature/shared/strategies/in-map-extent';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\n\n@Directive({\n  selector: '[igoWorkspaceUpdator]'\n})\nexport class WorkspaceUpdatorDirective implements OnInit, OnDestroy {\n\n  private layers$$: Subscription;\n  private entities$$: Subscription[] = [];\n\n  @Input() map: IgoMap;\n\n  @Input() workspaceStore: WorkspaceStore;\n\n  constructor(\n    private wfsWorkspaceService: WfsWorkspaceService,\n    private wmsWorkspaceService: WmsWorkspaceService,\n    private editionWorkspaceService: EditionWorkspaceService,\n    private featureWorkspaceService: FeatureWorkspaceService\n  ) {}\n\n  ngOnInit() {\n    this.layers$$ = this.map.layers$\n      .pipe(debounceTime(50))\n      .subscribe((layers: Layer[]) =>\n        this.onLayersChange(layers)\n      );\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n    this.entities$$.map(entities => entities.unsubscribe());\n  }\n\n  private onLayersChange(layers: Layer[]) {\n    const editableLayers = layers.filter((layer: Layer) =>\n      this.layerIsEditable(layer)\n    );\n    const editableLayersIds = editableLayers.map((layer: Layer) => layer.id);\n\n    const workspacesToAdd = editableLayers\n      .map((layer: VectorLayer) => this.getOrCreateWorkspace(layer))\n      .filter((workspace: Workspace | undefined) => workspace !== undefined);\n\n    const workspacesToRemove = this.workspaceStore.all()\n      .filter((workspace: Workspace) => {\n        return editableLayersIds.indexOf(workspace.id) < 0;\n      });\n\n    if (workspacesToRemove.length > 0) {\n      workspacesToRemove.forEach((workspace: Workspace) => {\n        workspace.entityStore.deactivateStrategyOfType(FeatureStoreInMapExtentStrategy);\n        workspace.deactivate();\n      });\n      this.workspaceStore.state.updateMany(workspacesToRemove, {active: false, selected: false});\n      this.workspaceStore.deleteMany(workspacesToRemove);\n    }\n\n    if (workspacesToAdd.length > 0) {\n      this.workspaceStore.insertMany(workspacesToAdd);\n    }\n  }\n\n  private getOrCreateWorkspace(layer: VectorLayer | ImageLayer): Workspace | undefined {\n    const workspace = this.workspaceStore.get(layer.id);\n    if (workspace !== undefined) {\n      return;\n    }\n    if (layer.dataSource instanceof WFSDataSource && layer.dataSource.options.edition?.enabled !== true) {\n      const wfsWks = this.wfsWorkspaceService.createWorkspace(layer as VectorLayer, this.map);\n      return wfsWks;\n    } else if (layer.dataSource instanceof WMSDataSource && layer.dataSource.options.edition?.enabled !== true) {\n      if (!layer.dataSource.options.paramsWFS) { return; }\n      const wmsWks = this.wmsWorkspaceService.createWorkspace(layer as ImageLayer, this.map);\n      wmsWks?.inResolutionRange$.subscribe((inResolutionRange) => {\n        if ((layer.dataSource.options as QueryableDataSourceOptions)?.queryFormatAsWms) {\n          (wmsWks.layer.dataSource.options as QueryableDataSourceOptions).queryable = true;\n          return wmsWks;\n        }\n        (layer.dataSource.options as QueryableDataSourceOptions).queryable = !inResolutionRange;\n        (wmsWks.layer.dataSource.options as QueryableDataSourceOptions).queryable = inResolutionRange;\n      });\n      return wmsWks;\n    } else if (\n        layer.dataSource instanceof FeatureDataSource &&\n        (layer as VectorLayer).exportable === true &&\n        layer.dataSource.options.edition?.enabled !== true) {\n      const featureWks = this.featureWorkspaceService.createWorkspace(layer as VectorLayer, this.map);\n      return featureWks;\n    } else if (layer.dataSource instanceof WMSDataSource && layer.dataSource.options.edition?.enabled === true) {\n      const editionWks = this.editionWorkspaceService.createWorkspace(layer as ImageLayer, this.map);\n      return editionWks;\n    }\n\n    return;\n  }\n\n  private layerIsEditable(layer: Layer): boolean {\n    const dataSource = layer.dataSource;\n    if (dataSource instanceof WFSDataSource) {\n      return true;\n    }\n    if (dataSource instanceof FeatureDataSource) {\n      return true;\n    }\n    if (dataSource instanceof WMSDataSource) {\n      const dataSourceOptions = (dataSource.options ||\n        {}) as OgcFilterableDataSourceOptions;\n      return (dataSourceOptions.ogcFilters?.enabled || dataSource.options.paramsWFS?.featureTypes !== undefined);\n    }\n\n    return false;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { WorkspaceUpdatorDirective } from './workspace-updator.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n   WorkspaceUpdatorDirective\n  ],\n  declarations: [\n    WorkspaceUpdatorDirective\n  ]\n})\nexport class IgoWorkspaceUpdatorModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatDialogModule } from '@angular/material/dialog';\n\nimport { ConfirmationPopupComponent } from './confirmation-popup.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatButtonModule,\n    MatDialogModule,\n    MatButtonToggleModule\n  ],\n  exports: [ConfirmationPopupComponent],\n  declarations: [ConfirmationPopupComponent]\n})\nexport class IgoConfirmationPopupModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { IgoWidgetModule } from '@igo2/common';\n\nimport { provideOgcFilterWidget } from './widgets/widgets';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoOgcFilterModule } from './widgets/ogc-filter/ogc-filter.module';\nimport { IgoWorkspaceSelectorModule } from './workspace-selector/workspace-selector.module';\nimport { IgoWorkspaceUpdatorModule } from './workspace-updator/workspace-updator.module';\nimport { IgoConfirmationPopupModule } from './confirmation-popup/confirmation-popup.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoLanguageModule,\n    IgoWidgetModule,\n    IgoWorkspaceSelectorModule,\n    IgoWorkspaceUpdatorModule,\n    IgoOgcFilterModule,\n    MatDialogModule\n  ],\n  exports: [\n    IgoWorkspaceSelectorModule,\n    IgoWorkspaceUpdatorModule,\n    IgoOgcFilterModule,\n    IgoConfirmationPopupModule\n  ],\n  declarations: [],\n  providers: [\n    provideOgcFilterWidget()\n  ]\n})\nexport class IgoGeoWorkspaceModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\n\n@NgModule({\n  imports: [],\n  exports: [],\n  declarations: []\n})\nexport class IgoWktModule {\n  static forRoot(): ModuleWithProviders<IgoWktModule> {\n    return {\n      ngModule: IgoWktModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\n\nimport { IgoCatalogModule } from './catalog/catalog.module';\nimport { IgoDataSourceModule } from './datasource/datasource.module';\nimport { IgoDownloadModule } from './download/download.module';\nimport { IgoDrawingToolModule } from './draw/drawingTool.module';\nimport { IgoFeatureModule } from './feature/feature.module';\nimport { IgoFilterModule } from './filter/filter.module';\nimport { IgoGeometryModule } from './geometry/geometry.module';\nimport { IgoImportExportModule } from './import-export/import-export.module';\nimport { IgoLayerModule } from './layer/layer.module';\nimport { IgoMapModule } from './map/map.module';\nimport { IgoMeasureModule } from './measure/measure.module';\nimport { IgoMetadataModule } from './metadata/metadata.module';\nimport { IgoOverlayModule } from './overlay/overlay.module';\nimport { IgoPrintModule } from './print/print.module';\nimport { IgoQueryModule } from './query/query.module';\nimport { IgoDirectionsModule } from './directions/directions.module';\nimport { IgoSearchModule } from './search/search.module';\nimport { IgoToastModule } from './toast/toast.module';\nimport { IgoGeoWorkspaceModule } from './workspace/workspace.module';\nimport { IgoWktModule } from './wkt/wkt.module';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: [\n    IgoCatalogModule,\n    IgoDataSourceModule,\n    IgoDownloadModule,\n    IgoDrawingToolModule,\n    IgoFeatureModule,\n    IgoFilterModule,\n    IgoGeometryModule,\n    IgoImportExportModule,\n    IgoLayerModule,\n    IgoMapModule,\n    IgoMeasureModule,\n    IgoMetadataModule,\n    IgoOverlayModule,\n    IgoPrintModule,\n    IgoQueryModule,\n    IgoDirectionsModule,\n    IgoSearchModule,\n    IgoToastModule,\n    IgoGeoWorkspaceModule,\n    IgoWktModule\n  ]\n})\nexport class IgoGeoModule {\n  static forRoot(): ModuleWithProviders<IgoGeoModule> {\n    return {\n      ngModule: IgoGeoModule,\n      providers: []\n    };\n  }\n}\n","import { EntityStore } from '@igo2/common';\nimport { BehaviorSubject } from 'rxjs';\nimport { FeatureStore } from '../../feature/shared/store';\nimport { FeatureWithDirection, FeatureWithStep, FeatureWithStop, Stop } from './directions.interface';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * stops.\n */\nexport class StopsStore extends EntityStore<Stop> {\n\n    public storeInitialized$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n    public clearStops() {\n        this.storeInitialized$.next(false);\n        this.clear();\n    }\n\n}\n\nexport class StopsFeatureStore extends FeatureStore<FeatureWithStop> {\n\n}\nexport class RoutesFeatureStore extends FeatureStore<FeatureWithDirection> {\n\n}\nexport class StepFeatureStore extends FeatureStore<FeatureWithStep> {\n\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { Cacheable } from 'ts-cacheable';\n\nimport { uuid } from '@igo2/utils';\nimport { ConfigService } from '@igo2/core';\n\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\nimport { DirectionsFormat, SourceDirectionsType } from '../shared/directions.enum';\n\nimport { DirectionsSource } from './directions-source';\nimport { DirectionsSourceOptions } from './directions-source.interface';\n\n@Injectable()\nexport class OsrmDirectionsSource extends DirectionsSource {\n  get enabled(): boolean {\n    return this.options.enabled !== false;\n  }\n  set enabled(value: boolean) {\n    this.options.enabled = value;\n  }\n  static _name = 'OSRM Qubec';\n  private directionsUrl =\n    'https://geoegl.msp.gouv.qc.ca/services/itineraire/route/v1/driving/';\n  private options: DirectionsSourceOptions;\n\n  constructor(private http: HttpClient, private config: ConfigService) {\n    super();\n    this.options = this.config.getConfig('directionsSources.osrm') || {};\n    this.directionsUrl = this.options.url || this.directionsUrl;\n  }\n\n  getName(): string {\n    return OsrmDirectionsSource._name;\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  route(coordinates: [number, number][], directionsOptions: DirectionOptions = {}): Observable<Direction[]> {\n    const directionsParams = this.getRouteParams(directionsOptions);\n    return this.http\n      .get<JSON[]>(this.directionsUrl + coordinates.join(';'), {\n        params: directionsParams\n      })\n      .pipe(map(res => this.extractRoutesData(res)));\n  }\n\n  private extractRoutesData(response): Direction[] {\n    const routeResponse = [];\n    response.routes.forEach(route => {\n      routeResponse.push(this.formatRoute(route, response.waypoints));\n    });\n    return routeResponse;\n  }\n\n  private getRouteParams(directionsOptions: DirectionOptions = {}): HttpParams {\n\n    directionsOptions.alternatives = directionsOptions.alternatives !== undefined ? directionsOptions.alternatives : true;\n    directionsOptions.steps = directionsOptions.steps !== undefined ? directionsOptions.steps : true;\n    directionsOptions.geometries = directionsOptions.geometries !== undefined ? directionsOptions.geometries : 'geojson';\n    directionsOptions.overview = directionsOptions.overview !== undefined ? directionsOptions.overview : false;\n    directionsOptions.continue_straight = directionsOptions.continue_straight !== undefined ? directionsOptions.continue_straight : false;\n\n    return new HttpParams({\n      fromObject: {\n        alternatives: directionsOptions.alternatives ? 'true' : 'false',\n        overview: directionsOptions.overview ? 'simplified' : 'full',\n        steps: directionsOptions.steps ? 'true' : 'false',\n        geometries: directionsOptions.geometries ? directionsOptions.geometries : 'geojson',\n        continue_straight: directionsOptions.continue_straight ? 'true' : 'false',\n      }\n    });\n  }\n\n  private formatRoute(roadNetworkRoute: any, waypoints: any): Direction {\n    const stepsUI = [];\n    roadNetworkRoute.legs.forEach(leg => {\n      leg.steps.forEach(step => {\n        stepsUI.push(step);\n      });\n    });\n    return {\n      id: uuid(),\n      title: roadNetworkRoute.legs[0].summary,\n      source: OsrmDirectionsSource._name,\n      sourceType: SourceDirectionsType.Route,\n      order: 1,\n      format: DirectionsFormat.GeoJSON,\n      icon: 'directions',\n      projection: 'EPSG:4326',\n      waypoints,\n      distance: roadNetworkRoute.distance,\n      duration: roadNetworkRoute.duration,\n      geometry: roadNetworkRoute.geometry,\n      legs: roadNetworkRoute.legs,\n      steps: stepsUI,\n      weight: roadNetworkRoute.weight,\n      weight_name: roadNetworkRoute.weight_name\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService } from '@igo2/core';\n\nimport { DirectionsSource } from './directions-source';\nimport { OsrmDirectionsSource } from './osrm-directions-source';\n\nexport function osrmDirectionsSourcesFactory(\n  http: HttpClient,\n  config: ConfigService\n) {\n  return new OsrmDirectionsSource(http, config);\n}\n\nexport function provideOsrmDirectionsSource() {\n  return {\n    provide: DirectionsSource,\n    useFactory: osrmDirectionsSourcesFactory,\n    multi: true,\n    deps: [HttpClient, ConfigService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport olWKT from 'ol/format/WKT';\n\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch } from './source';\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\n\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n/**\n * Cadastre search source\n */\n@Injectable()\nexport class CadastreSearchSource extends SearchSource implements TextSearch {\n  static id = 'cadastre';\n  static type = FEATURE;\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n  }\n\n  getId(): string {\n    return CadastreSearchSource.id;\n  }\n\n  getType(): string {\n    return CadastreSearchSource.type;\n  }\n\n  /*\n   * Source : https://wiki.openstreetmap.org/wiki/Key:amenity\n   */\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Cadastre (Qubec)',\n      searchUrl: 'https://carto.cptaq.gouv.qc.ca/php/find_lot_v1.php?'\n    };\n  }\n\n  /**\n   * Search a place by name\n   * @param term Place name\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    term = term.endsWith(',') ? term.slice(0, -1) : term;\n    term = term.startsWith(',') ? term.substr(1) : term;\n    term = term.replace(/ /g, '');\n\n    const params = this.computeSearchRequestParams(term, options || {});\n    if (!params.get('numero') || !params.get('numero').match(/^[0-9,]+$/g)) {\n      return of([]);\n    }\n    return this.http\n      .get(this.searchUrl, { params, responseType: 'text' })\n      .pipe(map((response: string) => this.extractResults(response, term)));\n  }\n\n  private computeSearchRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          numero: term,\n          epsg: '4326'\n        },\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(response: string, term: string): SearchResult<Feature>[] {\n    return response\n      .split('<br />')\n      .filter((lot: string) => lot.length > 0)\n      .map((lot: string) => this.dataToResult(lot, term));\n  }\n\n  private dataToResult(data: string, term: string): SearchResult<Feature> {\n    const lot = data.split(';');\n    const numero = lot[0];\n    const wkt = lot[7];\n    const geometry = this.computeGeometry(wkt);\n\n    const properties = {\n      NoLot: numero,\n      Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>'\n    };\n    const id = [this.getId(), 'cadastre', numero].join('.');\n\n    return {\n      source: this,\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: numero,\n        score: computeTermSimilarity(term.trim(), numero),\n        icon: 'map-marker'\n      },\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry,\n        properties,\n        meta: {\n          id,\n          title: numero\n        }\n      }\n    };\n  }\n\n  private computeGeometry(wkt: string): FeatureGeometry {\n    const feature = new olWKT().readFeature(wkt, {\n      dataProjection: 'EPSG:4326',\n      featureProjection: 'EPSG:4326'\n    });\n    return {\n      type: feature.getGeometry().getType(),\n      coordinates: feature.getGeometry().getCoordinates()\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport { CadastreSearchSource } from './cadastre';\n\n/**\n * Cadastre search source factory\n * @ignore\n */\nexport function cadastreSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService\n) {\n  return new CadastreSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${CadastreSearchSource.id}`),\n  );\n}\n\n/**\n * Function that returns a provider for the Cadastre search source\n */\nexport function provideCadastreSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: cadastreSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\n\nimport { StorageService } from '@igo2/core';\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch } from './source';\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\nimport { NominatimData } from './nominatim.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n/**\n * Nominatim search source\n */\n@Injectable()\nexport class NominatimSearchSource extends SearchSource implements TextSearch {\n  static id = 'nominatim';\n  static type = FEATURE;\n\n  constructor(\n    private http: HttpClient,\n    @Inject('options') options: SearchSourceOptions,\n    storageService: StorageService\n  ) {\n    super(options, storageService);\n  }\n\n  getId(): string {\n    return NominatimSearchSource.id;\n  }\n\n  getType(): string {\n    return NominatimSearchSource.type;\n  }\n\n  /*\n   * Source : https://wiki.openstreetmap.org/wiki/Key:amenity\n   */\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Nominatim (OSM)',\n      searchUrl: 'https://nominatim.openstreetmap.org/search',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'amenity',\n          values: [\n            {\n              title: 'igo.geo.search.nominatim.type.food',\n              value:\n                'bar,bbq,biergaten,cafe,drinking_water,fast_food,food_court,ice_cream,pub,restaurant',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.health',\n              value:\n                'baby_hatch,clinic,dentist,doctors,hospital,nursing_home,pharmacy,social_facility,veterinary',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.entertainment',\n              value:\n                'arts_centre,brothel,casino,cinema,community_center_fountain,gambling,nightclub,planetarium \\\n                          ,public_bookcase,social_centre,stripclub,studio,swingerclub,theatre,internet_cafe',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.finance',\n              value: 'atm,bank,bureau_de_change',\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '10',\n              value: 10,\n              enabled: true\n            },\n            {\n              title: '20',\n              value: 20,\n              enabled: false\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'restrictExtent',\n          name: 'countrycodes',\n          values: [\n            {\n              title: 'igo.geo.search.nominatim.country.canada',\n              value: 'CA',\n              enabled: true\n            },\n            {\n              title: 'igo.geo.search.nominatim.country.all',\n              value: null,\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'multiple object',\n          name: 'dedupe',\n          values: [\n            {\n              title: 'igo.geo.search.searchSources.settings.true',\n              value: 0,\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.searchSources.settings.false',\n              value: 1,\n              enabled: true\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a place by name\n   * @param term Place name\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeSearchRequestParams(term, options || {});\n    if (!params.get('q')) {\n      return of([]);\n    }\n    return this.http\n      .get(this.searchUrl, { params })\n      .pipe(map((response: NominatimData[]) => this.extractResults(response, term)));\n  }\n\n  private computeSearchRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          q: this.computeTerm(term),\n          format: 'json'\n        },\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(response: NominatimData[], term: string): SearchResult<Feature>[] {\n    return response.map((data: NominatimData) => this.dataToResult(data, term));\n  }\n\n  private dataToResult(data: NominatimData, term: string): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const geometry = this.computeGeometry(data);\n    const extent = this.computeExtent(data);\n    const id = [this.getId(), 'place', data.place_id].join('.');\n\n    return {\n      source: this,\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.display_name,\n        icon: 'map-marker',\n        score: computeTermSimilarity(term.trim(), data.display_name)\n      },\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry,\n        extent,\n        properties,\n        meta: {\n          id,\n          title: data.display_name\n        }\n      }\n    };\n  }\n\n  private computeProperties(data: NominatimData): { [key: string]: any } {\n    return {\n      display_name: data.display_name,\n      place_id: data.place_id,\n      osm_type: data.osm_type,\n      class: data.class,\n      type: data.type\n    };\n  }\n\n  private computeGeometry(data: NominatimData): FeatureGeometry {\n    return {\n      type: 'Point',\n      coordinates: [parseFloat(data.lon), parseFloat(data.lat)]\n    };\n  }\n\n  private computeExtent(data: NominatimData): [number, number, number, number] {\n    return [\n      parseFloat(data.boundingbox[2]),\n      parseFloat(data.boundingbox[0]),\n      parseFloat(data.boundingbox[3]),\n      parseFloat(data.boundingbox[1])\n    ];\n  }\n\n  private computeTerm(term: string): string {\n    return this.computeTermTags(term);\n  }\n\n  /**\n   * Add hashtag from query in Nominatim's format (+[])\n   * @param term Query with hashtag\n   */\n  private computeTermTags(term: string): string {\n    const hashtags = super.getHashtagsValid(term, 'amenity');\n    if (!hashtags) {\n      return this.computeTermSettings(term);\n    }\n\n    if (!hashtags.length) {\n      return null;\n    }\n\n    term = term.replace(/(#[^\\s]*)/g, '');\n    hashtags.forEach(tag => {\n      term += '+[' + tag + ']';\n    });\n\n    return term;\n  }\n\n  /**\n   * Add hashtag from settings in Nominatim's format (+[])\n   * @param term Query\n   */\n  private computeTermSettings(term: string): string {\n    this.options.settings.forEach(settings => {\n      if (settings.name === 'amenity') {\n        settings.values.forEach(conf => {\n          if (conf.enabled && typeof conf.value === 'string') {\n            const splitted = conf.value.split(',');\n            splitted.forEach(value => {\n              term += '+[' + value + ']';\n            });\n          }\n        });\n      }\n    });\n    return term;\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport { NominatimSearchSource } from './nominatim';\n\n/**\n * Nominatim search source factory\n * @ignore\n */\nexport function nominatimSearchSourceFactory(\n  http: HttpClient,\n  config: ConfigService,\n  storageService: StorageService\n) {\n  return new NominatimSearchSource(\n    http,\n    config.getConfig(`searchSources.${NominatimSearchSource.id}`),\n    storageService\n  );\n}\n\n/**\n * Function that returns a provider for the Nominatim search source\n */\nexport function provideNominatimSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: nominatimSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, ConfigService, StorageService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { FEATURE, Feature } from '../../../feature';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch, ReverseSearch } from './source';\nimport {\n  SearchSourceOptions,\n  TextSearchOptions,\n  ReverseSearchOptions\n} from './source.interfaces';\nimport {\n  StoredQueriesData,\n  StoredQueriesResponse,\n  StoredQueriesReverseData,\n  StoredQueriesReverseResponse,\n  StoredQueriesSearchSourceOptions,\n  StoredQueriesFields,\n  StoredQueriesReverseSearchSourceOptions\n} from './storedqueries.interfaces';\n\nimport * as olformat from 'ol/format';\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n/**\n * StoredQueries search source\n */\n@Injectable()\nexport class StoredQueriesSearchSource extends SearchSource\n  implements TextSearch {\n  static id = 'storedqueries';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [\n    'boundedBy',\n    'id',\n    'coord_x',\n    'coord_y'\n  ];\n  public resultTitle: 'title';\n  public storedQueriesOptions: StoredQueriesSearchSourceOptions;\n  public multipleFieldsQuery: boolean;\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n    this.storedQueriesOptions = options as StoredQueriesSearchSourceOptions;\n    if (this.storedQueriesOptions && !this.storedQueriesOptions.available) {\n      return;\n    }\n\n    const defaultStoredqueryId = 'rtss';\n    const defaultFieldSplitter: StoredQueriesFields[] = [\n      { name: 'rtss', defaultValue: '-99' },\n      { name: 'chainage', defaultValue: '0', splitPrefix: '\\\\+' }\n    ];\n    const defaultOutputformat = 'text/xml; subtype=gml/3.1.1';\n    const defaultSrsname = 'EPSG:4326';\n    const defaultResultTitle = 'title';\n\n    if (!this.storedQueriesOptions) {\n      console.log(\n        ' No configuration for this search source (storedqueries). You will use the default values'\n      );\n      this.storedQueriesOptions = {\n        storedquery_id: defaultStoredqueryId,\n        fields: defaultFieldSplitter,\n        outputformat: defaultOutputformat,\n        srsname: defaultSrsname,\n        resultTitle: defaultResultTitle\n      };\n      this.resultTitle = defaultResultTitle;\n      console.log('Default values', this.storedQueriesOptions);\n    }\n\n    if (!this.storedQueriesOptions.storedquery_id) {\n      const err =\n        'Stored Queries :You have to set \"storedquery_id\" into StoredQueries options. ex: storedquery_id: \"nameofstoredquerie\"';\n      throw new Error(err);\n    }\n    if (!this.storedQueriesOptions.fields) {\n      throw new Error(\n        'Stored Queries :You have to set \"fields\" into options. ex: fields: {\"name\": \"rtss\", \"defaultValue\": \"-99\"}'\n      );\n    }\n\n    this.storedQueriesOptions.outputformat =\n      this.storedQueriesOptions.outputformat || 'text/xml; subtype=gml/3.1.1';\n    this.storedQueriesOptions.srsname =\n      this.storedQueriesOptions.srsname || 'EPSG:4326';\n\n    const storedQueryId = this.storedQueriesOptions.storedquery_id.toLowerCase();\n    if (\n      storedQueryId.includes('getfeaturebyid') &&\n      this.storedQueriesOptions.outputformat\n        .toLowerCase()\n        .includes('getfeaturebyid')\n    ) {\n      let err =\n        'You must set a geojson format for your stored query. This is due to an openlayers issue)';\n      err += ' (wfs 1.1.0 & gml 3.1.1 limitation)';\n      throw new Error(err);\n    }\n\n    if (!(this.storedQueriesOptions.fields instanceof Array)) {\n      this.storedQueriesOptions.fields = [this.storedQueriesOptions.fields];\n    }\n\n    this.multipleFieldsQuery =\n      this.storedQueriesOptions.fields.length > 1 ? true : false;\n\n    this.storedQueriesOptions.fields.forEach((field, index) => {\n      if (this.multipleFieldsQuery && !field.splitPrefix && index !== 0) {\n        throw new Error(\n          'Stored Queries :You must set a field spliter into your field definition (optional for the first one!)'\n        );\n      }\n      if (!field.defaultValue) {\n        throw new Error(\n          'Stored Queries :You must set a field default value into your field definition'\n        );\n      }\n    });\n\n    this.storedQueriesOptions.resultTitle =\n      this.storedQueriesOptions.resultTitle || this.resultTitle;\n  }\n\n  getId(): string {\n    return StoredQueriesSearchSource.id;\n  }\n\n  getType(): string {\n    return StoredQueriesSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Stored Queries',\n      searchUrl: 'https://ws.mapserver.transports.gouv.qc.ca/swtq'\n    };\n  }\n\n  // URL CALL EXAMPLES:\n  //  GetFeatureById (mandatory storedquery for wfs server) (outputformat must be in geojson)\n /* eslint-disable max-len */\n  //  https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=2.0.0&request=GetFeature&storedquery_id=urn:ogc:def:query:OGC-WFS::GetFeatureById&srsname=epsg:4326&outputformat=geojson&ID=a_num_route.132\n  //  Custom StoredQuery\n /* eslint-disable max-len */\n  //  https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=1.1.0&request=GetFeature&storedquery_id=rtss&srsname=epsg:4326&outputformat=text/xml;%20subtype=gml/3.1.1&rtss=0013801110000c&chainage=12\n\n  /**\n   * Search a location by name or keyword\n   * @param term Location name or keyword\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const storedqueriesParams = this.termSplitter(\n      term,\n      this.storedQueriesOptions.fields\n    );\n    const params = this.computeRequestParams(\n      options || {},\n      storedqueriesParams\n    );\n    this.options.params = this.options.params ? this.options.params : {};\n    this.options.params.page = options.page ? String(options.page) : '1';\n\n    if (\n      new RegExp('.*?gml.*?', 'i').test(this.storedQueriesOptions.outputformat)\n    ) {\n      return this.http\n        .get(this.searchUrl, { params, responseType: 'text' })\n        .pipe(\n          map(response => {\n            let resultArray = this.extractResults(this.extractWFSData(response), term);\n            resultArray.sort((a, b) =>\n              (a.meta.score > b.meta.score) ? 1 :\n              (a.meta.score === b.meta.score) ? ((a.meta.titleHtml < b.meta.titleHtml) ? 1 : -1) : -1);\n            resultArray.reverse();\n            if (resultArray.length > Number(this.options.params.limit)) {\n              const idxEnd = Number(this.options.params.limit) * Number(this.options.params.page);\n              const resultTotLenght = resultArray.length;\n              resultArray = resultArray.slice(0, idxEnd);\n              if (idxEnd < resultTotLenght) {\n                resultArray[resultArray.length - 1 ].meta.nextPage = true;\n              } else {\n                resultArray[resultArray.length - 1 ].meta.nextPage = false;\n              }\n            }\n            return resultArray;\n          })\n        );\n    } else {\n      return this.http.get(this.searchUrl, { params }).pipe(\n        map(response => {\n          return this.extractResults(this.extractWFSData(response), term);\n        })\n      );\n    }\n  }\n\n  private getFormatFromOptions() {\n    let olFormatCls;\n\n    const outputFormat = this.storedQueriesOptions.outputformat;\n    const patternGml3 = new RegExp('.*?gml.*?', 'i');\n    const patternGeojson = new RegExp('.*?json.*?', 'i');\n\n    if (patternGeojson.test(outputFormat)) {\n      olFormatCls = olformat.GeoJSON;\n    }\n    if (patternGml3.test(outputFormat)) {\n      olFormatCls = olformat.WFS;\n    }\n\n    return new olFormatCls();\n  }\n\n  private extractWFSData(res) {\n    const olFormat = this.getFormatFromOptions();\n    const geojson = olformat.GeoJSON;\n    const wfsfeatures = olFormat.readFeatures(res);\n    const features = JSON.parse(new geojson().writeFeatures(wfsfeatures));\n    return features;\n  }\n\n  private termSplitter(term: string, fields: StoredQueriesFields[]): {} {\n    const splittedTerm = {};\n    let remainingTerm = term;\n    let cnt = 0;\n\n    // Used to build the default values\n    fields.forEach(field => {\n      splittedTerm[field.name] = field.defaultValue;\n      const splitterRegex = new RegExp(field.splitPrefix + '(.+)', 'i');\n      if (splitterRegex.test(remainingTerm)) {\n        cnt = field.splitPrefix ? (cnt += 1) : cnt;\n        remainingTerm = remainingTerm.split(splitterRegex)[1];\n      }\n    });\n    if (cnt === 0) {\n      splittedTerm[fields[0].name] = term;\n      return splittedTerm;\n    }\n    remainingTerm = term;\n    const localFields = [...fields].reverse();\n    localFields.forEach(field => {\n      const splitterRegex = new RegExp(field.splitPrefix || '' + '(.+)', 'i');\n      if (remainingTerm || remainingTerm !== '') {\n        const values = remainingTerm.split(splitterRegex);\n        remainingTerm = values[0];\n        if (values[1]) {\n          splittedTerm[field.name] = values[1].trim();\n        }\n      }\n    });\n    return splittedTerm;\n  }\n\n  private computeRequestParams(\n    options: TextSearchOptions,\n    queryParams\n  ): HttpParams {\n    const wfsversion = this.storedQueriesOptions.storedquery_id\n      .toLowerCase()\n      .includes('getfeaturebyid')\n      ? '2.0.0'\n      : '1.1.0';\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          service: 'wfs',\n          version: wfsversion,\n          request: 'GetFeature',\n          storedquery_id: this.storedQueriesOptions.storedquery_id,\n          srsname: this.storedQueriesOptions.srsname,\n          outputformat: this.storedQueriesOptions.outputformat\n        },\n        queryParams,\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(\n    response: StoredQueriesResponse, term: string\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: StoredQueriesData) => {\n      return this.dataToResult(data, term);\n    });\n  }\n\n  private dataToResult(data: StoredQueriesData, term: string): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, data.id].join('.');\n    const title = data.properties[this.storedQueriesOptions.resultTitle]\n      ? this.storedQueriesOptions.resultTitle\n      : this.resultTitle;\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        // extent: data.bbox,\n        properties,\n        meta: {\n          id,\n          title: data.properties[title]\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.title,\n        titleHtml: data.properties[title],\n        icon: 'map-marker',\n        score: (data.properties.title) ?\n        computeTermSimilarity(term.trim(), data.properties.title) :\n        computeTermSimilarity(term.trim(), data.properties[title]),\n\n      }\n    };\n  }\n\n  private computeProperties(data: StoredQueriesData): { [key: string]: any } {\n    const properties = Object.assign(\n      {},\n      ObjectUtils.removeKeys(\n        data.properties,\n        StoredQueriesSearchSource.propertiesBlacklist\n      ),\n      { Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>' }\n    );\n    return properties;\n  }\n}\n\n/**\n * StoredQueriesReverse search source\n */\n\n// EXAMPLE CALLS\n /* eslint-disable max-len */\n// https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=1.1.0&request=GetFeature&storedquery_id=lim_adm&srsname=epsg:4326&outputformat=text/xml;%20subtype=gml/3.1.1&long=-71.292469&lat=46.748107\n//\n\n@Injectable()\nexport class StoredQueriesReverseSearchSource extends SearchSource\n  implements ReverseSearch {\n  static id = 'storedqueriesreverse';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n  public resultTitle: 'title';\n  public storedQueriesOptions: StoredQueriesReverseSearchSourceOptions;\n  public multipleFieldsQuery: boolean;\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n    this.storedQueriesOptions = options as StoredQueriesReverseSearchSourceOptions;\n\n    if (!this.storedQueriesOptions || (this.storedQueriesOptions && !this.storedQueriesOptions.available) ) {\n      return;\n    }\n\n    if (!this.storedQueriesOptions.storedquery_id) {\n      const err =\n        'Stored Queries :You have to set \"storedquery_id\" into StoredQueries options. ex: storedquery_id: \"nameofstoredquerie\"';\n      throw new Error(err);\n    }\n    if (!this.storedQueriesOptions.longField) {\n      throw new Error(\n        'Stored Queries :You have to set \"longField\" to map the longitude coordinate to the query params.'\n      );\n    }\n    if (!this.storedQueriesOptions.latField) {\n      throw new Error(\n        'Stored Queries :You have to set \"latField\" to map the latitude coordinate to the query params.'\n      );\n    }\n\n    this.storedQueriesOptions.outputformat =\n      this.storedQueriesOptions.outputformat || 'text/xml; subtype=gml/3.1.1';\n    this.storedQueriesOptions.srsname =\n      this.storedQueriesOptions.srsname || 'EPSG:4326';\n    this.storedQueriesOptions.resultTitle =\n      this.storedQueriesOptions.resultTitle || this.resultTitle;\n  }\n\n  getId(): string {\n    return StoredQueriesReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return StoredQueriesReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Stored Queries (reverse)',\n      searchUrl: 'https://ws.mapserver.transports.gouv.qc.ca/swtq'\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param distance Search raidus around lonLat\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(lonLat, options || {});\n\n    if (\n      new RegExp('.*?gml.*?', 'i').test(this.storedQueriesOptions.outputformat)\n    ) {\n      return this.http\n        .get(this.searchUrl, { params, responseType: 'text' })\n        .pipe(\n          map(response => {\n            return this.extractResults(this.extractWFSData(response));\n          })\n        );\n    } else {\n      return this.http.get(this.searchUrl, { params }).pipe(\n        map(response => {\n          return this.extractResults(this.extractWFSData(response));\n        })\n      );\n    }\n  }\n\n  private getFormatFromOptions() {\n    let olFormatCls;\n\n    const outputFormat = this.storedQueriesOptions.outputformat;\n    const patternGml3 = new RegExp('.*?gml.*?', 'i');\n    const patternGeojson = new RegExp('.*?json.*?', 'i');\n\n    if (patternGeojson.test(outputFormat)) {\n      olFormatCls = olformat.GeoJSON;\n    }\n    if (patternGml3.test(outputFormat)) {\n      olFormatCls = olformat.WFS;\n    }\n\n    return new olFormatCls();\n  }\n\n  private extractWFSData(res) {\n    const olFormat = this.getFormatFromOptions();\n    const geojson = olformat.GeoJSON;\n    const wfsfeatures = olFormat.readFeatures(res);\n    const features = JSON.parse(new geojson().writeFeatures(wfsfeatures));\n    return features;\n  }\n\n  private computeRequestParams(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): HttpParams {\n    const longLatParams = {};\n    longLatParams[this.storedQueriesOptions.longField] = lonLat[0];\n    longLatParams[this.storedQueriesOptions.latField] = lonLat[1];\n\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          service: 'WFS',\n          version: '1.1.0',\n          request: 'GetFeature',\n          storedquery_id: this.storedQueriesOptions.storedquery_id,\n          srsname: this.storedQueriesOptions.srsname,\n          outputformat: this.storedQueriesOptions.outputformat\n        },\n        longLatParams,\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(\n    response: StoredQueriesReverseResponse\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: StoredQueriesReverseData) => {\n      return this.dataToResult(data);\n    });\n  }\n\n  private dataToResult(data: StoredQueriesReverseData): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, data.id].join('.');\n    const title = data.properties[this.storedQueriesOptions.resultTitle]\n      ? this.storedQueriesOptions.resultTitle\n      : this.resultTitle;\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        properties,\n        meta: {\n          id,\n          title: data.properties[title]\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties[title],\n        icon: 'map-marker'\n      }\n    };\n  }\n\n  private computeProperties(\n    data: StoredQueriesReverseData\n  ): { [key: string]: any } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      StoredQueriesReverseSearchSource.propertiesBlacklist\n    );\n    const routing = {\n      Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>'\n    };\n    return Object.assign(properties, { type: data.properties.doc_type }, routing);\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport {\n  StoredQueriesSearchSource,\n  StoredQueriesReverseSearchSource\n} from './storedqueries';\n\n/**\n * StoredQueries search source factory\n * @ignore\n */\nexport function storedqueriesSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService\n) {\n  return new StoredQueriesSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${StoredQueriesSearchSource.id}`)\n  );\n}\n\n/**\n * Function that returns a provider for the StoredQueries search source\n */\nexport function provideStoredQueriesSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: storedqueriesSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\n  };\n}\n\n/**\n * StoredQueriesReverse search source factory\n * @ignore\n */\n\nexport function storedqueriesReverseSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService\n) {\n  return new StoredQueriesReverseSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${StoredQueriesReverseSearchSource.id}`)\n  );\n}\n\n/**\n * Function that returns a provider for the StoredQueriesReverse search source\n */\nexport function provideStoredQueriesReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: storedqueriesReverseSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\n  };\n}\n","import { WfsWorkspace } from './wfs-workspace';\nimport { FeatureWorkspace } from './feature-workspace';\nimport { EditionWorkspace } from './edition-workspace';\nimport { Observable } from 'rxjs';\nimport { EntityStoreFilterCustomFuncStrategy, EntityRecord } from '@igo2/common';\nimport { map } from 'rxjs/operators';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { StorageScope } from '@igo2/core';\n\n\nexport function getRowsInMapExtent(layerId, storageService): boolean {\n  return storageService.get(`workspace.rowsInMapExtent.${layerId}`) as boolean || true;\n}\n\nexport function setRowsInMapExtent(value, layerId, storageService) {\n  storageService.set(`workspace.rowsInMapExtent.${layerId}`, value, StorageScope.SESSION);\n}\n\nexport function getSelectedOnly(layerId, storageService): boolean {\n  return storageService.get(`workspace.selectedOnly.${layerId}`) as boolean || false;\n}\n\nexport function setSelectedOnly(value, layerId, storageService) {\n  storageService.set(`workspace.selectedOnly.${layerId}`, value, StorageScope.SESSION);\n}\n\nexport function mapExtentStrategyActiveToolTip(ws: WfsWorkspace | FeatureWorkspace | EditionWorkspace): Observable<string> {\n  return ws.entityStore.getStrategyOfType(EntityStoreFilterCustomFuncStrategy).active$.pipe(\n    map((active: boolean) => active ? 'igo.geo.workspace.inMapExtent.active.tooltip' : 'igo.geo.workspace.inMapExtent.inactive.tooltip')\n  );\n}\n\nexport function noElementSelected(ws: WfsWorkspace | FeatureWorkspace | EditionWorkspace): Observable<boolean> {\n  return ws.entityStore.stateView.manyBy$((record: EntityRecord<Feature>) => {\n    return record.state.selected === true;\n  }).pipe(\n    map((entities: EntityRecord<Feature>[]) => entities.length >= 1)\n  );\n}\n\n","/*\n * Public API Surface of geo\n */\n\nexport * from './lib/geo.module';\nexport * from './lib/catalog/catalog.module';\nexport * from './lib/catalog/catalog-browser/catalog-browser.module';\nexport * from './lib/catalog/catalog-library/catalog-library.module';\nexport * from './lib/datasource/datasource.module';\nexport * from './lib/directions/directions.module';\nexport * from './lib/download/download.module';\nexport * from './lib/draw/drawingTool.module';\nexport * from './lib/draw/draw/draw.module';\nexport * from './lib/workspace/workspace.module';\n\nexport * from './lib/feature/feature.module';\nexport * from './lib/feature/feature-form/feature-form.module';\nexport * from './lib/feature/feature-details/feature-details.module';\nexport * from './lib/feature/feature-details/feature-details.directive';\nexport * from './lib/filter/filter.module';\nexport * from './lib/geometry/geometry.module';\nexport * from './lib/geometry/geometry-form-field/geometry-form-field.module';\nexport * from './lib/import-export/import-export.module';\nexport * from './lib/layer/layer.module';\nexport * from './lib/map/map.module';\nexport * from './lib/measure/measure.module';\nexport * from './lib/measure/measurer/measurer.module';\nexport * from './lib/metadata/metadata.module';\nexport * from './lib/overlay/overlay.module';\nexport * from './lib/print/print.module';\nexport * from './lib/query/query.module';\nexport * from './lib/search/search.module';\nexport * from './lib/toast/toast.module';\nexport * from './lib/wkt/wkt.module';\n\nexport * from './lib/catalog';\nexport * from './lib/datasource';\nexport * from './lib/download';\nexport * from './lib/draw';\nexport * from './lib/feature';\nexport * from './lib/filter';\nexport * from './lib/geometry';\nexport * from './lib/import-export';\nexport * from './lib/layer';\nexport * from './lib/map';\nexport * from './lib/measure';\nexport * from './lib/metadata';\nexport * from './lib/overlay';\nexport * from './lib/print';\nexport * from './lib/query';\nexport * from './lib/directions';\nexport * from './lib/search';\nexport * from './lib/toast';\nexport * from './lib/utils';\nexport * from './lib/wkt';\nexport * from './lib/workspace';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":["Injectable","i0","Component","ChangeDetectionStrategy","Input","MAT_DIALOG_DATA","ViewEncapsulation","Inject","CommonModule","MatIconModule","MatButtonModule","MatTooltipModule","IgoLanguageModule","MatDialogModule","NgModule","FeatureMotion","uuid","SubjectStatus","Watcher","LinkedProperties","TooltipType","Md5","OgcFilterOperatorType","OgcFilterOperator","moment","moment_","olfilter","olFormatWFS","olFormatWKT","ObjectUtils","QueryFormat","QueryFormatMimeType","QueryHtmlTarget","OlFormat","olFormatGML2","olFormatGML32","olFormatGML3","olFormatOSMXML","BehaviorSubject","olSourceImageWMS","first","olSourceVector","olformat","olSourceCluster","olproj","MAC","NumberUtils","combineLatest","map","olLayerVector","getVectorContext","easeOut","ColorAsArray","unByKey","olProjection","FormatType","olSourceOSM","olSourceXYZ","OlLoadingStrategy","Observable","concatMap","of","extentGetWidth","olTileGridWMTS","extentGetTopLeft","olSourceWMTS","olSourceCarto","olFormatEsriJSON","olloadingstrategy","ImageArcGISRest","olSourceTileArcGISRest","TileGrid","TileDebug","olFormatMVT","feature","olSourceVectorTile","olstyle","TimeFilterType","TimeFilterStyle","TypeCapabilities","WMSCapabilities","WMTSCapabilities","EsriJSON","catchError","forkJoin","HttpParams","optionsFromCapabilities","olAttribution","Cacheable","proj4","olproj4","Optional","HttpClient","ConfigService","getEntityId","OlFormatGeoJSON","getEntityTitle","getEntityProperty","getEntityRevision","getEntityIcon","OlPolygon","OlGeometryLayout","OlPoint","OlLineString","olextent","EntityStore","skipWhile","EntityStoreStrategy","OlDragBoxInteraction","debounceTime","skip","OlFeature","distinctUntilChanged","MapViewAction","Subject","oleasing","olControlAttribution","olControlScaleLine","olMap","olinteraction","olView","olPoint","olFeature","olCircle","olGeolocation","Directive","EventEmitter","transform","Self","Output","olLayerImage","olLayerTile","olLayerVectorTile","take","olVectorTileSource","OlGeom","RenderFeature","HostListener","OlStyle","trigger","state","style","transition","animate","Media","stylefunction","getRenderPixel","CatalogItemType","TypeCatalog","mergeMap","olgeom","striptags_","zip","OlRenderFeature","EMPTY","EntityStoreWatcher","SecureImagePipe","ViewChildren","LayerListControlsEnum","LayerListSelectVisibleEnum","LayerListDisplacement","ReplaySubject","debounce","timer","ContentChild","MatInputModule","MatFormFieldModule","FormsModule","MatDividerModule","MatMenuModule","MatSlideToggleModule","MatSelectModule","MatListModule","MatSliderModule","MatBadgeModule","MatCheckboxModule","IgoListModule","IgoCollapsibleModule","IgoImageModule","IgoPanelModule","IgoMatBadgeIconModule","IgoCustomHtmlModule","Validators","ReactiveFormsModule","MatAutocompleteModule","Pipe","SpatialFilterQueryType","SpatialFilterType","SpatialFilterItemType","takeUntil","userAgent","ViewChild","GeometryType","OlGeoJSON","lineString","lineIntersect","OlVectorLayer","OlVectorSource","OlDraw","OlModify","OlSelect","doubleClick","fromEvent","MeasureType","MeasureLengthUnit","MeasureAreaUnit","olGetLength","olGetArea","OlCircle","olGetCenter","OlOverlay","Olstyle","getDistance","MatButtonToggleModule","IgoEntityTableModule","ColorPickerModule","olProj","pointOnFeature","IgoKeyValueModule","IgoFormModule","OlTranslate","OlLinearRing","LayerListToolControlsEnum","StorageScope","Point","GeometryFormFieldComponent","IgoFormFieldComponent","MatSlider","olWKT","FormControl","NestedTreeControl","MatTreeNestedDataSource","SelectionModel","olStyle","EntityStoreFilterSelectionStrategy","EntityTableColumnRenderer","MAT_DATE_LOCALE","MatTabsModule","MatRadioModule","MatTableModule","MatTreeModule","MatOptionModule","MatDatepickerModule","MatNativeDateModule","MatDatetimepickerModule","MatNativeDatetimeModule","IgoEntityModule","downloadContent","strEnum","HttpHeaders","throwError","circular","DragAndDropDirective","InjectionToken","APP_INITIALIZER","IgoSpinnerModule","IgoDrapDropModule","IgoConfirmDialogModule","OverlayAction","olFormatGeoJSON","jspdf","html2canvas","rxMap","saveAs","JSZip","DirectionsFormat","SourceDirectionsType","ProposalType","DirectionType","DirectionRelativePositionType","olGeom","moveItemInArray","olObservable","Clipboard","olInteraction","olCondition","ChangeUtils","DragDropModule","AuthService","LanguageService","StorageService","Injector","fromCircle","getEntityTitleHtml","SearchResultMode","EntityStoreFilterCustomFuncStrategy","IgoStopPropagationModule","IgoFlexibleModule","WidgetService","Workspace","ActionStore","Collection","IgoWidgetModule"],"mappings":"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"}